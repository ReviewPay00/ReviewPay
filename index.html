<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ReviewPay</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Space Grotesk', 'system-ui', 'sans-serif']
            },
            colors: {
              ink: {
                900: '#0b1220',
                800: '#121b2e',
                700: '#1d2740',
                600: '#2a3758'
              },
              glow: {
                400: '#5eead4',
                500: '#38bdf8',
                600: '#6366f1'
              }
            }
          }
        }
      };
    </script>
    <style>
      .sidebar {
        width: 72px;
        transition: width 0.25s ease;
        overflow: hidden;
        padding-left: 12px;
        padding-right: 12px;
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        z-index: 40;
      }

      .sidebar:hover {
        width: 260px;
        padding-left: 16px;
        padding-right: 16px;
      }

      .sidebar-hover-spacer {
        width: 72px;
        transition: width 0.25s ease;
        flex-shrink: 0;
      }

      .sidebar:hover + .sidebar-hover-spacer {
        width: 260px;
      }

      .sidebar .sidebar-text {
        opacity: 0;
        transform: translateX(-8px);
        transition: opacity 0.2s ease, transform 0.2s ease;
        pointer-events: none;
        white-space: nowrap;
        max-width: 0;
        overflow: hidden;
      }

      .sidebar:hover .sidebar-text {
        opacity: 1;
        transform: translateX(0);
        pointer-events: auto;
        max-width: 240px;
      }

      .sidebar .nav-item {
        justify-content: center;
        gap: 0;
      }

      .sidebar:hover .nav-item {
        justify-content: flex-start;
        gap: 12px;
      }

      .sidebar:not(:hover) .sidebar-logo {
        justify-content: center;
        gap: 0;
      }

      .plan-badge {
        position: relative;
        animation: planPulse 2.2s ease-in-out infinite;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .plan-badge:hover {
        transform: translateY(-4px) scale(1.03);
        box-shadow: 0 14px 30px -18px rgba(56, 189, 248, 0.8);
        animation-play-state: paused;
      }

      @keyframes planPulse {
        0% {
          box-shadow: 0 0 0 0 rgba(56, 189, 248, 0.35);
        }
        70% {
          box-shadow: 0 0 0 12px rgba(56, 189, 248, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(56, 189, 248, 0);
        }
      }

      .lever-toggle {
        display: inline-flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        min-width: 106px;
        padding: 4px 6px 4px 12px;
        border-radius: 9999px;
        border: 1px solid rgba(148, 163, 184, 0.35);
        background: rgba(15, 23, 42, 0.55);
        transition: transform 0.18s ease, border-color 0.2s ease, background 0.2s ease, opacity 0.2s ease;
      }

      .lever-toggle:hover {
        transform: translateY(-1px);
      }

      .lever-toggle:disabled {
        opacity: 0.55;
        cursor: not-allowed;
        transform: none;
      }

      .lever-toggle__text {
        font-size: 10px;
        font-weight: 700;
        letter-spacing: 0.14em;
        color: rgba(148, 163, 184, 0.95);
      }

      .lever-toggle__track {
        position: relative;
        display: inline-flex;
        align-items: center;
        width: 44px;
        height: 24px;
        padding: 2px;
        border-radius: 9999px;
        border: 1px solid rgba(148, 163, 184, 0.35);
        background: rgba(30, 41, 59, 0.9);
        transition: border-color 0.2s ease, background 0.2s ease;
      }

      .lever-toggle__thumb {
        width: 18px;
        height: 18px;
        border-radius: 9999px;
        background: linear-gradient(135deg, #cbd5e1, #94a3b8);
        box-shadow: 0 2px 8px rgba(15, 23, 42, 0.55);
        transform: translateX(0);
        transition: transform 0.2s ease, background 0.2s ease;
      }

      .lever-toggle[data-state='on'] {
        border-color: rgba(56, 189, 248, 0.5);
        background: rgba(56, 189, 248, 0.12);
      }

      .lever-toggle[data-state='on'] .lever-toggle__text {
        color: rgb(34 211 238 / 1);
      }

      .lever-toggle[data-state='on'] .lever-toggle__track {
        border-color: rgba(94, 234, 212, 0.6);
        background: rgba(34, 211, 238, 0.3);
      }

      .lever-toggle[data-state='on'] .lever-toggle__thumb {
        transform: translateX(20px);
        background: linear-gradient(135deg, #67e8f9, #06b6d4);
      }

      .nav-item {
        transition: background 0.2s ease, color 0.2s ease, transform 0.2s ease;
      }

      .nav-item:hover {
        transform: translateX(3px);
      }

      .theme-toggle-btn {
        position: relative;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 36px;
        height: 36px;
        border-radius: 9999px;
        border: 1px solid rgba(148, 163, 184, 0.35);
        background: rgba(15, 23, 42, 0.55);
        color: rgba(226, 232, 240, 0.92);
        transition: transform 0.18s ease, border-color 0.2s ease, background 0.2s ease, color 0.2s ease;
      }

      .theme-toggle-btn:hover {
        transform: translateY(-1px);
        border-color: rgba(56, 189, 248, 0.5);
        background: rgba(56, 189, 248, 0.14);
      }

      .theme-toggle-btn .theme-icon {
        position: absolute;
        width: 16px;
        height: 16px;
        transition: opacity 0.2s ease, transform 0.2s ease;
      }

      .theme-toggle-btn[data-mode='dark'] .theme-icon-sun {
        opacity: 1;
        transform: scale(1);
      }

      .theme-toggle-btn[data-mode='dark'] .theme-icon-moon {
        opacity: 0;
        transform: scale(0.6);
      }

      .theme-toggle-btn[data-mode='light'] .theme-icon-sun {
        opacity: 0;
        transform: scale(0.6);
      }

      .theme-toggle-btn[data-mode='light'] .theme-icon-moon {
        opacity: 1;
        transform: scale(1);
      }

      .toast {
        background: linear-gradient(135deg, rgba(30,41,59,0.92), rgba(15,23,42,0.95));
        border: 1px solid rgba(148,163,184,0.2);
        box-shadow: 0 18px 50px -30px rgba(15, 23, 42, 0.85);
        padding: 12px 14px;
        border-radius: 16px;
        display: grid;
        gap: 6px;
        color: #e2e8f0;
        animation: toastIn 0.35s ease forwards;
      }

      .toast-success {
        border-color: rgba(52, 211, 153, 0.4);
      }

      .toast-warning {
        border-color: rgba(250, 204, 21, 0.45);
      }

      .toast-info {
        border-color: rgba(56, 189, 248, 0.4);
      }

      .toast-title {
        font-size: 0.85rem;
        font-weight: 600;
      }

      .toast-message {
        font-size: 0.75rem;
        color: rgba(226, 232, 240, 0.8);
      }

      .toast-exit {
        animation: toastOut 0.35s ease forwards;
      }

      @keyframes toastIn {
        from {
          transform: translateY(-10px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      @keyframes toastOut {
        from {
          transform: translateY(0);
          opacity: 1;
        }
        to {
          transform: translateY(-10px);
          opacity: 0;
        }
      }

      .confetti {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 70;
      }

      .confetti-piece {
        position: absolute;
        width: 8px;
        height: 14px;
        opacity: 0.9;
        animation: confettiFall 1.6s ease forwards;
      }

      @keyframes confettiFall {
        0% {
          transform: translateY(-20px) rotate(0deg);
          opacity: 1;
        }
        100% {
          transform: translateY(120vh) rotate(360deg);
          opacity: 0;
        }
      }

      .privacy-blur {
        filter: blur(6px);
        opacity: 0.35;
      }

      .celebrate {
        animation: screenShake 0.4s ease;
      }

      @keyframes screenShake {
        0% { transform: translateX(0); }
        20% { transform: translateX(-4px); }
        40% { transform: translateX(4px); }
        60% { transform: translateX(-3px); }
        80% { transform: translateX(3px); }
        100% { transform: translateX(0); }
      }

      #appView::before {
        content: '';
        position: absolute;
        inset: 0;
        pointer-events: none;
        opacity: 0.45;
        background-image:
          radial-gradient(circle at 12% 18%, rgba(56, 189, 248, 0.2), transparent 38%),
          radial-gradient(circle at 88% 78%, rgba(20, 184, 166, 0.2), transparent 42%),
          linear-gradient(120deg, rgba(15, 23, 42, 0.7), rgba(11, 18, 32, 0.94));
      }

      body.theme-light {
        color-scheme: light;
        background: #edf4ff;
        color: #0f172a;
      }

      body.theme-light #authView,
      body.theme-light #appView {
        background:
          radial-gradient(circle at 12% 8%, rgba(14, 165, 233, 0.1), transparent 34%),
          radial-gradient(circle at 90% 94%, rgba(59, 130, 246, 0.09), transparent 40%),
          linear-gradient(180deg, #f9fbff 0%, #eef4ff 58%, #e7f0ff 100%);
      }

      body.theme-light #authView > .absolute,
      body.theme-light #appView > .pointer-events-none.absolute {
        opacity: 0.42;
        filter: saturate(0.85);
      }

      body.theme-light #appView::before {
        opacity: 0.11;
        background-image:
          radial-gradient(circle at 12% 18%, rgba(14, 165, 233, 0.24), transparent 42%),
          radial-gradient(circle at 88% 78%, rgba(59, 130, 246, 0.2), transparent 46%);
      }

      body.theme-light main > header {
        background: linear-gradient(
          96deg,
          rgba(255, 255, 255, 0.95),
          rgba(241, 247, 255, 0.92),
          rgba(233, 243, 255, 0.9)
        ) !important;
        border-bottom-color: rgba(15, 23, 42, 0.12) !important;
        box-shadow: 0 20px 42px -32px rgba(37, 99, 235, 0.4) !important;
      }

      body.theme-light .sidebar {
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.96), rgba(247, 251, 255, 0.9)) !important;
        border-color: rgba(15, 23, 42, 0.12) !important;
        box-shadow: 0 24px 48px -36px rgba(15, 23, 42, 0.32);
      }

      body.theme-light .sidebar .sidebar-logo:hover,
      body.theme-light .sidebar .nav-item:hover {
        background: rgba(15, 23, 42, 0.06) !important;
      }

      body.theme-light .sidebar .nav-item {
        color: rgba(15, 23, 42, 0.66) !important;
      }

      body.theme-light .sidebar .nav-item svg {
        color: rgba(15, 23, 42, 0.72) !important;
      }

      body.theme-light .sidebar .nav-item.bg-white\/10 {
        background: rgba(14, 165, 233, 0.16) !important;
        color: #0f172a !important;
        box-shadow: inset 0 0 0 1px rgba(14, 165, 233, 0.2);
      }

      body.theme-light .sidebar .nav-item .bg-white\/5 {
        background: rgba(15, 23, 42, 0.06) !important;
      }

      body.theme-light [class*='bg-ink-900'],
      body.theme-light [class*='bg-ink-800'],
      body.theme-light [class*='bg-ink-700'],
      body.theme-light [class*='bg-ink-600'] {
        background-color: rgba(255, 255, 255, 0.84) !important;
      }

      body.theme-light [class*='from-ink-'],
      body.theme-light [class*='via-ink-'],
      body.theme-light [class*='to-ink-'] {
        --tw-gradient-from: rgba(255, 255, 255, 0.96) var(--tw-gradient-from-position) !important;
        --tw-gradient-via: rgba(241, 247, 255, 0.94) var(--tw-gradient-via-position) !important;
        --tw-gradient-to: rgba(232, 243, 255, 0.9) var(--tw-gradient-to-position) !important;
      }

      body.theme-light .rounded-\[32px\],
      body.theme-light .rounded-\[30px\],
      body.theme-light .rounded-3xl {
        box-shadow: 0 18px 40px -32px rgba(15, 23, 42, 0.3);
      }

      body.theme-light .rounded-\[32px\] {
        background:
          radial-gradient(circle at 10% 18%, rgba(14, 165, 233, 0.1), transparent 42%),
          linear-gradient(150deg, rgba(255, 255, 255, 0.95), rgba(242, 248, 255, 0.92)) !important;
        border-color: rgba(15, 23, 42, 0.14) !important;
      }

      body.theme-light .border-white\/10 {
        border-color: rgba(15, 23, 42, 0.14) !important;
      }

      body.theme-light .border-white\/20 {
        border-color: rgba(15, 23, 42, 0.2) !important;
      }

      body.theme-light .bg-white\/5 {
        background-color: rgba(15, 23, 42, 0.05) !important;
      }

      body.theme-light .bg-white\/10 {
        background-color: rgba(15, 23, 42, 0.08) !important;
      }

      body.theme-light .text-white {
        color: #0f172a !important;
      }

      body.theme-light .text-white\/90 {
        color: rgba(15, 23, 42, 0.9) !important;
      }

      body.theme-light .text-white\/80 {
        color: rgba(15, 23, 42, 0.82) !important;
      }

      body.theme-light .text-white\/70 {
        color: rgba(15, 23, 42, 0.72) !important;
      }

      body.theme-light .text-white\/60 {
        color: rgba(15, 23, 42, 0.62) !important;
      }

      body.theme-light .text-white\/50 {
        color: rgba(15, 23, 42, 0.54) !important;
      }

      body.theme-light .text-white\/40 {
        color: rgba(15, 23, 42, 0.46) !important;
      }

      body.theme-light .plan-badge {
        border-color: rgba(14, 165, 233, 0.36) !important;
        background: linear-gradient(120deg, rgba(14, 165, 233, 0.16), rgba(59, 130, 246, 0.14)) !important;
        color: #0369a1 !important;
        box-shadow: 0 14px 26px -20px rgba(14, 165, 233, 0.46);
      }

      body.theme-light input,
      body.theme-light textarea,
      body.theme-light select {
        background: rgba(255, 255, 255, 0.94) !important;
        border-color: rgba(15, 23, 42, 0.16) !important;
        color: #0f172a !important;
      }

      body.theme-light input::placeholder,
      body.theme-light textarea::placeholder {
        color: rgba(15, 23, 42, 0.4) !important;
      }

      body.theme-light .toast {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.97), rgba(243, 248, 255, 0.98));
        border-color: rgba(15, 23, 42, 0.14);
        color: #0f172a;
        box-shadow: 0 20px 42px -32px rgba(37, 99, 235, 0.28);
      }

      body.theme-light .toast-message {
        color: rgba(15, 23, 42, 0.72);
      }

      body.theme-light .support-bubble {
        box-shadow: 0 16px 30px -24px rgba(15, 23, 42, 0.25);
      }

      body.theme-light .support-bubble-assistant {
        background: linear-gradient(140deg, rgba(255, 255, 255, 0.98), rgba(233, 244, 255, 0.9));
        border-color: rgba(59, 130, 246, 0.26);
        color: #0f172a;
      }

      body.theme-light .support-bubble-user {
        background: linear-gradient(140deg, rgba(14, 165, 233, 0.2), rgba(59, 130, 246, 0.2));
        border-color: rgba(14, 165, 233, 0.34);
        color: #082f49;
      }

      body.theme-light .support-meta {
        color: rgba(15, 23, 42, 0.52);
      }

      body.theme-light .support-avatar-assistant {
        border-color: rgba(59, 130, 246, 0.32);
        background: rgba(219, 234, 254, 0.82);
        color: rgba(30, 64, 175, 0.95);
      }

      body.theme-light .support-avatar-user {
        border-color: rgba(14, 165, 233, 0.32);
        background: rgba(224, 242, 254, 0.86);
        color: rgba(12, 74, 110, 0.95);
      }

      body.theme-light .support-typing {
        border-color: rgba(59, 130, 246, 0.24);
        background: rgba(224, 242, 254, 0.76);
        color: rgba(7, 89, 133, 0.94);
      }

      body.theme-light .support-dots i {
        background: rgba(7, 89, 133, 0.78);
      }

      body.theme-light .market-popup-shell {
        background:
          radial-gradient(circle at 12% 18%, rgba(14, 165, 233, 0.12), transparent 42%),
          linear-gradient(160deg, rgba(255, 255, 255, 0.98), rgba(241, 247, 255, 0.96));
        border-color: rgba(15, 23, 42, 0.16) !important;
        box-shadow: 0 32px 72px -44px rgba(37, 99, 235, 0.44);
      }

      body.theme-light .tutorial-popup-shell {
        background:
          radial-gradient(circle at 14% 12%, rgba(14, 165, 233, 0.14), transparent 44%),
          linear-gradient(160deg, rgba(255, 255, 255, 0.99), rgba(241, 247, 255, 0.97));
        border-color: rgba(15, 23, 42, 0.16) !important;
        box-shadow: 0 34px 78px -44px rgba(37, 99, 235, 0.46);
      }

      body.theme-light .market-popup-item {
        border-color: rgba(15, 23, 42, 0.15);
        background: rgba(255, 255, 255, 0.84);
      }

      body.theme-light .market-popup-item:hover {
        border-color: rgba(14, 165, 233, 0.4);
        background: rgba(239, 247, 255, 0.96);
      }

      body.theme-light .market-future-btn {
        border-color: rgba(14, 165, 233, 0.45);
        background: linear-gradient(140deg, rgba(14, 165, 233, 0.2), rgba(59, 130, 246, 0.2));
        color: #075985;
        box-shadow:
          0 16px 26px -20px rgba(14, 165, 233, 0.56),
          inset 0 1px 0 rgba(255, 255, 255, 0.4);
      }

      body.theme-light .market-future-btn-ghost {
        border-color: rgba(15, 23, 42, 0.2);
        background: rgba(255, 255, 255, 0.7);
        color: rgba(15, 23, 42, 0.78);
      }

      body.theme-light .market-future-btn-ghost:hover {
        border-color: rgba(14, 165, 233, 0.44);
        background: rgba(224, 242, 254, 0.9);
      }

      body.theme-light .level-shell {
        background:
          radial-gradient(circle at 14% 16%, rgba(14, 165, 233, 0.14), transparent 44%),
          radial-gradient(circle at 86% 82%, rgba(16, 185, 129, 0.12), transparent 50%),
          linear-gradient(150deg, rgba(255, 255, 255, 0.95), rgba(240, 248, 255, 0.92));
      }

      body.theme-light .level-badge {
        border-color: rgba(14, 165, 233, 0.32);
        background: rgba(224, 242, 254, 0.72);
        color: rgba(7, 89, 133, 0.9);
      }

      body.theme-light .ai-level-progress-track {
        background: rgba(226, 232, 240, 0.7);
        border-color: rgba(15, 23, 42, 0.14);
      }

      body.theme-light .ai-robot-float {
        border-color: rgba(14, 165, 233, 0.35);
        background: linear-gradient(140deg, rgba(255, 255, 255, 0.96), rgba(240, 247, 255, 0.92));
        box-shadow: 0 24px 44px -34px rgba(37, 99, 235, 0.5);
      }

      body.theme-light .ai-robot-float__button {
        border-color: rgba(14, 165, 233, 0.34);
        background: rgba(14, 165, 233, 0.12);
        color: #075985;
      }

      body.theme-light .ai-robot-float__track {
        border-color: rgba(15, 23, 42, 0.14);
        background: rgba(226, 232, 240, 0.72);
      }

      body.theme-light .robot-action {
        border-color: rgba(14, 165, 233, 0.42);
        background: linear-gradient(135deg, rgba(14, 165, 233, 0.16), rgba(59, 130, 246, 0.14));
        color: #0369a1;
      }

      body.theme-light .theme-toggle-btn {
        background: rgba(255, 255, 255, 0.9);
        border-color: rgba(15, 23, 42, 0.2);
        color: rgba(15, 23, 42, 0.82);
      }

      body.theme-light .theme-toggle-btn:hover {
        border-color: rgba(14, 165, 233, 0.45);
        background: rgba(14, 165, 233, 0.12);
      }

      body.theme-light .lever-toggle {
        border-color: rgba(15, 23, 42, 0.2);
        background: rgba(255, 255, 255, 0.74);
      }

      body.theme-light .lever-toggle__text {
        color: rgba(15, 23, 42, 0.64);
      }

      body.theme-light .lever-toggle__track {
        border-color: rgba(15, 23, 42, 0.22);
        background: rgba(226, 232, 240, 0.82);
      }

      body.theme-light .lever-toggle__thumb {
        background: linear-gradient(135deg, #ffffff, #cbd5e1);
      }

      body.theme-light .lever-toggle[data-state='on'] {
        border-color: rgba(14, 165, 233, 0.42);
        background: rgba(14, 165, 233, 0.12);
      }

      body.theme-light .lever-toggle[data-state='on'] .lever-toggle__text {
        color: rgba(7, 89, 133, 0.95);
      }

      body.theme-light .lever-toggle[data-state='on'] .lever-toggle__track {
        border-color: rgba(14, 165, 233, 0.48);
        background: rgba(186, 230, 253, 0.92);
      }

      body.theme-light .lever-toggle[data-state='on'] .lever-toggle__thumb {
        background: linear-gradient(135deg, #38bdf8, #0ea5e9);
      }

      body.theme-light button.border-white\/10.bg-white\/5 {
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.94), rgba(241, 247, 255, 0.92)) !important;
        border-color: rgba(15, 23, 42, 0.16) !important;
        box-shadow: 0 10px 20px -18px rgba(37, 99, 235, 0.34);
      }

      body.theme-light button.border-white\/10.bg-white\/5:hover {
        border-color: rgba(14, 165, 233, 0.34) !important;
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.98), rgba(234, 244, 255, 0.94)) !important;
      }

      body.theme-light .surface-card::after {
        background: linear-gradient(120deg, transparent 22%, rgba(14, 165, 233, 0.08) 50%, transparent 78%);
      }

      body.theme-light .surface-card:hover {
        border-color: rgba(14, 165, 233, 0.3);
        box-shadow: 0 22px 40px -30px rgba(37, 99, 235, 0.36);
      }

      .surface-card {
        position: relative;
        overflow: hidden;
        transition: transform 0.28s ease, box-shadow 0.28s ease, border-color 0.28s ease;
      }

      .surface-card::after {
        content: '';
        position: absolute;
        inset: 0;
        pointer-events: none;
        background: linear-gradient(120deg, transparent 18%, rgba(255, 255, 255, 0.09) 50%, transparent 82%);
        transform: translateX(-120%);
        transition: transform 0.48s ease;
      }

      .surface-card:hover {
        transform: translateY(-4px);
        border-color: rgba(94, 234, 212, 0.34);
        box-shadow: 0 22px 52px -34px rgba(56, 189, 248, 0.65);
      }

      .surface-card:hover::after {
        transform: translateX(120%);
      }

      .section-enter {
        animation: sectionEnter 0.38s ease;
      }

      @keyframes sectionEnter {
        from {
          opacity: 0;
          transform: translateY(14px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .reveal-item {
        opacity: 0;
        transform: translateY(16px);
        transition: opacity 0.44s ease, transform 0.44s ease;
        transition-delay: var(--reveal-delay, 0ms);
      }

      .reveal-item.reveal-visible {
        opacity: 1;
        transform: translateY(0);
      }

      .value-pop {
        animation: valuePop 0.34s ease;
      }

      @keyframes valuePop {
        0% {
          opacity: 0.72;
          transform: translateY(4px);
        }
        70% {
          opacity: 1;
          transform: translateY(0);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }

      #reportCustomDateWrap {
        align-items: end;
      }

      .robot-action {
        position: relative;
        border: 1px solid rgba(94, 234, 212, 0.4);
        background: linear-gradient(135deg, rgba(56, 189, 248, 0.18), rgba(20, 184, 166, 0.14));
        color: #99f6e4;
        box-shadow: 0 0 0 0 rgba(56, 189, 248, 0.4);
        animation: robotPulse 2.2s ease-in-out infinite;
      }

      .robot-action:hover {
        background: linear-gradient(135deg, rgba(56, 189, 248, 0.28), rgba(20, 184, 166, 0.22));
        transform: translateY(-1px);
      }

      @keyframes robotPulse {
        0% {
          box-shadow: 0 0 0 0 rgba(56, 189, 248, 0.35);
        }
        75% {
          box-shadow: 0 0 0 10px rgba(56, 189, 248, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(56, 189, 248, 0);
        }
      }

      .ai-level-progress-track {
        position: relative;
        height: 10px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.75);
        border: 1px solid rgba(148, 163, 184, 0.2);
        overflow: hidden;
      }

      .ai-level-progress-fill {
        position: absolute;
        inset: 0 auto 0 0;
        width: 0%;
        border-radius: 999px;
        background: linear-gradient(90deg, rgba(56, 189, 248, 0.95), rgba(45, 212, 191, 0.95));
        transition: width 0.25s ease;
      }

      .ai-robot-float {
        position: fixed;
        right: 16px;
        bottom: 16px;
        z-index: 68;
        width: min(270px, calc(100vw - 24px));
        border-radius: 16px;
        border: 1px solid rgba(94, 234, 212, 0.35);
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.95), rgba(30, 41, 59, 0.92));
        box-shadow: 0 24px 48px -36px rgba(56, 189, 248, 0.7);
        padding: 10px;
        display: grid;
        gap: 8px;
        backdrop-filter: blur(8px);
      }

      .ai-robot-float__button {
        border-radius: 999px;
        border: 1px solid rgba(94, 234, 212, 0.35);
        background: rgba(56, 189, 248, 0.14);
        color: #99f6e4;
        font-size: 0.7rem;
        font-weight: 700;
        padding: 7px 12px;
        transition: background 0.2s ease, transform 0.2s ease;
      }

      .ai-robot-float__button:hover {
        background: rgba(56, 189, 248, 0.24);
        transform: translateY(-1px);
      }

      .ai-robot-float__track {
        height: 8px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.24);
        background: rgba(15, 23, 42, 0.72);
        overflow: hidden;
      }

      .ai-robot-float__fill {
        height: 100%;
        width: 0%;
        border-radius: 999px;
        background: linear-gradient(90deg, rgba(20, 184, 166, 0.95), rgba(56, 189, 248, 0.95));
        transition: width 0.25s ease;
      }

      .level-shell {
        background:
          radial-gradient(circle at 14% 16%, rgba(56, 189, 248, 0.16), transparent 42%),
          radial-gradient(circle at 86% 82%, rgba(20, 184, 166, 0.14), transparent 46%),
          linear-gradient(140deg, rgba(15, 23, 42, 0.9), rgba(17, 24, 39, 0.92));
      }

      .level-badge {
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.3);
        background: rgba(15, 23, 42, 0.62);
        padding: 4px 10px;
        font-size: 10px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: rgba(226, 232, 240, 0.85);
      }

      @media (max-width: 768px) {
        .ai-robot-float {
          right: 10px;
          bottom: 10px;
          width: calc(100vw - 20px);
        }
      }

      .support-chat-scroll {
        max-height: 360px;
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: rgba(148, 163, 184, 0.45) transparent;
      }

      .support-chat-scroll::-webkit-scrollbar {
        width: 8px;
      }

      .support-chat-scroll::-webkit-scrollbar-track {
        background: transparent;
      }

      .support-chat-scroll::-webkit-scrollbar-thumb {
        background: rgba(148, 163, 184, 0.45);
        border-radius: 999px;
      }

      .support-bubble {
        border-radius: 16px;
        border: 1px solid rgba(148, 163, 184, 0.2);
        padding: 10px 12px;
        font-size: 0.82rem;
        line-height: 1.4;
        box-shadow: 0 14px 30px -22px rgba(8, 47, 73, 0.75);
      }

      .support-bubble-user {
        background: linear-gradient(145deg, rgba(56, 189, 248, 0.2), rgba(14, 165, 233, 0.12));
        border-color: rgba(56, 189, 248, 0.35);
        color: #e0f2fe;
      }

      .support-bubble-assistant {
        background: linear-gradient(145deg, rgba(15, 23, 42, 0.88), rgba(30, 41, 59, 0.74));
        border-color: rgba(148, 163, 184, 0.25);
        color: rgba(226, 232, 240, 0.95);
      }

      .support-row {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 10px;
        align-items: start;
        animation: supportMessageIn 0.24s ease;
      }

      .support-row-user {
        grid-template-columns: 1fr auto;
      }

      .support-avatar {
        height: 30px;
        width: 30px;
        border-radius: 999px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 0.6rem;
        font-weight: 700;
        letter-spacing: 0.06em;
      }

      .support-avatar-assistant {
        border: 1px solid rgba(56, 189, 248, 0.34);
        background: rgba(8, 47, 73, 0.6);
        color: rgba(125, 211, 252, 0.96);
      }

      .support-avatar-user {
        border: 1px solid rgba(34, 197, 94, 0.34);
        background: rgba(20, 83, 45, 0.48);
        color: rgba(187, 247, 208, 0.95);
      }

      .support-content {
        display: grid;
        gap: 4px;
      }

      .support-meta {
        font-size: 10px;
        color: rgba(226, 232, 240, 0.52);
      }

      .support-row-user .support-content {
        justify-items: end;
      }

      .support-typing {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        border-radius: 999px;
        border: 1px solid rgba(56, 189, 248, 0.25);
        background: rgba(8, 47, 73, 0.34);
        padding: 6px 10px;
        font-size: 11px;
        color: rgba(125, 211, 252, 0.92);
      }

      .support-dots {
        display: inline-flex;
        gap: 4px;
      }

      .support-dots i {
        width: 5px;
        height: 5px;
        border-radius: 999px;
        background: rgba(125, 211, 252, 0.9);
        animation: supportTypingPulse 1.05s infinite ease-in-out;
      }

      .support-dots i:nth-child(2) {
        animation-delay: 0.16s;
      }

      .support-dots i:nth-child(3) {
        animation-delay: 0.32s;
      }

      .market-popup-shell {
        background:
          radial-gradient(circle at 12% 18%, rgba(56, 189, 248, 0.14), transparent 42%),
          radial-gradient(circle at 88% 84%, rgba(16, 185, 129, 0.1), transparent 46%),
          linear-gradient(150deg, rgba(15, 23, 42, 0.96), rgba(17, 24, 39, 0.95));
        box-shadow: 0 30px 80px -42px rgba(8, 47, 73, 0.95);
      }

      .tutorial-popup-shell {
        background:
          radial-gradient(circle at 12% 18%, rgba(56, 189, 248, 0.12), transparent 44%),
          radial-gradient(circle at 88% 84%, rgba(16, 185, 129, 0.08), transparent 48%),
          linear-gradient(155deg, rgba(15, 23, 42, 0.97), rgba(17, 24, 39, 0.96));
        box-shadow: 0 34px 86px -48px rgba(8, 47, 73, 0.95);
      }

      .market-future-btn {
        border-radius: 999px;
        border: 1px solid rgba(56, 189, 248, 0.45);
        background: linear-gradient(140deg, rgba(14, 165, 233, 0.26), rgba(30, 64, 175, 0.24));
        color: rgba(224, 242, 254, 0.98);
        box-shadow:
          0 14px 28px -20px rgba(56, 189, 248, 0.95),
          inset 0 1px 0 rgba(255, 255, 255, 0.2);
        transition: transform 0.2s ease, box-shadow 0.2s ease, filter 0.2s ease;
      }

      .market-future-btn:hover {
        transform: translateY(-1px);
        filter: brightness(1.08);
        box-shadow:
          0 20px 34px -22px rgba(56, 189, 248, 0.95),
          inset 0 1px 0 rgba(255, 255, 255, 0.25);
      }

      .market-future-btn-ghost {
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.35);
        background: rgba(30, 41, 59, 0.55);
        color: rgba(226, 232, 240, 0.9);
        transition: background 0.2s ease, border-color 0.2s ease, transform 0.2s ease;
      }

      .market-future-btn-ghost:hover {
        transform: translateY(-1px);
        border-color: rgba(56, 189, 248, 0.5);
        background: rgba(30, 58, 138, 0.36);
      }

      .market-popup-item {
        border-radius: 14px;
        border: 1px solid rgba(148, 163, 184, 0.24);
        background: linear-gradient(140deg, rgba(30, 41, 59, 0.72), rgba(15, 23, 42, 0.68));
        transition: border-color 0.2s ease, background 0.2s ease, transform 0.2s ease;
      }

      .market-popup-item:hover {
        transform: translateY(-1px);
        border-color: rgba(56, 189, 248, 0.45);
        background: linear-gradient(140deg, rgba(30, 58, 138, 0.44), rgba(15, 23, 42, 0.76));
      }

      @keyframes supportTypingPulse {
        0%, 80%, 100% {
          transform: scale(0.72);
          opacity: 0.5;
        }
        40% {
          transform: scale(1);
          opacity: 1;
        }
      }

      @keyframes supportMessageIn {
        from {
          opacity: 0;
          transform: translateY(6px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @media (prefers-reduced-motion: reduce) {
        *, *::before, *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
          scroll-behavior: auto !important;
        }

        .reveal-item {
          opacity: 1 !important;
          transform: none !important;
        }
      }
    </style>
  </head>
  <body class="bg-ink-900 text-white">
    <div id="authView" class="min-h-screen">
      <div class="absolute inset-0 overflow-hidden">
        <div class="absolute -top-40 -left-32 h-96 w-96 rounded-full bg-glow-600/20 blur-[120px]"></div>
        <div class="absolute bottom-0 right-0 h-96 w-96 rounded-full bg-glow-500/20 blur-[140px]"></div>
      </div>

      <div class="relative mx-auto flex min-h-screen max-w-6xl flex-col gap-12 px-6 py-12 lg:flex-row lg:items-center">
        <section class="flex-1 space-y-6">
          <div class="inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-4 py-2 text-sm text-white/80">
            <span class="h-2 w-2 rounded-full bg-glow-400"></span>
            Plataforma de feedback inteligente
          </div>
          <h1 class="text-4xl font-semibold leading-tight md:text-5xl">
            ReviewPay centraliza decisões, feedbacks e operações em um painel simples.
          </h1>
          <p class="text-lg text-white/70">
            Acompanhe a evolução do seu SaaS com um painel moderno, rápido e feito para o dia a dia do time.
          </p>
          <div class="grid gap-4 md:grid-cols-2">
            <div class="rounded-2xl border border-white/10 bg-white/5 p-4">
              <h3 class="text-base font-medium">Seguro e confiável</h3>
              <p class="text-sm text-white/70">Autenticação simples e controle centralizado.</p>
            </div>
            <div class="rounded-2xl border border-white/10 bg-white/5 p-4">
              <h3 class="text-base font-medium">Rápido e elegante</h3>
              <p class="text-sm text-white/70">Interface limpa para operar sem distrações.</p>
            </div>
          </div>
          <div class="flex flex-wrap gap-3 text-xs text-white/60">
            <span class="rounded-full border border-white/10 px-3 py-1">Fluxo inteligente</span>
            <span class="rounded-full border border-white/10 px-3 py-1">Painel em tempo real</span>
            <span class="rounded-full border border-white/10 px-3 py-1">Operação contínua</span>
          </div>
        </section>

        <section class="flex w-full max-w-md flex-col gap-6 rounded-3xl border border-white/10 bg-ink-800/80 p-6 shadow-xl backdrop-blur">
          <div>
            <h2 class="text-2xl font-semibold">Acessar painel</h2>
            <p class="text-sm text-white/70">Digite a senha de acesso para entrar na plataforma.</p>
          </div>

          <form id="loginForm" class="grid gap-3">
            <h3 class="text-sm font-medium uppercase tracking-wide text-white/60">Acesso rápido</h3>
            <input
              class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white placeholder:text-white/40"
              type="password"
              name="password"
              placeholder=""
              required
            />
            <button
              class="rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm font-semibold text-white transition hover:bg-white/10"
              type="submit"
            >
              Entrar
            </button>
          </form>

          <p id="authMessage" class="text-sm text-rose-400"></p>
        </section>
      </div>
    </div>
    <div id="appView" class="relative hidden min-h-screen bg-ink-900">
      <div class="pointer-events-none absolute inset-0 overflow-hidden">
        <div class="absolute -top-32 right-10 h-72 w-72 rounded-full bg-glow-600/15 blur-[130px]"></div>
        <div class="absolute bottom-0 left-0 h-80 w-80 rounded-full bg-glow-500/10 blur-[150px]"></div>
      </div>
      <div class="relative flex min-h-screen">
        <aside class="sidebar hidden flex-col border-r border-white/10 bg-ink-800/60 py-8 lg:flex">
          <button
            id="sidebarGeneralButton"
            type="button"
            class="sidebar-logo group flex items-center gap-3 rounded-2xl px-2 py-1 text-left transition hover:bg-white/5"
            title="Abrir Geral da conta"
          >
            <span class="flex h-11 w-11 items-center justify-center rounded-2xl bg-gradient-to-br from-glow-400/90 via-glow-500/85 to-glow-700/80 text-ink-900 shadow-[0_12px_30px_-14px_rgba(56,189,248,0.8)]">
              <svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 2.8l7 4.3v5.6c0 4-2.8 7.5-7 8.6-4.2-1.1-7-4.6-7-8.6V7.1L12 2.8z" />
                <path stroke-linecap="round" stroke-linejoin="round" d="m8.6 11.9 2.2 2.1 4.6-4.6" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M7.2 5.8 12 8.7l4.8-2.9" />
              </svg>
            </span>
            <span>
              <span class="sidebar-text block text-lg font-semibold">ReviewPay</span>
              <span class="sidebar-text block text-xs text-white/50">Conta e identidade</span>
            </span>
          </button>
          <nav class="mt-6 flex flex-1 flex-col gap-1 text-sm">
            <button
              type="button"
              data-section-target="dashboard"
              class="nav-item flex items-center gap-3 rounded-xl bg-white/10 px-3 py-2 text-white transition"
            >
              <span class="flex h-8 w-8 items-center justify-center rounded-lg bg-white/5">
                <svg class="h-5 w-5 text-white/80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M3 10.5L12 3l9 7.5v9a1.5 1.5 0 01-1.5 1.5H4.5A1.5 1.5 0 013 19.5v-9z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 21V12h6v9" />
                </svg>
              </span>
              <span class="sidebar-text">Principal</span>
            </button>
            <button
              type="button"
              data-section-target="reviews"
              class="nav-item flex items-center gap-3 rounded-xl px-3 py-2 text-white/60 transition hover:bg-white/5"
            >
              <span class="flex h-8 w-8 items-center justify-center rounded-lg bg-white/5">
                <svg class="h-5 w-5 text-white/80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 5h6a2 2 0 012 2v12a2 2 0 01-2 2H9a2 2 0 01-2-2V7a2 2 0 012-2z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 5V3h6v2" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M8 11h8M8 15h5" />
                </svg>
              </span>
              <span class="sidebar-text">Avaliações</span>
            </button>
            <button
              type="button"
              data-section-target="financeiro"
              class="nav-item flex items-center gap-3 rounded-xl px-3 py-2 text-white/60 transition hover:bg-white/5"
            >
              <span class="flex h-8 w-8 items-center justify-center rounded-lg bg-white/5">
                <svg class="h-5 w-5 text-white/80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v18" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 7.5c0-1.933-1.79-3.5-4-3.5s-4 1.567-4 3.5 1.79 3.5 4 3.5 4 1.567 4 3.5-1.79 3.5-4 3.5-4-1.567-4-3.5" />
                </svg>
              </span>
              <span class="sidebar-text">Financeiro</span>
            </button>
            <button
              type="button"
              data-section-target="ferramentas"
              class="nav-item flex items-center gap-3 rounded-xl px-3 py-2 text-white/60 transition hover:bg-white/5"
            >
              <span class="flex h-8 w-8 items-center justify-center rounded-lg bg-white/5">
                <svg class="h-5 w-5 text-white/80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83" />
                  <circle cx="12" cy="12" r="3.5" stroke-linecap="round" stroke-linejoin="round"></circle>
                </svg>
              </span>
              <span class="sidebar-text">Ferramentas</span>
            </button>
            <button
              type="button"
              data-section-target="niveis"
              class="nav-item flex items-center gap-3 rounded-xl px-3 py-2 text-white/60 transition hover:bg-white/5"
            >
              <span class="flex h-8 w-8 items-center justify-center rounded-lg bg-white/5">
                <svg class="h-5 w-5 text-white/80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M3 9l4-4h10l4 4-9 10-9-10z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M7 5l5 14 5-14" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M3 9h18" />
                </svg>
              </span>
              <span class="sidebar-text">Níveis</span>
            </button>
            <button
              type="button"
              data-section-target="produtos"
              class="nav-item flex items-center gap-3 rounded-xl px-3 py-2 text-white/60 transition hover:bg-white/5"
            >
              <span class="flex h-8 w-8 items-center justify-center rounded-lg bg-white/5">
                <svg class="h-5 w-5 text-white/80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4 7l8-4 8 4-8 4-8-4z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4 7v10l8 4 8-4V7" />
                </svg>
              </span>
              <span class="sidebar-text">Produtos</span>
            </button>
            <button
              type="button"
              data-section-target="integracoes"
              class="nav-item flex items-center gap-3 rounded-xl px-3 py-2 text-white/60 transition hover:bg-white/5"
            >
              <span class="flex h-8 w-8 items-center justify-center rounded-lg bg-white/5">
                <svg class="h-5 w-5 text-white/80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M10 14a4 4 0 010-8h3" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M14 10a4 4 0 010 8h-3" />
                </svg>
              </span>
              <span class="sidebar-text">Integrações</span>
            </button>
            <button
              type="button"
              data-section-target="informacao"
              class="nav-item flex items-center gap-3 rounded-xl px-3 py-2 text-white/60 transition hover:bg-white/5"
            >
              <span class="flex h-8 w-8 items-center justify-center rounded-lg bg-white/5">
                <svg class="h-5 w-5 text-white/80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                  <circle cx="12" cy="12" r="9"></circle>
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 9h.01"></path>
                  <path stroke-linecap="round" stroke-linejoin="round" d="M11 12h1v4h1"></path>
                </svg>
              </span>
              <span class="sidebar-text">Informação</span>
            </button>
            <button
              type="button"
              data-section-target="suporte"
              class="nav-item flex items-center gap-3 rounded-xl px-3 py-2 text-white/60 transition hover:bg-white/5"
            >
              <span class="flex h-8 w-8 items-center justify-center rounded-lg bg-white/5">
                <svg class="h-5 w-5 text-white/80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4 13v-2a8 8 0 0116 0v2" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4 13a3 3 0 003 3h1v-6H7a3 3 0 00-3 3zM20 13a3 3 0 01-3 3h-1v-6h1a3 3 0 013 3z" />
                </svg>
              </span>
              <span class="sidebar-text">Suporte</span>
            </button>
          </nav>
        </aside>

        <div class="sidebar-hover-spacer hidden lg:block"></div>
        <main class="flex-1">
          <header class="flex flex-wrap items-center justify-between gap-4 border-b border-white/10 bg-gradient-to-r from-ink-800/90 via-ink-900/95 to-ink-800/90 px-6 py-6 backdrop-blur shadow-[0_20px_50px_-30px_rgba(15,23,42,0.8)]">
            <div>
              <h2 class="text-2xl font-semibold">Bem-vindo ao ReviewPay</h2>
            </div>
            <div class="flex flex-wrap items-center gap-3">
              <div class="plan-badge rounded-full border border-glow-500/40 bg-gradient-to-r from-glow-500/20 to-glow-600/20 px-4 py-2 text-xs font-semibold uppercase tracking-wide text-glow-400">
                Plano vitalicio
              </div>
              <a
                href="https://reviewpay00.github.io/ReviewPay-vitalicio/"
                class="plan-badge rounded-full border border-glow-500/40 bg-gradient-to-r from-glow-500/20 to-glow-600/20 px-4 py-2 text-xs font-semibold uppercase tracking-wide text-glow-400"
              >
                Ver Planos
              </a>
              <div class="rounded-2xl border border-white/10 bg-ink-900/70 px-4 py-2">
                <div class="flex items-center justify-between gap-2">
                  <p class="text-xs text-white/60">Carteira</p>
                  <button
                    id="walletVisibilityToggle"
                    type="button"
                    class="flex h-7 w-7 items-center justify-center rounded-full border border-white/10 bg-white/5 text-white/60 transition hover:bg-white/10 hover:text-white"
                    aria-pressed="false"
                  >
                    <span id="walletVisibilityLabel" class="sr-only">Ocultar valores</span>
                    <svg
                      id="walletEyeOn"
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="1.5"
                      class="h-4 w-4"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7Z"
                      />
                      <circle cx="12" cy="12" r="3" />
                    </svg>
                    <svg
                      id="walletEyeOff"
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="1.5"
                      class="hidden h-4 w-4"
                    >
                      <path stroke-linecap="round" stroke-linejoin="round" d="M3 3l18 18" />
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M10.5 6.5A8.9 8.9 0 0 1 12 6c4.477 0 8.268 2.943 9.542 7a12.6 12.6 0 0 1-2.64 4.15M6.25 6.25A12.6 12.6 0 0 0 2.458 12c1.274 4.057 5.065 7 9.542 7 1.7 0 3.3-.42 4.71-1.16"
                      />
                      <path stroke-linecap="round" stroke-linejoin="round" d="M9.9 9.9a3 3 0 0 0 4.2 4.2" />
                    </svg>
                  </button>
                </div>
                <p class="text-lg font-semibold" id="walletBalance">R$ 0,00</p>
              </div>
              <span id="connectionStatus" class="hidden">Conectado</span>
              <button
                id="themeToggleButton"
                type="button"
                class="theme-toggle-btn"
                aria-pressed="false"
                title="Ativar modo dia"
              >
                <span id="themeToggleLabel" class="sr-only">Ativar modo dia</span>
                <svg
                  id="themeSunIcon"
                  class="theme-icon theme-icon-sun"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.8"
                  aria-hidden="true"
                >
                  <circle cx="12" cy="12" r="4.5"></circle>
                  <path stroke-linecap="round" d="M12 2.5v2.5M12 19v2.5M4.5 12H2m20 0h-2.5M5.64 5.64l1.77 1.77m8.18 8.18 1.77 1.77m0-11.72-1.77 1.77M7.41 16.59l-1.77 1.77"></path>
                </svg>
                <svg
                  id="themeMoonIcon"
                  class="theme-icon theme-icon-moon"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.8"
                  aria-hidden="true"
                >
                  <path stroke-linecap="round" stroke-linejoin="round" d="M20.5 14.8a8.5 8.5 0 1 1-11.3-11.3 7.2 7.2 0 0 0 11.3 11.3Z"></path>
                </svg>
              </button>
              <button
                id="logoutButton"
                class="rounded-xl border border-white/10 bg-white/5 px-4 py-2 text-sm font-medium text-white/80 transition hover:bg-white/10"
                type="button"
              >
                Sair
              </button>
            </div>
          </header>

          <div class="px-6 py-8">
            <section id="section-dashboard" data-section="dashboard" class="space-y-6">
              <div class="rounded-[32px] border border-white/10 bg-gradient-to-br from-ink-800/90 via-ink-900/95 to-ink-800/80 p-6 shadow-[0_25px_70px_-35px_rgba(56,189,248,0.6)]">
                <div class="flex flex-wrap items-center justify-between gap-3">
                  <div>
                    <h3 class="text-xl font-semibold">Central VIP BLACK</h3>
                    <p class="text-sm text-white/60">Operação premium com decisões rápidas e feedbacks confiáveis.</p>
                  </div>
                  <button class="rounded-full border border-white/10 bg-white/5 px-4 py-2 text-xs text-white/70 hover:bg-white/10">Falar com suporte</button>
                </div>
                <div class="mt-4 grid gap-3 md:grid-cols-3">
                  <div class="rounded-2xl border border-white/10 bg-white/5 p-4 backdrop-blur">
                    <p class="text-xs text-white/60">Status da operação</p>
                    <p class="text-lg font-semibold" id="modeText">Operação contínua</p>
                  </div>
                  <div class="rounded-2xl border border-white/10 bg-white/5 p-4 backdrop-blur">
                    <p class="text-xs text-white/60">Saldo disponível</p>
                    <p class="text-lg font-semibold" id="walletBalanceInline">R$ 0,00</p>
                  </div>
                  <div class="rounded-2xl border border-white/10 bg-white/5 p-4 backdrop-blur">
                    <p class="text-xs text-white/60">Avaliações ativas</p>
                    <p class="text-lg font-semibold" id="statActiveReviews">0</p>
                  </div>
                </div>
              </div>

              <div class="grid gap-6 lg:grid-cols-3">
                <section class="lg:col-span-2 space-y-6">
                  <div class="rounded-3xl border border-white/10 bg-white p-6 text-ink-900 shadow-lg">
                    <div class="flex flex-wrap items-center justify-between gap-3">
                      <h3 class="text-xl font-semibold">Centro de controle</h3>
                      <span class="rounded-full bg-emerald-100 px-3 py-1 text-xs font-semibold text-emerald-700">Operação</span>
                    </div>
                    <p class="mt-2 text-sm text-slate-600">
                      Seu painel central para manter o time alinhado e as decisões registradas com clareza.
                    </p>
                    <div class="mt-4 grid gap-3 md:grid-cols-2">
                      <div class="rounded-2xl border border-slate-100 bg-slate-50 p-4">
                        <p class="text-xs text-slate-500">Modo atual</p>
                        <p class="text-lg font-semibold">Operação contínua</p>
                      </div>
                      <div class="rounded-2xl border border-slate-100 bg-slate-50 p-4">
                        <p class="text-xs text-slate-500">Canal ativo</p>
                        <p class="text-lg font-semibold">Equipe interna</p>
                      </div>
                    </div>
                    <div class="mt-4 grid gap-3 md:grid-cols-4">
                      <div class="rounded-2xl border border-slate-100 bg-slate-50 p-4">
                        <p class="text-xs text-slate-500">Avaliações ativas</p>
                        <p class="text-lg font-semibold" id="statActiveReviewsMirror">0</p>
                      </div>
                      <div class="rounded-2xl border border-slate-100 bg-slate-50 p-4">
                        <p class="text-xs text-slate-500">Expiram em 5 min</p>
                        <p class="text-lg font-semibold" id="statExpiringReviews">0</p>
                      </div>
                      <div class="rounded-2xl border border-slate-100 bg-slate-50 p-4">
                        <p class="text-xs text-slate-500">Saldo pendente</p>
                        <p class="text-lg font-semibold" id="statPendingBalances">0</p>
                      </div>
                      <div class="rounded-2xl border border-slate-100 bg-slate-50 p-4">
                        <p class="text-xs text-slate-500">Saques pendentes</p>
                        <p class="text-lg font-semibold" id="statPendingWithdrawals">0</p>
                      </div>
                    </div>
                  </div>

                  <div class="rounded-3xl border border-white/10 bg-ink-800/70 p-6">
                    <div class="flex items-center justify-between">
                      <h3 class="text-lg font-semibold">Avaliações pendentes</h3>
                      <span class="text-sm text-white/60" id="nextReviewInfo">Próxima em --</span>
                    </div>
                    <p class="mt-2 text-xs text-white/50">Cada avaliação expira em cerca de 20 minutos.</p>
                    <ul id="reviewList" class="mt-4 grid gap-3 text-sm text-white/70"></ul>
                  </div>
                </section>

                <section class="flex flex-col gap-6">
                  <div class="rounded-3xl border border-white/10 bg-ink-800/70 p-6">
                    <h3 class="text-lg font-semibold">Ações rápidas</h3>
                    <p class="mt-1 text-sm text-white/60">Atalhos para acelerar sua operação.</p>
                    <div class="mt-4 grid gap-3 text-sm">
                      <button
                        id="quickSync"
                        class="rounded-2xl border border-white/10 bg-ink-700/60 px-4 py-3 text-left text-white/80 hover:bg-white/10"
                        type="button"
                      >
                        Sincronizar marketplaces agora
                      </button>
                      <button
                        id="quickGenerate"
                        class="rounded-2xl border border-white/10 bg-ink-700/60 px-4 py-3 text-left text-white/80 hover:bg-white/10"
                        type="button"
                      >
                        Gerar novas avaliações recomendadas
                      </button>
                      <button
                        id="quickSummary"
                        class="rounded-2xl border border-white/10 bg-ink-700/60 px-4 py-3 text-left text-white/80 hover:bg-white/10"
                        type="button"
                      >
                        Gerar resumo VIP do dia
                      </button>
                    </div>
                  </div>

                  <div class="rounded-3xl border border-white/10 bg-ink-800/70 p-6">
                    <h3 class="text-lg font-semibold">Alertas inteligentes</h3>
                    <p class="mt-1 text-sm text-white/60">Pontos de atenção e status crítico.</p>
                    <ul id="alertList" class="mt-4 grid gap-2 text-xs text-white/70"></ul>
                  </div>

                  <div class="rounded-3xl border border-white/10 bg-ink-800/70 p-6">
                    <h3 class="text-lg font-semibold">Marketplaces</h3>
                    <p class="mt-1 text-sm text-white/60">Conecte e gerencie suas plataformas de venda.</p>
                    <ul id="marketplaceList" class="mt-4 grid gap-3 text-sm text-white/70"></ul>
                  </div>

                  <div class="rounded-3xl border border-white/10 bg-ink-800/70 p-6">
                    <h3 class="text-lg font-semibold">Resumo VIP</h3>
                    <p class="mt-1 text-sm text-white/60">Acompanhe as metas premium da semana.</p>
                    <div class="mt-4 grid gap-3 text-sm text-white/70">
                      <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                        <p class="text-xs text-white/50">Avaliações concluídas</p>
                        <p class="text-lg font-semibold" id="statCompletedReviews">0</p>
                      </div>
                      <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                        <div class="flex items-center justify-between gap-2">
                          <div>
                            <p class="text-xs text-white/50">Bônus VIP</p>
                            <p class="text-lg font-semibold" id="vipBonusValue">R$ 0,00</p>
                          </div>
                          <button
                            id="vipBonusCashout"
                            class="rounded-full border border-glow-500/40 bg-glow-500/10 px-3 py-1 text-[10px] font-semibold text-glow-400 hover:bg-glow-500/20"
                            type="button"
                          >
                            Sacar bônus
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="rounded-3xl border border-white/10 bg-ink-800/70 p-6">
                    <h3 class="text-lg font-semibold">Atividades recentes</h3>
                    <p class="mt-1 text-sm text-white/60">Últimas ações registradas na conta.</p>
                    <ul id="activityList" class="mt-4 grid gap-3 text-sm text-white/70"></ul>
                  </div>
                </section>
              </div>

              <div class="rounded-3xl border border-white/10 bg-ink-800/70 p-5">
                <div class="flex flex-wrap items-start justify-between gap-3">
                  <div>
                    <h3 class="text-lg font-semibold">Área de membros</h3>
                    <p class="mt-1 text-sm text-white/60">Atualizações da comunidade a cada 5 minutos.</p>
                  </div>
                  <div class="flex items-center gap-2">
                    <span id="memberPulseUpdated" class="text-xs text-white/60">Atualizado agora</span>
                    <button
                      id="memberPulseRefresh"
                      class="rounded-full border border-white/10 bg-white/5 px-3 py-1 text-xs font-semibold text-white/70 transition hover:bg-white/10"
                      type="button"
                    >
                      Atualizar agora
                    </button>
                  </div>
                </div>
                <div id="memberPulseSummary" class="mt-3 grid gap-2 md:grid-cols-4"></div>
                <ul id="memberPulseList" class="mt-3 grid gap-2 md:grid-cols-2"></ul>
              </div>
            </section>

            <section id="section-geral" data-section="geral" class="hidden space-y-6">
              <div class="rounded-3xl border border-white/10 bg-ink-800/70 p-6">
                <div class="flex flex-wrap items-center justify-between gap-3">
                  <div>
                    <h3 class="text-xl font-semibold">Geral da conta</h3>
                    <p class="mt-1 text-sm text-white/60">Resumo completo da conta e dados operacionais.</p>
                  </div>
                </div>

                <div class="mt-5 grid gap-3 md:grid-cols-2 xl:grid-cols-3">
                  <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                    <p class="text-xs text-white/50">Dono da conta</p>
                    <p id="generalOwnerName" class="text-sm font-semibold">--</p>
                  </div>
                  <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                    <p class="text-xs text-white/50">Empresa / operação</p>
                    <p id="generalBusinessName" class="text-sm font-semibold">--</p>
                  </div>
                  <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                    <p class="text-xs text-white/50">Contato principal</p>
                    <p id="generalContactLine" class="text-sm font-semibold">--</p>
                  </div>
                  <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                    <p class="text-xs text-white/50">Documento</p>
                    <p id="generalDocument" class="text-sm font-semibold">--</p>
                  </div>
                  <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                    <p class="text-xs text-white/50">Localidade</p>
                    <p id="generalCityState" class="text-sm font-semibold">--</p>
                  </div>
                  <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                    <p class="text-xs text-white/50">Conta criada em</p>
                    <p id="generalCreatedAt" class="text-sm font-semibold">--</p>
                  </div>
                </div>

                <div class="mt-5 grid gap-3 md:grid-cols-2 xl:grid-cols-4">
                  <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                    <p class="text-xs text-white/50">ID local</p>
                    <p id="generalAccountId" class="text-sm font-semibold">--</p>
                  </div>
                  <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                    <p class="text-xs text-white/50">Nível atual</p>
                    <p id="generalCurrentLevel" class="text-sm font-semibold">--</p>
                  </div>
                  <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                    <p class="text-xs text-white/50">Marketplaces conectados</p>
                    <p id="generalConnectedCount" class="text-sm font-semibold">0</p>
                  </div>
                  <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                    <p class="text-xs text-white/50">Avaliações registradas</p>
                    <p id="generalReviewsCount" class="text-sm font-semibold">0</p>
                  </div>
                </div>

                <div class="mt-5 rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                  <div class="flex flex-wrap items-center justify-between gap-3">
                    <div>
                      <h4 class="text-sm font-semibold">Backup de segurança</h4>
                      <p class="text-xs text-white/60">Exporte e restaure os dados da conta em JSON.</p>
                    </div>
                    <span
                      id="generalBackupStatus"
                      class="rounded-full border border-white/10 bg-white/5 px-3 py-1 text-[11px] text-white/60"
                    >
                      Sem backup recente
                    </span>
                  </div>
                  <div class="mt-3 flex flex-wrap gap-2">
                    <button
                      id="generalBackupExport"
                      type="button"
                      class="rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-xs font-semibold text-white/80 transition hover:bg-white/10"
                    >
                      Exportar backup
                    </button>
                    <button
                      id="generalBackupImport"
                      type="button"
                      class="rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-xs font-semibold text-white/80 transition hover:bg-white/10"
                    >
                      Importar backup
                    </button>
                    <input id="generalBackupFile" class="hidden" type="file" accept=".json,application/json" />
                  </div>
                  <p id="generalBackupMessage" class="mt-2 text-xs text-white/60"></p>
                </div>
              </div>
            </section>

            <section id="section-reviews" data-section="reviews" class="hidden space-y-6">
              <div class="rounded-3xl border border-white/10 bg-ink-800/70 p-6">
                <h3 class="text-xl font-semibold">Avaliações ativas</h3>
                <p class="mt-1 text-sm text-white/60">Gerencie todas as avaliações disponíveis.</p>
                <div class="mt-4">
                  <ul id="reviewListSecondary" class="grid gap-3 text-sm text-white/70"></ul>
                </div>
              </div>
            </section>

            <section id="section-financeiro" data-section="financeiro" class="hidden space-y-6">
              <div class="rounded-3xl border border-white/10 bg-ink-800/70 p-6">
                <div class="flex flex-wrap items-center justify-between gap-3">
                  <div>
                    <h3 class="text-xl font-semibold">Painel financeiro</h3>
                    <p class="mt-1 text-sm text-white/60">Controle seu saldo, aprovações internas e relatórios em abas.</p>
                  </div>
                  <div class="inline-flex rounded-full border border-white/10 bg-ink-800/80 p-1 text-xs">
                    <button
                      id="financeTabOverview"
                      class="rounded-full bg-white/15 px-3 py-1 text-white transition"
                      type="button"
                    >
                      Financeiro
                    </button>
                    <button
                      id="financeTabReports"
                      class="rounded-full px-3 py-1 text-white/70 transition hover:bg-white/10"
                      type="button"
                    >
                      Relatórios
                    </button>
                  </div>
                </div>

                <div id="financePanelOverview" class="mt-5 space-y-6">
                  <div class="grid gap-3 md:grid-cols-3 xl:grid-cols-6">
                    <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                      <p class="text-xs text-white/50">Saldo atual</p>
                      <p class="text-lg font-semibold" id="financeBalance">R$ 0,00</p>
                    </div>
                    <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                      <p class="text-xs text-white/50">Disponível p/ saque</p>
                      <p class="text-lg font-semibold" id="financeAvailableBalance">R$ 0,00</p>
                    </div>
                    <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                      <p class="text-xs text-white/50">Solicitações de saldo</p>
                      <p class="text-lg font-semibold" id="financePendingBalance">0</p>
                    </div>
                    <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                      <p class="text-xs text-white/50">Saques pendentes</p>
                      <p class="text-lg font-semibold" id="financePendingWithdrawals">0</p>
                    </div>
                    <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                      <p class="text-xs text-white/50">Saques aprovados</p>
                      <p class="text-lg font-semibold" id="financeApprovedWithdrawals">0</p>
                    </div>
                    <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                      <p class="text-xs text-white/50">Saques rejeitados</p>
                      <p class="text-lg font-semibold" id="financeRejectedWithdrawals">0</p>
                    </div>
                  </div>
                  <div class="grid gap-4 lg:grid-cols-2">
                    <section class="rounded-2xl border border-white/10 bg-ink-700/60 p-5">
                      <h4 class="text-base font-semibold">Solicitar saque</h4>
                      <p class="mt-1 text-xs text-white/60">Informe o valor que deseja sacar. A solicitação passa pela validação da plataforma.</p>
                      <form id="userWithdrawalForm" class="mt-4 grid gap-3">
                        <input
                          id="userWithdrawalAmount"
                          class="w-full rounded-xl border border-white/10 bg-ink-800 px-4 py-3 text-sm text-white placeholder:text-white/40"
                          type="text"
                          inputmode="decimal"
                          placeholder="Valor do saque (R$)"
                          required
                        />
                        <input
                          id="userWithdrawalKey"
                          class="w-full rounded-xl border border-white/10 bg-ink-800 px-4 py-3 text-sm text-white placeholder:text-white/40"
                          type="password"
                          autocomplete="off"
                          placeholder="Chave PIX (CPF, CNPJ, e-mail, celular ou aleatória)"
                          required
                        />
                        <p id="userWithdrawalKeyInfo" class="text-[11px] text-white/50">
                          Chaves aceitas: CPF, CNPJ, e-mail, celular e aleatória (UUID).
                        </p>
                        <p id="userWithdrawalBankInfo" class="text-[11px] text-white/50">Banco de destino será detectado automaticamente.</p>
                        <button
                          class="rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm font-semibold text-white transition hover:bg-white/10"
                          type="submit"
                        >
                          Solicitar saque
                        </button>
                      </form>
                      <p id="userWithdrawalMessage" class="mt-3 text-xs text-white/60"></p>
                    </section>
                    <section class="rounded-2xl border border-white/10 bg-ink-700/60 p-5">
                      <h4 class="text-base font-semibold">Status dos saques</h4>
                      <p class="mt-1 text-xs text-white/60">Acompanhe suas solicitações e o status.</p>
                      <ul id="financeWithdrawalList" class="mt-4 grid gap-2 text-xs text-white/70"></ul>
                    </section>
                  </div>
                  <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-5">
                    <h4 class="text-base font-semibold">Pagamentos de avaliações</h4>
                    <p class="mt-1 text-xs text-white/60">Recompensas das avaliações (pendentes e histórico).</p>
                    <div class="mt-3 inline-flex rounded-full border border-white/10 bg-ink-800/80 p-1 text-xs">
                      <button
                        id="financePaymentsFilterPending"
                        class="rounded-full px-3 py-1 text-white/80 transition hover:bg-white/10"
                        type="button"
                      >
                        Pendentes
                      </button>
                      <button
                        id="financePaymentsFilterAll"
                        class="rounded-full px-3 py-1 text-white/80 transition hover:bg-white/10"
                        type="button"
                      >
                        Todos
                      </button>
                    </div>
                    <ul id="financeBalanceRequestList" class="mt-4 grid gap-2 text-xs text-white/70"></ul>
                  </div>
                  <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-5">
                    <h4 class="text-base font-semibold">Relatório de ganhos</h4>
                    <p class="mt-1 text-xs text-white/60">Mostra o total do período selecionado, incluindo valores já realizados.</p>
                    <div class="mt-4 rounded-2xl border border-white/10 bg-ink-800/70 p-4">
                      <p class="text-xs text-white/50">Total do período</p>
                      <p class="text-2xl font-semibold" id="salesCustom">R$ 0,00</p>
                    </div>
                    <div class="mt-4 grid gap-3 md:grid-cols-3">
                      <input
                        id="salesStartDate"
                        class="w-full rounded-xl border border-white/10 bg-ink-800 px-4 py-3 text-sm text-white"
                        type="date"
                      />
                      <input
                        id="salesEndDate"
                        class="w-full rounded-xl border border-white/10 bg-ink-800 px-4 py-3 text-sm text-white"
                        type="date"
                      />
                      <button
                        id="salesApply"
                        class="rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm font-semibold text-white transition hover:bg-white/10"
                        type="button"
                      >
                        Aplicar filtro
                      </button>
                    </div>
                    <p id="salesRangeMessage" class="mt-3 text-xs text-white/60"></p>
                  </div>
                </div>

                <div id="financePanelReports" class="mt-5 hidden space-y-6">
                  <div>
                    <h3 class="text-xl font-semibold">Relatórios inteligentes</h3>
                    <p class="mt-1 text-sm text-white/60">Indicadores de desempenho e qualidade das avaliações.</p>
                  </div>
                  <div class="grid gap-3 md:grid-cols-2 xl:grid-cols-4">
                    <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                      <p class="text-xs text-white/50">Nota média</p>
                      <p class="text-lg font-semibold" id="reportAverageRating">0.0</p>
                    </div>
                    <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                      <p class="text-xs text-white/50">Taxa de aprovação</p>
                      <p class="text-lg font-semibold" id="reportApprovalRate">0%</p>
                    </div>
                    <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                      <p class="text-xs text-white/50">Tempo médio de aprovação</p>
                      <p class="text-lg font-semibold" id="reportApprovalTime">--</p>
                    </div>
                    <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                      <p class="text-xs text-white/50">Ganhos liberados</p>
                      <p class="text-lg font-semibold" id="reportApprovedValue">R$ 0,00</p>
                    </div>
                  </div>
                  <div class="grid gap-3 md:grid-cols-2">
                    <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                      <p class="text-xs text-white/50">Pagamentos pendentes</p>
                      <p class="text-lg font-semibold" id="reportPendingValue">R$ 0,00</p>
                    </div>
                    <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                      <p class="text-xs text-white/50">Avaliações aprovadas</p>
                      <p class="text-lg font-semibold" id="reportApprovedReviews">0</p>
                    </div>
                  </div>
                  <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-5">
                    <div class="flex flex-wrap items-center justify-between gap-4">
                      <div>
                        <p class="text-xs text-white/50">Resultado do período</p>
                        <p class="text-2xl font-semibold" id="reportSalesValue">R$ 0,00</p>
                        <p id="reportRangeMessage" class="mt-1 text-xs text-white/50">Periodo: Ultimos 30 dias</p>
                      </div>
                    </div>
                    <div class="mt-4 grid gap-3 md:grid-cols-[240px_minmax(0,1fr)]">
                      <div class="grid gap-2">
                        <label class="text-xs text-white/50" for="reportRangeSelect">Periodo</label>
                        <select
                          id="reportRangeSelect"
                          class="w-full rounded-xl border border-white/10 bg-ink-800 px-4 py-3 text-sm text-white"
                        >
                          <option value="today">Hoje</option>
                          <option value="last7">Ultimos 7 dias</option>
                          <option value="last15">Ultimos 15 dias</option>
                          <option value="last30" selected>Ultimos 30 dias</option>
                          <option value="custom">Periodo personalizado</option>
                        </select>
                      </div>
                      <div id="reportCustomDateWrap" class="hidden grid gap-3 md:grid-cols-3">
                        <input
                          id="reportCustomStartDate"
                          class="w-full rounded-xl border border-white/10 bg-ink-800 px-4 py-3 text-sm text-white"
                          type="date"
                        />
                        <input
                          id="reportCustomEndDate"
                          class="w-full rounded-xl border border-white/10 bg-ink-800 px-4 py-3 text-sm text-white"
                          type="date"
                        />
                        <button
                          id="reportCustomApply"
                          class="rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm font-semibold text-white transition hover:bg-white/10"
                          type="button"
                        >
                          Aplicar periodo
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="rounded-3xl border border-white/10 bg-ink-900/70 p-6">
                    <div class="flex items-center justify-between">
                      <h4 class="text-base font-semibold">Gráfico de resultados</h4>
                      <span id="reportChartLabel" class="text-xs text-white/50">Ultimos 30 dias</span>
                    </div>
                    <div class="mt-4">
                      <canvas id="reportChart" class="h-56 w-full"></canvas>
                    </div>
                  </div>
                </div>
              </div>
            </section>

            <section id="section-equipe" data-section="equipe" class="hidden space-y-6">
              <div class="rounded-3xl border border-white/10 bg-ink-800/70 p-6">
                <h3 class="text-xl font-semibold">Equipe & permissões</h3>
                <p class="mt-1 text-sm text-white/60">Gerencie membros da operação e níveis de acesso.</p>
                <div class="mt-5 grid gap-4 lg:grid-cols-2">
                  <section class="rounded-2xl border border-white/10 bg-ink-700/60 p-5">
                    <h4 class="text-base font-semibold">Adicionar membro</h4>
                    <form id="teamMemberForm" class="mt-4 grid gap-3">
                      <input
                        id="teamMemberName"
                        class="w-full rounded-xl border border-white/10 bg-ink-800 px-4 py-3 text-sm text-white placeholder:text-white/40"
                        type="text"
                        placeholder="Nome do membro"
                        required
                      />
                      <input
                        id="teamMemberRole"
                        class="w-full rounded-xl border border-white/10 bg-ink-800 px-4 py-3 text-sm text-white placeholder:text-white/40"
                        type="text"
                        placeholder="Cargo ou função"
                        required
                      />
                      <button
                        class="rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm font-semibold text-white transition hover:bg-white/10"
                        type="submit"
                      >
                        Adicionar membro
                      </button>
                    </form>
                    <p id="teamMemberMessage" class="mt-3 text-xs text-white/60"></p>
                  </section>
                  <section class="rounded-2xl border border-white/10 bg-ink-700/60 p-5">
                    <h4 class="text-base font-semibold">Membros ativos</h4>
                    <ul id="teamMemberList" class="mt-4 grid gap-2 text-xs text-white/70"></ul>
                  </section>
                </div>
              </div>
            </section>

            <section id="section-ferramentas" data-section="ferramentas" class="hidden space-y-6">
              <div class="rounded-3xl border border-white/10 bg-ink-800/70 p-6">
                <h3 class="text-xl font-semibold">Ferramentas da conta</h3>
                <p class="mt-1 text-sm text-white/60">Configurações que deixam sua operação mais rápida.</p>
                <div class="mt-4 space-y-3">
                  <div class="flex items-center justify-between rounded-2xl border border-white/10 bg-ink-700/60 px-4 py-3 text-sm">
                    <span>Notificações internas</span>
                    <button
                      id="prefNotificationsToggle"
                      type="button"
                      class="lever-toggle"
                      data-state="off"
                      aria-pressed="false"
                    >
                      <span class="lever-toggle__text" data-switch-label>OFF</span>
                      <span class="lever-toggle__track">
                        <span class="lever-toggle__thumb"></span>
                      </span>
                    </button>
                  </div>
                  <div class="flex items-center justify-between rounded-2xl border border-white/10 bg-ink-700/60 px-4 py-3 text-sm">
                    <span>Resumo diário</span>
                    <button
                      id="prefSummaryToggle"
                      type="button"
                      class="lever-toggle"
                      data-state="off"
                      aria-pressed="false"
                    >
                      <span class="lever-toggle__text" data-switch-label>OFF</span>
                      <span class="lever-toggle__track">
                        <span class="lever-toggle__thumb"></span>
                      </span>
                    </button>
                  </div>
                  <div class="flex items-center justify-between rounded-2xl border border-white/10 bg-ink-700/60 px-4 py-3 text-sm">
                    <span>Modo compacto</span>
                    <button
                      id="prefCompactToggle"
                      type="button"
                      class="lever-toggle"
                      data-state="off"
                      aria-pressed="false"
                    >
                      <span class="lever-toggle__text" data-switch-label>OFF</span>
                      <span class="lever-toggle__track">
                        <span class="lever-toggle__thumb"></span>
                      </span>
                    </button>
                  </div>
                  <div class="rounded-2xl border border-white/10 bg-ink-700/60 px-4 py-3">
                    <div class="flex items-center justify-between gap-3 text-sm">
                      <div>
                        <p>Auto IA nas avaliações</p>
                        <p id="autoAiStatus" class="mt-1 text-[11px] text-white/50">Bloqueado até atingir R$ 1.000,00.</p>
                      </div>
                      <button
                        id="autoAiToggleButton"
                        type="button"
                        class="lever-toggle"
                        data-state="off"
                        aria-pressed="false"
                        disabled
                      >
                        <span class="lever-toggle__text" data-switch-label>OFF</span>
                        <span class="lever-toggle__track">
                          <span class="lever-toggle__thumb"></span>
                        </span>
                      </button>
                    </div>
                    <p id="autoAiProgress" class="mt-2 text-[11px] text-white/50"></p>
                  </div>
                </div>
              </div>
            </section>

            <section id="section-niveis" data-section="niveis" class="hidden space-y-6">
              <div class="grid gap-6 xl:grid-cols-[1.35fr_1fr]">
                <div class="space-y-6">
                  <div class="level-shell rounded-[30px] border border-white/10 p-6 shadow-[0_28px_70px_-42px_rgba(56,189,248,0.7)]">
                    <div class="flex flex-wrap items-start justify-between gap-3">
                      <div>
                        <div class="level-badge inline-flex items-center gap-2">
                          <span class="h-1.5 w-1.5 rounded-full bg-glow-400"></span>
                          Controle de automação
                        </div>
                        <h3 class="mt-3 flex items-center gap-2 text-2xl font-semibold">
                          <svg class="h-6 w-6 text-cyan-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 3l7 6-7 12L5 9l7-6z" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8 9h8" />
                          </svg>
                          Níveis da IA
                        </h3>
                        <p class="mt-1 text-sm text-white/70">
                          Sistema real de progressão: quanto maior o faturamento aprovado, maior o tempo diário do robô.
                        </p>
                      </div>
                      <button
                        id="levelRobotActionButton"
                        type="button"
                        class="robot-action rounded-full px-4 py-2 text-xs font-semibold uppercase tracking-wide"
                      >
                        Iniciar robô
                      </button>
                    </div>

                    <div class="mt-5 grid gap-3 md:grid-cols-3">
                      <div class="rounded-2xl border border-white/10 bg-ink-900/45 p-4">
                        <p class="text-xs text-white/50">Nível atual</p>
                        <p id="levelCurrentName" class="mt-1 text-lg font-semibold text-glow-300">Bronze</p>
                      </div>
                      <div class="rounded-2xl border border-white/10 bg-ink-900/45 p-4">
                        <p class="text-xs text-white/50">Faturamento aprovado</p>
                        <p id="levelApprovedTotal" class="mt-1 text-lg font-semibold">R$ 0,00</p>
                      </div>
                      <div class="rounded-2xl border border-white/10 bg-ink-900/45 p-4">
                        <p class="text-xs text-white/50">Tempo IA no dia</p>
                        <p id="levelDailyMinutes" class="mt-1 text-lg font-semibold">0 min</p>
                      </div>
                    </div>

                    <div class="mt-5 grid gap-4 md:grid-cols-2">
                      <div class="rounded-2xl border border-white/10 bg-ink-900/45 p-4">
                        <p class="text-xs font-semibold uppercase tracking-wide text-white/60">Uso diário</p>
                        <div class="mt-2 flex flex-wrap items-center justify-between gap-2 text-xs text-white/60">
                          <span id="levelUsageText">Uso hoje: 0 min / 0 min</span>
                          <span id="levelRemainingText">Restante: 0 min</span>
                        </div>
                        <div class="ai-level-progress-track mt-2">
                          <span id="levelUsageBar" class="ai-level-progress-fill"></span>
                        </div>
                        <p id="levelUsagePercentText" class="mt-2 text-xs text-white/50">0% do tempo diário usado</p>
                        <p id="levelNextTarget" class="mt-2 text-xs text-glow-200">Sem próximo nível</p>
                      </div>

                      <div class="rounded-2xl border border-white/10 bg-ink-900/45 p-4">
                        <p class="text-xs font-semibold uppercase tracking-wide text-white/60">Tarefa da IA em execução</p>
                        <p id="levelRobotTaskText" class="mt-2 text-xs text-white/80">Aguardando início do robô.</p>
                        <div class="ai-level-progress-track mt-2">
                          <span id="levelRobotTaskProgressBar" class="ai-level-progress-fill"></span>
                        </div>
                        <p id="levelRobotTaskPercent" class="mt-2 text-xs text-white/50">0% da tarefa atual</p>
                        <p id="levelRobotActionStatus" class="mt-2 text-xs text-white/60">Robô IA parado.</p>
                      </div>
                    </div>
                  </div>

                  <div class="rounded-3xl border border-white/10 bg-ink-800/75 p-6">
                    <div class="flex flex-wrap items-center justify-between gap-3">
                      <h4 class="text-base font-semibold">Execução ao vivo</h4>
                      <span class="level-badge">Log em tempo real</span>
                    </div>
                    <p class="mt-2 text-xs text-white/60">
                      Aqui aparece tudo que o robô está fazendo: leitura de anúncio, geração de avaliação, validação e envio.
                    </p>
                    <ul id="levelRobotLog" class="support-chat-scroll mt-4 grid gap-2 text-xs text-white/70"></ul>
                  </div>
                </div>

                <div class="space-y-6">
                  <div class="rounded-3xl border border-white/10 bg-ink-800/75 p-6">
                    <h4 class="text-base font-semibold">Tabela de níveis</h4>
                    <p class="mt-1 text-xs text-white/60">Cada nível muda o limite real de minutos da IA por dia.</p>
                    <div class="mt-4 overflow-x-auto rounded-2xl border border-white/10 bg-ink-900/45 p-3">
                      <table class="min-w-full text-left text-xs text-white/70">
                        <thead class="text-white/50">
                          <tr>
                            <th class="py-2 pr-3">Nível</th>
                            <th class="py-2 pr-3">Meta faturada</th>
                            <th class="py-2">Tempo IA/dia</th>
                          </tr>
                        </thead>
                        <tbody id="levelRulesTableBody"></tbody>
                      </table>
                    </div>
                  </div>

                  <div class="rounded-3xl border border-glow-500/25 bg-glow-500/10 p-6">
                    <h4 class="text-base font-semibold text-glow-200">Regras de operação</h4>
                    <ul class="mt-3 grid gap-2 text-xs text-glow-100/90">
                      <li>1. O limite de tempo zera automaticamente no início de cada dia.</li>
                      <li>2. A IA pode ser pausada a qualquer momento sem perder o progresso do dia.</li>
                      <li>3. Cada tarefa passa por etapas para manter a operação realista.</li>
                      <li>4. Sem saldo aprovado novo, o nível não sobe.</li>
                    </ul>
                  </div>
                </div>
              </div>
            </section>

            <section id="section-produtos" data-section="produtos" class="hidden space-y-6">
              <div class="rounded-3xl border border-white/10 bg-ink-800/70 p-6">
                <h3 class="text-xl font-semibold">Produtos em destaque</h3>
                <p class="mt-1 text-sm text-white/60">Itens mais avaliados pelos usuários.</p>
                <ul id="productHighlights" class="mt-4 grid gap-3 text-sm text-white/70"></ul>
              </div>
            </section>

            <section id="section-integracoes" data-section="integracoes" class="hidden space-y-6">
              <div class="rounded-3xl border border-white/10 bg-ink-800/70 p-6">
                <div class="flex flex-wrap items-center justify-between gap-3">
                  <div>
                    <h3 class="text-xl font-semibold">Integrações</h3>
                    <p class="mt-1 text-sm text-white/60">Gerencie conectados e catálogo no mesmo lugar.</p>
                  </div>
                  <div class="inline-flex rounded-full border border-white/10 bg-ink-800/80 p-1 text-xs">
                    <button
                      id="integrationTabConnected"
                      class="rounded-full bg-white/15 px-3 py-1 text-white transition"
                      type="button"
                    >
                      Conectados
                    </button>
                    <button
                      id="integrationTabCatalog"
                      class="rounded-full px-3 py-1 text-white/70 transition hover:bg-white/10"
                      type="button"
                    >
                      Catálogo
                    </button>
                  </div>
                </div>

                <div id="integrationPanelConnected" class="mt-4">
                  <p class="text-sm text-white/60">Aqui aparecem somente marketplaces já conectados à conta.</p>
                  <ul id="marketplaceConnectedList" class="mt-4 grid gap-3 text-sm text-white/70"></ul>
                </div>

                <div id="integrationPanelCatalog" class="mt-4 hidden">
                  <p class="text-sm text-white/60">Conecte individualmente por card ou use a ação rápida para conectar em lote.</p>
                  <p class="mt-2 text-xs text-white/50">
                    Operação em modo de simulação: o sistema usa catálogo demonstrativo e não publica avaliações reais automaticamente.
                  </p>
                  <div class="mt-3 grid gap-3 md:grid-cols-2">
                    <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                      <p class="text-xs text-white/50">Marketplaces no catálogo</p>
                      <p id="integrationCatalogCount" class="text-lg font-semibold">0</p>
                    </div>
                    <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                      <p class="text-xs text-white/50">Marketplaces conectados</p>
                      <p id="integrationConnectedCount" class="text-lg font-semibold">0</p>
                    </div>
                  </div>
                  <ul id="marketplaceCatalogList" class="mt-4 grid gap-3 text-sm text-white/70"></ul>
                </div>
              </div>
            </section>

            <section id="section-informacao" data-section="informacao" class="hidden space-y-6">
              <div class="rounded-3xl border border-white/10 bg-ink-800/70 p-6">
                <div class="flex flex-wrap items-center justify-between gap-3">
                  <div>
                    <h3 class="text-xl font-semibold">Informação</h3>
                    <p class="mt-1 text-sm text-white/60">
                      Base completa de operação: modelo de ganhos, critérios de qualidade, fluxo de aprovação e segurança da conta.
                    </p>
                  </div>
                  <button
                    id="informationTutorialOpen"
                    type="button"
                    class="rounded-xl border border-glow-500/35 bg-glow-500/10 px-4 py-2 text-xs font-semibold text-glow-200 transition hover:bg-glow-500/20"
                  >
                    Abrir tutorial completo
                  </button>
                </div>

                <div class="mt-4 grid gap-3 md:grid-cols-2 xl:grid-cols-4 text-sm text-white/70">
                  <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                    <p class="text-xs text-white/50">Etapas da operação</p>
                    <p class="mt-1 text-base font-semibold text-white">6 etapas principais</p>
                    <p class="mt-1 text-xs text-white/60">Conectar, gerar, avaliar, enviar, aprovar e sacar.</p>
                  </div>
                  <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                    <p class="text-xs text-white/50">Tempo de análise</p>
                    <p class="mt-1 text-base font-semibold text-white">Validação por etapas</p>
                    <p class="mt-1 text-xs text-white/60">A plataforma valida coerência entre nota, título, SKU e feedback.</p>
                  </div>
                  <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                    <p class="text-xs text-white/50">Pagamento</p>
                    <p class="mt-1 text-base font-semibold text-white">Financeiro integrado</p>
                    <p class="mt-1 text-xs text-white/60">Tudo entra em pagamentos pendentes e recebe status após validação.</p>
                  </div>
                  <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                    <p class="text-xs text-white/50">Escala</p>
                    <p class="mt-1 text-base font-semibold text-white">Níveis e limites reais</p>
                    <p class="mt-1 text-xs text-white/60">Quanto mais faturamento aprovado, maior uso diário da IA.</p>
                  </div>
                </div>

                <div class="mt-4 grid gap-4 text-sm text-white/70">
                  <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-5">
                    <p class="font-semibold text-white">Como funciona a economia da ferramenta</p>
                    <p class="mt-2 text-xs text-white/70">
                      Marketplaces como Mercado Livre, Amazon, Shopee, Magalu, KaBuM! e outros dependem de confiança para converter.
                      Avaliações estruturadas aumentam prova social, reduzem devolução e elevam relevância do anúncio. Por isso existe orçamento de aquisição de feedback.
                    </p>
                  </div>
                  <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-5">
                    <p class="font-semibold text-white">Critérios de aprovação que realmente importam</p>
                    <ul class="mt-2 grid gap-2 text-xs text-white/70">
                      <li>1. Texto coerente com título, categoria e proposta do produto.</li>
                      <li>2. Nota compatível com a justificativa escrita.</li>
                      <li>3. SKU correto e sem divergência com o anúncio real.</li>
                      <li>4. Linguagem natural, sem spam e sem duplicação.</li>
                      <li>5. Recomendação e qualidade preenchidas de forma consistente.</li>
                    </ul>
                  </div>
                  <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-5">
                    <p class="font-semibold text-white">Fluxo financeiro dentro da plataforma</p>
                    <ul class="mt-2 grid gap-2 text-xs text-white/70">
                      <li>1. Avaliação enviada entra como pagamento pendente.</li>
                      <li>2. O sistema valida qualidade e consistência da solicitação.</li>
                      <li>3. Quando aprovada, o valor soma no saldo disponível.</li>
                      <li>4. Saque: exige chave PIX válida, banco detectado automaticamente e saldo suficiente.</li>
                    </ul>
                  </div>
                  <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-5">
                    <p class="font-semibold text-white">Boas práticas para manter qualidade alta</p>
                    <ul class="mt-2 grid gap-2 text-xs text-white/70">
                      <li>1. Revise anúncio real antes de enviar.</li>
                      <li>2. Evite exageros em todas as avaliações.</li>
                      <li>3. Diversifique argumentos e exemplos de uso.</li>
                      <li>4. Use o backup da conta regularmente para segurança operacional.</li>
                    </ul>
                  </div>
                  <div class="rounded-2xl border border-glow-500/30 bg-glow-500/10 p-5 text-xs text-glow-200">
                    Dica estratégica: use o tutorial completo para treinar equipe nova e padronizar o processo. Isso reduz rejeições e melhora previsibilidade de receita.
                  </div>
                </div>
              </div>
            </section>

            <section id="section-suporte" data-section="suporte" class="hidden space-y-6">
              <div class="rounded-3xl border border-white/10 bg-ink-800/70 p-6">
                <h3 class="text-xl font-semibold">Suporte VIP BLACK</h3>
                <p class="mt-1 text-sm text-white/60">Assistente inteligente para tirar dúvidas reais da plataforma.</p>
                <div class="mt-4 rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                  <div class="flex flex-wrap items-center justify-between gap-3">
                    <div class="flex items-center gap-3">
                      <span class="inline-flex h-8 w-8 items-center justify-center rounded-full border border-glow-400/30 bg-glow-500/10 text-[10px] font-semibold text-glow-200">
                        IA
                      </span>
                      <div>
                        <p class="text-xs text-white/50">Assistente de suporte</p>
                        <p id="supportAssistantModeLabel" class="text-xs text-glow-300">Modo: Atlas IA local</p>
                      </div>
                    </div>
                    <p id="supportAssistantState" class="text-xs text-glow-400">Online e pronto para ajudar</p>
                  </div>
                  <ul id="supportChatList" class="support-chat-scroll mt-4 grid gap-3 text-sm"></ul>
                  <div id="supportTypingIndicator" class="mt-3 hidden">
                    <div class="support-typing">
                      <span class="support-dots" aria-hidden="true">
                        <i></i>
                        <i></i>
                        <i></i>
                      </span>
                      <span id="supportTypingLabel">Processando...</span>
                    </div>
                  </div>
                  <form id="supportChatForm" class="mt-4 grid gap-3 md:grid-cols-[1fr_auto]">
                    <input
                      id="supportChatInput"
                      class="w-full rounded-xl border border-white/10 bg-ink-800 px-4 py-3 text-sm text-white placeholder:text-white/40"
                      type="text"
                      placeholder="Pergunte qualquer coisa sobre o ReviewPay..."
                      autocomplete="off"
                      required
                    />
                    <button
                      id="supportChatSend"
                      class="rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm font-semibold text-white transition hover:bg-white/10"
                      type="submit"
                    >
                      Enviar
                    </button>
                  </form>
                </div>
              </div>
            </section>
          </div>
        </main>
      </div>
      <div id="aiRobotFloating" class="ai-robot-float hidden" aria-live="polite">
        <button id="aiRobotFloatingButton" type="button" class="ai-robot-float__button">Pausar IA</button>
        <p id="aiRobotFloatingLabel" class="text-[11px] text-white/70">Robô IA em execução</p>
        <div class="ai-robot-float__track">
          <span id="aiRobotFloatingBar" class="ai-robot-float__fill"></span>
        </div>
      </div>
    </div>

    <div id="informationTutorialOverlay" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/70 p-4 backdrop-blur">
      <div class="tutorial-popup-shell w-full max-w-4xl rounded-3xl border border-white/10 bg-ink-800/95 p-6 shadow-2xl">
        <div class="flex flex-wrap items-start justify-between gap-3">
          <div>
            <h3 class="text-xl font-semibold">Tutorial Completo do ReviewPay</h3>
            <p class="mt-1 text-sm text-white/60">Passo a passo simples e prático, do login ao saque.</p>
          </div>
          <button
            id="informationTutorialClose"
            type="button"
            class="rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-xs font-semibold text-white/80 transition hover:bg-white/10"
          >
            Fechar
          </button>
        </div>

        <div class="support-chat-scroll mt-4 max-h-[70vh] space-y-4 pr-1 text-sm text-white/70">
          <div class="rounded-2xl border border-glow-500/25 bg-glow-500/10 p-4">
            <p class="text-xs font-semibold uppercase tracking-wide text-glow-200">Objetivo da plataforma</p>
            <p class="mt-2 text-xs text-glow-100/90">
              O ReviewPay organiza geração e gestão de avaliações qualificadas para marketplaces, com rastreio de aprovação e controle financeiro no mesmo painel.
            </p>
          </div>

          <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
            <p class="font-semibold text-white">Passo a passo de uso</p>
            <ul class="mt-3 grid gap-3 text-xs text-white/70">
              <li>1. Entre na conta e confirme se o painel principal carregou normalmente.</li>
              <li>2. Vá em Geral e confira o ID local da conta (você vai usar ele nas integrações).</li>
              <li>3. Abra Integrações, clique em Conectar no marketplace desejado e informe o ID local.</li>
              <li>4. Volte para Principal e use "Gerar novas avaliações recomendadas".</li>
              <li>5. Em Avaliações, abra uma tarefa pendente e veja o anúncio real.</li>
              <li>6. Preencha nota, recomendação, qualidade, SKU e comentário coerente.</li>
              <li>7. Envie a avaliação: ela entra no financeiro como pagamento pendente.</li>
              <li>8. O sistema valida a tarefa e define o status (aprovada ou rejeitada).</li>
              <li>9. Quando aprovada, o valor entra no saldo disponível da carteira.</li>
              <li>10. No Financeiro, solicite saque PIX com chave válida.</li>
              <li>11. Acompanhe Níveis para liberar mais tempo diário de automação da IA.</li>
              <li>12. Faça backup da conta com frequência para proteger seus dados.</li>
            </ul>
          </div>

          <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
            <p class="font-semibold text-white">Exemplo prático (1 tarefa completa)</p>
            <ul class="mt-2 grid gap-2 text-xs text-white/70">
              <li>1. Conectou Amazon com o ID local da conta.</li>
              <li>2. Gerou novas tarefas pelo botão de ação rápida.</li>
              <li>3. Abriu a tarefa "Fone Bluetooth X Pro" em Avaliações.</li>
              <li>4. Preencheu nota 5, qualidade alta, SKU correto e comentário útil.</li>
              <li>5. Enviou e a tarefa ficou como pagamento pendente no financeiro.</li>
              <li>6. Após validação, entrou saldo e você já pode solicitar saque PIX.</li>
            </ul>
          </div>

          <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
            <p class="font-semibold text-white">Por que a ferramenta funciona</p>
            <ul class="mt-2 grid gap-2 text-xs text-white/70">
              <li>1. Avaliações boas aumentam confiança e conversão no anúncio.</li>
              <li>2. Comentários úteis reduzem dúvidas e devoluções.</li>
              <li>3. Produtos bem avaliados ganham mais relevância no marketplace.</li>
              <li>4. O fluxo com validação mantém qualidade e previsibilidade de ganhos.</li>
            </ul>
          </div>

          <div class="grid gap-3 md:grid-cols-2">
            <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
              <p class="font-semibold text-white">Boas práticas de qualidade</p>
              <ul class="mt-2 grid gap-2 text-xs text-white/70">
                <li>1. Escreva feedback específico, não genérico.</li>
                <li>2. Não use textos repetidos em lote.</li>
                <li>3. Mantenha coerência entre nota e comentário.</li>
                <li>4. Sempre valide SKU e dados do anúncio.</li>
              </ul>
            </div>
            <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
              <p class="font-semibold text-white">Erros que mais geram rejeição</p>
              <ul class="mt-2 grid gap-2 text-xs text-white/70">
                <li>1. SKU incorreto ou não preenchido.</li>
                <li>2. Comentário curto sem contexto.</li>
                <li>3. Texto fora da proposta do produto.</li>
                <li>4. Inconsistência entre recomendação e nota.</li>
              </ul>
            </div>
          </div>

          <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
            <p class="font-semibold text-white">Mapa rápido da navegação</p>
            <ul class="mt-2 grid gap-2 text-xs text-white/70">
              <li>1. Principal: visão geral, alertas e ações rápidas.</li>
              <li>2. Avaliações: fila ativa para execução manual/assistida.</li>
              <li>3. Financeiro: saldo, pendências, saques e relatórios.</li>
              <li>4. Ferramentas: preferências e ativação da Auto IA.</li>
              <li>5. Níveis: metas de faturamento e limite diário da IA.</li>
              <li>6. Integrações: conectados e catálogo de marketplaces.</li>
              <li>7. Informação: base operacional e material de treinamento.</li>
              <li>8. Suporte: chat assistente para dúvidas no fluxo.</li>
            </ul>
          </div>

          <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
            <p class="font-semibold text-white">Perguntas frequentes</p>
            <ul class="mt-2 grid gap-2 text-xs text-white/70">
              <li>1. Posso conectar qualquer marketplace? Sim, desde que use o ID local correto da conta.</li>
              <li>2. Quando o saldo entra? Apenas após aprovação da avaliação ou crédito registrado.</li>
              <li>3. O robô IA funciona sem limite? Não, ele segue tempo diário por nível.</li>
              <li>4. Posso pausar a IA? Sim, pelo botão flutuante quando o robô estiver em execução.</li>
              <li>5. Como evitar perda de dados? Faça backup periódico na seção Geral.</li>
            </ul>
          </div>
        </div>

        <div class="mt-4 flex flex-wrap justify-end gap-2">
          <button
            id="informationTutorialGoReviews"
            type="button"
            class="rounded-xl border border-glow-500/35 bg-glow-500/10 px-4 py-2 text-xs font-semibold text-glow-200 transition hover:bg-glow-500/20"
          >
            Ir para Avaliações
          </button>
          <button
            id="informationTutorialDone"
            type="button"
            class="rounded-xl border border-white/10 bg-white/5 px-4 py-2 text-xs font-semibold text-white/80 transition hover:bg-white/10"
          >
            Entendi
          </button>
        </div>
      </div>
    </div>

    <div id="marketplaceConnectOverlay" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60 p-6 backdrop-blur">
      <div class="market-popup-shell w-full max-w-2xl rounded-3xl border border-white/10 p-6">
        <div class="flex items-start justify-between gap-4">
          <div>
            <h3 id="marketplaceConnectTitle" class="text-xl font-semibold">Conectar marketplaces</h3>
            <p id="marketplaceConnectSubtitle" class="text-sm text-white/60">Digite o ID da conta e selecione os marketplaces para conectar.</p>
          </div>
          <button
            id="marketplaceConnectClose"
            class="market-future-btn-ghost px-3 py-2 text-xs font-semibold"
            type="button"
          >
            Fechar
          </button>
        </div>

        <div class="mt-4 grid gap-3 md:grid-cols-[1fr_auto]">
          <input
            id="marketplaceConnectAccountId"
            class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white placeholder:text-white/40"
            type="text"
            placeholder="ID da conta"
            autocomplete="off"
          />
          <button
            id="marketplaceConnectUseLocalId"
            class="market-future-btn-ghost px-4 py-3 text-xs font-semibold"
            type="button"
          >
            Usar ID local
          </button>
        </div>

        <div id="marketplaceConnectSelectionHeader" class="mt-4 flex flex-wrap items-center justify-between gap-3">
          <p class="text-xs text-white/50">Selecione os marketplaces</p>
          <button
            id="marketplaceConnectSelectAll"
            class="market-future-btn-ghost px-3 py-1 text-[11px] font-semibold"
            type="button"
          >
            Selecionar todos
          </button>
        </div>

        <ul id="marketplaceConnectSelectionList" class="support-chat-scroll mt-3 grid max-h-[260px] gap-2 text-sm text-white/80"></ul>
        <p id="marketplaceConnectMessage" class="mt-3 text-xs text-white/60"></p>

        <div class="mt-4 flex flex-wrap justify-end gap-2">
          <button
            id="marketplaceConnectCancel"
            class="market-future-btn-ghost px-4 py-3 text-xs font-semibold"
            type="button"
          >
            Cancelar
          </button>
          <button
            id="marketplaceConnectConfirm"
            class="market-future-btn px-4 py-3 text-xs font-semibold"
            type="button"
          >
            Conectar selecionados
          </button>
        </div>
      </div>
    </div>
    <div id="reviewOverlay" class="fixed inset-0 z-40 hidden items-center justify-center bg-black/60 p-6 backdrop-blur">
      <div class="w-full max-w-xl rounded-3xl border border-white/10 bg-ink-800 p-6 shadow-2xl">
          <div class="flex items-start justify-between gap-4">
            <div>
              <h3 class="text-xl font-semibold">Enviar avaliação</h3>
              <p id="reviewProductInfo" class="text-sm text-white/60"></p>
            </div>
            <div class="flex flex-wrap items-center gap-2">
              <button
                id="reviewOpenProduct"
                class="rounded-xl border border-glow-500/40 bg-glow-500/10 px-3 py-2 text-xs font-semibold text-glow-400 transition hover:bg-glow-500/20"
                type="button"
              >
                Ver produto
              </button>
              <button
                id="reviewToggleTutorial"
                class="rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-xs font-semibold text-white/80 transition hover:bg-white/10"
                type="button"
              >
                Tutorial
              </button>
              <button
                id="reviewCancel"
                class="rounded-xl border border-white/10 px-3 py-2 text-xs font-semibold text-white/80 transition hover:bg-white/10"
                type="button"
              >
                Fechar
              </button>
              <button
                id="reviewOpenSupportAI"
                class="robot-action inline-flex items-center gap-2 rounded-xl px-3 py-2 text-xs font-semibold transition"
                type="button"
                title="Preencher avaliacao com IA"
              >
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" class="h-4 w-4">
                  <rect x="6" y="8" width="12" height="10" rx="3"></rect>
                  <path d="M12 4v3"></path>
                  <circle cx="10" cy="12.5" r="1"></circle>
                  <circle cx="14" cy="12.5" r="1"></circle>
                  <path d="M9.5 15.5h5"></path>
                </svg>
                <span>Auto IA</span>
              </button>
            </div>
          </div>
          <div class="mt-5 space-y-4">
          <div class="grid gap-3 md:grid-cols-2">
            <div>
              <label class="text-xs text-white/60">Nota geral</label>
              <div class="mt-2 flex flex-wrap gap-2">
                <label class="flex items-center gap-2 rounded-full border border-white/10 bg-ink-700 px-3 py-2 text-xs">
                  <input type="radio" name="reviewRating" value="5" class="accent-glow-400" />
                  5
                </label>
                <label class="flex items-center gap-2 rounded-full border border-white/10 bg-ink-700 px-3 py-2 text-xs">
                  <input type="radio" name="reviewRating" value="4" class="accent-glow-400" />
                  4
                </label>
                <label class="flex items-center gap-2 rounded-full border border-white/10 bg-ink-700 px-3 py-2 text-xs">
                  <input type="radio" name="reviewRating" value="3" class="accent-glow-400" />
                  3
                </label>
                <label class="flex items-center gap-2 rounded-full border border-white/10 bg-ink-700 px-3 py-2 text-xs">
                  <input type="radio" name="reviewRating" value="2" class="accent-glow-400" />
                  2
                </label>
                <label class="flex items-center gap-2 rounded-full border border-white/10 bg-ink-700 px-3 py-2 text-xs">
                  <input type="radio" name="reviewRating" value="1" class="accent-glow-400" />
                  1
                </label>
              </div>
            </div>
            <div>
              <label class="text-xs text-white/60">Recomendaria?</label>
              <select
                id="reviewRecommend"
                class="mt-2 w-full rounded-2xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white"
              >
                <option value="">Selecione</option>
                <option value="sim">Sim</option>
                <option value="nao">Não</option>
              </select>
            </div>
          </div>

          <div>
            <label class="text-xs text-white/60">Qualidade do produto</label>
            <select
              id="reviewQuality"
              class="mt-2 w-full rounded-2xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white"
            >
              <option value="">Selecione</option>
              <option value="excelente">Excelente</option>
              <option value="boa">Boa</option>
              <option value="regular">Regular</option>
              <option value="ruim">Ruim</option>
            </select>
          </div>

          <div>
            <label class="text-xs text-white/60">Nome do produto</label>
            <input
              id="reviewTitle"
              class="mt-2 w-full rounded-2xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white placeholder:text-white/40"
              type="text"
              placeholder="Digite o nome do produto"
            />
          </div>

          <div>
            <label class="text-xs text-white/60">Código SKU</label>
            <input
              id="reviewSku"
              class="mt-2 w-full rounded-2xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white placeholder:text-white/40"
              type="text"
              placeholder="Digite o SKU do anúncio"
            />
            <p class="mt-1 text-[11px] text-white/40">Confira o SKU em "Ver produto".</p>
          </div>

          <div>
            <label class="text-xs text-white/60">Seu feedback detalhado</label>
            <textarea
              id="reviewFeedback"
              class="mt-2 w-full rounded-2xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white placeholder:text-white/40"
              rows="4"
              placeholder="Descreva o que achou do produto"
            ></textarea>
          </div>

          <button
            id="reviewSubmit"
            class="mt-2 w-full rounded-xl bg-glow-500 px-4 py-3 text-sm font-semibold text-ink-900 transition hover:bg-glow-400"
            type="button"
          >
            Enviar avaliação
          </button>
          <p id="reviewMessage" class="mt-3 text-xs text-white/60"></p>
        </div>
      </div>
    </div>
    <div id="reviewTutorialOverlay" class="fixed inset-0 z-40 hidden items-center justify-center bg-black/60 p-6 backdrop-blur">
      <div class="w-full max-w-lg rounded-3xl border border-white/10 bg-ink-800 p-6 shadow-2xl">
        <div class="flex items-start justify-between gap-4">
          <div>
            <h3 class="text-xl font-semibold">Passo a passo</h3>
            <p class="text-sm text-white/60">Como preencher a avaliação corretamente.</p>
          </div>
          <button
            id="reviewTutorialClose"
            class="rounded-xl border border-white/10 px-3 py-2 text-xs font-semibold text-white/80 transition hover:bg-white/10"
            type="button"
          >
            Fechar
          </button>
        </div>
        <ol class="mt-4 grid gap-3 text-sm text-white/70">
          <li>1. Clique em "Ver produto" e confira o anúncio real.</li>
          <li>2. Confirme nome, preço, categoria e especificações do item.</li>
          <li>3. Selecione a nota, recomendação e qualidade com base no anúncio.</li>
          <li>4. Digite o nome do produto e escreva um feedback claro.</li>
        </ol>
      </div>
    </div>
    <div id="productOverlay" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60 p-6 backdrop-blur">
      <div class="w-full max-w-2xl rounded-3xl border border-white/10 bg-ink-800 p-6 shadow-2xl">
        <div class="flex items-start justify-between gap-4">
          <div>
            <h3 id="productAdTitle" class="text-xl font-semibold">Anuncio do produto</h3>
            <p id="productAdMarketplace" class="text-sm text-white/60"></p>
          </div>
          <button
            id="productAdClose"
            class="rounded-xl border border-white/10 px-3 py-2 text-xs font-semibold text-white/80 transition hover:bg-white/10"
            type="button"
          >
            Fechar
          </button>
        </div>

        <div class="mt-6 grid gap-6 md:grid-cols-[220px,1fr]">
          <div class="relative h-56 overflow-hidden rounded-2xl border border-white/10 bg-gradient-to-br from-ink-700/80 to-ink-900/80">
            <img
              id="productAdImage"
              class="h-full w-full object-cover opacity-0 transition duration-500"
              src=""
              alt="Imagem do produto"
              loading="lazy"
            />
            <div id="productAdImageFallback" class="absolute inset-0 flex items-center justify-center text-3xl font-semibold text-white/70">
              RP
            </div>
            <div class="pointer-events-none absolute inset-0 bg-gradient-to-t from-ink-900/55 via-transparent to-transparent"></div>
          </div>
          <div class="space-y-4">
            <div class="flex flex-wrap items-center gap-3 text-sm">
              <span class="rounded-full border border-glow-500/40 bg-glow-500/10 px-3 py-1 text-xs text-glow-400">Anuncio VIP</span>
              <span class="rounded-full border border-white/10 px-3 py-1 text-xs text-white/60" id="productAdCategory"></span>
              <span class="rounded-full border border-white/10 px-3 py-1 text-xs text-white/60" id="productAdSku"></span>
            </div>
            <p id="productAdDescription" class="text-sm text-white/70"></p>
            <div class="rounded-2xl border border-white/10 bg-ink-900/60 p-4">
              <p class="text-xs font-semibold uppercase tracking-wide text-white/60">Especificações</p>
              <ul id="productAdSpecs" class="mt-2 grid gap-2 text-xs text-white/70"></ul>
            </div>
            <div class="flex items-center justify-between">
              <div>
                <p class="text-xs text-white/50">Preco</p>
                <p class="text-xl font-semibold" id="productAdPrice">R$ 0,00</p>
              </div>
              <button
                id="productAdExternal"
                class="rounded-xl border border-glow-500/40 bg-glow-500/10 px-4 py-2 text-xs font-semibold text-glow-400 transition hover:bg-glow-500/20"
                type="button"
              >
                Abrir anuncio real
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="toastContainer" class="fixed right-6 top-6 z-[60] flex max-w-sm flex-col gap-3"></div>

    <div id="adminOverlay" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60 p-6 backdrop-blur">
      <div class="w-full max-w-4xl max-h-[85vh] overflow-y-auto rounded-3xl border border-white/10 bg-ink-800 p-6 shadow-2xl">
        <div class="flex items-start justify-between gap-4">
          <div>
            <h3 class="text-xl font-semibold">Sub painel admin</h3>
            <p class="text-sm text-white/60">Controle operacional e aprovações críticas.</p>
          </div>
          <button
            id="adminClose"
            class="rounded-xl border border-white/10 px-3 py-2 text-xs font-semibold text-white/80 transition hover:bg-white/10"
            type="button"
          >
            Fechar
          </button>
        </div>

        <div class="mt-6 grid gap-4 lg:grid-cols-2">
          <section class="rounded-2xl border border-white/10 bg-ink-700/60 p-5">
            <h4 class="text-base font-semibold">Adicionar saldo</h4>
            <p class="mt-1 text-xs text-white/60">Aplicar saldo diretamente na sua conta.</p>
            <p class="mt-2 text-xs text-white/50">Saldo atual: <span id="adminBalanceValue">R$ 0,00</span></p>
            <form id="adminBalanceForm" class="mt-4 grid gap-3">
              <input
                id="adminBalanceAmount"
                class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white placeholder:text-white/40"
                type="text"
                inputmode="decimal"
                placeholder="Valor do saldo"
                required
              />
              <button
                class="rounded-xl bg-glow-500 px-4 py-3 text-sm font-semibold text-ink-900 transition hover:bg-glow-400"
                type="submit"
              >
                Adicionar saldo
              </button>
            </form>
            <p id="adminBalanceMessage" class="mt-3 text-xs text-white/60"></p>
          </section>

          <section class="rounded-2xl border border-white/10 bg-ink-700/60 p-5">
            <h4 class="text-base font-semibold">Limpar saldo</h4>
            <p class="mt-1 text-xs text-white/60">Zera o saldo da carteira da conta atual.</p>
            <button
              id="adminClearBalance"
              class="mt-4 w-full rounded-xl border border-rose-400/40 bg-rose-500/10 px-4 py-3 text-sm font-semibold text-rose-200 transition hover:bg-rose-500/20"
              type="button"
            >
              Zerar saldo agora
            </button>
            <p id="adminClearMessage" class="mt-3 text-xs text-white/60"></p>
          </section>

          <section class="rounded-2xl border border-white/10 bg-ink-700/60 p-5">
            <h4 class="text-base font-semibold">Apagar tudo</h4>
            <p class="mt-1 text-xs text-white/60">Remove todas as avaliações, saldos e dados desta conta.</p>
            <button
              id="adminResetAccount"
              class="mt-4 w-full rounded-xl border border-rose-400/40 bg-rose-500/10 px-4 py-3 text-sm font-semibold text-rose-200 transition hover:bg-rose-500/20"
              type="button"
            >
              Apagar tudo agora
            </button>
            <p id="adminResetMessage" class="mt-3 text-xs text-white/60"></p>
          </section>

          <section class="rounded-2xl border border-white/10 bg-ink-700/60 p-5">
            <h4 class="text-base font-semibold">Auto IA (desbloqueio)</h4>
            <p id="adminAutoAIStatus" class="mt-1 text-xs text-white/60">Sem status no momento.</p>
            <button
              id="adminAutoAIUnlockButton"
              class="mt-4 w-full rounded-xl border border-glow-500/40 bg-glow-500/10 px-4 py-3 text-sm font-semibold text-glow-300 transition hover:bg-glow-500/20"
              type="button"
            >
              Desbloquear Auto IA
            </button>
            <p id="adminAutoAIMessage" class="mt-3 text-xs text-white/60"></p>
          </section>

          <section class="rounded-2xl border border-white/10 bg-ink-700/60 p-5">
            <h4 class="text-base font-semibold">Nível da conta (Robô IA)</h4>
            <p id="adminLevelStatus" class="mt-1 text-xs text-white/60">Sem status no momento.</p>
            <form id="adminLevelForm" class="mt-4 grid gap-3">
              <select
                id="adminLevelSelect"
                class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white"
                required
              ></select>
              <div class="grid gap-2 md:grid-cols-2">
                <button
                  class="rounded-xl border border-glow-500/40 bg-glow-500/10 px-4 py-3 text-sm font-semibold text-glow-200 transition hover:bg-glow-500/20"
                  type="submit"
                >
                  Aplicar nível
                </button>
                <button
                  id="adminLevelResetButton"
                  class="rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm font-semibold text-white transition hover:bg-white/10"
                  type="button"
                >
                  Voltar para automático
                </button>
              </div>
            </form>
            <p id="adminLevelMessage" class="mt-3 text-xs text-white/60"></p>
          </section>

          <section class="rounded-2xl border border-white/10 bg-ink-700/60 p-5">
            <h4 class="text-base font-semibold">Dados da conta (Geral)</h4>
            <p class="mt-1 text-xs text-white/60">Edite as informações exibidas na página Geral.</p>
            <form id="adminProfileForm" class="mt-4 grid gap-3">
              <input
                id="adminProfileOwnerName"
                class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white placeholder:text-white/40"
                type="text"
                placeholder="Nome do dono da conta"
                required
              />
              <input
                id="adminProfileBusinessName"
                class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white placeholder:text-white/40"
                type="text"
                placeholder="Nome da empresa / operação"
              />
              <input
                id="adminProfileEmail"
                class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white placeholder:text-white/40"
                type="email"
                placeholder="Email principal"
              />
              <input
                id="adminProfilePhone"
                class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white placeholder:text-white/40"
                type="text"
                placeholder="Telefone / WhatsApp"
              />
              <input
                id="adminProfileDocument"
                class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white placeholder:text-white/40"
                type="text"
                placeholder="Documento (CPF/CNPJ)"
              />
              <input
                id="adminProfileCityState"
                class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white placeholder:text-white/40"
                type="text"
                placeholder="Cidade / Estado"
              />
              <button
                class="rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm font-semibold text-white transition hover:bg-white/10"
                type="submit"
              >
                Salvar dados da conta
              </button>
            </form>
            <p id="adminProfileMessage" class="mt-3 text-xs text-white/60"></p>
          </section>

          <section class="rounded-2xl border border-white/10 bg-ink-700/60 p-5">
            <h4 class="text-base font-semibold">Suporte IA (ChatGPT)</h4>
            <p class="mt-1 text-xs text-white/60">Defina se o chat usa Atlas local ou ChatGPT real via API.</p>
            <p class="mt-2 text-[11px] text-white/50">A chave da API fica salva somente neste navegador para esta conta.</p>
            <form id="adminSupportAIForm" class="mt-4 grid gap-3">
              <select
                id="adminSupportMode"
                class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white"
              >
                <option value="atlas">Atlas IA local</option>
                <option value="openai">ChatGPT real (OpenAI)</option>
              </select>
              <input
                id="adminSupportModel"
                class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white placeholder:text-white/40"
                type="text"
                placeholder="Modelo (ex: gpt-4o-mini)"
                autocomplete="off"
              />
              <input
                id="adminSupportApiKey"
                class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white placeholder:text-white/40"
                type="password"
                placeholder="OpenAI API key (sk-...)"
                autocomplete="off"
              />
              <div class="grid gap-2 md:grid-cols-2">
                <button
                  class="rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm font-semibold text-white transition hover:bg-white/10"
                  type="submit"
                >
                  Salvar suporte IA
                </button>
                <button
                  id="adminSupportClearKey"
                  class="rounded-xl border border-rose-400/40 bg-rose-500/10 px-4 py-3 text-sm font-semibold text-rose-200 transition hover:bg-rose-500/20"
                  type="button"
                >
                  Limpar chave
                </button>
              </div>
            </form>
            <p id="adminSupportMessage" class="mt-3 text-xs text-white/60"></p>
          </section>

          <section class="rounded-2xl border border-white/10 bg-ink-700/60 p-5">
            <h4 class="text-base font-semibold">Adicionar avaliação</h4>
            <form id="adminReviewForm" class="mt-4 grid gap-3">
              <select
                id="adminMarketplace"
                class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white"
                required
              >
                <option value="">Selecione o marketplace</option>
              </select>
              <input
                id="adminProductName"
                class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white"
                type="text"
                placeholder="Nome do produto"
                required
              />
              <input
                id="adminRewardValue"
                class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white"
                type="text"
                inputmode="decimal"
                placeholder="Recompensa (R$)"
                required
              />
              <button
                class="rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm font-semibold text-white transition hover:bg-white/10"
                type="submit"
              >
                Adicionar avaliação
              </button>
            </form>
            <ul id="adminReviewList" class="mt-4 grid gap-2 text-xs text-white/70"></ul>
          </section>

          <section class="rounded-2xl border border-white/10 bg-ink-700/60 p-5">
            <h4 class="text-base font-semibold">Adicionar saldo bônus</h4>
            <p class="mt-1 text-xs text-white/60">Aplique bônus manualmente para esta conta.</p>
            <p class="mt-2 text-xs text-white/50">Bônus atual: <span id="adminBonusValue">R$ 0,00</span></p>
            <form id="adminBonusForm" class="mt-4 grid gap-3">
              <input
                id="adminBonusAmount"
                class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white placeholder:text-white/40"
                type="text"
                inputmode="decimal"
                placeholder="Valor do bônus"
                required
              />
              <button
                class="rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm font-semibold text-white transition hover:bg-white/10"
                type="submit"
              >
                Adicionar bônus
              </button>
            </form>
            <p id="adminBonusMessage" class="mt-3 text-xs text-white/60"></p>
          </section>

          <section class="rounded-2xl border border-white/10 bg-ink-700/60 p-5">
            <h4 class="text-base font-semibold">Distribuir por período</h4>
            <p class="mt-1 text-xs text-white/60">
              Informe o total dos últimos dias e o sistema distribui por data de forma previsível.
            </p>
            <p class="mt-2 text-xs text-white/50">Total manual (últimos 30 dias): <span id="adminRollingValue">R$ 0,00</span></p>
            <form id="adminRollingForm" class="mt-4 grid gap-3">
              <input
                id="adminRollingDays"
                class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white"
                type="number"
                min="1"
                max="365"
                step="1"
                value="30"
                placeholder="Quantidade de dias"
                required
              />
              <input
                id="adminRollingAmount"
                class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white"
                type="text"
                inputmode="decimal"
                placeholder="Valor total do período (R$)"
                required
              />
              <select
                id="adminRollingMode"
                class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white"
              >
                <option value="equal" selected>Linear (valor dividido por dia)</option>
                <option value="weighted">Inteligente (prioriza dias com histórico)</option>
              </select>
              <button
                class="rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm font-semibold text-white transition hover:bg-white/10"
                type="submit"
              >
                Aplicar no período
              </button>
            </form>
            <button
              id="adminRollingClear"
              class="mt-3 w-full rounded-xl border border-rose-400/40 bg-rose-500/10 px-4 py-2 text-xs font-semibold text-rose-200 transition hover:bg-rose-500/20"
              type="button"
            >
              Limpar valores dos últimos dias
            </button>
            <p id="adminRollingMessage" class="mt-3 text-xs text-white/60"></p>
          </section>

          <section class="rounded-2xl border border-white/10 bg-ink-700/60 p-5">
            <h4 class="text-base font-semibold">Resultado por dia</h4>
            <p class="mt-1 text-xs text-white/60">Crie ou edite o valor do dia que você quiser.</p>
            <form id="adminReportForm" class="mt-4 grid gap-3">
              <input
                id="adminReportDate"
                class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white"
                type="date"
                required
              />
              <input
                id="adminReportAmount"
                class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white"
                type="text"
                inputmode="decimal"
                placeholder="Valor do dia (R$)"
                required
              />
              <button
                class="rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm font-semibold text-white transition hover:bg-white/10"
                type="submit"
              >
                Salvar / atualizar dia
              </button>
            </form>
            <p id="adminReportMessage" class="mt-3 text-xs text-white/60"></p>
            <ul id="adminReportList" class="mt-4 grid gap-2 text-xs text-white/70"></ul>
          </section>

          <section class="rounded-2xl border border-white/10 bg-ink-700/60 p-5">
            <h4 class="text-base font-semibold">Resultado por mês</h4>
            <p class="mt-1 text-xs text-white/60">Defina metas mensais quando não houver granularidade diária.</p>
            <form id="adminReportMonthForm" class="mt-4 grid gap-3">
              <input
                id="adminReportMonth"
                class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white"
                type="month"
                required
              />
              <input
                id="adminReportMonthAmount"
                class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white"
                type="text"
                inputmode="decimal"
                placeholder="Valor do mês (R$)"
                required
              />
              <button
                class="rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm font-semibold text-white transition hover:bg-white/10"
                type="submit"
              >
                Salvar / atualizar mês
              </button>
            </form>
            <p id="adminReportMonthMessage" class="mt-3 text-xs text-white/60"></p>
            <ul id="adminReportMonthList" class="mt-4 grid gap-2 text-xs text-white/70"></ul>
          </section>

          <section class="rounded-2xl border border-white/10 bg-ink-700/60 p-5">
            <h4 class="text-base font-semibold">Aprovar saldos</h4>
            <form id="balanceRequestForm" class="mt-4 grid gap-3">
              <input
                id="balanceRequestLabel"
                class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white"
                type="text"
                placeholder="Solicitante / referência"
                required
              />
              <input
                id="balanceRequestAmount"
                class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white"
                type="text"
                inputmode="decimal"
                placeholder="Valor solicitado"
                required
              />
              <button
                class="rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm font-semibold text-white transition hover:bg-white/10"
                type="submit"
              >
                Registrar solicitação
              </button>
            </form>
            <ul id="balanceRequestList" class="mt-4 grid gap-2 text-xs text-white/70"></ul>
          </section>

          <section class="rounded-2xl border border-white/10 bg-ink-700/60 p-5 lg:col-span-2">
            <h4 class="text-base font-semibold">Aprovar saques</h4>
            <form id="withdrawalRequestForm" class="mt-4 grid gap-3 md:grid-cols-2">
              <input
                id="withdrawalRequestLabel"
                class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white"
                type="text"
                placeholder="Solicitante / referência"
                required
              />
              <input
                id="withdrawalRequestAmount"
                class="w-full rounded-xl border border-white/10 bg-ink-700 px-4 py-3 text-sm text-white"
                type="text"
                inputmode="decimal"
                placeholder="Valor solicitado"
                required
              />
              <div class="md:col-span-2">
                <button
                  class="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm font-semibold text-white transition hover:bg-white/10"
                  type="submit"
                >
                  Registrar solicitação de saque
                </button>
              </div>
            </form>
            <ul id="withdrawalRequestList" class="mt-4 grid gap-2 text-xs text-white/70"></ul>
          </section>
        </div>

        <p class="mt-4 text-xs text-white/50">Atalho: pressione 7 duas vezes rapidamente.</p>
      </div>
    </div>
    <script>
      const authView = document.getElementById('authView');
      const appView = document.getElementById('appView');
      const authMessage = document.getElementById('authMessage');
      const logoutButton = document.getElementById('logoutButton');
      const connectionStatus = document.getElementById('connectionStatus');
      const modeText = document.getElementById('modeText');
      const adminOverlay = document.getElementById('adminOverlay');
      const adminClose = document.getElementById('adminClose');
      const marketplaceConnectOverlay = document.getElementById('marketplaceConnectOverlay');
      const marketplaceConnectClose = document.getElementById('marketplaceConnectClose');
      const marketplaceConnectTitle = document.getElementById('marketplaceConnectTitle');
      const marketplaceConnectSubtitle = document.getElementById('marketplaceConnectSubtitle');
      const marketplaceConnectAccountId = document.getElementById('marketplaceConnectAccountId');
      const marketplaceConnectUseLocalId = document.getElementById('marketplaceConnectUseLocalId');
      const marketplaceConnectSelectionHeader = document.getElementById('marketplaceConnectSelectionHeader');
      const marketplaceConnectSelectAll = document.getElementById('marketplaceConnectSelectAll');
      const marketplaceConnectSelectionList = document.getElementById('marketplaceConnectSelectionList');
      const marketplaceConnectMessage = document.getElementById('marketplaceConnectMessage');
      const marketplaceConnectCancel = document.getElementById('marketplaceConnectCancel');
      const marketplaceConnectConfirm = document.getElementById('marketplaceConnectConfirm');
      const informationTutorialOverlay = document.getElementById('informationTutorialOverlay');
      const informationTutorialOpen = document.getElementById('informationTutorialOpen');
      const informationTutorialClose = document.getElementById('informationTutorialClose');
      const informationTutorialDone = document.getElementById('informationTutorialDone');
      const informationTutorialGoReviews = document.getElementById('informationTutorialGoReviews');
      const reviewOverlay = document.getElementById('reviewOverlay');
      const reviewCancel = document.getElementById('reviewCancel');
      const reviewOpenSupportAI = document.getElementById('reviewOpenSupportAI');
      const reviewSubmit = document.getElementById('reviewSubmit');
      const reviewFeedback = document.getElementById('reviewFeedback');
      const reviewProductInfo = document.getElementById('reviewProductInfo');
      const reviewMessage = document.getElementById('reviewMessage');
      const reviewOpenProduct = document.getElementById('reviewOpenProduct');
      const reviewToggleTutorial = document.getElementById('reviewToggleTutorial');
      const reviewTutorialOverlay = document.getElementById('reviewTutorialOverlay');
      const reviewTutorialClose = document.getElementById('reviewTutorialClose');
      const productOverlay = document.getElementById('productOverlay');
      const productAdTitle = document.getElementById('productAdTitle');
      const productAdMarketplace = document.getElementById('productAdMarketplace');
      const productAdCategory = document.getElementById('productAdCategory');
      const productAdSku = document.getElementById('productAdSku');
      const productAdDescription = document.getElementById('productAdDescription');
      const productAdSpecs = document.getElementById('productAdSpecs');
      const productAdPrice = document.getElementById('productAdPrice');
      const productAdImage = document.getElementById('productAdImage');
      const productAdImageFallback = document.getElementById('productAdImageFallback');
      const productAdExternal = document.getElementById('productAdExternal');
      const productAdClose = document.getElementById('productAdClose');
      const reviewRecommend = document.getElementById('reviewRecommend');
      const reviewQuality = document.getElementById('reviewQuality');
      const reviewTitle = document.getElementById('reviewTitle');
      const reviewSku = document.getElementById('reviewSku');
      const reviewRatingInputs = document.querySelectorAll('input[name="reviewRating"]');
      const prefNotificationsToggle = document.getElementById('prefNotificationsToggle');
      const prefSummaryToggle = document.getElementById('prefSummaryToggle');
      const prefCompactToggle = document.getElementById('prefCompactToggle');
      const autoAiToggleButton = document.getElementById('autoAiToggleButton');
      const autoAiStatus = document.getElementById('autoAiStatus');
      const autoAiProgress = document.getElementById('autoAiProgress');
      const reviewList = document.getElementById('reviewList');
      const reviewListSecondary = document.getElementById('reviewListSecondary');
      const nextReviewInfo = document.getElementById('nextReviewInfo');
      const statActiveReviews = document.getElementById('statActiveReviews');
      const statActiveReviewsMirror = document.getElementById('statActiveReviewsMirror');
      const statExpiringReviews = document.getElementById('statExpiringReviews');
      const statPendingBalances = document.getElementById('statPendingBalances');
      const statPendingWithdrawals = document.getElementById('statPendingWithdrawals');
      const statCompletedReviews = document.getElementById('statCompletedReviews');
      const sidebarGeneralButton = document.getElementById('sidebarGeneralButton');
      const marketplaceList = document.getElementById('marketplaceList');
      const marketplaceConnectedList = document.getElementById('marketplaceConnectedList');
      const marketplaceCatalogList = document.getElementById('marketplaceCatalogList');
      const integrationTabConnected = document.getElementById('integrationTabConnected');
      const integrationTabCatalog = document.getElementById('integrationTabCatalog');
      const integrationPanelConnected = document.getElementById('integrationPanelConnected');
      const integrationPanelCatalog = document.getElementById('integrationPanelCatalog');
      const generalOwnerName = document.getElementById('generalOwnerName');
      const generalBusinessName = document.getElementById('generalBusinessName');
      const generalContactLine = document.getElementById('generalContactLine');
      const generalDocument = document.getElementById('generalDocument');
      const generalCityState = document.getElementById('generalCityState');
      const generalCreatedAt = document.getElementById('generalCreatedAt');
      const generalAccountId = document.getElementById('generalAccountId');
      const generalCurrentLevel = document.getElementById('generalCurrentLevel');
      const generalConnectedCount = document.getElementById('generalConnectedCount');
      const generalReviewsCount = document.getElementById('generalReviewsCount');
      const generalBackupStatus = document.getElementById('generalBackupStatus');
      const generalBackupExport = document.getElementById('generalBackupExport');
      const generalBackupImport = document.getElementById('generalBackupImport');
      const generalBackupFile = document.getElementById('generalBackupFile');
      const generalBackupMessage = document.getElementById('generalBackupMessage');
      const walletBalance = document.getElementById('walletBalance');
      const walletBalanceInline = document.getElementById('walletBalanceInline');
      const walletVisibilityToggle = document.getElementById('walletVisibilityToggle');
      const walletVisibilityLabel = document.getElementById('walletVisibilityLabel');
      const walletEyeOn = document.getElementById('walletEyeOn');
      const walletEyeOff = document.getElementById('walletEyeOff');
      const themeToggleButton = document.getElementById('themeToggleButton');
      const themeToggleLabel = document.getElementById('themeToggleLabel');
      const themeSunIcon = document.getElementById('themeSunIcon');
      const themeMoonIcon = document.getElementById('themeMoonIcon');
      const financeBalance = document.getElementById('financeBalance');
      const financeAvailableBalance = document.getElementById('financeAvailableBalance');
      const financePendingBalance = document.getElementById('financePendingBalance');
      const financePendingWithdrawals = document.getElementById('financePendingWithdrawals');
      const financeApprovedWithdrawals = document.getElementById('financeApprovedWithdrawals');
      const financeRejectedWithdrawals = document.getElementById('financeRejectedWithdrawals');
      const financeBalanceRequestList = document.getElementById('financeBalanceRequestList');
      const financeWithdrawalList = document.getElementById('financeWithdrawalList');
      const financePaymentsFilterPending = document.getElementById('financePaymentsFilterPending');
      const financePaymentsFilterAll = document.getElementById('financePaymentsFilterAll');
      const financeTabOverview = document.getElementById('financeTabOverview');
      const financeTabReports = document.getElementById('financeTabReports');
      const financePanelOverview = document.getElementById('financePanelOverview');
      const financePanelReports = document.getElementById('financePanelReports');
      const userWithdrawalForm = document.getElementById('userWithdrawalForm');
      const userWithdrawalAmount = document.getElementById('userWithdrawalAmount');
      const userWithdrawalKey = document.getElementById('userWithdrawalKey');
      const userWithdrawalKeyInfo = document.getElementById('userWithdrawalKeyInfo');
      const userWithdrawalBankInfo = document.getElementById('userWithdrawalBankInfo');
      const userWithdrawalMessage = document.getElementById('userWithdrawalMessage');
      const salesCustom = document.getElementById('salesCustom');
      const salesStartDate = document.getElementById('salesStartDate');
      const salesEndDate = document.getElementById('salesEndDate');
      const salesApply = document.getElementById('salesApply');
      const salesRangeMessage = document.getElementById('salesRangeMessage');
      const productHighlights = document.getElementById('productHighlights');
      const activityList = document.getElementById('activityList');
      const alertList = document.getElementById('alertList');
      const memberPulseList = document.getElementById('memberPulseList');
      const memberPulseSummary = document.getElementById('memberPulseSummary');
      const memberPulseUpdated = document.getElementById('memberPulseUpdated');
      const memberPulseRefresh = document.getElementById('memberPulseRefresh');
      const quickSync = document.getElementById('quickSync');
      const quickGenerate = document.getElementById('quickGenerate');
      const quickSummary = document.getElementById('quickSummary');
      const supportChatList = document.getElementById('supportChatList');
      const supportChatForm = document.getElementById('supportChatForm');
      const supportChatInput = document.getElementById('supportChatInput');
      const supportChatSend = document.getElementById('supportChatSend');
      const supportAssistantState = document.getElementById('supportAssistantState');
      const supportAssistantModeLabel = document.getElementById('supportAssistantModeLabel');
      const supportTypingIndicator = document.getElementById('supportTypingIndicator');
      const supportTypingLabel = document.getElementById('supportTypingLabel');
      const toastContainer = document.getElementById('toastContainer');
      const reportAverageRating = document.getElementById('reportAverageRating');
      const reportApprovalRate = document.getElementById('reportApprovalRate');
      const reportApprovalTime = document.getElementById('reportApprovalTime');
      const reportApprovedValue = document.getElementById('reportApprovedValue');
      const reportPendingValue = document.getElementById('reportPendingValue');
      const reportApprovedReviews = document.getElementById('reportApprovedReviews');
      const reportSalesValue = document.getElementById('reportSalesValue');
      const reportRangeSelect = document.getElementById('reportRangeSelect');
      const reportCustomDateWrap = document.getElementById('reportCustomDateWrap');
      const reportCustomStartDate = document.getElementById('reportCustomStartDate');
      const reportCustomEndDate = document.getElementById('reportCustomEndDate');
      const reportCustomApply = document.getElementById('reportCustomApply');
      const reportRangeMessage = document.getElementById('reportRangeMessage');
      const reportChart = document.getElementById('reportChart');
      const reportChartLabel = document.getElementById('reportChartLabel');
      const integrationCatalogCount = document.getElementById('integrationCatalogCount');
      const integrationConnectedCount = document.getElementById('integrationConnectedCount');
      const teamMemberForm = document.getElementById('teamMemberForm');
      const teamMemberName = document.getElementById('teamMemberName');
      const teamMemberRole = document.getElementById('teamMemberRole');
      const teamMemberMessage = document.getElementById('teamMemberMessage');
      const teamMemberList = document.getElementById('teamMemberList');
      const vipBonusValue = document.getElementById('vipBonusValue');
      const vipBonusCashout = document.getElementById('vipBonusCashout');
      const levelCurrentName = document.getElementById('levelCurrentName');
      const levelApprovedTotal = document.getElementById('levelApprovedTotal');
      const levelNextTarget = document.getElementById('levelNextTarget');
      const levelDailyMinutes = document.getElementById('levelDailyMinutes');
      const levelUsageText = document.getElementById('levelUsageText');
      const levelRemainingText = document.getElementById('levelRemainingText');
      const levelUsageBar = document.getElementById('levelUsageBar');
      const levelUsagePercentText = document.getElementById('levelUsagePercentText');
      const levelRobotTaskText = document.getElementById('levelRobotTaskText');
      const levelRobotTaskProgressBar = document.getElementById('levelRobotTaskProgressBar');
      const levelRobotTaskPercent = document.getElementById('levelRobotTaskPercent');
      const levelRobotActionButton = document.getElementById('levelRobotActionButton');
      const levelRobotActionStatus = document.getElementById('levelRobotActionStatus');
      const levelRulesTableBody = document.getElementById('levelRulesTableBody');
      const levelRobotLog = document.getElementById('levelRobotLog');
      const aiRobotFloating = document.getElementById('aiRobotFloating');
      const aiRobotFloatingButton = document.getElementById('aiRobotFloatingButton');
      const aiRobotFloatingLabel = document.getElementById('aiRobotFloatingLabel');
      const aiRobotFloatingBar = document.getElementById('aiRobotFloatingBar');

      const adminBalanceForm = document.getElementById('adminBalanceForm');
      const adminBalanceAmount = document.getElementById('adminBalanceAmount');
      const adminBalanceMessage = document.getElementById('adminBalanceMessage');
      const adminBalanceValue = document.getElementById('adminBalanceValue');
      const adminClearBalance = document.getElementById('adminClearBalance');
      const adminClearMessage = document.getElementById('adminClearMessage');
      const adminResetAccount = document.getElementById('adminResetAccount');
      const adminResetMessage = document.getElementById('adminResetMessage');
      const adminAutoAIUnlockButton = document.getElementById('adminAutoAIUnlockButton');
      const adminAutoAIStatus = document.getElementById('adminAutoAIStatus');
      const adminAutoAIMessage = document.getElementById('adminAutoAIMessage');
      const adminLevelForm = document.getElementById('adminLevelForm');
      const adminLevelSelect = document.getElementById('adminLevelSelect');
      const adminLevelStatus = document.getElementById('adminLevelStatus');
      const adminLevelMessage = document.getElementById('adminLevelMessage');
      const adminLevelResetButton = document.getElementById('adminLevelResetButton');
      const adminProfileForm = document.getElementById('adminProfileForm');
      const adminProfileOwnerName = document.getElementById('adminProfileOwnerName');
      const adminProfileBusinessName = document.getElementById('adminProfileBusinessName');
      const adminProfileEmail = document.getElementById('adminProfileEmail');
      const adminProfilePhone = document.getElementById('adminProfilePhone');
      const adminProfileDocument = document.getElementById('adminProfileDocument');
      const adminProfileCityState = document.getElementById('adminProfileCityState');
      const adminProfileMessage = document.getElementById('adminProfileMessage');
      const adminSupportAIForm = document.getElementById('adminSupportAIForm');
      const adminSupportMode = document.getElementById('adminSupportMode');
      const adminSupportModel = document.getElementById('adminSupportModel');
      const adminSupportApiKey = document.getElementById('adminSupportApiKey');
      const adminSupportClearKey = document.getElementById('adminSupportClearKey');
      const adminSupportMessage = document.getElementById('adminSupportMessage');

      const adminReviewForm = document.getElementById('adminReviewForm');
      const adminMarketplace = document.getElementById('adminMarketplace');
      const adminProductName = document.getElementById('adminProductName');
      const adminRewardValue = document.getElementById('adminRewardValue');
      const adminReviewList = document.getElementById('adminReviewList');

      const adminBonusForm = document.getElementById('adminBonusForm');
      const adminBonusAmount = document.getElementById('adminBonusAmount');
      const adminBonusMessage = document.getElementById('adminBonusMessage');
      const adminBonusValue = document.getElementById('adminBonusValue');
      const adminRollingForm = document.getElementById('adminRollingForm');
      const adminRollingDays = document.getElementById('adminRollingDays');
      const adminRollingAmount = document.getElementById('adminRollingAmount');
      const adminRollingMode = document.getElementById('adminRollingMode');
      const adminRollingMessage = document.getElementById('adminRollingMessage');
      const adminRollingValue = document.getElementById('adminRollingValue');
      const adminRollingClear = document.getElementById('adminRollingClear');
      const adminReportForm = document.getElementById('adminReportForm');
      const adminReportDate = document.getElementById('adminReportDate');
      const adminReportAmount = document.getElementById('adminReportAmount');
      const adminReportMessage = document.getElementById('adminReportMessage');
      const adminReportList = document.getElementById('adminReportList');
      const adminReportMonthForm = document.getElementById('adminReportMonthForm');
      const adminReportMonth = document.getElementById('adminReportMonth');
      const adminReportMonthAmount = document.getElementById('adminReportMonthAmount');
      const adminReportMonthMessage = document.getElementById('adminReportMonthMessage');
      const adminReportMonthList = document.getElementById('adminReportMonthList');

      const balanceRequestForm = document.getElementById('balanceRequestForm');
      const balanceRequestLabel = document.getElementById('balanceRequestLabel');
      const balanceRequestAmount = document.getElementById('balanceRequestAmount');
      const balanceRequestList = document.getElementById('balanceRequestList');

      const withdrawalRequestForm = document.getElementById('withdrawalRequestForm');
      const withdrawalRequestLabel = document.getElementById('withdrawalRequestLabel');
      const withdrawalRequestAmount = document.getElementById('withdrawalRequestAmount');
      const withdrawalRequestList = document.getElementById('withdrawalRequestList');

      const accountStoragePrefix = 'reviewpay_account_v2_';
      let privacyMode = false;

      function safeStorageGet(key) {
        try {
          return localStorage.getItem(key);
        } catch (error) {
          return null;
        }
      }

      function safeStorageSet(key, value) {
        try {
          localStorage.setItem(key, value);
        } catch (error) {
          // ignore storage errors
        }
      }

      function safeStorageRemove(key) {
        try {
          localStorage.removeItem(key);
        } catch (error) {
          // ignore storage errors
        }
      }

      const privacyStorageKey = 'privacy_mode_v1';
      privacyMode = safeStorageGet(privacyStorageKey) === '1';
      const themeStorageKey = 'theme_mode_v1';
      let themeMode = safeStorageGet(themeStorageKey) === 'light' ? 'light' : 'dark';

      function sanitizePixText(value) {
        const text = String(value ?? '');
        return text.replace(/(pix\s*:\s*)(.*)$/i, '$1PIX privado');
      }

      function maskSensitiveText(value) {
        const text = String(value ?? '');
        return text.replace(/\d/g, '•');
      }

      function applyPrivacyText(value) {
        const sanitized = sanitizePixText(value);
        return privacyMode ? maskSensitiveText(sanitized) : sanitized;
      }

      function setSensitiveValue(element, value) {
        if (!element) {
          return;
        }
        const text = String(value ?? '');
        const previous = element.dataset.sensitiveValue;
        element.dataset.sensitiveValue = text;
        element.textContent = applyPrivacyText(text);
        if (typeof previous === 'string' && previous !== text) {
          element.classList.remove('value-pop');
          void element.offsetWidth;
          element.classList.add('value-pop');
        }
      }

      function syncPrivacyVisibility() {
        const label = privacyMode ? 'Mostrar valores' : 'Ocultar valores';
        if (walletVisibilityLabel) {
          walletVisibilityLabel.textContent = label;
        }
        if (walletVisibilityToggle) {
          walletVisibilityToggle.setAttribute('aria-pressed', privacyMode ? 'true' : 'false');
          walletVisibilityToggle.setAttribute('title', label);
        }
        if (walletEyeOn) {
          walletEyeOn.classList.toggle('hidden', privacyMode);
        }
        if (walletEyeOff) {
          walletEyeOff.classList.toggle('hidden', !privacyMode);
        }

        const sensitiveElements = [
          walletBalance,
          walletBalanceInline,
          financeBalance,
          financeAvailableBalance,
          financePendingBalance,
          financePendingWithdrawals,
          financeApprovedWithdrawals,
          financeRejectedWithdrawals,
          salesCustom,
          reportAverageRating,
          reportApprovalRate,
          reportApprovalTime,
          reportApprovedValue,
          reportPendingValue,
          reportApprovedReviews,
          reportSalesValue,
          statActiveReviews,
          statActiveReviewsMirror,
          statExpiringReviews,
          statPendingBalances,
          statPendingWithdrawals,
          statCompletedReviews,
          vipBonusValue,
          adminBalanceValue,
          adminBonusValue,
          adminRollingValue,
          productAdPrice,
          reviewProductInfo
        ];

        sensitiveElements.forEach((element) => {
          if (!element) {
            return;
          }
          const stored = element.dataset.sensitiveValue ?? element.textContent ?? '';
          element.dataset.sensitiveValue = stored;
          element.textContent = applyPrivacyText(stored);
        });

        if (reportChart) {
          reportChart.classList.toggle('privacy-blur', privacyMode);
        }

        renderReviewList(true);
        renderAdminReviews();
        renderAdminReportList();
        renderAdminReportMonthList();
        renderFinanceLists();
        renderProductHighlights();
        renderMemberPulse();
        renderActivities();
        renderAlerts();

        if (accountState) {
          updateWalletBalance();
          updateDashboardStats();
          renderRequestList(accountState.balanceRequests || [], balanceRequestList, 'Sem solicitações de saldo.');
          renderRequestList(accountState.withdrawalRequests || [], withdrawalRequestList, 'Sem solicitações de saque.');
        }
      }

      function syncThemeMode() {
        const isLight = themeMode === 'light';
        document.body.classList.toggle('theme-light', isLight);
        const toggleLabel = isLight ? 'Ativar modo noite' : 'Ativar modo dia';
        if (themeToggleLabel) {
          themeToggleLabel.textContent = toggleLabel;
        }
        if (themeToggleButton) {
          themeToggleButton.setAttribute('aria-pressed', isLight ? 'true' : 'false');
          themeToggleButton.setAttribute('title', toggleLabel);
          themeToggleButton.dataset.mode = isLight ? 'light' : 'dark';
        }
        if (themeSunIcon) {
          themeSunIcon.setAttribute('aria-hidden', isLight ? 'true' : 'false');
        }
        if (themeMoonIcon) {
          themeMoonIcon.setAttribute('aria-hidden', isLight ? 'false' : 'true');
        }
      }

      const localAuthKey = 'local_auth_v1';
      const reviewIntervals = [3, 6, 9, 4, 7, 11];
      const reviewTTL = 20 * 60 * 1000;
      const autoIAUnlockTarget = 1000;
      const aiRobotLevels = [
        { id: 'bronze', name: 'Bronze', minApproved: 0, dailyMinutes: 5 },
        { id: 'prata', name: 'Prata', minApproved: 1000, dailyMinutes: 10 },
        { id: 'ouro', name: 'Ouro', minApproved: 3000, dailyMinutes: 20 },
        { id: 'platina', name: 'Platina', minApproved: 7000, dailyMinutes: 35 },
        { id: 'diamante', name: 'Diamante', minApproved: 15000, dailyMinutes: 60 }
      ];
      const aiRobotTickIntervalMs = 1000;
      const aiRobotMaxLogEntries = 80;
      const aiRobotTaskProfiles = {
        submit: { minMs: 75000, maxMs: 150000 },
        generate: { minMs: 55000, maxMs: 110000 },
        idle: { minMs: 35000, maxMs: 70000 }
      };
      const navItems = document.querySelectorAll('[data-section-target]');
      const sections = document.querySelectorAll('[data-section]');
      const productImageSearchCache = new Map();
      let currentUser = null;
      let accountState = null;
      let lastSevenPress = 0;
      let taskTimer = null;
      let countdownTimer = null;
      let lastPendingReviewCount = 0;
      let lastZeroPress = 0;
      let reportResizeTimer = null;
      let revealObserver = null;
      let aiRobotTimer = null;
      let financePaymentsFilterMode = 'pending';
      let aiRobotRunning = false;
      let aiRobotPaused = false;
      let aiRobotLastTickAt = 0;
      let aiRobotConnectedThisSession = false;
      let aiRobotTaskState = null;
      let supportConversationTurns = [];
      let supportRequestInFlight = false;
      let marketplaceConnectSeedId = '';
      let marketplaceConnectSingleMode = false;

      function showAuth() {
        appView.classList.add('hidden');
        authView.classList.remove('hidden');
        closeInformationTutorialOverlay();
        closeMarketplaceConnectOverlay();
      }

      function showApp() {
        authView.classList.add('hidden');
        appView.classList.remove('hidden');
        initializeSurfaceCards();
        initializeRevealObserver();
        setActiveSection('dashboard');
      }

      function setSubTabButtonState(button, active) {
        if (!button) {
          return;
        }
        button.classList.toggle('bg-white/15', active);
        button.classList.toggle('text-white', active);
        if (active) {
          button.classList.remove('text-white/70');
        } else {
          button.classList.add('text-white/70');
        }
      }

      function setIntegrationsTab(tab = 'connected') {
        const currentTab = tab === 'catalog' ? 'catalog' : 'connected';
        if (integrationPanelConnected) {
          integrationPanelConnected.classList.toggle('hidden', currentTab !== 'connected');
        }
        if (integrationPanelCatalog) {
          integrationPanelCatalog.classList.toggle('hidden', currentTab !== 'catalog');
        }
        setSubTabButtonState(integrationTabConnected, currentTab === 'connected');
        setSubTabButtonState(integrationTabCatalog, currentTab === 'catalog');
      }

      function setFinanceTab(tab = 'overview') {
        const currentTab = tab === 'reports' ? 'reports' : 'overview';
        if (financePanelOverview) {
          financePanelOverview.classList.toggle('hidden', currentTab !== 'overview');
        }
        if (financePanelReports) {
          financePanelReports.classList.toggle('hidden', currentTab !== 'reports');
        }
        setSubTabButtonState(financeTabOverview, currentTab === 'overview');
        setSubTabButtonState(financeTabReports, currentTab === 'reports');
        if (currentTab === 'reports') {
          updateReportSummary();
        }
      }

      function setActiveSection(sectionId, options = {}) {
        if (!sectionId) {
          return;
        }
        const requestedSectionId = String(sectionId);
        let normalizedSectionId = requestedSectionId;
        if (normalizedSectionId === 'catalogo') {
          normalizedSectionId = 'integracoes';
        } else if (normalizedSectionId === 'relatorios') {
          normalizedSectionId = 'financeiro';
        }

        sections.forEach((section) => {
          const isActive = section.dataset.section === normalizedSectionId;
          section.classList.toggle('hidden', !isActive);
          if (isActive) {
            section.classList.remove('section-enter');
            void section.offsetWidth;
            section.classList.add('section-enter');
          }
        });
        navItems.forEach((item) => {
          const isActive = item.dataset.sectionTarget === normalizedSectionId;
          item.classList.toggle('bg-white/10', isActive);
          item.classList.toggle('text-white', isActive);
          if (isActive) {
            item.classList.remove('text-white/60');
          } else {
            item.classList.add('text-white/60');
          }
        });

        if (normalizedSectionId === 'geral') {
          renderGeneralSection();
        } else if (normalizedSectionId === 'niveis') {
          renderAIRobotLevelsPanel();
        } else if (normalizedSectionId === 'integracoes') {
          const integrationsTab = options.integrationsTab || (requestedSectionId === 'catalogo' ? 'catalog' : 'connected');
          setIntegrationsTab(integrationsTab);
          renderMarketplaces();
        } else if (normalizedSectionId === 'financeiro') {
          const financeTab = options.financeTab || (requestedSectionId === 'relatorios' ? 'reports' : 'overview');
          setFinanceTab(financeTab);
        } else if (normalizedSectionId === 'suporte') {
          initializeSupportAssistant();
        }
      }

      function initializeSurfaceCards() {
        const targets = document.querySelectorAll(
          '#appView section[data-section] > div, #appView section[data-section] > div > .grid > section'
        );
        targets.forEach((element, index) => {
          if (element.dataset.surfaceReady === '1') {
            return;
          }
          element.dataset.surfaceReady = '1';
          element.classList.add('surface-card', 'reveal-item');
          element.style.setProperty('--reveal-delay', `${Math.min(index * 35, 320)}ms`);
        });
      }

      function initializeRevealObserver() {
        const revealItems = document.querySelectorAll('.reveal-item');
        if (revealItems.length === 0) {
          return;
        }
        if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
          revealItems.forEach((item) => item.classList.add('reveal-visible'));
          return;
        }
        if (revealObserver) {
          revealObserver.disconnect();
        }
        revealObserver = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (!entry.isIntersecting) {
                return;
              }
              entry.target.classList.add('reveal-visible');
              revealObserver.unobserve(entry.target);
            });
          },
          {
            threshold: 0.12
          }
        );
        revealItems.forEach((item) => {
          if (!item.classList.contains('reveal-visible')) {
            revealObserver.observe(item);
          }
        });
      }

      function setUserInfo(user) {
        stopAIRobotAutomation('', true);
        currentUser = user || { id: 'local-user' };
        const storageKey = `${accountStoragePrefix}${currentUser.id || 'default'}`;
        accountState = loadAccountState(storageKey);
        accountState.storageKey = storageKey;
        migrateLegacyRollingSales();
        pruneExpiredReviews();
        accountState.marketplaces = syncMarketplacesWithCatalog(accountState.marketplaces);
        saveAccountState();
        populateAdminMarketplaceOptions();
        populateAdminLevelOptions();
        seedInitialReviews();
        lastPendingReviewCount = accountState.reviews.filter((review) => review.status === 'pending').length;
        if (lastPendingReviewCount > 0) {
          notifyNewTask(lastPendingReviewCount);
        }
        updateWalletBalance();
        renderAllAdminLists();
        renderReviewList();
        renderMarketplaces();
        renderGeneralSection();
        populateAdminProfileForm();
        renderProductHighlights();
        initReportDates();
        initAdminReportDate();
        initAdminReportMonth();
        initSalesReport();
        initializeSupportAssistant(true);
        updateDashboardStats();
        renderAIRobotLevelsPanel();
        renderActivities();
        renderTeamMembers();
        scheduleNextReview();
        startCountdownTimer();
      }

      function ensureAccountProfileState() {
        const defaults = defaultAccountProfile();
        if (!accountState) {
          return { ...defaults };
        }
        if (!accountState.profile || typeof accountState.profile !== 'object') {
          accountState.profile = { ...defaults };
          saveAccountState();
          return accountState.profile;
        }
        const normalized = {
          ownerName: String(accountState.profile.ownerName || defaults.ownerName || '').trim() || defaults.ownerName,
          businessName: String(accountState.profile.businessName || defaults.businessName || '').trim(),
          email: String(accountState.profile.email || '').trim(),
          phone: String(accountState.profile.phone || '').trim(),
          document: String(accountState.profile.document || '').trim(),
          cityState: String(accountState.profile.cityState || '').trim()
        };
        const changed = Object.keys(normalized).some((key) => normalized[key] !== accountState.profile[key]);
        if (changed) {
          accountState.profile = normalized;
          saveAccountState();
        }
        return accountState.profile;
      }

      function formatDateTimeCompact(value) {
        if (!value) {
          return '--';
        }
        const date = new Date(value);
        if (Number.isNaN(date.getTime())) {
          return '--';
        }
        return `${date.toLocaleDateString('pt-BR')} ${date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}`;
      }

      function setGeneralBackupMessage(text, tone = 'neutral') {
        if (!generalBackupMessage) {
          return;
        }
        generalBackupMessage.textContent = text || '';
        const toneClass =
          tone === 'error'
            ? 'text-rose-300'
            : tone === 'success'
              ? 'text-emerald-300'
              : 'text-white/60';
        generalBackupMessage.className = `mt-2 text-xs ${toneClass}`;
      }

      function renderGeneralBackupStatus() {
        if (!generalBackupStatus) {
          return;
        }
        if (!accountState || !accountState.lastBackupAt) {
          generalBackupStatus.textContent = 'Sem backup recente';
          return;
        }
        const label = formatDateTimeCompact(accountState.lastBackupAt);
        generalBackupStatus.textContent = applyPrivacyText(
          label === '--' ? 'Sem backup recente' : `Último backup: ${label}`
        );
      }

      function downloadTextFile(filename, content, mimeType = 'application/json;charset=utf-8') {
        const blob = new Blob([content], { type: mimeType });
        const objectUrl = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = objectUrl;
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        link.remove();
        setTimeout(() => {
          URL.revokeObjectURL(objectUrl);
        }, 100);
      }

      function createAccountBackupPayload() {
        if (!accountState) {
          return null;
        }
        const snapshot = JSON.parse(JSON.stringify(accountState));
        delete snapshot.storageKey;
        return {
          app: 'ReviewPay',
          version: 1,
          exportedAt: new Date().toISOString(),
          accountId: getOrCreateLocalAccountId() || '',
          data: snapshot
        };
      }

      function normalizeImportedAccountState(rawData) {
        const tempStorageKey = `${accountStoragePrefix}__import_tmp_${Date.now()}`;
        safeStorageSet(tempStorageKey, JSON.stringify(rawData));
        const normalized = loadAccountState(tempStorageKey);
        safeStorageRemove(tempStorageKey);
        return normalized;
      }

      function exportAccountBackup() {
        if (!accountState || !accountState.storageKey) {
          return;
        }
        const payload = createAccountBackupPayload();
        if (!payload) {
          return;
        }
        const accountId = String(payload.accountId || 'conta').toLowerCase();
        const stamp = String(payload.exportedAt || new Date().toISOString()).replace(/[:.]/g, '-');
        const filename = `reviewpay-backup-${accountId}-${stamp}.json`;
        downloadTextFile(filename, JSON.stringify(payload, null, 2));
        accountState.lastBackupAt = payload.exportedAt;
        saveAccountState();
        renderGeneralBackupStatus();
        setGeneralBackupMessage('Backup exportado com sucesso.', 'success');
        showToast({
          title: 'Backup concluído',
          message: 'Arquivo de backup gerado com sucesso.',
          type: 'success'
        });
      }

      function importAccountBackupObject(rawPayload) {
        if (!accountState || !accountState.storageKey) {
          return false;
        }
        if (!rawPayload || typeof rawPayload !== 'object') {
          throw new Error('Arquivo inválido.');
        }
        const payloadData =
          rawPayload.data && typeof rawPayload.data === 'object' && !Array.isArray(rawPayload.data)
            ? rawPayload.data
            : rawPayload;
        if (!payloadData || typeof payloadData !== 'object' || Array.isArray(payloadData)) {
          throw new Error('Estrutura de backup inválida.');
        }
        const normalized = normalizeImportedAccountState(payloadData);
        normalized.storageKey = accountState.storageKey;
        const importedDate =
          typeof rawPayload.exportedAt === 'string' && !Number.isNaN(new Date(rawPayload.exportedAt).getTime())
            ? rawPayload.exportedAt
            : new Date().toISOString();
        normalized.lastBackupAt = importedDate;
        safeStorageSet(accountState.storageKey, JSON.stringify(normalized));
        setUserInfo(currentUser || { id: 'local-user' });
        setActiveSection('geral');
        setGeneralBackupMessage('Backup importado com sucesso.', 'success');
        showToast({
          title: 'Backup restaurado',
          message: 'Os dados da conta foram restaurados com sucesso.',
          type: 'success'
        });
        return true;
      }

      function renderGeneralSection() {
        if (!generalOwnerName) {
          return;
        }
        if (!accountState) {
          generalOwnerName.textContent = '--';
          generalBusinessName.textContent = '--';
          generalContactLine.textContent = '--';
          generalDocument.textContent = '--';
          generalCityState.textContent = '--';
          generalCreatedAt.textContent = '--';
          generalAccountId.textContent = '--';
          generalCurrentLevel.textContent = '--';
          generalConnectedCount.textContent = '0';
          generalReviewsCount.textContent = '0';
          renderGeneralBackupStatus();
          setGeneralBackupMessage('');
          return;
        }

        const profile = ensureAccountProfileState();
        const connectedCount = (accountState.marketplaces || [])
          .filter((marketplace) => isMarketplaceConnectionValidForCurrentAccount(marketplace))
          .length;
        const reviewsCount = Array.isArray(accountState.reviews) ? accountState.reviews.length : 0;
        const createdAtDate = accountState.createdAt ? new Date(accountState.createdAt) : null;
        const createdAtLabel = createdAtDate && !Number.isNaN(createdAtDate.getTime())
          ? createdAtDate.toLocaleDateString('pt-BR')
          : '--';
        const contactParts = [profile.email, profile.phone].filter(Boolean);
        const contactLine = contactParts.length > 0 ? contactParts.join(' · ') : '--';
        const levelState = getAIRobotLevelState();

        generalOwnerName.textContent = applyPrivacyText(profile.ownerName || '--');
        generalBusinessName.textContent = applyPrivacyText(profile.businessName || '--');
        generalContactLine.textContent = applyPrivacyText(contactLine);
        generalDocument.textContent = applyPrivacyText(profile.document || '--');
        generalCityState.textContent = applyPrivacyText(profile.cityState || '--');
        generalCreatedAt.textContent = applyPrivacyText(createdAtLabel);
        generalAccountId.textContent = applyPrivacyText(getOrCreateLocalAccountId() || '--');
        generalCurrentLevel.textContent = applyPrivacyText(levelState.currentLevel.name);
        generalConnectedCount.textContent = applyPrivacyText(String(connectedCount));
        generalReviewsCount.textContent = applyPrivacyText(String(reviewsCount));
        renderGeneralBackupStatus();
      }

      function populateAdminProfileForm() {
        if (
          !adminProfileOwnerName
          || !adminProfileBusinessName
          || !adminProfileEmail
          || !adminProfilePhone
          || !adminProfileDocument
          || !adminProfileCityState
        ) {
          return;
        }

        if (!accountState) {
          adminProfileOwnerName.value = '';
          adminProfileBusinessName.value = '';
          adminProfileEmail.value = '';
          adminProfilePhone.value = '';
          adminProfileDocument.value = '';
          adminProfileCityState.value = '';
          return;
        }

        const profile = ensureAccountProfileState();
        adminProfileOwnerName.value = profile.ownerName || '';
        adminProfileBusinessName.value = profile.businessName || '';
        adminProfileEmail.value = profile.email || '';
        adminProfilePhone.value = profile.phone || '';
        adminProfileDocument.value = profile.document || '';
        adminProfileCityState.value = profile.cityState || '';
      }

      function setStatus(text) {
        connectionStatus.textContent = text;
      }

      function isLocalPasswordValid(value) {
        if (!value) {
          return false;
        }
        return String(value).trim().toLowerCase() === 'netosaas';
      }

      function openAdminOverlay() {
        if (appView.classList.contains('hidden')) {
          return;
        }
        initAdminReportDate();
        initAdminReportMonth();
        populateAdminProfileForm();
        adminOverlay.classList.remove('hidden');
        adminOverlay.classList.add('flex');
      }

      function closeAdminOverlay() {
        adminOverlay.classList.add('hidden');
        adminOverlay.classList.remove('flex');
      }

      function toggleAdminOverlay() {
        if (adminOverlay.classList.contains('hidden')) {
          openAdminOverlay();
        } else {
          closeAdminOverlay();
        }
      }

      function loadPreferenceValue(key, defaultValue) {
        const stored = safeStorageGet(key);
        if (stored === null) {
          return defaultValue;
        }
        return stored === 'true';
      }

      function renderLeverToggle(button, enabled, disabled = false) {
        if (!button) {
          return;
        }
        button.dataset.state = enabled ? 'on' : 'off';
        button.setAttribute('aria-pressed', enabled ? 'true' : 'false');
        button.disabled = Boolean(disabled);
        const label = button.querySelector('[data-switch-label]');
        if (label) {
          label.textContent = enabled ? 'ON' : 'OFF';
        }
      }

      function renderPreferenceToggle(button, enabled) {
        renderLeverToggle(button, enabled, false);
      }

      function bindPreferenceToggle(button, key, defaultValue) {
        if (!button) {
          return;
        }
        let enabled = loadPreferenceValue(key, defaultValue);
        renderPreferenceToggle(button, enabled);
        button.addEventListener('click', () => {
          enabled = !enabled;
          safeStorageSet(key, enabled ? 'true' : 'false');
          renderPreferenceToggle(button, enabled);
        });
      }

      const marketplaceCatalog = [
        { id: 'mercado_livre', name: 'Mercado Livre' },
        { id: 'shopee', name: 'Shopee' },
        { id: 'amazon', name: 'Amazon' },
        { id: 'magalu', name: 'Magazine Luiza' },
        { id: 'shein', name: 'Shein' },
        { id: 'aliexpress', name: 'AliExpress' },
        { id: 'americanas', name: 'Americanas' },
        { id: 'casas_bahia', name: 'Casas Bahia' },
        { id: 'ponto', name: 'Ponto' },
        { id: 'kabum', name: 'KaBuM!' },
        { id: 'netshoes', name: 'Netshoes' },
        { id: 'carrefour', name: 'Carrefour' },
        { id: 'extra', name: 'Extra' },
        { id: 'madeiramadeira', name: 'MadeiraMadeira' },
        { id: 'dafiti', name: 'Dafiti' },
        { id: 'enjoei', name: 'Enjoei' },
        { id: 'ebay', name: 'eBay' },
        { id: 'etsy', name: 'Etsy' },
        { id: 'walmart', name: 'Walmart' },
        { id: 'target', name: 'Target' },
        { id: 'bestbuy', name: 'Best Buy' }
      ];

      const productCatalog = {
        mercado_livre: [
          'Smartphone Galaxy A15',
          'Fone JBL Tune 510',
          'Notebook Lenovo Ideapad',
          'Air Fryer Mondial 4L',
          'Caixa de Som JBL Go 3',
          'Cafeteira Espresso Oster',
          'Kit Teclado e Mouse Logitech',
          'Aspirador Portatil WAP',
          'Monitor Samsung 24"',
          'Smart TV LG 55" 4K'
        ],
        shopee: [
          'Tenis Esportivo Olympikus Corre',
          'Relogio Smartwatch Mibro Lite',
          'Mouse Gamer Redragon Cobra',
          'Luminaria LED de Mesa',
          'Camiseta Oversized Basic',
          'Cadeira Gamer Reclinavel',
          'Mini Camera Wi-Fi 1080p',
          'Moletom Street Vintage',
          'Fone Bluetooth Lenovo LP40',
          'Suporte de Celular Ajustavel'
        ],
        amazon: [
          'Echo Dot 5',
          'Kindle 11a geracao',
          'Camera Logitech C920',
          'SSD Kingston NV2 1TB',
          'Fire TV Stick 4K',
          'Monitor AOC 27"',
          'Mouse MX Master 3S',
          'Headset HyperX Cloud Stinger',
          'Roteador TP-Link AX1800',
          'Kindle Paperwhite'
        ],
        magalu: [
          'Cafeteira Arno New Element',
          'Ventilador Arno Turbo 40cm',
          'Smart TV TCL 50" 4K',
          'Liquidificador Philips Walita',
          'Geladeira Brastemp Inverter',
          'Micro-ondas Electrolux 31L',
          'Fogao Atlas 4 bocas',
          'Sanduicheira Mondial Grill',
          'Air Fryer Philco 5,5L',
          'Notebook Acer Aspire 5'
        ],
        shein: [
          'Jaqueta Puffer Feminina',
          'Conjunto Fitness Seamless',
          'Bolsa Tiracolo Minimalista',
          'Tenis Casual Branco',
          'Vestido Midi Floral',
          'Blusa Tricot Manga Longa',
          'Calca Cargo Feminina',
          'Mochila Escolar Casual',
          'Top Esportivo Dry Fit',
          'Shorts Jeans Cintura Alta'
        ],
        aliexpress: [
          'Teclado Mecanico 60%',
          'Drone Mini com Camera',
          'Fone TWS Bluetooth 5.3',
          'Carregador GaN 65W',
          'Smartwatch AMOLED',
          'Mini Projetor Portatil HD',
          'Webcam USB 1080p',
          'Power Bank 20000mAh',
          'Kit Lampadas RGB Wi-Fi',
          'Controle Bluetooth Mobile'
        ],
        americanas: [
          'Smartphone Moto G54',
          'Notebook Dell Inspiron 15',
          'Smart TV Samsung 50"',
          'Bicicleta Aro 29 Caloi',
          'Purificador de Agua Electrolux',
          'Lavadora de Roupas 11kg',
          'Fritadeira Air Fryer 4L',
          'Sofá Retratil 3 Lugares',
          'Cooktop 5 bocas',
          'Cadeira de Escritorio Ergonomica'
        ],
        casas_bahia: [
          'Geladeira Consul Frost Free',
          'Maquina de Lavar 12kg',
          'Sofá Retratil 4 Lugares',
          'Smart TV Philco 43"',
          'Fogao 5 Bocas Brastemp',
          'Guarda-Roupa Casal 6 Portas',
          'Notebook Samsung Book',
          'Ar Condicionado Split 9000 BTUs',
          'Colchao Casal D33',
          'Mesa de Jantar 6 Cadeiras'
        ],
        ponto: [
          'iPhone 13 128GB',
          'PlayStation 5 Slim',
          'Xbox Series S 512GB',
          'TV LG OLED 55"',
          'Soundbar Samsung',
          'Lavadora e Secadora 11kg',
          'Frigobar 93L',
          'Aspirador Robo KaBuM! Smart',
          'Notebook Gamer Lenovo LOQ',
          'Fone JBL Live 660NC'
        ],
        kabum: [
          'Placa de Video RTX 4060',
          'Processador Ryzen 7 5700X',
          'Memoria RAM DDR4 16GB',
          'SSD NVMe 1TB',
          'Gabinete Mid Tower',
          'Fonte 650W 80 Plus Bronze',
          'Water Cooler 240mm',
          'Mouse Gamer Logitech G203',
          'Monitor Gamer 165Hz',
          'Teclado Mecanico Redragon Kumara'
        ],
        netshoes: [
          'Tenis Nike Revolution 7',
          'Tenis Adidas Runfalcon',
          'Camisa Corinthians 2025',
          'Camisa Flamengo 2025',
          'Jaqueta Corta-Vento Puma',
          'Mochila Esportiva Adidas',
          'Bola Nike Strike',
          'Meiao Futebol Penalty',
          'Relogio Garmin Forerunner',
          'Bermuda Dry Fit Masculina'
        ],
        carrefour: [
          'Smart TV 50" 4K',
          'Geladeira Duplex 375L',
          'Micro-ondas 20L',
          'Ferro a Vapor Philips',
          'Liquidificador Arno Power',
          'Panela de Pressao Eletrica',
          'Kit Panelas Antiaderente',
          'Cadeira Gamer',
          'Tablet Samsung Galaxy Tab',
          'Purificador de Ar'
        ],
        extra: [
          'Notebook Positivo Vision',
          'Celular Xiaomi Redmi Note 13',
          'Lava e Seca 10kg',
          'Cooktop Inducao 4 bocas',
          'Forno Eletrico 44L',
          'Cama Box Casal',
          'Smartwatch Samsung Galaxy Fit',
          'Batedeira Planetaria',
          'Aspirador Vertical',
          'Roteador Wi-Fi 6'
        ],
        madeiramadeira: [
          'Sofá Retratil Reclinavel',
          'Painel para TV ate 65"',
          'Guarda-Roupa 3 Portas',
          'Cama Box Baú Casal',
          'Escrivaninha Home Office',
          'Cadeira de Jantar Estofada',
          'Rack com Pes de Madeira',
          'Mesa de Centro Industrial',
          'Armario de Cozinha Completo',
          'Cabeceira Estofada Queen'
        ],
        dafiti: [
          'Tenis Vans Old Skool',
          'Tenis Converse Chuck Taylor',
          'Calca Jeans Skinny',
          'Vestido Midi Preto',
          'Camisa Polo Lacoste',
          'Bolsa Shoulder Bag',
          'Mochila Nike Heritage',
          'Jaqueta Jeans Masculina',
          'Sandalia Plataforma',
          'Relogio Casio Vintage'
        ],
        enjoei: [
          'Jaqueta Jeans Seminova',
          'Bolsa Coach Original',
          'Tenis Adidas Ultraboost',
          'Vestido Farm Estampado',
          'Camiseta Vintage Band',
          'Relogio G-Shock Usado',
          'Fone AirPods 2',
          'Calca Levis 501',
          'Bone New Era',
          'Mochila Fjallraven Kanken'
        ],
        ebay: [
          'Apple Watch Series 8',
          'Canon EOS Rebel T7',
          'Nintendo Switch OLED',
          'GoPro Hero 11',
          'DJI Mini 3',
          'Bose QuietComfort 45',
          'MacBook Air M1',
          'iPad 10th Generation',
          'Samsung Galaxy Buds2 Pro',
          'LEGO Star Wars Set'
        ],
        etsy: [
          'Handmade Ceramic Mug',
          'Personalized Leather Wallet',
          'Minimalist Wall Art Print',
          'Custom Name Necklace',
          'Handmade Soy Candle',
          'Knitted Wool Scarf',
          'Wooden Desk Organizer',
          'Macrame Plant Hanger',
          'Brass Hoop Earrings',
          'Vintage Style Tote Bag'
        ],
        walmart: [
          'Apple AirTag 4 Pack',
          'Instant Pot Duo 6Qt',
          'Dyson V8 Cordless Vacuum',
          'Ninja Blender Professional',
          'HP 15.6 Laptop',
          'Samsung 65" Crystal UHD',
          'Roku Streaming Stick 4K',
          'Shark Robot Vacuum',
          'Keurig K-Express Coffee Maker',
          'Fitbit Charge 6'
        ],
        target: [
          'Apple iPad Air',
          'KitchenAid Stand Mixer',
          'Beats Studio Pro',
          'Sony WH-1000XM5',
          'JBL PartyBox 110',
          'Google Nest Cam',
          'LEGO Technic McLaren',
          'Anker MagSafe Charger',
          'Amazfit GTR Smartwatch',
          'Crock-Pot Slow Cooker'
        ],
        bestbuy: [
          'MacBook Pro 14 M3',
          'Dell XPS 13',
          'Samsung Galaxy S24',
          'Sony PlayStation 5',
          'ASUS ROG Zephyrus G14',
          'LG OLED C4 55"',
          'Bose SoundLink Flex',
          'Meta Quest 3',
          'GoPro Hero 12 Black',
          'Canon PowerShot G7X Mark III'
        ]
      };

      function syncMarketplacesWithCatalog(existingList = []) {
        const existingMap = new Map(
          (Array.isArray(existingList) ? existingList : [])
            .filter((item) => item && item.id)
            .map((item) => [item.id, item])
        );
        return marketplaceCatalog.map((item) => {
          const previous = existingMap.get(item.id);
          const accountId = previous && previous.accountId ? normalizeMarketplaceAccountCode(previous.accountId) : '';
          const connected = previous ? Boolean(previous.connected) && isValidMarketplaceAccountCode(accountId) : false;
          return {
            id: item.id,
            name: item.name,
            connected,
            accountId,
            lastSync: connected && previous ? previous.lastSync || null : null
          };
        });
      }

      function defaultMarketplaces() {
        return syncMarketplacesWithCatalog([]);
      }

      function populateAdminMarketplaceOptions() {
        if (!adminMarketplace) {
          return;
        }
        const currentValue = adminMarketplace.value;
        adminMarketplace.innerHTML = [
          '<option value="">Selecione o marketplace</option>',
          ...marketplaceCatalog.map((item) => `<option value="${item.id}">${item.name}</option>`)
        ].join('');
        const hasCurrent = marketplaceCatalog.some((item) => item.id === currentValue);
        adminMarketplace.value = hasCurrent ? currentValue : '';
      }

      function populateAdminLevelOptions() {
        if (!adminLevelSelect) {
          return;
        }
        const currentValue = adminLevelSelect.value;
        adminLevelSelect.innerHTML = aiRobotLevels
          .map((level) => `<option value="${level.id}">${level.name} • ${level.dailyMinutes} min/dia</option>`)
          .join('');
        const hasCurrent = aiRobotLevels.some((level) => level.id === currentValue);
        adminLevelSelect.value = hasCurrent ? currentValue : aiRobotLevels[0].id;
      }

      function defaultAccountProfile() {
        return {
          ownerName: 'Neto (Owner)',
          businessName: 'ReviewPay Operacao',
          email: '',
          phone: '',
          document: '',
          cityState: ''
        };
      }

      function defaultSupportAssistantConfig() {
        return {
          mode: 'atlas',
          openAIModel: 'gpt-4o-mini',
          openAIApiKey: ''
        };
      }

      function normalizeSupportAssistantMode(value) {
        const mode = String(value || '').trim().toLowerCase();
        return mode === 'openai' ? 'openai' : 'atlas';
      }

      function normalizeSupportAssistantModel(value) {
        const raw = String(value || '')
          .trim()
          .replace(/\s+/g, '');
        const cleaned = raw.replace(/[^a-zA-Z0-9._:-]/g, '');
        return cleaned || defaultSupportAssistantConfig().openAIModel;
      }

      function normalizeSupportAssistantApiKey(value) {
        return String(value || '').trim();
      }

      function normalizeSupportAssistantConfig(config) {
        const defaults = defaultSupportAssistantConfig();
        const source = config && typeof config === 'object' ? config : {};
        return {
          mode: normalizeSupportAssistantMode(source.mode || defaults.mode),
          openAIModel: normalizeSupportAssistantModel(source.openAIModel || defaults.openAIModel),
          openAIApiKey: normalizeSupportAssistantApiKey(source.openAIApiKey || defaults.openAIApiKey)
        };
      }

      function normalizeLocalAccountId(value) {
        return String(value || '')
          .trim()
          .toUpperCase()
          .replace(/[^A-Z0-9]/g, '');
      }

      function isValidLocalAccountId(value) {
        const code = normalizeLocalAccountId(value);
        if (code.length < 8 || code.length > 24) {
          return false;
        }
        if (!/^[A-Z0-9]+$/.test(code)) {
          return false;
        }
        return /[A-Z]/.test(code) && /\d/.test(code);
      }

      function generateLocalAccountId() {
        const alphabet = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
        let code = 'RP';
        for (let i = 0; i < 10; i += 1) {
          const randomIndex = Math.floor(Math.random() * alphabet.length);
          code += alphabet[randomIndex];
        }
        if (!/\d/.test(code)) {
          code = `${code.slice(0, code.length - 1)}7`;
        }
        if (!/[A-Z]/.test(code)) {
          code = `R${code.slice(1)}`;
        }
        return code;
      }

      function getOrCreateLocalAccountId() {
        if (!accountState) {
          return '';
        }
        const normalized = normalizeLocalAccountId(accountState.localAccountId || '');
        if (isValidLocalAccountId(normalized)) {
          if (accountState.localAccountId !== normalized) {
            accountState.localAccountId = normalized;
            saveAccountState();
          }
          return normalized;
        }
        const generated = generateLocalAccountId();
        accountState.localAccountId = generated;
        saveAccountState();
        return generated;
      }

      function getSavedMarketplaceAccountId() {
        if (!accountState) {
          return '';
        }
        const localAccountId = getOrCreateLocalAccountId();
        const savedId = normalizeMarketplaceAccountCode(accountState.marketplaceSavedAccountId || '');
        if (
          savedId
          && isValidMarketplaceAccountCode(savedId)
          && localAccountId
          && savedId === localAccountId
        ) {
          if (accountState.marketplaceSavedAccountId !== savedId) {
            accountState.marketplaceSavedAccountId = savedId;
            saveAccountState();
          }
          return savedId;
        }
        if (accountState.marketplaceSavedAccountId) {
          accountState.marketplaceSavedAccountId = '';
          saveAccountState();
        }
        return '';
      }

      function setSavedMarketplaceAccountId(value) {
        if (!accountState) {
          return '';
        }
        const normalized = normalizeMarketplaceAccountCode(value || '');
        const localAccountId = getOrCreateLocalAccountId();
        if (!normalized || !isValidMarketplaceAccountCode(normalized)) {
          accountState.marketplaceSavedAccountId = '';
          saveAccountState();
          return '';
        }
        if (!localAccountId || normalized !== localAccountId) {
          accountState.marketplaceSavedAccountId = '';
          saveAccountState();
          return '';
        }
        accountState.marketplaceSavedAccountId = normalized;
        saveAccountState();
        return normalized;
      }

      function isMarketplaceConnectionValidForCurrentAccount(marketplace) {
        if (!accountState || !marketplace) {
          return false;
        }
        const accountId = normalizeMarketplaceAccountCode(marketplace.accountId || '');
        const localAccountId = getOrCreateLocalAccountId();
        if (!localAccountId) {
          return false;
        }
        return Boolean(
          marketplace.connected
          && isValidMarketplaceAccountCode(accountId)
          && accountId === localAccountId
        );
      }

      function ensureSupportAssistantConfigState() {
        if (!accountState) {
          return defaultSupportAssistantConfig();
        }
        const normalized = normalizeSupportAssistantConfig(accountState.supportAssistantConfig);
        const previous = accountState.supportAssistantConfig;
        const changed =
          !previous
          || previous.mode !== normalized.mode
          || previous.openAIModel !== normalized.openAIModel
          || previous.openAIApiKey !== normalized.openAIApiKey;
        if (changed) {
          accountState.supportAssistantConfig = normalized;
          saveAccountState();
        }
        return accountState.supportAssistantConfig;
      }

      function defaultAccountState() {
        return {
          createdAt: new Date().toISOString(),
          localAccountId: generateLocalAccountId(),
          marketplaceSavedAccountId: '',
          supportAssistantConfig: defaultSupportAssistantConfig(),
          profile: defaultAccountProfile(),
          balance: 0,
          bonusBalance: 0,
          walletCredits: [],
          bonusHistory: [],
          reviews: [],
          rewards: [],
          balanceRequests: [],
          withdrawalRequests: [],
          manualSales: [],
          manualSalesMonths: [],
          manualRollingSales: null,
          lastManualSaleDate: null,
          marketplaces: defaultMarketplaces(),
          activities: [],
          teamMembers: [
            { id: 'tm-1', name: 'Neto (Owner)', role: 'Administrador', status: 'ativo' },
            { id: 'tm-2', name: 'Equipe VIP', role: 'Operacao', status: 'ativo' }
          ],
          autoAIEnabled: false,
          autoAIAdminUnlocked: false,
          integrationCatalogInitialized: true,
          aiRobotLevelOverrideId: '',
          aiRobotUsage: { day: '', usedMs: 0 },
          aiRobotLogs: [],
          lastBackupAt: '',
          nextReviewAt: 0,
          reviewIntervalIndex: 0
        };
      }

      function seedInitialReviews() {
        if (!accountState) {
          return;
        }
        const pending = accountState.reviews.filter((review) => review.status === 'pending');
        if (pending.length > 0) {
          return;
        }
        const seedCount = 5;
        for (let i = 0; i < seedCount; i += 1) {
          const template = getRandomReviewTemplate();
          if (!template) {
            break;
          }
          accountState.reviews.unshift(createReviewItem(template, 'auto'));
        }
        const interval = reviewIntervals[accountState.reviewIntervalIndex % reviewIntervals.length];
        accountState.reviewIntervalIndex = (accountState.reviewIntervalIndex + 1) % reviewIntervals.length;
        accountState.nextReviewAt = Date.now() + interval * 60 * 1000;
        saveAccountState();
      }

      function loadAccountState(storageKey) {
        const fallback = defaultAccountState();
        if (!storageKey) {
          return fallback;
        }
        try {
          const stored = safeStorageGet(storageKey);
          if (!stored) {
            return { ...fallback };
          }
          const parsed = JSON.parse(stored);
          const rawMarketplaces = Array.isArray(parsed.marketplaces) ? parsed.marketplaces : fallback.marketplaces;
          let syncedMarketplaces = syncMarketplacesWithCatalog(rawMarketplaces);
          if (parsed.integrationCatalogInitialized !== true) {
            syncedMarketplaces = syncedMarketplaces.map((marketplace) => ({
              ...marketplace,
              connected: false,
              lastSync: null
            }));
          }
          const profileDefaults = defaultAccountProfile();
          const rawProfile = parsed.profile && typeof parsed.profile === 'object' ? parsed.profile : {};
          const normalizedProfile = {
            ownerName: String(rawProfile.ownerName || profileDefaults.ownerName || '').trim() || profileDefaults.ownerName,
            businessName: String(rawProfile.businessName || profileDefaults.businessName || '').trim(),
            email: String(rawProfile.email || profileDefaults.email || '').trim(),
            phone: String(rawProfile.phone || profileDefaults.phone || '').trim(),
            document: String(rawProfile.document || profileDefaults.document || '').trim(),
            cityState: String(rawProfile.cityState || profileDefaults.cityState || '').trim()
          };
          const createdAtValue = typeof parsed.createdAt === 'string' && parsed.createdAt ? parsed.createdAt : fallback.createdAt;
          const normalizedLocalAccountId = normalizeLocalAccountId(parsed.localAccountId || '');
          const localAccountId = isValidLocalAccountId(normalizedLocalAccountId)
            ? normalizedLocalAccountId
            : generateLocalAccountId();
          const normalizedSavedMarketplaceAccountId = normalizeMarketplaceAccountCode(parsed.marketplaceSavedAccountId || '');
          const marketplaceSavedAccountId =
            isValidMarketplaceAccountCode(normalizedSavedMarketplaceAccountId)
            && normalizedSavedMarketplaceAccountId === localAccountId
              ? normalizedSavedMarketplaceAccountId
              : '';
          const supportAssistantConfig = normalizeSupportAssistantConfig(parsed.supportAssistantConfig);
          return {
            ...fallback,
            ...parsed,
            createdAt: createdAtValue,
            localAccountId,
            marketplaceSavedAccountId,
            supportAssistantConfig,
            profile: normalizedProfile,
            bonusBalance: Number(parsed.bonusBalance || 0),
            walletCredits: Array.isArray(parsed.walletCredits) ? parsed.walletCredits : [],
            bonusHistory: Array.isArray(parsed.bonusHistory) ? parsed.bonusHistory : [],
            reviews: Array.isArray(parsed.reviews) ? parsed.reviews : [],
            rewards: Array.isArray(parsed.rewards) ? parsed.rewards : [],
            balanceRequests: Array.isArray(parsed.balanceRequests) ? parsed.balanceRequests : [],
            withdrawalRequests: Array.isArray(parsed.withdrawalRequests) ? parsed.withdrawalRequests : [],
            manualSales: Array.isArray(parsed.manualSales) ? parsed.manualSales : [],
            manualSalesMonths: Array.isArray(parsed.manualSalesMonths) ? parsed.manualSalesMonths : [],
            manualRollingSales: parsed.manualRollingSales || null,
            lastManualSaleDate: parsed.lastManualSaleDate || null,
            marketplaces: syncedMarketplaces,
            activities: Array.isArray(parsed.activities) ? parsed.activities : [],
            teamMembers: Array.isArray(parsed.teamMembers) ? parsed.teamMembers : fallback.teamMembers,
            autoAIEnabled: parsed.autoAIEnabled === true,
            autoAIAdminUnlocked: parsed.autoAIAdminUnlocked === true,
            integrationCatalogInitialized: true,
            aiRobotLevelOverrideId:
              typeof parsed.aiRobotLevelOverrideId === 'string'
              && aiRobotLevels.some((level) => level.id === parsed.aiRobotLevelOverrideId)
                ? parsed.aiRobotLevelOverrideId
                : '',
            aiRobotUsage:
              parsed.aiRobotUsage &&
              typeof parsed.aiRobotUsage === 'object' &&
              typeof parsed.aiRobotUsage.day === 'string'
                ? {
                    day: parsed.aiRobotUsage.day,
                    usedMs: Math.max(0, Number(parsed.aiRobotUsage.usedMs || 0))
                  }
                : fallback.aiRobotUsage,
            aiRobotLogs: Array.isArray(parsed.aiRobotLogs)
              ? parsed.aiRobotLogs
                  .filter((entry) => entry && typeof entry.message === 'string')
                  .slice(0, aiRobotMaxLogEntries)
              : [],
            lastBackupAt: typeof parsed.lastBackupAt === 'string' ? parsed.lastBackupAt : ''
          };
        } catch (error) {
          return { ...fallback };
        }
      }

      function saveAccountState() {
        if (!accountState || !accountState.storageKey) {
          return;
        }
        safeStorageSet(accountState.storageKey, JSON.stringify(accountState));
      }

      function roundCurrency(value) {
        return Math.round(value * 100) / 100;
      }

      function recordWalletCredit(amount, source = 'wallet', label = 'Crédito') {
        if (!accountState) {
          return;
        }
        const value = Number(amount || 0);
        if (Number.isNaN(value) || value <= 0) {
          return;
        }
        const entry = {
          id: `credit-${Date.now()}-${Math.random().toString(16).slice(2, 6)}`,
          amount: roundCurrency(value),
          source,
          label,
          createdAt: Date.now()
        };
        accountState.walletCredits = [entry, ...(accountState.walletCredits || [])].slice(0, 200);
      }

      function recordBonusEarned(amount, source = 'review', label = 'Bônus VIP', reviewId = null) {
        if (!accountState) {
          return;
        }
        const value = Number(amount || 0);
        if (Number.isNaN(value) || value <= 0) {
          return;
        }
        if (!Array.isArray(accountState.bonusHistory)) {
          accountState.bonusHistory = [];
        }
        const entry = {
          id: `bonus-${Date.now()}-${Math.random().toString(16).slice(2, 6)}`,
          amount: roundCurrency(value),
          source,
          label,
          reviewId: reviewId || null,
          createdAt: Date.now()
        };
        accountState.bonusHistory = [entry, ...accountState.bonusHistory].slice(0, 200);
      }

      const currencyFormatter = new Intl.NumberFormat('pt-BR', {
        style: 'currency',
        currency: 'BRL'
      });

      function formatCurrency(value) {
        const numberValue = Number(value || 0);
        return currencyFormatter.format(Number.isNaN(numberValue) ? 0 : numberValue);
      }

      function escapeHtml(value) {
        const text = String(value ?? '');
        return text
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#39;');
      }

      function getLocalDateKey(date) {
        if (!(date instanceof Date) || Number.isNaN(date.getTime())) {
          return '';
        }
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
      }

      function formatDateInput(date) {
        return getLocalDateKey(date);
      }

      function parseDateInput(value, isEnd = false) {
        if (!value) {
          return null;
        }
        const [year, month, day] = value.split('-').map(Number);
        if (!year || !month || !day) {
          return null;
        }
        return new Date(year, month - 1, day, isEnd ? 23 : 0, isEnd ? 59 : 0, isEnd ? 59 : 0, isEnd ? 999 : 0);
      }

      function formatMoney(value) {
        const numberValue = Number(value || 0);
        return numberValue.toFixed(2);
      }

      function normalizeAmountInput(value) {
        const raw = String(value ?? '').trim();
        if (!raw) {
          return null;
        }
        let text = raw.replace(/\s+/g, '').replace(/R\$/gi, '');
        text = text.replace(/[^0-9,.-]/g, '');
        if (!text) {
          return null;
        }

        const hasComma = text.includes(',');
        const dotCount = (text.match(/\./g) || []).length;
        const commaCount = (text.match(/,/g) || []).length;
        const hasDot = dotCount > 0;

        if (hasComma && hasDot) {
          const lastComma = text.lastIndexOf(',');
          const lastDot = text.lastIndexOf('.');
          if (lastComma > lastDot) {
            text = text.replace(/\./g, '').replace(/,/g, '.');
          } else {
            text = text.replace(/,/g, '');
          }
        } else if (hasComma) {
          const isCommaThousand = /^-?\d{1,3}(,\d{3})+$/.test(text);
          if (isCommaThousand) {
            text = text.replace(/,/g, '');
          } else {
            text = text.replace(/,/g, '.');
          }
        } else if (dotCount > 1) {
          const isDotThousand = /^-?\d{1,3}(\.\d{3})+$/.test(text);
          if (isDotThousand) {
            text = text.replace(/\./g, '');
          } else {
            const parts = text.split('.');
            const decimals = parts.pop();
            text = `${parts.join('')}.${decimals}`;
          }
        } else if (dotCount === 1) {
          const parts = text.split('.');
          if (parts[1] && parts[1].length === 3 && !hasComma && commaCount === 0) {
            text = `${parts[0]}${parts[1]}`;
          }
        }

        const parsed = Number(text);
        if (!Number.isFinite(parsed)) {
          return null;
        }
        return parsed;
      }

      function parseAmount(value) {
        const parsed = normalizeAmountInput(value);
        if (Number.isNaN(parsed) || parsed <= 0) {
          return null;
        }
        return parsed;
      }

      function parseAmountAllowZero(value) {
        const parsed = normalizeAmountInput(value);
        if (parsed === null || Number.isNaN(parsed) || parsed < 0) {
          return null;
        }
        return parsed;
      }

      function onlyDigits(value) {
        return String(value || '').replace(/\D/g, '');
      }

      function isValidCPF(cpfDigits) {
        const digits = onlyDigits(cpfDigits);
        if (digits.length !== 11 || /^(\d)\1{10}$/.test(digits)) {
          return false;
        }
        const calcCheck = (base, factorStart) => {
          let total = 0;
          for (let i = 0; i < base.length; i += 1) {
            total += Number(base[i]) * (factorStart - i);
          }
          const remainder = (total * 10) % 11;
          return remainder === 10 ? 0 : remainder;
        };
        const firstCheck = calcCheck(digits.slice(0, 9), 10);
        const secondCheck = calcCheck(digits.slice(0, 10), 11);
        return firstCheck === Number(digits[9]) && secondCheck === Number(digits[10]);
      }

      function isValidCNPJ(cnpjDigits) {
        const digits = onlyDigits(cnpjDigits);
        if (digits.length !== 14 || /^(\d)\1{13}$/.test(digits)) {
          return false;
        }
        const calcCheck = (base, factors) => {
          let total = 0;
          for (let i = 0; i < factors.length; i += 1) {
            total += Number(base[i]) * factors[i];
          }
          const remainder = total % 11;
          return remainder < 2 ? 0 : 11 - remainder;
        };
        const firstCheck = calcCheck(digits.slice(0, 12), [5, 4, 3, 2, 9, 8, 7, 6, 5, 4, 3, 2]);
        const secondCheck = calcCheck(digits.slice(0, 13), [6, 5, 4, 3, 2, 9, 8, 7, 6, 5, 4, 3, 2]);
        return firstCheck === Number(digits[12]) && secondCheck === Number(digits[13]);
      }

      function normalizePixPhoneDigits(rawDigits) {
        const digits = onlyDigits(rawDigits);
        if (digits.length === 12 || digits.length === 13) {
          if (digits.startsWith('55')) {
            return `+${digits}`;
          }
        }
        if (digits.length === 10 || digits.length === 11) {
          return `+55${digits}`;
        }
        return '';
      }

      function isValidPixPhoneDigits(rawDigits) {
        const digits = onlyDigits(rawDigits);
        let local = digits;
        if ((digits.length === 12 || digits.length === 13) && digits.startsWith('55')) {
          local = digits.slice(2);
        }
        if (!(local.length === 10 || local.length === 11)) {
          return false;
        }
        const ddd = Number(local.slice(0, 2));
        if (!Number.isInteger(ddd) || ddd < 11 || ddd > 99) {
          return false;
        }
        const numberPart = local.slice(2);
        return !/^0+$/.test(numberPart);
      }

      function inferBankByEmailDomain(domainValue) {
        const domain = String(domainValue || '').toLowerCase().trim();
        if (!domain) {
          return '';
        }
        const entries = [
          { domain: 'nubank.com.br', bank: 'Nubank' },
          { domain: 'itau.com.br', bank: 'Itaú' },
          { domain: 'bradesco.com.br', bank: 'Bradesco' },
          { domain: 'santander.com.br', bank: 'Santander' },
          { domain: 'bb.com.br', bank: 'Banco do Brasil' },
          { domain: 'bancodobrasil.com.br', bank: 'Banco do Brasil' },
          { domain: 'caixa.gov.br', bank: 'Caixa Econômica Federal' },
          { domain: 'inter.com.br', bank: 'Banco Inter' },
          { domain: 'c6bank.com.br', bank: 'C6 Bank' },
          { domain: 'picpay.com', bank: 'PicPay' },
          { domain: 'mercadopago.com.br', bank: 'Mercado Pago' },
          { domain: 'sicredi.com.br', bank: 'Sicredi' },
          { domain: 'sicoob.com.br', bank: 'Sicoob' }
        ];
        const found = entries.find((entry) => domain === entry.domain || domain.endsWith(`.${entry.domain}`));
        return found ? found.bank : '';
      }

      function inferBankByPixKeyAuto(pixData) {
        if (!pixData || !pixData.valid) {
          return '';
        }
        if (pixData.bank) {
          return pixData.bank;
        }
        const bankList = [
          'Banco do Brasil',
          'Caixa Econômica Federal',
          'Bradesco',
          'Itaú',
          'Santander',
          'Nubank',
          'Banco Inter',
          'C6 Bank',
          'PicPay',
          'Mercado Pago',
          'Sicredi',
          'Sicoob'
        ];
        const seed = hashString(`${pixData.type}:${pixData.normalized}`);
        return bankList[seed % bankList.length];
      }

      function detectPixKey(value) {
        const raw = String(value || '').trim();
        if (!raw) {
          return {
            valid: false,
            type: '',
            normalized: '',
            bank: '',
            reason: 'Informe sua chave PIX.'
          };
        }

        const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
        if (uuidRegex.test(raw)) {
          return {
            valid: true,
            type: 'aleatoria',
            normalized: raw.toLowerCase(),
            bank: ''
          };
        }

        const emailRegex = /^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$/i;
        if (emailRegex.test(raw)) {
          const normalized = raw.toLowerCase();
          const domain = normalized.split('@')[1] || '';
          return {
            valid: true,
            type: 'email',
            normalized,
            bank: inferBankByEmailDomain(domain)
          };
        }

        const digits = onlyDigits(raw);
        if (digits.length === 11 && isValidCPF(digits)) {
          return {
            valid: true,
            type: 'cpf',
            normalized: digits,
            bank: ''
          };
        }

        if (digits.length === 14 && isValidCNPJ(digits)) {
          return {
            valid: true,
            type: 'cnpj',
            normalized: digits,
            bank: ''
          };
        }

        if (isValidPixPhoneDigits(digits)) {
          return {
            valid: true,
            type: 'celular',
            normalized: normalizePixPhoneDigits(digits),
            bank: ''
          };
        }

        return {
          valid: false,
          type: '',
          normalized: '',
          bank: '',
          reason: 'Chave PIX inválida. Use CPF, CNPJ, e-mail, celular ou chave aleatória válida.'
        };
      }

      function getPixTypeLabel(type) {
        switch (type) {
          case 'cpf':
            return 'CPF';
          case 'cnpj':
            return 'CNPJ';
          case 'email':
            return 'E-mail';
          case 'celular':
            return 'Celular';
          case 'aleatoria':
            return 'Aleatória';
          default:
            return 'PIX';
        }
      }

      function updateUserWithdrawalPixState() {
        if (!userWithdrawalKey) {
          return;
        }
        const rawInput = String(userWithdrawalKey.value || '').trim();
        if (!rawInput) {
          if (userWithdrawalKeyInfo) {
            userWithdrawalKeyInfo.textContent = 'Chaves aceitas: CPF, CNPJ, e-mail, celular e aleatória (UUID).';
            userWithdrawalKeyInfo.className = 'text-[11px] text-white/50';
          }
          if (userWithdrawalBankInfo) {
            userWithdrawalBankInfo.textContent = 'Banco de destino será detectado automaticamente.';
            userWithdrawalBankInfo.className = 'text-[11px] text-white/50';
          }
          return {
            valid: false,
            reason: 'Informe sua chave PIX.'
          };
        }
        const pixData = detectPixKey(rawInput);
        if (userWithdrawalKeyInfo) {
          userWithdrawalKeyInfo.textContent = pixData.valid
            ? `Chave válida (${getPixTypeLabel(pixData.type)}).`
            : (pixData.reason || 'Informe uma chave PIX válida.');
          userWithdrawalKeyInfo.className = `text-[11px] ${pixData.valid ? 'text-emerald-300' : 'text-rose-300'}`;
        }

        if (!pixData.valid) {
          if (userWithdrawalBankInfo) {
            userWithdrawalBankInfo.textContent = '';
            userWithdrawalBankInfo.className = 'text-[11px] text-white/50';
          }
          return pixData;
        }

        const detectedBank = inferBankByPixKeyAuto(pixData);
        if (userWithdrawalBankInfo) {
          userWithdrawalBankInfo.textContent = detectedBank
            ? `Banco de destino detectado automaticamente: ${detectedBank}.`
            : 'Não foi possível detectar banco automaticamente.';
          userWithdrawalBankInfo.className = `text-[11px] ${detectedBank ? 'text-sky-300' : 'text-amber-300'}`;
        }
        return {
          ...pixData,
          bank: detectedBank
        };
      }

      function formatCurrencyInputValue(value) {
        const parsed = normalizeAmountInput(value);
        if (parsed === null) {
          return '';
        }
        const numericText = String(parsed).replace('.', ',');
        return formatCurrencyTypingValue(numericText);
      }

      function formatCurrencyTypingValue(value) {
        const raw = String(value ?? '');
        if (!raw.trim()) {
          return '';
        }

        let text = raw.replace(/\s+/g, '').replace(/R\$/gi, '');
        text = text.replace(/[^0-9,\.]/g, '');
        if (!text) {
          return '';
        }

        const lastComma = text.lastIndexOf(',');
        const lastDot = text.lastIndexOf('.');
        let decimalIndex = -1;

        if (lastComma >= 0 || lastDot >= 0) {
          const candidateIndex = Math.max(lastComma, lastDot);
          const separator = text[candidateIndex];
          const rightRaw = text.slice(candidateIndex + 1);
          const rightDigits = rightRaw.replace(/\D/g, '');
          if (separator === ',' || rightRaw.length === 0 || rightDigits.length <= 2) {
            decimalIndex = candidateIndex;
          }
        }

        let integerDigits = '';
        let decimalDigits = '';
        if (decimalIndex >= 0) {
          integerDigits = text.slice(0, decimalIndex).replace(/\D/g, '');
          decimalDigits = text
            .slice(decimalIndex + 1)
            .replace(/\D/g, '')
            .slice(0, 2);
        } else {
          integerDigits = text.replace(/\D/g, '');
        }

        if (integerDigits.length > 1) {
          integerDigits = integerDigits.replace(/^0+(?=\d)/, '');
        }

        const groupedInteger = (integerDigits || '0').replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        if (decimalIndex < 0) {
          return groupedInteger;
        }

        const rightRaw = text.slice(decimalIndex + 1);
        const typedSeparatorAtEnd = rightRaw.length === 0;
        return `${groupedInteger},${typedSeparatorAtEnd ? '' : decimalDigits}`;
      }

      function bindCurrencyMaskInput(input, allowZero = false) {
        if (!input) {
          return;
        }
        input.setAttribute('inputmode', 'decimal');

        const applyTypingMask = () => {
          const raw = String(input.value || '');
          if (!raw.trim()) {
            input.value = '';
            return;
          }
          input.value = formatCurrencyTypingValue(raw);
        };

        const applyMask = () => {
          const raw = String(input.value || '').trim();
          if (!raw) {
            input.value = '';
            return;
          }
          const parsed = normalizeAmountInput(raw);
          if (parsed === null) {
            return;
          }
          if ((!allowZero && parsed <= 0) || (allowZero && parsed < 0)) {
            input.value = '';
            return;
          }
          let masked = formatCurrencyTypingValue(raw);
          if (masked.endsWith(',')) {
            masked = masked.slice(0, -1);
          }
          input.value = masked;
        };
        input.addEventListener('input', applyTypingMask);
        input.addEventListener('keydown', (event) => {
          if (event.key === 'Enter') {
            applyMask();
          }
        });
        input.addEventListener('blur', applyMask);
        input.addEventListener('change', applyMask);
      }

      function parseDateKey(value) {
        if (!value) {
          return null;
        }
        const [year, month, day] = String(value).split('-').map(Number);
        if (!year || !month || !day) {
          return null;
        }
        return new Date(year, month - 1, day, 0, 0, 0);
      }

      function getDateRange(start, end) {
        const range = [];
        if (!(start instanceof Date) || Number.isNaN(start.getTime()) || !(end instanceof Date) || Number.isNaN(end.getTime())) {
          return range;
        }
        const current = new Date(start.getFullYear(), start.getMonth(), start.getDate(), 0, 0, 0, 0);
        const limit = new Date(end.getFullYear(), end.getMonth(), end.getDate(), 0, 0, 0, 0);
        while (current <= limit) {
          range.push(new Date(current));
          current.setDate(current.getDate() + 1);
        }
        return range;
      }

      function getApprovedSalesMapByDate(start, end) {
        const map = new Map();
        const sales = getApprovedSales();
        sales.forEach((sale) => {
          if (!sale?.date || sale.date < start || sale.date > end) {
            return;
          }
          const key = getLocalDateKey(sale.date);
          map.set(key, (map.get(key) || 0) + Number(sale.amount || 0));
        });
        return map;
      }

      function distributeTotalByDays(totalValue, dayCount, weights = null) {
        const count = Number(dayCount || 0);
        if (!Number.isFinite(count) || count <= 0) {
          return [];
        }
        const totalCents = Math.max(0, Math.round(Number(totalValue || 0) * 100));
        let cents = null;

        if (Array.isArray(weights) && weights.length === count) {
          const safeWeights = weights.map((value) => {
            const numeric = Number(value || 0);
            return Number.isFinite(numeric) && numeric > 0 ? numeric : 0;
          });
          const weightTotal = safeWeights.reduce((sum, value) => sum + value, 0);
          if (weightTotal > 0) {
            const raw = safeWeights.map((weight) => (weight / weightTotal) * totalCents);
            cents = raw.map((value) => Math.floor(value));
            let remainder = totalCents - cents.reduce((sum, value) => sum + value, 0);
            if (remainder > 0) {
              const order = raw
                .map((value, index) => ({ index, fraction: value - Math.floor(value) }))
                .sort((a, b) => (b.fraction === a.fraction ? a.index - b.index : b.fraction - a.fraction));
              let cursor = 0;
              while (remainder > 0) {
                cents[order[cursor % order.length].index] += 1;
                remainder -= 1;
                cursor += 1;
              }
            }
          }
        }

        if (!cents) {
          const base = Math.floor(totalCents / count);
          let remainder = totalCents - base * count;
          cents = Array(count).fill(base);
          let cursor = count - 1;
          while (remainder > 0) {
            cents[cursor] += 1;
            remainder -= 1;
            cursor -= 1;
            if (cursor < 0) {
              cursor = count - 1;
            }
          }
        }

        return cents.map((value) => roundCurrency(value / 100));
      }

      function applyManualSalesForRange(start, end, totalValue, mode = 'weighted') {
        if (!accountState) {
          return null;
        }
        const days = getDateRange(start, end);
        if (days.length === 0) {
          return null;
        }
        const keys = days.map((day) => getLocalDateKey(day));
        const approvedMap = getApprovedSalesMapByDate(start, end);
        const weights =
          mode === 'weighted'
            ? keys.map((key) => ((approvedMap.get(key) || 0) > 0 ? 2 : 1))
            : null;
        const distributedValues = distributeTotalByDays(totalValue, keys.length, weights);

        if (!Array.isArray(accountState.manualSales)) {
          accountState.manualSales = [];
        }
        const manualMap = new Map(accountState.manualSales.map((entry) => [entry.date, entry]));
        keys.forEach((key, index) => {
          manualMap.set(key, {
            date: key,
            value: roundCurrency(distributedValues[index] || 0),
            updatedAt: new Date().toISOString()
          });
        });
        accountState.manualSales = Array.from(manualMap.values());
        accountState.manualRollingSales = null;
        accountState.lastManualSaleDate = keys[keys.length - 1] || null;

        return {
          count: keys.length,
          startKey: keys[0],
          endKey: keys[keys.length - 1]
        };
      }

      function applyManualSalesForLastDays(dayCount, totalValue, mode = 'weighted') {
        const safeDays = Math.max(1, Math.min(365, Math.trunc(Number(dayCount || 0) || 0)));
        const now = new Date();
        const end = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59, 999);
        const start = new Date(end);
        start.setDate(end.getDate() - (safeDays - 1));
        start.setHours(0, 0, 0, 0);
        const applied = applyManualSalesForRange(start, end, totalValue, mode);
        if (!applied) {
          return null;
        }
        return {
          ...applied,
          days: safeDays
        };
      }

      function clearManualSalesForRange(start, end) {
        if (!accountState || !Array.isArray(accountState.manualSales)) {
          return 0;
        }
        let removed = 0;
        accountState.manualSales = accountState.manualSales.filter((entry) => {
          const date = parseDateKey(entry?.date);
          if (!date || date < start || date > end) {
            return true;
          }
          removed += 1;
          return false;
        });
        accountState.manualRollingSales = null;
        const sorted = [...accountState.manualSales].sort((a, b) => (a.date < b.date ? 1 : -1));
        accountState.lastManualSaleDate = sorted[0]?.date || null;
        return removed;
      }

      function migrateLegacyRollingSales() {
        if (!accountState || !accountState.manualRollingSales) {
          return;
        }
        const hasManualDays = Array.isArray(accountState.manualSales) && accountState.manualSales.length > 0;
        const hasManualMonths = Array.isArray(accountState.manualSalesMonths) && accountState.manualSalesMonths.length > 0;
        const total = Number(accountState.manualRollingSales.total || 0);
        if (!hasManualDays && !hasManualMonths && Number.isFinite(total) && total >= 0) {
          applyManualSalesForLastDays(30, total, 'equal');
        }
        accountState.manualRollingSales = null;
        saveAccountState();
      }

      function getPendingWithdrawalTotal() {
        if (!accountState) {
          return 0;
        }
        return (accountState.withdrawalRequests || [])
          .filter((request) => request.status === 'pendente')
          .reduce((total, request) => total + Number(request.amount || 0), 0);
      }

      function getAvailableBalance() {
        const balance = accountState ? Number(accountState.balance || 0) : 0;
        return Math.max(0, balance - getPendingWithdrawalTotal());
      }

      function getApprovedSales() {
        if (!accountState) {
          return [];
        }
        const reviewMap = new Map(
          (accountState.reviews || [])
            .filter((review) => review && review.id)
            .map((review) => [String(review.id), review])
        );

        const approvedReviews = (accountState.balanceRequests || [])
          .filter((request) => request.status === 'aprovado' && request.source === 'review')
          .map((request) => {
            const review = request.reviewId ? reviewMap.get(String(request.reviewId)) : null;
            const reviewCompletedAt = review ? Number(review.completedAt || review.createdAt || 0) : 0;
            const timestamp = Number.isFinite(reviewCompletedAt) && reviewCompletedAt > 0
              ? reviewCompletedAt
              : request.approvedAt || request.createdAt || null;
            return {
              amount: Number(request.amount || 0),
              date: timestamp ? new Date(timestamp) : null
            };
          })
          .filter((item) => item.date && !Number.isNaN(item.date.getTime()) && Number.isFinite(item.amount));

        const walletCredits = (accountState.walletCredits || [])
          .map((entry) => {
            const timestamp = entry.createdAt || entry.approvedAt || null;
            return {
              amount: Number(entry.amount || 0),
              date: timestamp ? new Date(timestamp) : null
            };
          })
          .filter((item) => item.date && !Number.isNaN(item.date.getTime()) && Number.isFinite(item.amount));

        return [...approvedReviews, ...walletCredits];
      }

      function getOperationalSales() {
        if (!accountState) {
          return [];
        }
        const reviewMap = new Map(
          (accountState.reviews || [])
            .filter((review) => review && review.id)
            .map((review) => [String(review.id), review])
        );

        const reviewTotals = (accountState.balanceRequests || [])
          .filter((request) => request && request.source === 'review' && request.status !== 'rejeitado')
          .map((request) => {
            const review = request.reviewId ? reviewMap.get(String(request.reviewId)) : null;
            const reviewCompletedAt = review ? Number(review.completedAt || review.createdAt || 0) : 0;
            const timestamp = Number.isFinite(reviewCompletedAt) && reviewCompletedAt > 0
              ? reviewCompletedAt
              : request.createdAt || request.approvedAt || null;
            return {
              amount: Number(request.amount || 0),
              date: timestamp ? new Date(timestamp) : null
            };
          })
          .filter((item) => item.date && !Number.isNaN(item.date.getTime()) && Number.isFinite(item.amount));

        const walletCredits = (accountState.walletCredits || [])
          .map((entry) => {
            const timestamp = entry.createdAt || entry.approvedAt || null;
            return {
              amount: Number(entry.amount || 0),
              date: timestamp ? new Date(timestamp) : null
            };
          })
          .filter((item) => item.date && !Number.isNaN(item.date.getTime()) && Number.isFinite(item.amount));

        return [...reviewTotals, ...walletCredits];
      }

      function getAutoIAApprovedTotal() {
        if (!accountState) {
          return 0;
        }
        const total = (accountState.balanceRequests || [])
          .filter((request) => request && request.source === 'review' && request.status === 'aprovado')
          .reduce((sum, request) => sum + Number(request.amount || 0), 0);
        return roundCurrency(Number.isFinite(total) ? total : 0);
      }

      function getAutoIAUnlockState() {
        const approvedTotal = getAutoIAApprovedTotal();
        const unlockedByTarget = approvedTotal >= autoIAUnlockTarget;
        const unlockedByAdmin = Boolean(accountState && accountState.autoAIAdminUnlocked);
        const unlocked = unlockedByTarget || unlockedByAdmin;
        const remaining = Math.max(0, roundCurrency(autoIAUnlockTarget - approvedTotal));
        const displayApprovedTotal = unlocked ? Math.max(approvedTotal, autoIAUnlockTarget) : approvedTotal;
        return {
          approvedTotal,
          displayApprovedTotal,
          unlockedByTarget,
          unlockedByAdmin,
          unlocked,
          remaining
        };
      }

      function isAutoIAUnlocked() {
        return getAutoIAUnlockState().unlocked;
      }

      function isAutoAIEnabled() {
        return Boolean(accountState && accountState.autoAIEnabled && isAutoIAUnlocked());
      }

      function updateReviewAutoAIButtonState() {
        if (!reviewOpenSupportAI) {
          return;
        }
        const unlockState = getAutoIAUnlockState();
        const unlocked = unlockState.unlocked;
        const enabled = isAutoAIEnabled();
        reviewOpenSupportAI.disabled = !enabled;
        reviewOpenSupportAI.classList.toggle('opacity-50', !enabled);
        reviewOpenSupportAI.classList.toggle('cursor-not-allowed', !enabled);

        if (!accountState) {
          reviewOpenSupportAI.title = 'Auto IA indisponível no momento.';
          return;
        }
        if (!unlocked) {
          reviewOpenSupportAI.title = applyPrivacyText(
            `Auto IA bloqueado. Falta ${formatCurrency(unlockState.remaining)} para liberar.`
          );
          return;
        }
        if (!accountState.autoAIEnabled) {
          reviewOpenSupportAI.title = 'Auto IA desativado em Ferramentas.';
          return;
        }
        reviewOpenSupportAI.title = 'Preencher avaliacao com IA';
      }

      function renderAutoIAToolControl() {
        if (!autoAiToggleButton || !autoAiStatus || !autoAiProgress) {
          updateReviewAutoAIButtonState();
          return;
        }

        if (!accountState) {
          renderLeverToggle(autoAiToggleButton, false, true);
          autoAiStatus.textContent = 'Entre na conta para gerenciar o Auto IA.';
          autoAiStatus.className = 'mt-1 text-[11px] text-white/50';
          autoAiProgress.textContent = '';
          updateReviewAutoAIButtonState();
          return;
        }

        if (typeof accountState.autoAIEnabled !== 'boolean') {
          accountState.autoAIEnabled = false;
        }
        if (typeof accountState.autoAIAdminUnlocked !== 'boolean') {
          accountState.autoAIAdminUnlocked = false;
        }

        const unlockState = getAutoIAUnlockState();
        const unlocked = unlockState.unlocked;
        if (!unlocked && accountState.autoAIEnabled) {
          accountState.autoAIEnabled = false;
          saveAccountState();
        }

        const active = unlocked ? Boolean(accountState.autoAIEnabled) : false;
        renderLeverToggle(autoAiToggleButton, active, !unlocked);

        if (unlocked) {
          autoAiStatus.textContent = active
            ? 'Auto IA ativo: preenchimento automático liberado.'
            : 'Auto IA desativado: você pode ativar quando quiser.';
          autoAiStatus.className = `mt-1 text-[11px] ${active ? 'text-emerald-300' : 'text-white/60'}`;
          autoAiProgress.textContent = applyPrivacyText(
            `Meta liberada com ${formatCurrency(unlockState.displayApprovedTotal)} aprovados.`
          );
        } else {
          autoAiStatus.textContent = 'Bloqueado até completar R$ 1.000,00 em ganhos aprovados.';
          autoAiStatus.className = 'mt-1 text-[11px] text-amber-300';
          autoAiProgress.textContent = applyPrivacyText(
            `Progresso: ${formatCurrency(unlockState.approvedTotal)} / ${formatCurrency(autoIAUnlockTarget)}. Falta ${formatCurrency(unlockState.remaining)}.`
          );
        }
        autoAiProgress.className = 'mt-2 text-[11px] text-white/50';
        updateReviewAutoAIButtonState();
      }

      function renderAdminAutoIAControl() {
        if (!adminAutoAIUnlockButton || !adminAutoAIStatus || !adminAutoAIMessage) {
          return;
        }

        if (!accountState) {
          adminAutoAIUnlockButton.disabled = true;
          adminAutoAIUnlockButton.textContent = 'Desbloquear Auto IA';
          adminAutoAIStatus.textContent = 'Faça login para gerenciar este controle.';
          adminAutoAIStatus.className = 'mt-1 text-xs text-white/60';
          adminAutoAIMessage.textContent = '';
          adminAutoAIMessage.className = 'mt-3 text-xs text-white/60';
          return;
        }

        if (typeof accountState.autoAIAdminUnlocked !== 'boolean') {
          accountState.autoAIAdminUnlocked = false;
        }

        const unlockState = getAutoIAUnlockState();
        const adminUnlocked = unlockState.unlockedByAdmin;
        adminAutoAIUnlockButton.disabled = false;
        adminAutoAIUnlockButton.textContent = adminUnlocked ? 'Rebloquear Auto IA' : 'Desbloquear Auto IA';
        adminAutoAIUnlockButton.className = adminUnlocked
          ? 'mt-4 w-full rounded-xl border border-amber-400/40 bg-amber-500/10 px-4 py-3 text-sm font-semibold text-amber-200 transition hover:bg-amber-500/20'
          : 'mt-4 w-full rounded-xl border border-glow-500/40 bg-glow-500/10 px-4 py-3 text-sm font-semibold text-glow-300 transition hover:bg-glow-500/20';

        if (adminUnlocked || unlockState.unlockedByTarget) {
          adminAutoAIStatus.textContent = applyPrivacyText(
            `Meta dos R$ 1.000,00 concluida. Total aprovado: ${formatCurrency(unlockState.displayApprovedTotal)}.`
          );
          adminAutoAIStatus.className = 'mt-1 text-xs text-emerald-300';
        } else {
          adminAutoAIStatus.textContent = applyPrivacyText(
            `Bloqueado por meta. Progresso: ${formatCurrency(unlockState.approvedTotal)} / ${formatCurrency(autoIAUnlockTarget)}.`
          );
          adminAutoAIStatus.className = 'mt-1 text-xs text-white/60';
        }
      }

      function renderAdminLevelControl() {
        if (!adminLevelSelect || !adminLevelStatus || !adminLevelMessage || !adminLevelResetButton) {
          return;
        }

        populateAdminLevelOptions();

        if (!accountState) {
          adminLevelSelect.disabled = true;
          adminLevelResetButton.disabled = true;
          adminLevelStatus.textContent = 'Faça login para editar o nível do Robô IA.';
          adminLevelStatus.className = 'mt-1 text-xs text-white/60';
          adminLevelMessage.textContent = '';
          adminLevelMessage.className = 'mt-3 text-xs text-white/60';
          return;
        }

        const levelState = getAIRobotLevelState();
        const overrideLevel = getAIRobotLevelOverride();
        adminLevelSelect.disabled = false;
        adminLevelResetButton.disabled = false;

        if (overrideLevel) {
          adminLevelSelect.value = overrideLevel.id;
          adminLevelStatus.textContent = applyPrivacyText(
            `Nível manual ativo: ${overrideLevel.name} (${overrideLevel.dailyMinutes} min/dia).`
          );
          adminLevelStatus.className = 'mt-1 text-xs text-emerald-300';
        } else {
          adminLevelSelect.value = levelState.currentLevel.id;
          adminLevelStatus.textContent = applyPrivacyText(
            `Nível automático atual: ${levelState.currentLevel.name}. Total aprovado: ${formatCurrency(levelState.approvedTotal)}.`
          );
          adminLevelStatus.className = 'mt-1 text-xs text-white/60';
        }
      }

      function renderAdminSupportAssistantConfig() {
        if (!adminSupportMode || !adminSupportModel || !adminSupportApiKey || !adminSupportMessage) {
          return;
        }
        if (!accountState) {
          adminSupportMode.disabled = true;
          adminSupportModel.disabled = true;
          adminSupportApiKey.disabled = true;
          if (adminSupportClearKey) {
            adminSupportClearKey.disabled = true;
          }
          adminSupportMessage.textContent = 'Faça login para configurar o suporte IA.';
          adminSupportMessage.className = 'mt-3 text-xs text-white/60';
          updateSupportAssistantModeLabel();
          return;
        }

        const config = ensureSupportAssistantConfigState();
        adminSupportMode.disabled = false;
        adminSupportModel.disabled = false;
        adminSupportApiKey.disabled = false;
        if (adminSupportClearKey) {
          adminSupportClearKey.disabled = false;
        }
        adminSupportMode.value = config.mode;
        adminSupportModel.value = config.openAIModel;
        adminSupportApiKey.value = config.openAIApiKey;
        updateSupportAssistantModeLabel();

        const runtime = getSupportAssistantRuntime();
        if (runtime.useOpenAI) {
          adminSupportMessage.textContent = `ChatGPT real ativo com o modelo ${runtime.config.openAIModel}.`;
          adminSupportMessage.className = 'mt-3 text-xs text-emerald-300';
        } else if (config.mode === 'openai') {
          adminSupportMessage.textContent = 'Modo ChatGPT está selecionado, mas a API key ainda não foi configurada.';
          adminSupportMessage.className = 'mt-3 text-xs text-amber-300';
        } else {
          adminSupportMessage.textContent = 'Suporte rodando em Atlas IA local.';
          adminSupportMessage.className = 'mt-3 text-xs text-white/60';
        }
      }

      function getCurrentDayKey(dateValue = new Date()) {
        const year = dateValue.getFullYear();
        const month = String(dateValue.getMonth() + 1).padStart(2, '0');
        const day = String(dateValue.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
      }

      function formatMinutesFromMs(valueMs) {
        const minutes = Math.max(0, Number(valueMs || 0)) / 60000;
        if (minutes >= 10) {
          return `${minutes.toFixed(0)} min`;
        }
        return `${minutes.toFixed(1)} min`;
      }

      function ensureAIRobotUsageState() {
        if (!accountState) {
          return { day: getCurrentDayKey(), usedMs: 0 };
        }
        if (!accountState.aiRobotUsage || typeof accountState.aiRobotUsage !== 'object') {
          accountState.aiRobotUsage = { day: '', usedMs: 0 };
        }
        const todayKey = getCurrentDayKey();
        let changed = false;
        if (accountState.aiRobotUsage.day !== todayKey) {
          accountState.aiRobotUsage.day = todayKey;
          accountState.aiRobotUsage.usedMs = 0;
          changed = true;
        }
        const sanitized = Math.max(0, Number(accountState.aiRobotUsage.usedMs || 0));
        if (sanitized !== accountState.aiRobotUsage.usedMs) {
          accountState.aiRobotUsage.usedMs = sanitized;
          changed = true;
        }
        if (changed) {
          saveAccountState();
        }
        return accountState.aiRobotUsage;
      }

      function ensureAIRobotLogState() {
        if (!accountState) {
          return [];
        }
        if (!Array.isArray(accountState.aiRobotLogs)) {
          accountState.aiRobotLogs = [];
          saveAccountState();
        }
        return accountState.aiRobotLogs;
      }

      function getAIRobotLevelById(levelId) {
        if (!levelId) {
          return null;
        }
        return aiRobotLevels.find((level) => level.id === levelId) || null;
      }

      function getAIRobotLevelOverride() {
        if (!accountState || typeof accountState.aiRobotLevelOverrideId !== 'string') {
          return null;
        }
        return getAIRobotLevelById(accountState.aiRobotLevelOverrideId);
      }

      function getAIRobotLevelState() {
        const approvedTotal = getAutoIAApprovedTotal();
        let currentLevel = aiRobotLevels[0];
        let currentIndex = 0;
        aiRobotLevels.forEach((level, index) => {
          if (approvedTotal >= level.minApproved) {
            currentLevel = level;
            currentIndex = index;
          }
        });
        const overrideLevel = getAIRobotLevelOverride();
        if (overrideLevel) {
          currentLevel = overrideLevel;
          currentIndex = aiRobotLevels.findIndex((level) => level.id === overrideLevel.id);
        }
        const nextLevel = currentIndex < aiRobotLevels.length - 1 ? aiRobotLevels[currentIndex + 1] : null;
        const usageState = ensureAIRobotUsageState();
        const dailyLimitMs = currentLevel.dailyMinutes * 60 * 1000;
        const usedMsRaw = Math.max(0, Number(usageState.usedMs || 0));
        const usedMs = Math.min(dailyLimitMs, usedMsRaw);
        if (usedMs !== usedMsRaw && accountState) {
          accountState.aiRobotUsage.usedMs = usedMs;
          saveAccountState();
        }
        const remainingMs = Math.max(0, dailyLimitMs - usedMs);
        const usedPercent = dailyLimitMs > 0 ? Math.min(100, Math.round((usedMs / dailyLimitMs) * 100)) : 0;
        const remainingPercent = Math.max(0, 100 - usedPercent);
        const toNext = nextLevel ? Math.max(0, roundCurrency(nextLevel.minApproved - approvedTotal)) : 0;
        return {
          approvedTotal,
          currentLevel,
          nextLevel,
          dailyLimitMs,
          usedMs,
          remainingMs,
          usedPercent,
          remainingPercent,
          toNext,
          manualOverride: Boolean(overrideLevel)
        };
      }

      function renderAIRobotLogs() {
        if (!levelRobotLog) {
          return;
        }
        if (!accountState) {
          levelRobotLog.innerHTML = '<li class="rounded-xl border border-white/10 bg-ink-800/60 px-3 py-2 text-white/50">Faça login para acompanhar a execução da IA.</li>';
          return;
        }
        const logs = ensureAIRobotLogState();
        if (logs.length === 0) {
          levelRobotLog.innerHTML = '<li class="rounded-xl border border-white/10 bg-ink-800/60 px-3 py-2 text-white/50">Sem ações registradas ainda.</li>';
          return;
        }
        levelRobotLog.innerHTML = logs
          .slice(0, 30)
          .map((entry) => {
            const timestamp = new Date(entry.at || Date.now()).toLocaleTimeString('pt-BR');
            const toneClass = entry.type === 'warn'
              ? 'text-amber-200 border-amber-400/20'
              : entry.type === 'success'
                ? 'text-emerald-200 border-emerald-400/20'
                : 'text-sky-100 border-sky-400/20';
            return `
              <li class="rounded-xl border ${toneClass} bg-ink-800/60 px-3 py-2">
                <p class="text-[10px] text-white/45">${timestamp}</p>
                <p class="mt-1">${applyPrivacyText(entry.message)}</p>
              </li>
            `;
          })
          .join('');
      }

      function pushAIRobotLog(message, type = 'info') {
        if (!accountState || !message) {
          return;
        }
        const logs = ensureAIRobotLogState();
        const entry = {
          id: `air-log-${Date.now()}-${Math.random().toString(16).slice(2, 6)}`,
          at: Date.now(),
          type,
          message: String(message)
        };
        logs.unshift(entry);
        accountState.aiRobotLogs = logs.slice(0, aiRobotMaxLogEntries);
        saveAccountState();
        renderAIRobotLogs();
      }

      function getAIRobotTaskProgressState() {
        if (!aiRobotTaskState) {
          return {
            percent: 0,
            text: aiRobotRunning ? 'IA preparando a próxima tarefa...' : 'Aguardando início do robô.'
          };
        }
        const percent = Math.min(
          100,
          Math.max(0, Math.round((Number(aiRobotTaskState.completedMs || 0) / Math.max(1, Number(aiRobotTaskState.durationMs || 1))) * 100))
        );
        return {
          percent,
          text: aiRobotTaskState.label || 'Executando tarefa'
        };
      }

      function renderAIRobotFloating() {
        if (!aiRobotFloating || !aiRobotFloatingButton || !aiRobotFloatingLabel || !aiRobotFloatingBar) {
          return;
        }
        const shouldShow = Boolean(accountState && aiRobotRunning && !aiRobotPaused);
        aiRobotFloating.classList.toggle('hidden', !shouldShow);
        if (!shouldShow) {
          return;
        }
        const levelState = getAIRobotLevelState();
        const taskState = getAIRobotTaskProgressState();
        const remainingTaskPercent = Math.max(0, 100 - taskState.percent);
        aiRobotFloatingButton.textContent = 'Pausar IA';
        aiRobotFloatingLabel.textContent = `${taskState.text} · faltam ${remainingTaskPercent}%`;
        aiRobotFloatingBar.style.width = `${taskState.percent}%`;
        aiRobotFloatingButton.title = `${levelState.currentLevel.name}: ${formatMinutesFromMs(levelState.remainingMs)} restantes hoje`;
      }

      function renderAIRobotLevelsPanel() {
        if (!levelCurrentName) {
          renderAIRobotFloating();
          return;
        }
        if (!accountState) {
          levelCurrentName.textContent = 'Sem conta';
          setSensitiveValue(levelApprovedTotal, 'R$ 0,00');
          levelNextTarget.textContent = 'Faça login para carregar níveis.';
          levelDailyMinutes.textContent = '0 min';
          levelUsageText.textContent = 'Uso hoje: 0 min / 0 min';
          levelRemainingText.textContent = 'Restante: 0 min';
          levelUsagePercentText.textContent = '0% do tempo diário usado';
          levelUsageBar.style.width = '0%';
          if (levelRobotTaskText) {
            levelRobotTaskText.textContent = 'Aguardando início do robô.';
          }
          if (levelRobotTaskProgressBar) {
            levelRobotTaskProgressBar.style.width = '0%';
          }
          if (levelRobotTaskPercent) {
            levelRobotTaskPercent.textContent = '0% da tarefa atual';
          }
          if (levelRobotActionStatus) {
            levelRobotActionStatus.textContent = 'Robô IA parado.';
          }
          if (levelRobotActionButton) {
            levelRobotActionButton.disabled = true;
            levelRobotActionButton.textContent = 'Iniciar robô';
            levelRobotActionButton.classList.add('opacity-60');
          }
          if (modeText) {
            setSensitiveValue(modeText, 'Operação contínua');
          }
          if (levelRulesTableBody) {
            levelRulesTableBody.innerHTML = aiRobotLevels
              .map((rule) => `
                <tr class="border-t border-white/10">
                  <td class="py-2 pr-3">${rule.name}</td>
                  <td class="py-2 pr-3">${formatCurrency(rule.minApproved)}</td>
                  <td class="py-2">${rule.dailyMinutes} min</td>
                </tr>
              `)
              .join('');
          }
          renderAIRobotLogs();
          renderAIRobotFloating();
          return;
        }

        const levelState = getAIRobotLevelState();
        const taskProgress = getAIRobotTaskProgressState();
        const usageText = `Uso hoje: ${formatMinutesFromMs(levelState.usedMs)} / ${levelState.currentLevel.dailyMinutes} min`;
        const nextText = levelState.manualOverride
          ? `Nível forçado manualmente no admin: ${levelState.currentLevel.name}.`
          : levelState.nextLevel
            ? `${levelState.nextLevel.name} em ${formatCurrency(levelState.nextLevel.minApproved)} (faltam ${formatCurrency(levelState.toNext)})`
            : 'Você já está no nível máximo.';

        levelCurrentName.textContent = levelState.currentLevel.name;
        setSensitiveValue(levelApprovedTotal, formatCurrency(levelState.approvedTotal));
        levelNextTarget.textContent = applyPrivacyText(nextText);
        levelDailyMinutes.textContent = `${levelState.currentLevel.dailyMinutes} min por dia`;
        levelUsageText.textContent = applyPrivacyText(usageText);
        levelRemainingText.textContent = applyPrivacyText(`Restante: ${formatMinutesFromMs(levelState.remainingMs)}`);
        levelUsagePercentText.textContent = `${levelState.usedPercent}% do tempo diário usado`;
        levelUsageBar.style.width = `${levelState.usedPercent}%`;
        if (levelRobotTaskText) {
          levelRobotTaskText.textContent = applyPrivacyText(taskProgress.text);
        }
        if (levelRobotTaskProgressBar) {
          levelRobotTaskProgressBar.style.width = `${taskProgress.percent}%`;
        }
        if (levelRobotTaskPercent) {
          levelRobotTaskPercent.textContent = `${taskProgress.percent}% da tarefa atual`;
        }

        if (levelRulesTableBody) {
          levelRulesTableBody.innerHTML = aiRobotLevels
            .map((rule) => {
              const isCurrent = rule.id === levelState.currentLevel.id;
              const rowClass = isCurrent ? 'border-glow-400/35 text-glow-200 bg-glow-500/10' : 'border-white/10 text-white/70';
              return `
                <tr class="border-t ${rowClass}">
                  <td class="py-2 pr-3 font-semibold">${rule.name}</td>
                  <td class="py-2 pr-3">${applyPrivacyText(formatCurrency(rule.minApproved))}</td>
                  <td class="py-2">${rule.dailyMinutes} min</td>
                </tr>
              `;
            })
            .join('');
        }

        if (levelRobotActionStatus) {
          if (aiRobotRunning && !aiRobotPaused) {
            levelRobotActionStatus.textContent = `Robô IA ativo agora. Restam ${formatMinutesFromMs(levelState.remainingMs)} para hoje.`;
            levelRobotActionStatus.className = 'mt-2 text-xs text-emerald-300';
          } else if (aiRobotRunning && aiRobotPaused) {
            levelRobotActionStatus.textContent = `Robô IA pausado. Restam ${formatMinutesFromMs(levelState.remainingMs)} para hoje.`;
            levelRobotActionStatus.className = 'mt-2 text-xs text-amber-300';
          } else if (levelState.remainingMs <= 0) {
            levelRobotActionStatus.textContent = 'Limite diário da IA encerrado. Volta automaticamente no próximo dia.';
            levelRobotActionStatus.className = 'mt-2 text-xs text-rose-300';
          } else {
            levelRobotActionStatus.textContent = 'Robô IA parado.';
            levelRobotActionStatus.className = 'mt-2 text-xs text-white/60';
          }
        }

        if (levelRobotActionButton) {
          levelRobotActionButton.classList.remove('opacity-60');
          levelRobotActionButton.disabled = false;
          if (!aiRobotRunning) {
            levelRobotActionButton.textContent = 'Iniciar robô';
          } else if (aiRobotPaused) {
            levelRobotActionButton.textContent = 'Retomar robô';
          } else {
            levelRobotActionButton.textContent = 'Pausar robô';
          }
          if (!aiRobotRunning && levelState.remainingMs <= 0) {
            levelRobotActionButton.disabled = true;
            levelRobotActionButton.classList.add('opacity-60');
          }
        }

        if (modeText) {
          if (aiRobotRunning && !aiRobotPaused) {
            setSensitiveValue(modeText, 'Robô IA em execução');
          } else if (aiRobotRunning && aiRobotPaused) {
            setSensitiveValue(modeText, 'Robô IA pausado');
          } else {
            setSensitiveValue(modeText, 'Operação contínua');
          }
        }

        renderAIRobotLogs();
        renderAIRobotFloating();
      }

      function robotEnsureMarketplacesConnected() {
        if (!accountState || !Array.isArray(accountState.marketplaces)) {
          return { syncedCount: 0, fixedCount: 0 };
        }
        const nowIso = new Date().toISOString();
        const localAccountId = getOrCreateLocalAccountId();
        let syncedCount = 0;
        let fixedCount = 0;
        accountState.marketplaces = accountState.marketplaces.map((marketplace) => {
          const originalAccountId = String(marketplace.accountId || '');
          const accountId = normalizeMarketplaceAccountCode(originalAccountId);
          const hasValidConnection =
            Boolean(marketplace.connected)
            && isValidMarketplaceAccountCode(accountId)
            && Boolean(localAccountId)
            && accountId === localAccountId;

          if (!hasValidConnection) {
            const hasInvalidConnectedState = Boolean(marketplace.connected) || Boolean(marketplace.lastSync);
            const changed = hasInvalidConnectedState || originalAccountId !== accountId;
            if (changed) {
              fixedCount += 1;
            }
            return {
              ...marketplace,
              connected: false,
              accountId,
              lastSync: null
            };
          }

          const needsAccountTrim = originalAccountId !== accountId;
          const needsSyncTimestamp = !marketplace.lastSync;
          if (!needsAccountTrim && !needsSyncTimestamp) {
            return marketplace;
          }

          if (needsSyncTimestamp) {
            syncedCount += 1;
          }
          fixedCount += 1;
          return {
            ...marketplace,
            connected: true,
            accountId,
            lastSync: needsSyncTimestamp ? nowIso : marketplace.lastSync
          };
        });
        return { syncedCount, fixedCount };
      }

      function robotGenerateReviewOnce(templateOverride = null) {
        if (!accountState) {
          return null;
        }
        const pendingCount = accountState.reviews.filter((review) => review.status === 'pending').length;
        if (pendingCount >= 12) {
          return null;
        }
        const template = templateOverride || getRandomReviewTemplate();
        if (!template) {
          return null;
        }
        accountState.reviews.unshift(createReviewItem(template, 'auto'));
        return `Nova avaliação gerada: ${template.marketplaceName} · ${template.productName}.`;
      }

      function robotSubmitReviewOnce(reviewId = null) {
        if (!accountState) {
          return null;
        }
        const reviewIndex = accountState.reviews.findIndex(
          (review) => review.status === 'pending' && (!reviewId || review.id === reviewId)
        );
        if (reviewIndex < 0) {
          return null;
        }
        const review = accountState.reviews[reviewIndex];
        const autoData = getReviewAutoFillData(review);
        const quality = autoData.quality || 'boa';
        const bonusIncrement = Math.min(MAX_VIP_BONUS_PER_TASK, calculateBonusByQuality(quality));
        const completedAt = Date.now();
        const rewardAmount = Number(review.reward || 0);
        accountState.reviews[reviewIndex] = {
          ...review,
          reward: rewardAmount,
          status: 'submitted',
          feedback: autoData.feedback,
          details: {
            rating: Number(autoData.rating || 4),
            recommend: autoData.recommend || 'sim',
            quality,
            title: autoData.title || review.productName,
            note: autoData.feedback
          },
          bonusEarned: bonusIncrement,
          completedAt,
          approvedAt: null,
          rejectedAt: null
        };
        accountState.bonusBalance = roundCurrency((accountState.bonusBalance || 0) + bonusIncrement);
        recordBonusEarned(bonusIncrement, 'review', 'Bônus VIP', review.id);
        const approvalRequest = {
          id: `review-${review.id}`,
          label: `Avaliação: ${review.marketplaceName} · ${review.productName}`,
          amount: formatMoney(rewardAmount),
          status: 'pendente',
          source: 'review',
          reviewId: review.id,
          createdAt: completedAt,
          approvedAt: null
        };
        accountState.balanceRequests = [
          approvalRequest,
          ...(accountState.balanceRequests || []).filter((request) => request.id !== approvalRequest.id)
        ];
        return `Avaliação enviada automaticamente: ${review.marketplaceName} · ${review.productName}.`;
      }

      function getAIRobotSpeedFactor(levelId) {
        switch (String(levelId || '').toLowerCase()) {
          case 'bronze':
            return 1.18;
          case 'prata':
            return 1.08;
          case 'ouro':
            return 1;
          case 'platina':
            return 0.92;
          case 'diamante':
            return 0.86;
          default:
            return 1;
        }
      }

      function randomIntegerBetween(min, max) {
        const start = Math.ceil(Number(min || 0));
        const end = Math.floor(Number(max || 0));
        if (end <= start) {
          return start;
        }
        return Math.floor(Math.random() * (end - start + 1)) + start;
      }

      function getAIRobotTaskDurationMs(taskType, levelId) {
        const profile = aiRobotTaskProfiles[taskType] || aiRobotTaskProfiles.idle;
        const base = randomIntegerBetween(profile.minMs, profile.maxMs);
        const factor = getAIRobotSpeedFactor(levelId);
        return Math.max(12000, Math.round(base * factor));
      }

      function buildAIRobotTaskStages(task) {
        if (!task) {
          return [];
        }
        if (task.type === 'submit') {
          return [
            { at: 0.12, message: `Abrindo anúncio de ${task.meta.review.productName} em ${task.meta.review.marketplaceName}.` },
            { at: 0.34, message: 'Lendo descrição, preço, SKU e especificações.' },
            { at: 0.58, message: 'Escrevendo feedback completo com linguagem natural.' },
            { at: 0.82, message: 'Validando consistência antes do envio.' }
          ];
        }
        if (task.type === 'generate') {
          return [
            { at: 0.18, message: `Mapeando catálogo no ${task.meta.template.marketplaceName}.` },
            { at: 0.44, message: 'Selecionando produto com potencial de conversão.' },
            { at: 0.72, message: 'Gerando tarefa e estimando recompensa com base no histórico.' }
          ];
        }
        return [
          { at: 0.5, message: 'Monitorando fila e aguardando a melhor janela operacional.' }
        ];
      }

      function createAIRobotTask() {
        if (!accountState || !aiRobotRunning || aiRobotPaused) {
          return null;
        }

        const levelState = getAIRobotLevelState();
        const pendingReviews = (accountState.reviews || [])
          .filter((review) => review.status === 'pending')
          .sort((a, b) => Number(a.createdAt || 0) - Number(b.createdAt || 0));
        const pendingCount = pendingReviews.length;

        let type = 'idle';
        if (pendingCount > 0 && (pendingCount >= 7 || Math.random() < 0.65)) {
          type = 'submit';
        } else if (pendingCount < 12) {
          type = 'generate';
        }

        if (type === 'submit' && pendingReviews.length > 0) {
          const review = pendingReviews[0];
          const durationMs = getAIRobotTaskDurationMs('submit', levelState.currentLevel.id);
          const task = {
            id: `task-submit-${Date.now()}`,
            type: 'submit',
            label: `Avaliando ${review.productName} em ${review.marketplaceName}`,
            startedAt: Date.now(),
            completedMs: 0,
            durationMs,
            stageIndex: 0,
            stages: [],
            meta: { review }
          };
          task.stages = buildAIRobotTaskStages(task);
          return task;
        }

        if (type === 'generate') {
          const template = getRandomReviewTemplate();
          if (template) {
            const durationMs = getAIRobotTaskDurationMs('generate', levelState.currentLevel.id);
            const task = {
              id: `task-generate-${Date.now()}`,
              type: 'generate',
              label: `Gerando tarefa para ${template.marketplaceName}`,
              startedAt: Date.now(),
              completedMs: 0,
              durationMs,
              stageIndex: 0,
              stages: [],
              meta: { template }
            };
            task.stages = buildAIRobotTaskStages(task);
            return task;
          }
        }

        const durationMs = getAIRobotTaskDurationMs('idle', levelState.currentLevel.id);
        const task = {
          id: `task-idle-${Date.now()}`,
          type: 'idle',
          label: 'Monitorando fila para próxima ação',
          startedAt: Date.now(),
          completedMs: 0,
          durationMs,
          stageIndex: 0,
          stages: [],
          meta: {}
        };
        task.stages = buildAIRobotTaskStages(task);
        return task;
      }

      function applyAIRobotStateAfterMutation() {
        if (!accountState) {
          return;
        }
        saveAccountState();
        updateWalletBalance();
        renderReviewList();
        renderAdminReviews();
        renderFinanceLists();
        updateDashboardStats();
      }

      function runAIRobotCycle(elapsedMs = 0) {
        if (!accountState || !aiRobotRunning || aiRobotPaused) {
          return;
        }

        if (!aiRobotConnectedThisSession) {
          const connectionCheck = robotEnsureMarketplacesConnected();
          aiRobotConnectedThisSession = true;
          if (connectionCheck.fixedCount > 0) {
            saveAccountState();
            renderMarketplaces();
            if (connectionCheck.syncedCount > 0) {
              pushAIRobotLog(
                `${connectionCheck.syncedCount} marketplace(s) sincronizado(s) para a execução da IA.`,
                'success'
              );
            } else {
              pushAIRobotLog('Conexões validadas. A IA usa somente marketplaces conectados com ID.', 'info');
            }
          }
        }

        if (!aiRobotTaskState) {
          aiRobotTaskState = createAIRobotTask();
          if (aiRobotTaskState) {
            pushAIRobotLog(`IA iniciou: ${aiRobotTaskState.label}.`, 'info');
          }
        }

        if (!aiRobotTaskState || elapsedMs <= 0) {
          return;
        }

        aiRobotTaskState.completedMs = Math.min(
          Number(aiRobotTaskState.durationMs || 0),
          Number(aiRobotTaskState.completedMs || 0) + elapsedMs
        );
        const progress = Math.max(
          0,
          Math.min(1, Number(aiRobotTaskState.completedMs || 0) / Math.max(1, Number(aiRobotTaskState.durationMs || 1)))
        );

        while (
          aiRobotTaskState.stageIndex < aiRobotTaskState.stages.length
          && progress >= aiRobotTaskState.stages[aiRobotTaskState.stageIndex].at
        ) {
          const stage = aiRobotTaskState.stages[aiRobotTaskState.stageIndex];
          pushAIRobotLog(stage.message, 'info');
          aiRobotTaskState.stageIndex += 1;
        }

        if (progress < 1) {
          return;
        }

        let completionMessage = '';
        let completionType = 'info';
        let changed = false;

        if (aiRobotTaskState.type === 'submit') {
          const reviewId = aiRobotTaskState.meta && aiRobotTaskState.meta.review ? aiRobotTaskState.meta.review.id : null;
          const submitMessage = robotSubmitReviewOnce(reviewId);
          if (submitMessage) {
            completionMessage = submitMessage;
            completionType = 'success';
            changed = true;
          } else {
            completionMessage = 'A avaliação alvo saiu da fila antes da conclusão da IA.';
            completionType = 'warn';
          }
        } else if (aiRobotTaskState.type === 'generate') {
          const template = aiRobotTaskState.meta ? aiRobotTaskState.meta.template : null;
          const generateMessage = robotGenerateReviewOnce(template);
          if (generateMessage) {
            completionMessage = generateMessage;
            completionType = 'success';
            changed = true;
          } else {
            completionMessage = 'Fila cheia ou sem marketplace conectado para gerar nova tarefa.';
            completionType = 'warn';
          }
        } else {
          completionMessage = 'Monitoramento concluído. Preparando próxima análise.';
        }

        if (changed) {
          applyAIRobotStateAfterMutation();
        } else if (accountState) {
          saveAccountState();
        }

        pushAIRobotLog(completionMessage, completionType);
        aiRobotTaskState = null;
      }

      function consumeAIRobotElapsedTime(nowValue = Date.now()) {
        if (!accountState || !aiRobotRunning || aiRobotPaused) {
          return {
            levelState: getAIRobotLevelState(),
            elapsedMs: 0
          };
        }
        if (!aiRobotLastTickAt) {
          aiRobotLastTickAt = nowValue;
          return {
            levelState: getAIRobotLevelState(),
            elapsedMs: 0
          };
        }
        const elapsedMs = Math.max(0, nowValue - aiRobotLastTickAt);
        aiRobotLastTickAt = nowValue;
        if (elapsedMs <= 0) {
          return {
            levelState: getAIRobotLevelState(),
            elapsedMs: 0
          };
        }
        const usageState = ensureAIRobotUsageState();
        const levelState = getAIRobotLevelState();
        if (levelState.remainingMs <= 0) {
          return {
            levelState,
            elapsedMs: 0
          };
        }
        const consumedMs = Math.min(elapsedMs, levelState.remainingMs);
        const nextUsed = Math.min(levelState.dailyLimitMs, Number(usageState.usedMs || 0) + consumedMs);
        usageState.usedMs = nextUsed;
        saveAccountState();
        return {
          levelState: getAIRobotLevelState(),
          elapsedMs: consumedMs
        };
      }

      function scheduleAIRobotTick(delayMs = aiRobotTickIntervalMs) {
        clearTimeout(aiRobotTimer);
        if (!aiRobotRunning || aiRobotPaused) {
          return;
        }
        aiRobotTimer = setTimeout(() => {
          if (!aiRobotRunning || aiRobotPaused) {
            return;
          }
          const consumeResult = consumeAIRobotElapsedTime();
          if (consumeResult.levelState.remainingMs <= 0) {
            stopAIRobotAutomation('Tempo diário do Robô IA encerrado por hoje.');
            showToast({
              title: 'Limite diário alcançado',
              message: 'O Robô IA atingiu o tempo máximo do seu nível hoje.',
              type: 'warning'
            });
            return;
          }
          runAIRobotCycle(consumeResult.elapsedMs);
          renderAIRobotLevelsPanel();
          scheduleAIRobotTick(aiRobotTickIntervalMs);
        }, delayMs);
      }

      function startAIRobotAutomation() {
        if (!accountState) {
          return;
        }
        const levelState = getAIRobotLevelState();
        if (levelState.remainingMs <= 0) {
          showToast({
            title: 'Sem tempo disponível',
            message: `Seu nível ${levelState.currentLevel.name} já usou todo o tempo diário da IA.`,
            type: 'warning'
          });
          renderAIRobotLevelsPanel();
          return;
        }
        aiRobotRunning = true;
        aiRobotPaused = false;
        aiRobotConnectedThisSession = false;
        aiRobotLastTickAt = Date.now();
        aiRobotTaskState = null;
        pushAIRobotLog(`Robô IA iniciado no nível ${levelState.currentLevel.name}.`, 'success');
        runAIRobotCycle(0);
        renderAIRobotLevelsPanel();
        scheduleAIRobotTick(aiRobotTickIntervalMs);
      }

      function pauseAIRobotAutomation() {
        if (!aiRobotRunning || aiRobotPaused) {
          return;
        }
        consumeAIRobotElapsedTime();
        aiRobotPaused = true;
        clearTimeout(aiRobotTimer);
        pushAIRobotLog('Robô IA pausado manualmente.', 'warn');
        renderAIRobotLevelsPanel();
      }

      function resumeAIRobotAutomation() {
        if (!accountState) {
          return;
        }
        if (!aiRobotRunning) {
          startAIRobotAutomation();
          return;
        }
        if (!aiRobotPaused) {
          return;
        }
        const levelState = getAIRobotLevelState();
        if (levelState.remainingMs <= 0) {
          stopAIRobotAutomation('Sem tempo restante para retomar hoje.');
          return;
        }
        aiRobotPaused = false;
        aiRobotLastTickAt = Date.now();
        pushAIRobotLog('Robô IA retomado.', 'success');
        renderAIRobotLevelsPanel();
        scheduleAIRobotTick(600);
      }

      function stopAIRobotAutomation(reason = '', silent = false) {
        clearTimeout(aiRobotTimer);
        aiRobotRunning = false;
        aiRobotPaused = false;
        aiRobotLastTickAt = 0;
        aiRobotConnectedThisSession = false;
        aiRobotTaskState = null;
        if (!silent && reason) {
          pushAIRobotLog(reason, 'warn');
        }
        renderAIRobotLevelsPanel();
      }

      function toggleAIRobotAutomation() {
        if (!accountState) {
          return;
        }
        if (!aiRobotRunning) {
          startAIRobotAutomation();
          return;
        }
        if (aiRobotPaused) {
          resumeAIRobotAutomation();
          return;
        }
        pauseAIRobotAutomation();
      }

      function getManualSalesMap() {
        if (!accountState || !Array.isArray(accountState.manualSales)) {
          return new Map();
        }
        const map = new Map();
        accountState.manualSales.forEach((entry) => {
          if (!entry || !entry.date) {
            return;
          }
          const value = Number(entry.value || 0);
          if (Number.isNaN(value)) {
            return;
          }
          map.set(entry.date, value);
        });
        return map;
      }

      function getManualMonthlyEntries() {
        if (!accountState || !Array.isArray(accountState.manualSalesMonths)) {
          return [];
        }
        return accountState.manualSalesMonths.filter((entry) => entry && entry.month && !Number.isNaN(Number(entry.value)));
      }

      function getRollingOverride() {
        if (!accountState || !accountState.manualRollingSales) {
          return null;
        }
        const hasManualDays = Array.isArray(accountState.manualSales) && accountState.manualSales.length > 0;
        const hasManualMonths = Array.isArray(accountState.manualSalesMonths) && accountState.manualSalesMonths.length > 0;
        if (hasManualDays || hasManualMonths) {
          return null;
        }
        const total = Number(accountState.manualRollingSales.total);
        if (Number.isNaN(total)) {
          return null;
        }
        const now = new Date();
        const end = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59, 999);
        const start = new Date(end);
        start.setDate(end.getDate() - 29);
        start.setHours(0, 0, 0, 0);
        return {
          total,
          daily: total / 30,
          start,
          end
        };
      }

      function getDaysInMonth(year, monthIndex) {
        return new Date(year, monthIndex + 1, 0).getDate();
      }

      function applyMonthlyOverrides(totals, start, end) {
        const months = getManualMonthlyEntries();
        months.forEach((entry) => {
          const parts = String(entry.month).split('-').map(Number);
          if (parts.length < 2) {
            return;
          }
          const year = parts[0];
          const month = parts[1];
          if (!year || !month) {
            return;
          }
          const daysInMonth = getDaysInMonth(year, month - 1);
          const dailyValue = Number(entry.value || 0) / daysInMonth;
          for (let day = 1; day <= daysInMonth; day += 1) {
            const date = new Date(year, month - 1, day, 0, 0, 0);
            if (date < start || date > end) {
              continue;
            }
            const key = getLocalDateKey(date);
            totals.set(key, dailyValue);
          }
        });
      }

      function sumSalesBetween(start, end, options = {}) {
        const includePending = Boolean(options.includePending);
        const rolling = getRollingOverride();
        if (rolling) {
          const overlapStart = start > rolling.start ? start : rolling.start;
          const overlapEnd = end < rolling.end ? end : rolling.end;
          let total = 0;
          if (overlapStart <= overlapEnd) {
            const days = daysBetweenInclusive(overlapStart, overlapEnd);
            total += rolling.daily * days;
          }
          const sales = includePending ? getOperationalSales() : getApprovedSales();
          sales.forEach((sale) => {
            if (sale.date < start || sale.date > end) {
              return;
            }
            if (sale.date >= rolling.start && sale.date <= rolling.end) {
              return;
            }
            total += sale.amount;
          });
          return total;
        }
        const sales = includePending ? getOperationalSales() : getApprovedSales();
        const totals = new Map();

        sales.forEach((sale) => {
          if (sale.date < start || sale.date > end) {
            return;
          }
          const key = getLocalDateKey(sale.date);
          totals.set(key, (totals.get(key) || 0) + sale.amount);
        });

        applyMonthlyOverrides(totals, start, end);

        const manualMap = getManualSalesMap();
        manualMap.forEach((value, key) => {
          const date = parseDateKey(key);
          if (!date || date < start || date > end) {
            return;
          }
          totals.set(key, value);
        });

        let total = 0;
        totals.forEach((value) => {
          total += value;
        });
        return total;
      }

      function sumBonusEarnedBetween(start, end) {
        if (!accountState) {
          return 0;
        }
        const startTime = start instanceof Date ? start.getTime() : 0;
        const endTime = end instanceof Date ? end.getTime() : Date.now();
        const history = Array.isArray(accountState.bonusHistory) ? accountState.bonusHistory : [];
        let total = 0;
        const historyReviewIds = new Set();

        history.forEach((entry) => {
          if (!entry) {
            return;
          }
          if (entry.reviewId) {
            historyReviewIds.add(String(entry.reviewId));
          }
          const timestamp = entry.createdAt;
          const timeValue = typeof timestamp === 'string' ? Date.parse(timestamp) : Number(timestamp);
          if (!Number.isFinite(timeValue) || timeValue < startTime || timeValue > endTime) {
            return;
          }
          const amount = Number(entry.amount || 0);
          if (Number.isNaN(amount)) {
            return;
          }
          total += amount;
        });

        const reviewTotal = (accountState.reviews || []).reduce((sum, review) => {
          if (!review || review.bonusEarned === undefined || review.bonusEarned === null) {
            return sum;
          }
          if (review.id && historyReviewIds.has(String(review.id))) {
            return sum;
          }
          const completedAt = Number(review.completedAt || review.approvedAt || 0);
          if (!Number.isFinite(completedAt) || completedAt < startTime || completedAt > endTime) {
            return sum;
          }
          const amount = Number(review.bonusEarned || 0);
          if (Number.isNaN(amount)) {
            return sum;
          }
          return sum + amount;
        }, 0);

        return roundCurrency(total + reviewTotal);
      }

      function getUnifiedPeriodTotal(start, end) {
        const operationalTotal = sumSalesBetween(start, end, { includePending: true });
        const bonusTotal = sumBonusEarnedBetween(start, end);
        return roundCurrency(operationalTotal + bonusTotal);
      }

      function applyTotalsForPeriod(start, end, rangeLabel) {
        const safeDays = daysBetweenInclusive(start, end);
        const total = getUnifiedPeriodTotal(start, end);

        if (reportSalesValue) {
          setSensitiveValue(reportSalesValue, formatCurrency(total));
        }
        if (reportRangeMessage) {
          reportRangeMessage.textContent = `Periodo: ${rangeLabel}`;
        }
        if (reportChartLabel) {
          reportChartLabel.textContent = rangeLabel;
        }
        renderReportChart(Math.min(safeDays, 365), end);

        if (salesCustom) {
          setSensitiveValue(salesCustom, formatCurrency(total));
        }
        if (salesRangeMessage) {
          salesRangeMessage.textContent = `Periodo: ${rangeLabel}.`;
        }
        if (salesStartDate) {
          salesStartDate.value = formatDateInput(start);
        }
        if (salesEndDate) {
          salesEndDate.value = formatDateInput(end);
        }
      }

      function updateSalesReport(options = {}) {
        if (!salesCustom) {
          return;
        }
        const syncReport = Boolean(options.syncReport);
        const start = parseDateInput(salesStartDate?.value);
        const end = parseDateInput(salesEndDate?.value, true);
        if (start && end && start <= end) {
          const rangeLabel = `${start.toLocaleDateString('pt-BR')} ate ${end.toLocaleDateString('pt-BR')}`;
          if (syncReport) {
            applyTotalsForPeriod(start, end, rangeLabel);
            if (reportRangeSelect) {
              reportRangeSelect.value = 'custom';
            }
            if (reportCustomStartDate) {
              reportCustomStartDate.value = formatDateInput(start);
            }
            if (reportCustomEndDate) {
              reportCustomEndDate.value = formatDateInput(end);
            }
            toggleReportCustomRange(true);
          } else {
            setSensitiveValue(salesCustom, formatCurrency(getUnifiedPeriodTotal(start, end)));
            if (salesRangeMessage) {
              salesRangeMessage.textContent = `Periodo: ${rangeLabel}.`;
            }
          }
        } else {
          setSensitiveValue(salesCustom, 'R$ 0,00');
          if (salesRangeMessage) {
            salesRangeMessage.textContent = 'Selecione um periodo valido.';
          }
        }
      }

      function daysBetweenInclusive(start, end) {
        const startDate = new Date(start.getFullYear(), start.getMonth(), start.getDate());
        const endDate = new Date(end.getFullYear(), end.getMonth(), end.getDate());
        const diff = Math.round((endDate - startDate) / 86400000) + 1;
        return Math.max(1, diff);
      }

      function getSalesByDay(days, endDate = new Date()) {
        const end = new Date(endDate.getFullYear(), endDate.getMonth(), endDate.getDate(), 23, 59, 59, 999);
        const start = new Date(end);
        start.setDate(end.getDate() - (days - 1));
        start.setHours(0, 0, 0, 0);

        const buckets = new Map();
        for (let i = 0; i < days; i += 1) {
          const current = new Date(start);
          current.setDate(start.getDate() + i);
          const key = getLocalDateKey(current);
          buckets.set(key, { date: current, value: 0 });
        }

        const sales = getApprovedSales();
        sales.forEach((sale) => {
          if (sale.date < start || sale.date > end) {
            return;
          }
          const key = getLocalDateKey(sale.date);
          if (buckets.has(key)) {
            buckets.get(key).value += sale.amount;
          }
        });

        const rolling = getRollingOverride();
        if (rolling) {
          buckets.forEach((entry) => {
            if (entry.date >= rolling.start && entry.date <= rolling.end) {
              entry.value = rolling.daily;
            }
          });
        } else {
          const monthlyTotals = new Map();
          buckets.forEach((entry, key) => {
            monthlyTotals.set(key, entry.value);
          });
          applyMonthlyOverrides(monthlyTotals, start, end);
          monthlyTotals.forEach((value, key) => {
            if (buckets.has(key)) {
              buckets.get(key).value = value;
            }
          });

          const manualMap = getManualSalesMap();
          manualMap.forEach((value, key) => {
            if (buckets.has(key)) {
              buckets.get(key).value = value;
            }
          });
        }

        const labels = [];
        const values = [];
        buckets.forEach((entry) => {
          labels.push(entry.date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' }));
          values.push(entry.value);
        });

        return { labels, values };
      }

      function renderReportChart(days = 30, endDate = new Date()) {
        if (!reportChart) {
          return;
        }
        const ctx = reportChart.getContext('2d');
        if (!ctx) {
          return;
        }
        const width = reportChart.clientWidth || 600;
        const height = reportChart.clientHeight || 220;
        const dpr = window.devicePixelRatio || 1;
        reportChart.width = width * dpr;
        reportChart.height = height * dpr;
        ctx.scale(dpr, dpr);

        ctx.clearRect(0, 0, width, height);
        ctx.fillStyle = 'rgba(15, 23, 42, 0.55)';
        ctx.fillRect(0, 0, width, height);

        const padding = 24;
        const chartWidth = width - padding * 2;
        const chartHeight = height - padding * 2;

        const { values } = getSalesByDay(days, endDate);
        const maxValue = Math.max(...values, 1);

        ctx.strokeStyle = 'rgba(148,163,184,0.2)';
        ctx.lineWidth = 1;
        for (let i = 0; i <= 4; i += 1) {
          const y = padding + (chartHeight / 4) * i;
          ctx.beginPath();
          ctx.moveTo(padding, y);
          ctx.lineTo(width - padding, y);
          ctx.stroke();
        }

        const step = chartWidth / (values.length - 1 || 1);
        const points = values.map((value, index) => {
          const x = padding + step * index;
          const y = padding + (1 - value / maxValue) * chartHeight;
          return { x, y };
        });

        const gradient = ctx.createLinearGradient(0, padding, 0, height - padding);
        gradient.addColorStop(0, 'rgba(56,189,248,0.5)');
        gradient.addColorStop(1, 'rgba(56,189,248,0)');

        ctx.beginPath();
        points.forEach((point, index) => {
          if (index === 0) {
            ctx.moveTo(point.x, point.y);
          } else {
            ctx.lineTo(point.x, point.y);
          }
        });
        ctx.lineTo(points[points.length - 1].x, height - padding);
        ctx.lineTo(points[0].x, height - padding);
        ctx.closePath();
        ctx.fillStyle = gradient;
        ctx.fill();

        ctx.beginPath();
        points.forEach((point, index) => {
          if (index === 0) {
            ctx.moveTo(point.x, point.y);
          } else {
            ctx.lineTo(point.x, point.y);
          }
        });
        ctx.strokeStyle = 'rgba(56,189,248,0.9)';
        ctx.lineWidth = 2;
        ctx.shadowColor = 'rgba(56,189,248,0.4)';
        ctx.shadowBlur = 6;
        ctx.stroke();
        ctx.shadowBlur = 0;
      }

      function toggleReportCustomRange(showCustom) {
        if (!reportCustomDateWrap) {
          return;
        }
        reportCustomDateWrap.classList.toggle('hidden', !showCustom);
      }

      function updateReportSummary() {
        if (!reportSalesValue || !reportRangeSelect) {
          return;
        }

        const now = new Date();
        const endToday = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59, 999);
        let start = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0);
        let end = new Date(endToday);
        let rangeLabel = 'Hoje';

        const selection = reportRangeSelect.value || 'today';
        const isCustom = selection === 'custom';
        toggleReportCustomRange(isCustom);

        if (selection === 'last7') {
          start = new Date(endToday);
          start.setDate(endToday.getDate() - 6);
          start.setHours(0, 0, 0, 0);
          rangeLabel = 'Ultimos 7 dias';
        } else if (selection === 'last15') {
          start = new Date(endToday);
          start.setDate(endToday.getDate() - 14);
          start.setHours(0, 0, 0, 0);
          rangeLabel = 'Ultimos 15 dias';
        } else if (selection === 'last30') {
          start = new Date(endToday);
          start.setDate(endToday.getDate() - 29);
          start.setHours(0, 0, 0, 0);
          rangeLabel = 'Ultimos 30 dias';
        } else if (selection === 'custom') {
          const customStart = parseDateInput(reportCustomStartDate?.value);
          const customEnd = parseDateInput(reportCustomEndDate?.value, true);
          if (!customStart || !customEnd || customStart > customEnd) {
            setSensitiveValue(reportSalesValue, 'R$ 0,00');
            if (reportRangeMessage) {
              reportRangeMessage.textContent = 'Periodo: selecione um intervalo personalizado valido.';
            }
            if (salesRangeMessage) {
              salesRangeMessage.textContent = 'Selecione um periodo valido.';
            }
            if (salesCustom) {
              setSensitiveValue(salesCustom, 'R$ 0,00');
            }
            if (reportChartLabel) {
              reportChartLabel.textContent = 'Periodo personalizado';
            }
            renderReportChart(1, endToday);
            return;
          }
          start = customStart;
          end = customEnd;
          rangeLabel = `${start.toLocaleDateString('pt-BR')} ate ${end.toLocaleDateString('pt-BR')}`;
        }

        applyTotalsForPeriod(start, end, rangeLabel);
      }

      function initReportDates() {
        if (!reportCustomStartDate || !reportCustomEndDate) {
          return;
        }
        const now = new Date();
        const startDefault = new Date(now.getFullYear(), now.getMonth(), now.getDate() - 29, 0, 0, 0, 0);
        if (!reportCustomStartDate.value) {
          reportCustomStartDate.value = formatDateInput(startDefault);
        }
        if (!reportCustomEndDate.value) {
          reportCustomEndDate.value = formatDateInput(now);
        }
      }

      function initAdminReportDate() {
        if (!adminReportDate) {
          return;
        }
        const now = new Date();
        if (!adminReportDate.value) {
          adminReportDate.value = formatDateInput(now);
        }
      }

      function initAdminReportMonth() {
        if (!adminReportMonth) {
          return;
        }
        const now = new Date();
        const monthValue = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
        if (!adminReportMonth.value) {
          adminReportMonth.value = monthValue;
        }
      }

      function initSalesReport() {
        if (!salesStartDate || !salesEndDate) {
          return;
        }
        const now = new Date();
        const startMonth = new Date(now.getFullYear(), now.getMonth(), now.getDate() - 29, 0, 0, 0, 0);
        if (!salesStartDate.value) {
          salesStartDate.value = formatDateInput(startMonth);
        }
        if (!salesEndDate.value) {
          salesEndDate.value = formatDateInput(now);
        }
        updateSalesReport();
      }

      function updateWalletBalance() {
        if (!accountState) {
          setSensitiveValue(walletBalance, 'R$ 0,00');
          setSensitiveValue(adminBalanceValue, 'R$ 0,00');
          if (walletBalanceInline) {
            setSensitiveValue(walletBalanceInline, 'R$ 0,00');
          }
          if (financeBalance) {
            setSensitiveValue(financeBalance, 'R$ 0,00');
          }
          if (financeAvailableBalance) {
            setSensitiveValue(financeAvailableBalance, 'R$ 0,00');
          }
          if (vipBonusValue) {
            setSensitiveValue(vipBonusValue, 'R$ 0,00');
          }
          if (adminBonusValue) {
            setSensitiveValue(adminBonusValue, 'R$ 0,00');
          }
          if (adminRollingValue) {
            setSensitiveValue(adminRollingValue, 'R$ 0,00');
          }
          return;
        }

        setSensitiveValue(walletBalance, formatCurrency(accountState.balance || 0));
        setSensitiveValue(adminBalanceValue, formatCurrency(accountState.balance || 0));
        if (walletBalanceInline) {
          setSensitiveValue(walletBalanceInline, formatCurrency(accountState.balance || 0));
        }
        if (financeBalance) {
          setSensitiveValue(financeBalance, formatCurrency(accountState.balance || 0));
        }
        if (financeAvailableBalance) {
          setSensitiveValue(financeAvailableBalance, formatCurrency(getAvailableBalance()));
        }
        if (vipBonusValue) {
          setSensitiveValue(vipBonusValue, formatCurrency(accountState.bonusBalance || 0));
        }
        if (adminBonusValue) {
          setSensitiveValue(adminBonusValue, formatCurrency(accountState.bonusBalance || 0));
        }
        if (adminRollingValue) {
          const now = new Date();
          const end = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59, 999);
          const start = new Date(end);
          start.setDate(end.getDate() - 29);
          start.setHours(0, 0, 0, 0);
          const manualMap = getManualSalesMap();
          let manualLast30 = 0;
          let manualCount = 0;
          manualMap.forEach((value, key) => {
            const date = parseDateKey(key);
            if (!date || date < start || date > end) {
              return;
            }
            manualLast30 += Number(value || 0);
            manualCount += 1;
          });
          const fallbackRolling = accountState.manualRollingSales ? Number(accountState.manualRollingSales.total || 0) : 0;
          const total = manualCount > 0 ? manualLast30 : fallbackRolling;
          setSensitiveValue(adminRollingValue, formatCurrency(total));
        }
      }

      function showToast({ title, message, type = 'info' }) {
        if (!toastContainer) {
          return;
        }
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        const safeMessage = applyPrivacyText(message);
        toast.innerHTML = `
          <div class="toast-title">${title}</div>
          <div class="toast-message">${safeMessage}</div>
        `;
        toastContainer.appendChild(toast);
        setTimeout(() => {
          toast.classList.add('toast-exit');
        }, 3600);
        setTimeout(() => {
          toast.remove();
        }, 4000);
      }

      function isTypingInForm() {
        const tag = document.activeElement?.tagName;
        return tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT';
      }

      function launchConfetti() {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        const colors = ['#38bdf8', '#34d399', '#f59e0b', '#a855f7', '#f472b6'];
        const pieces = 28;
        for (let i = 0; i < pieces; i += 1) {
          const piece = document.createElement('span');
          piece.className = 'confetti-piece';
          piece.style.left = `${Math.random() * 100}%`;
          piece.style.background = colors[Math.floor(Math.random() * colors.length)];
          piece.style.animationDelay = `${Math.random() * 0.4}s`;
          piece.style.transform = `rotate(${Math.random() * 360}deg)`;
          confetti.appendChild(piece);
        }
        document.body.appendChild(confetti);
        document.body.classList.add('celebrate');
        setTimeout(() => {
          confetti.remove();
          document.body.classList.remove('celebrate');
        }, 1800);
      }

      function notifyNewTask(total) {
        showToast({
          title: 'Nova avaliação disponível',
          message: `Você tem ${total} avaliações para revisar agora.`,
          type: 'info'
        });
      }

      function notifyApproval(kind, value) {
        showToast({
          title: 'Aprovação confirmada',
          message: `${kind} aprovado: ${formatCurrency(value)} liberado.`,
          type: 'success'
        });
        launchConfetti();
      }

      function approveAllPending() {
        if (!accountState) {
          return;
        }
        let approvedBalanceCount = 0;
        let approvedBalanceValue = 0;
        let approvedWithdrawals = 0;
        let rejectedWithdrawals = 0;
        let approvedReviewCount = 0;

        accountState.balanceRequests = (accountState.balanceRequests || []).map((request) => {
          if (request.status !== 'pendente') {
            return request;
          }
          approvedBalanceCount += 1;
          const amount = Number(request.amount || 0);
          if (!Number.isNaN(amount)) {
            accountState.balance = roundCurrency((accountState.balance || 0) + amount);
            approvedBalanceValue += amount;
          }
          if (request.source === 'review' && request.reviewId) {
            accountState.reviews = accountState.reviews.map((review) => {
              if (review.id !== request.reviewId) {
                return review;
              }
              approvedReviewCount += 1;
              return {
                ...review,
                status: 'approved',
                approvedAt: Date.now()
              };
            });
          }
          return {
            ...request,
            status: 'aprovado',
            approvedAt: Date.now()
          };
        });

        accountState.withdrawalRequests = (accountState.withdrawalRequests || []).map((request) => {
          if (request.status !== 'pendente') {
            return request;
          }
          const amount = Number(request.amount || 0);
          if (!Number.isNaN(amount) && (accountState.balance || 0) >= amount) {
            accountState.balance = roundCurrency((accountState.balance || 0) - amount);
            approvedWithdrawals += 1;
            return {
              ...request,
              status: 'aprovado',
              approvedAt: Date.now()
            };
          }
          rejectedWithdrawals += 1;
          return {
            ...request,
            status: 'rejeitado',
            rejectedAt: Date.now()
          };
        });

        saveAccountState();
        updateAdminBalance();
        renderRequestList(accountState.balanceRequests || [], balanceRequestList, 'Sem solicitações de saldo.');
        renderRequestList(accountState.withdrawalRequests || [], withdrawalRequestList, 'Sem solicitações de saque.');
        renderFinanceLists();
        renderReviewList();
        renderAdminReviews();
        updateDashboardStats();

        if (approvedBalanceCount === 0 && approvedWithdrawals === 0 && rejectedWithdrawals === 0) {
          showToast({
            title: 'Aprovação em lote',
            message: 'Nenhuma pendência encontrada.',
            type: 'warning'
          });
          return;
        }

        const summaryParts = [];
        if (approvedBalanceCount > 0) {
          summaryParts.push(`${approvedBalanceCount} pagamento(s) aprovados (${formatCurrency(approvedBalanceValue)})`);
        }
        if (approvedReviewCount > 0) {
          summaryParts.push(`${approvedReviewCount} avaliações aprovadas`);
        }
        if (approvedWithdrawals > 0) {
          summaryParts.push(`${approvedWithdrawals} saque(s) aprovados`);
        }
        if (rejectedWithdrawals > 0) {
          summaryParts.push(`${rejectedWithdrawals} saque(s) rejeitados`);
        }
        showToast({
          title: 'Aprovação em lote concluída',
          message: summaryParts.join(' · '),
          type: 'success'
        });
        launchConfetti();
      }

      function updateAdminBalance() {
        updateWalletBalance();
      }

      function addActivity(text) {
        if (!accountState) {
          return;
        }
        const entry = {
          id: `activity-${Date.now()}`,
          text,
          createdAt: Date.now()
        };
        accountState.activities.unshift(entry);
        accountState.activities = accountState.activities.slice(0, 6);
        saveAccountState();
        renderActivities();
      }

      function renderActivities() {
        if (!accountState) {
          return;
        }
        if (!activityList) {
          return;
        }
        if (accountState.activities.length === 0) {
          activityList.innerHTML = '<li class="rounded-2xl border border-white/10 bg-ink-700/60 p-4 text-white/50">Nenhuma atividade recente.</li>';
          return;
        }
        activityList.innerHTML = accountState.activities
          .map((activity) => `<li class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">${applyPrivacyText(activity.text)}</li>`)
          .join('');
      }

      function renderAlerts() {
        if (!accountState || !alertList) {
          return;
        }
        const now = Date.now();
        const pendingReviews = accountState.reviews.filter((review) => review.status === 'pending');
        const expiringSoon = pendingReviews.filter((review) => review.expiresAt && review.expiresAt - now <= 5 * 60 * 1000);
        const pendingBalances = (accountState.balanceRequests || []).filter((request) => request.status === 'pendente').length;
        const pendingWithdrawals = (accountState.withdrawalRequests || []).filter((request) => request.status === 'pendente').length;
        const alerts = [];

        if (pendingReviews.length > 0) {
          alerts.push(`Você tem ${pendingReviews.length} avaliações pendentes.`);
        }
        if (expiringSoon.length > 0) {
          alerts.push(`${expiringSoon.length} avaliações expiram em até 5 minutos.`);
        }
        if (pendingBalances > 0) {
          alerts.push(`${pendingBalances} pagamento(s) aguardando aprovação.`);
        }
        if (pendingWithdrawals > 0) {
          alerts.push(`${pendingWithdrawals} saque(s) aguardando aprovação.`);
        }
        if (getAvailableBalance() <= 5) {
          alerts.push('Saldo disponível baixo para novos saques.');
        }

        if (alerts.length === 0) {
          alertList.innerHTML = '<li class="rounded-2xl border border-white/10 bg-ink-700/60 p-4 text-white/50">Nenhum alerta crítico no momento.</li>';
          return;
        }

        alertList.innerHTML = alerts
          .map((alert) => `<li class="rounded-2xl border border-white/10 bg-ink-700/60 p-3">${applyPrivacyText(alert)}</li>`)
          .join('');
      }

      function renderTeamMembers() {
        if (!accountState || !teamMemberList) {
          return;
        }
        if (!accountState.teamMembers || accountState.teamMembers.length === 0) {
          teamMemberList.innerHTML = '<li class="text-white/50">Nenhum membro cadastrado.</li>';
          return;
        }
        teamMemberList.innerHTML = accountState.teamMembers
          .map((member) => {
            const statusClass = member.status === 'ativo' ? 'text-emerald-300' : 'text-white/50';
            return `
              <li class="rounded-xl border border-white/10 bg-ink-800/70 p-3">
                <div class="flex items-center justify-between gap-3">
                  <p class="text-sm font-semibold">${member.name}</p>
                  <span class="text-xs ${statusClass}">${member.status}</span>
                </div>
                <p class="mt-1 text-xs text-white/50">${member.role}</p>
              </li>
            `;
          })
          .join('');
      }

      function pruneExpiredReviews() {
        if (!accountState) {
          return;
        }
        const now = Date.now();
        accountState.reviews = accountState.reviews
          .map((review) => {
            if (!review.expiresAt) {
              const createdAt = review.createdAt || now;
              return {
                ...review,
                expiresAt: createdAt + reviewTTL,
                status: review.status || 'pending'
              };
            }
            return review;
          })
          .filter((review) => review.status !== 'pending' || review.expiresAt > now);
        saveAccountState();
      }

      function formatTimeLeft(expiresAt) {
        const diff = Math.max(0, expiresAt - Date.now());
        const minutes = Math.floor(diff / 60000);
        const seconds = Math.floor((diff % 60000) / 1000);
        return `${minutes}m ${seconds.toString().padStart(2, '0')}s`;
      }

      function updateNextReviewInfo() {
        if (!accountState || !accountState.nextReviewAt) {
          nextReviewInfo.textContent = 'Próxima em --';
          return;
        }
        const diff = Math.max(0, accountState.nextReviewAt - Date.now());
        const minutes = Math.floor(diff / 60000);
        const seconds = Math.floor((diff % 60000) / 1000);
        nextReviewInfo.textContent = `Próxima em ${minutes}m ${seconds.toString().padStart(2, '0')}s`;
      }

      function randomReward() {
        return roundCurrency(Math.random() * 12 + 5);
      }

      function randomRange(min, max) {
        return min + Math.random() * (max - min);
      }

      function randomWeightedRange(min, max, weight) {
        return min + (max - min) * Math.pow(Math.random(), weight);
      }

      const MAX_VIP_BONUS_PER_TASK = 30;
      const vipBonusRules = {
        rareRange: { min: 22, max: MAX_VIP_BONUS_PER_TASK, weight: 1.2 },
        quality: {
          excelente: { min: 6, max: 14, weight: 0.8, rareChance: 0.08 },
          boa: { min: 4, max: 10, weight: 1.0, rareChance: 0.05 },
          regular: { min: 2, max: 7, weight: 1.2, rareChance: 0.02 },
          ruim: { min: 1, max: 5, weight: 1.4, rareChance: 0.01 },
          default: { min: 2, max: 8, weight: 1.1, rareChance: 0.03 }
        }
      };

      function pickVipBonusProfile(quality) {
        return vipBonusRules.quality[quality] || vipBonusRules.quality.default;
      }

      function calculateBonusByQuality(quality) {
        const profile = pickVipBonusProfile(quality);
        const baseBonus = randomWeightedRange(profile.min, profile.max, profile.weight);
        if (Math.random() < profile.rareChance) {
          const rareBonus = randomWeightedRange(
            vipBonusRules.rareRange.min,
            vipBonusRules.rareRange.max,
            vipBonusRules.rareRange.weight
          );
          return roundCurrency(Math.min(MAX_VIP_BONUS_PER_TASK, rareBonus));
        }
        return roundCurrency(Math.min(MAX_VIP_BONUS_PER_TASK, baseBonus));
      }

      function pickMarketplaceForReview() {
        if (!accountState || !Array.isArray(accountState.marketplaces)) {
          return marketplaceCatalog[Math.floor(Math.random() * marketplaceCatalog.length)];
        }
        const connected = accountState.marketplaces.filter(
          (marketplace) => isMarketplaceConnectionValidForCurrentAccount(marketplace)
        );
        if (connected.length === 0) {
          return null;
        }
        return connected[Math.floor(Math.random() * connected.length)];
      }

      function getRandomReviewTemplate() {
        const marketplace = pickMarketplaceForReview();
        if (!marketplace) {
          return null;
        }
        const products = productCatalog[marketplace.id] || ['Produto destaque'];
        const productName = products[Math.floor(Math.random() * products.length)];
        return {
          marketplaceId: marketplace.id,
          marketplaceName: marketplace.name,
          productName,
          reward: randomReward()
        };
      }

      function slugify(value) {
        return String(value)
          .toLowerCase()
          .normalize('NFD')
          .replace(/[\u0300-\u036f]/g, '')
          .replace(/[^a-z0-9]+/g, '-')
          .replace(/(^-|-$)+/g, '');
      }

      function getProductLink(review) {
        const query = encodeURIComponent(review.productName);
        switch (review.marketplaceId) {
          case 'mercado_livre':
            return `https://lista.mercadolivre.com.br/${slugify(review.productName)}`;
          case 'shopee':
            return `https://shopee.com.br/search?keyword=${query}`;
          case 'amazon':
            return `https://www.amazon.com.br/s?k=${query}`;
          case 'magalu':
            return `https://www.magazineluiza.com.br/busca/${slugify(review.productName)}`;
          case 'shein':
            return `https://br.shein.com/search?q=${query}`;
          case 'aliexpress':
            return `https://pt.aliexpress.com/wholesale?SearchText=${query}`;
          case 'americanas':
            return `https://www.americanas.com.br/busca/${slugify(review.productName)}`;
          case 'casas_bahia':
            return `https://www.casasbahia.com.br/busca/${slugify(review.productName)}`;
          case 'ponto':
            return `https://www.pontofrio.com.br/busca/${slugify(review.productName)}`;
          case 'kabum':
            return `https://www.kabum.com.br/busca/${slugify(review.productName)}`;
          case 'netshoes':
            return `https://www.netshoes.com.br/busca?nsCat=Natural&q=${query}`;
          case 'carrefour':
            return `https://www.carrefour.com.br/busca/${slugify(review.productName)}`;
          case 'extra':
            return `https://www.extra.com.br/busca/${slugify(review.productName)}`;
          case 'madeiramadeira':
            return `https://www.madeiramadeira.com.br/busca?q=${query}`;
          case 'dafiti':
            return `https://www.dafiti.com.br/catalog/?q=${query}`;
          case 'enjoei':
            return `https://www.enjoei.com.br/search/${slugify(review.productName)}`;
          case 'ebay':
            return `https://www.ebay.com/sch/i.html?_nkw=${query}`;
          case 'etsy':
            return `https://www.etsy.com/search?q=${query}`;
          case 'walmart':
            return `https://www.walmart.com/search?q=${query}`;
          case 'target':
            return `https://www.target.com/s?searchTerm=${query}`;
          case 'bestbuy':
            return `https://www.bestbuy.com/site/searchpage.jsp?st=${query}`;
          default:
            return `https://www.google.com/search?q=${query}`;
        }
      }

      function hashString(value) {
        let hash = 0;
        for (let i = 0; i < value.length; i += 1) {
          hash = (hash << 5) - hash + value.charCodeAt(i);
          hash |= 0;
        }
        return Math.abs(hash);
      }

      function getProductMeta(productName, marketplaceName) {
        const hash = hashString(`${productName}-${marketplaceName}`);
        const price = (hash % 850) + 49.9;
        const categories = ['Eletronicos', 'Casa & Cozinha', 'Moda', 'Acessorios', 'Gadgets', 'Fitness'];
        const category = categories[hash % categories.length];
        const sku = `RP-${hash.toString().slice(0, 6).padStart(6, '0')}`;
        const warrantyMonths = (hash % 18) + 6;
        const delivery = hash % 2 === 0 ? 'Entrega: 24-48h' : 'Entrega: 3-7 dias';
        const condition = 'Condição: Novo lacrado';
        const description = `Anuncio verificado para ${productName}. Oferta exclusiva do marketplace ${marketplaceName} com garantia e suporte VIP. Confira as especificações completas abaixo.`;
        const specs = [
          `Garantia: ${warrantyMonths} meses`,
          delivery,
          condition,
          `Origem: ${marketplaceName}`,
          `SKU: ${sku}`
        ];
        return {
          price,
          category,
          sku,
          description,
          specs
        };
      }

      function getProductInitials(productName) {
        const parts = String(productName || 'RP')
          .replace(/[^a-zA-Z0-9\s]/g, ' ')
          .trim()
          .split(/\s+/)
          .filter(Boolean);
        if (parts.length === 0) {
          return 'RP';
        }
        if (parts.length === 1) {
          return parts[0].slice(0, 2).toUpperCase();
        }
        return `${parts[0][0]}${parts[1][0]}`.toUpperCase();
      }

      function buildProductSvgDataUrl(review, meta) {
        const safeName = String(review?.productName || 'Produto').slice(0, 28);
        const safeMarketplace = String(review?.marketplaceName || 'Marketplace').slice(0, 22);
        const safeCategory = String(meta?.category || 'Categoria').slice(0, 22);
        const initials = getProductInitials(safeName);
        const colorSeed = hashString(`${safeName}-${safeMarketplace}-${meta?.sku || ''}`);
        const hueA = colorSeed % 360;
        const hueB = (hueA + 48) % 360;
        const svg = `
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
            <defs>
              <linearGradient id="bg" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0%" stop-color="hsl(${hueA}, 78%, 26%)" />
                <stop offset="100%" stop-color="hsl(${hueB}, 74%, 16%)" />
              </linearGradient>
            </defs>
            <rect width="640" height="640" fill="url(#bg)" />
            <circle cx="520" cy="120" r="120" fill="rgba(255,255,255,0.08)" />
            <circle cx="110" cy="540" r="140" fill="rgba(255,255,255,0.07)" />
            <text x="50%" y="48%" dominant-baseline="middle" text-anchor="middle" fill="rgba(255,255,255,0.92)" font-family="Arial, sans-serif" font-size="138" font-weight="700">${initials}</text>
            <text x="50%" y="76%" dominant-baseline="middle" text-anchor="middle" fill="rgba(255,255,255,0.90)" font-family="Arial, sans-serif" font-size="36" font-weight="600">${safeName}</text>
            <text x="50%" y="84%" dominant-baseline="middle" text-anchor="middle" fill="rgba(255,255,255,0.78)" font-family="Arial, sans-serif" font-size="26">${safeMarketplace} • ${safeCategory}</text>
          </svg>
        `;
        return `data:image/svg+xml;charset=UTF-8,${encodeURIComponent(svg)}`;
      }

      function normalizeProductText(value) {
        return String(value || '')
          .toLowerCase()
          .normalize('NFD')
          .replace(/[\u0300-\u036f]/g, ' ')
          .replace(/[^a-z0-9\s]/g, ' ')
          .replace(/\s+/g, ' ')
          .trim();
      }

      function getProductTokens(value) {
        const stopWords = new Set([
          'de',
          'da',
          'do',
          'das',
          'dos',
          'com',
          'para',
          'sem',
          'em',
          'no',
          'na',
          'novo',
          'nova',
          'plus',
          'pro',
          'max',
          'ultra',
          'kit',
          'pack',
          'modelo'
        ]);
        return normalizeProductText(value)
          .split(' ')
          .filter((token) => token.length >= 3 && !stopWords.has(token));
      }

      function detectProductImageProfile(productName, category) {
        const text = normalizeProductText(`${productName} ${category || ''}`);
        const profiles = [
          {
            key: 'tv',
            regex: /\b(tv|televisao|smart tv|oled|qled|monitor)\b/,
            tags: ['television', 'monitor'],
            keywords: ['television', 'tv', 'monitor', 'screen'],
            queryHints: ['television product photo', 'smart tv']
          },
          {
            key: 'phone',
            regex: /\b(celular|smartphone|iphone|android|galaxy|redmi|motorola)\b/,
            tags: ['smartphone', 'mobile'],
            keywords: ['smartphone', 'phone', 'mobile'],
            queryHints: ['smartphone product photo', 'mobile phone']
          },
          {
            key: 'notebook',
            regex: /\b(notebook|laptop|macbook|ultrabook|computador)\b/,
            tags: ['laptop', 'notebook'],
            keywords: ['laptop', 'notebook', 'computer'],
            queryHints: ['laptop product photo', 'notebook computer']
          },
          {
            key: 'headphone',
            regex: /\b(fone|headphone|earbud|airpods|auricular)\b/,
            tags: ['headphones', 'earbuds'],
            keywords: ['headphones', 'earbuds', 'headset'],
            queryHints: ['headphones product photo', 'wireless earbuds']
          },
          {
            key: 'watch',
            regex: /\b(relogio|smartwatch|watch|pulseira)\b/,
            tags: ['watch', 'smartwatch'],
            keywords: ['watch', 'smartwatch', 'wristwatch'],
            queryHints: ['watch product photo', 'smartwatch']
          },
          {
            key: 'fan',
            regex: /\b(ventilador|fan|climatizador|ar condicionado)\b/,
            tags: ['fan', 'home-appliance'],
            keywords: ['fan', 'cooling', 'appliance'],
            queryHints: ['fan appliance product photo', 'home fan']
          },
          {
            key: 'kitchen',
            regex: /\b(microondas|geladeira|fogao|forno|liquidificador|batedeira|cafeteira|air fryer)\b/,
            tags: ['kitchen', 'appliance'],
            keywords: ['kitchen', 'appliance', 'cooking'],
            queryHints: ['kitchen appliance product photo', 'home appliance']
          },
          {
            key: 'vacuum',
            regex: /\b(aspirador|vacuum|robo aspirador)\b/,
            tags: ['vacuum', 'appliance'],
            keywords: ['vacuum', 'cleaner', 'appliance'],
            queryHints: ['vacuum cleaner product photo', 'home vacuum']
          },
          {
            key: 'fashion',
            regex: /\b(tenis|sapato|camiseta|calca|vestido|jaqueta|bolsa|mochila)\b/,
            tags: ['fashion', 'clothing'],
            keywords: ['fashion', 'clothing', 'apparel'],
            queryHints: ['fashion product photo', 'clothing product']
          },
          {
            key: 'beauty',
            regex: /\b(perfume|maquiagem|cosmetico|skincare|shampoo)\b/,
            tags: ['beauty', 'cosmetics'],
            keywords: ['beauty', 'cosmetics', 'skincare'],
            queryHints: ['beauty product photo', 'cosmetics']
          },
          {
            key: 'gaming',
            regex: /\b(console|playstation|xbox|controle|gamer|teclado|mouse)\b/,
            tags: ['gaming', 'console'],
            keywords: ['gaming', 'console', 'controller'],
            queryHints: ['gaming product photo', 'game console']
          }
        ];
        const matched = profiles.find((profile) => profile.regex.test(text));
        if (matched) {
          return matched;
        }
        return {
          key: 'product',
          tags: ['product', 'ecommerce'],
          keywords: ['product', 'ecommerce'],
          queryHints: ['ecommerce product photo']
        };
      }

      function uniqueValues(values) {
        return values.filter((value, index, arr) => value && arr.indexOf(value) === index);
      }

      function buildProductThemeKeywords(review, meta, profile) {
        const fromName = getProductTokens(review.productName);
        const fromCategory = getProductTokens(meta.category || '');
        const fromProfile = Array.isArray(profile?.keywords) ? profile.keywords : [];
        return uniqueValues([...fromName, ...fromCategory, ...fromProfile].map((item) => normalizeProductText(item)));
      }

      function buildProductImageQueries(review, meta, profile) {
        const productName = String(review?.productName || '').trim();
        const categoryName = String(meta?.category || '').trim();
        const queryHints = Array.isArray(profile?.queryHints) && profile.queryHints.length > 0 ? profile.queryHints : ['product photo'];
        const primaryHint = String(queryHints[0] || 'product photo').trim();
        const secondaryHint = String(queryHints[1] || primaryHint).trim();
        const baseQueries = [
          `${productName} ${primaryHint}`,
          `${productName} ${categoryName} produto`,
          `${secondaryHint} product isolated`,
          `${primaryHint} ecommerce`
        ];
        return baseQueries
          .map((query) => query.replace(/\s+/g, ' ').trim())
          .filter((query, index, arr) => query && arr.indexOf(query) === index);
      }

      function scoreImageCandidate(text, themeKeywords) {
        const normalized = normalizeProductText(text);
        if (!normalized) {
          return 0;
        }
        const penaltyRegex = /\b(logo|icon|icone|vector|illustration|wallpaper|banner|flag|map)\b/;
        let score = penaltyRegex.test(normalized) ? -8 : 0;
        const tokenSet = new Set(normalized.split(' ').filter(Boolean));

        themeKeywords.forEach((keyword) => {
          const keywordTokens = normalizeProductText(keyword).split(' ').filter(Boolean);
          if (keywordTokens.length === 0) {
            return;
          }
          const fullMatch = keywordTokens.every((token) => tokenSet.has(token));
          if (fullMatch) {
            score += keywordTokens.length >= 2 ? 7 : 4;
          } else {
            const partialHits = keywordTokens.filter((token) => tokenSet.has(token)).length;
            score += partialHits;
          }
        });

        return score;
      }

      function sanitizeWikiText(value) {
        return String(value || '')
          .replace(/<[^>]*>/g, ' ')
          .replace(/&nbsp;/g, ' ')
          .replace(/&amp;/g, '&')
          .replace(/\s+/g, ' ')
          .trim();
      }

      async function searchWikimediaCommons(query, themeKeywords) {
        const params = new URLSearchParams({
          action: 'query',
          generator: 'search',
          gsrsearch: query,
          gsrnamespace: '6',
          gsrlimit: '12',
          prop: 'imageinfo',
          iiprop: 'url|mime|size|extmetadata',
          iiurlwidth: '960',
          format: 'json',
          origin: '*'
        });
        const endpoint = `https://commons.wikimedia.org/w/api.php?${params.toString()}`;
        const response = await fetch(endpoint);
        if (!response.ok) {
          return [];
        }
        const data = await response.json();
        const pages = Object.values(data?.query?.pages || {});
        return pages
          .map((page) => {
            const info = Array.isArray(page.imageinfo) ? page.imageinfo[0] : null;
            if (!info) {
              return null;
            }
            const mime = String(info.mime || '').toLowerCase();
            if (!mime.startsWith('image/')) {
              return null;
            }
            const imageUrl = String(info.thumburl || info.url || '');
            if (!imageUrl) {
              return null;
            }
            const title = String(page.title || '').replace(/^File:/i, '').trim();
            const description = sanitizeWikiText(info?.extmetadata?.ImageDescription?.value || '');
            const score = scoreImageCandidate(`${title} ${description}`, themeKeywords);
            if (score < 1) {
              return null;
            }
            return {
              url: imageUrl,
              score,
              title
            };
          })
          .filter(Boolean);
      }

      async function searchWikipediaThumbnails(query, themeKeywords) {
        const params = new URLSearchParams({
          action: 'query',
          generator: 'search',
          gsrsearch: query,
          gsrlimit: '10',
          prop: 'pageimages|pageterms',
          piprop: 'thumbnail',
          pithumbsize: '960',
          format: 'json',
          origin: '*'
        });
        const endpoint = `https://pt.wikipedia.org/w/api.php?${params.toString()}`;
        const response = await fetch(endpoint);
        if (!response.ok) {
          return [];
        }
        const data = await response.json();
        const pages = Object.values(data?.query?.pages || {});
        return pages
          .map((page) => {
            const imageUrl = String(page?.thumbnail?.source || '');
            if (!imageUrl) {
              return null;
            }
            const description = Array.isArray(page?.terms?.description) ? page.terms.description.join(' ') : '';
            const title = String(page?.title || '');
            const score = scoreImageCandidate(`${title} ${description}`, themeKeywords);
            if (score < 1) {
              return null;
            }
            return {
              url: imageUrl,
              score,
              title
            };
          })
          .filter(Boolean);
      }

      async function getProductImageCandidates(review, meta) {
        const cacheKey = `${review.productName}|${meta.category || ''}|${meta.sku || ''}`;
        if (productImageSearchCache.has(cacheKey)) {
          return productImageSearchCache.get(cacheKey);
        }

        const profile = detectProductImageProfile(review.productName, meta.category);
        const queries = buildProductImageQueries(review, meta, profile);
        const themeKeywords = buildProductThemeKeywords(review, meta, profile);
        const querySubset = queries.slice(0, 3);
        const searchTasks = querySubset.flatMap((query) => [
          searchWikimediaCommons(query, themeKeywords),
          searchWikipediaThumbnails(query, themeKeywords)
        ]);

        const settled = await Promise.allSettled(searchTasks);
        const mergedCandidates = [];
        settled.forEach((result) => {
          if (result.status === 'fulfilled' && Array.isArray(result.value)) {
            mergedCandidates.push(...result.value);
          }
        });

        const dedupedByUrl = new Map();
        mergedCandidates.forEach((candidate) => {
          if (!candidate || !candidate.url) {
            return;
          }
          const existing = dedupedByUrl.get(candidate.url);
          if (!existing || candidate.score > existing.score) {
            dedupedByUrl.set(candidate.url, candidate);
          }
        });

        const rankedUrls = Array.from(dedupedByUrl.values())
          .sort((a, b) => b.score - a.score)
          .slice(0, 8)
          .map((item) => item.url);

        const finalCandidates = uniqueValues([...rankedUrls, buildProductSvgDataUrl(review, meta)]);
        productImageSearchCache.set(cacheKey, finalCandidates);
        return finalCandidates;
      }

      async function setProductAdImage(review, meta) {
        if (!productAdImage) {
          return;
        }

        const fallbackText = getProductInitials(review.productName);
        if (productAdImageFallback) {
          productAdImageFallback.textContent = fallbackText;
          productAdImageFallback.classList.remove('hidden');
        }
        productAdImage.classList.add('opacity-0');
        productAdImage.alt = `Imagem de ${review.productName}`;
        productAdImage.referrerPolicy = 'no-referrer';
        productAdImage.onload = null;
        productAdImage.onerror = null;

        const requestId = `${Date.now()}-${Math.random().toString(16).slice(2, 8)}`;
        productAdImage.dataset.requestId = requestId;
        let candidates = [buildProductSvgDataUrl(review, meta)];

        try {
          candidates = await getProductImageCandidates(review, meta);
        } catch (error) {
          console.warn('Falha ao buscar imagem inteligente do produto:', error);
        }
        if (productAdImage.dataset.requestId !== requestId) {
          return;
        }

        let index = 0;

        const applyCandidate = () => {
          if (index >= candidates.length) {
            if (productAdImageFallback) {
              productAdImageFallback.classList.remove('hidden');
            }
            return;
          }
          productAdImage.src = candidates[index];
        };

        productAdImage.onload = () => {
          if (productAdImage.dataset.requestId !== requestId) {
            return;
          }
          productAdImage.classList.remove('opacity-0');
          if (productAdImageFallback) {
            productAdImageFallback.classList.add('hidden');
          }
        };

        productAdImage.onerror = () => {
          if (productAdImage.dataset.requestId !== requestId) {
            return;
          }
          index += 1;
          applyCandidate();
        };

        applyCandidate();
      }

      function openProductOverlay(review) {
        if (!productOverlay) {
          return;
        }
        const meta = review.productMeta || getProductMeta(review.productName, review.marketplaceName);
        productAdTitle.textContent = review.productName;
        productAdMarketplace.textContent = `${review.marketplaceName} · Anuncio oficial`;
        productAdCategory.textContent = meta.category;
        productAdSku.textContent = meta.sku;
        productAdDescription.textContent = meta.description;
        if (productAdSpecs) {
          const specs = Array.isArray(meta.specs) ? meta.specs : [];
          if (specs.length === 0) {
            productAdSpecs.innerHTML = '<li>Especificações indisponíveis no momento.</li>';
          } else {
            productAdSpecs.innerHTML = specs.map((spec) => `<li>${applyPrivacyText(spec)}</li>`).join('');
          }
        }
        setProductAdImage(review, meta);
        setSensitiveValue(productAdPrice, formatCurrency(meta.price));
        productOverlay.classList.remove('hidden');
        productOverlay.classList.add('flex');
      }

      function closeProductOverlay() {
        if (!productOverlay) {
          return;
        }
        if (productAdImage) {
          productAdImage.onload = null;
          productAdImage.onerror = null;
          productAdImage.dataset.requestId = '';
          productAdImage.classList.add('opacity-0');
        }
        if (productAdImageFallback) {
          productAdImageFallback.classList.remove('hidden');
        }
        productOverlay.classList.add('hidden');
        productOverlay.classList.remove('flex');
      }

      function createReviewItem(template, source) {
        const now = Date.now();
        const productMeta = getProductMeta(template.productName, template.marketplaceName);
        return {
          id: `review-${now}-${Math.random().toString(16).slice(2, 6)}`,
          marketplaceId: template.marketplaceId,
          marketplaceName: template.marketplaceName,
          productName: template.productName,
          productMeta,
          reward: Number(template.reward || 0),
          source,
          status: 'pending',
          createdAt: now,
          expiresAt: now + reviewTTL
        };
      }

      function scheduleNextReview() {
        if (!accountState) {
          return;
        }

        const now = Date.now();
        if (!accountState.nextReviewAt || now >= accountState.nextReviewAt) {
          const interval = reviewIntervals[accountState.reviewIntervalIndex % reviewIntervals.length];
          const activeCount = accountState.reviews.filter((review) => review.status === 'pending').length;
          let createdCount = 0;
          if (activeCount < 8) {
            const template = getRandomReviewTemplate();
            if (template) {
              accountState.reviews.unshift(createReviewItem(template, 'auto'));
              createdCount = 1;
              const nextCount = activeCount + 1;
              if (nextCount > lastPendingReviewCount) {
                notifyNewTask(nextCount);
                lastPendingReviewCount = nextCount;
              }
            }
          }
          accountState.reviewIntervalIndex = (accountState.reviewIntervalIndex + 1) % reviewIntervals.length;
          accountState.nextReviewAt = now + interval * 60 * 1000;
          lastPendingReviewCount = activeCount + createdCount;
          saveAccountState();
          renderReviewList();
        }

        updateNextReviewInfo();
        clearTimeout(taskTimer);
        const delay = Math.max(1000, accountState.nextReviewAt - Date.now());
        taskTimer = setTimeout(scheduleNextReview, delay);
      }

      function renderReviewList(suppressNotify = false) {
        if (!accountState) {
          return;
        }
        pruneExpiredReviews();
        updateNextReviewInfo();

        const activeReviews = accountState.reviews.filter((review) => review.status === 'pending');
        if (!suppressNotify && activeReviews.length !== lastPendingReviewCount && activeReviews.length > lastPendingReviewCount) {
          notifyNewTask(activeReviews.length);
        }
        lastPendingReviewCount = activeReviews.length;
        if (activeReviews.length === 0) {
          reviewList.innerHTML = '<li class="text-white/50">Sem avaliações no momento. Aguarde novas recomendações.</li>';
          if (reviewListSecondary) {
            reviewListSecondary.innerHTML = '<li class="text-white/50">Sem avaliações no momento. Aguarde novas recomendações.</li>';
          }
          updateDashboardStats();
          renderProductHighlights();
          return;
        }

        const html = activeReviews
          .map(
            (review) => `
            <li class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
              <div class="flex flex-wrap items-center justify-between gap-3">
                <div>
                  <p class="text-sm font-semibold">${review.marketplaceName} · ${review.productName}</p>
                  <p class="text-xs text-white/60">Recompensa: ${applyPrivacyText(formatCurrency(review.reward))}</p>
                </div>
                <button data-review-id="${review.id}" class="text-xs text-emerald-200 hover:text-emerald-100">Avaliar</button>
              </div>
              <div class="mt-2 flex flex-wrap items-center justify-between gap-2 text-xs text-white/50">
                <span>${review.source === 'admin' ? 'Manual' : 'Automática'}</span>
                <span>Expira em ${formatTimeLeft(review.expiresAt)}</span>
              </div>
            </li>
          `
          )
          .join('');

        reviewList.innerHTML = html;
        if (reviewListSecondary) {
          reviewListSecondary.innerHTML = html;
        }
        updateDashboardStats();
        renderProductHighlights();
      }

      let activeReviewId = null;

      function openReviewOverlay(review) {
        activeReviewId = review.id;
        setSensitiveValue(
          reviewProductInfo,
          `${review.marketplaceName} · ${review.productName} · ${formatCurrency(review.reward)}`
        );
        resetReviewForm();
        updateReviewAutoAIButtonState();
        reviewOverlay.classList.remove('hidden');
        reviewOverlay.classList.add('flex');
      }

      function closeReviewOverlay() {
        reviewOverlay.classList.add('hidden');
        reviewOverlay.classList.remove('flex');
        activeReviewId = null;
        if (reviewTutorialOverlay) {
          reviewTutorialOverlay.classList.add('hidden');
          reviewTutorialOverlay.classList.remove('flex');
        }
      }

      function resetReviewForm() {
        reviewMessage.textContent = '';
        reviewFeedback.value = '';
        reviewTitle.value = '';
        if (reviewSku) {
          reviewSku.value = '';
        }
        reviewRecommend.value = '';
        reviewQuality.value = '';
        reviewRatingInputs.forEach((input) => {
          input.checked = false;
        });
        if (reviewTutorialOverlay) {
          reviewTutorialOverlay.classList.add('hidden');
        }
      }

      function getReviewAutoFillData(review) {
        const productName = String(review?.productName || 'Produto');
        const marketplaceName = String(review?.marketplaceName || 'Marketplace');
        const meta = review.productMeta || getProductMeta(productName, marketplaceName);
        const combinedText = `${productName} ${String(meta.category || '')}`.toLowerCase();
        const rewardValue = Number(review.reward || 0);

        let rating = 5;
        if (/cabo|case|pelicula|adaptador|suporte|acessorio/.test(combinedText)) {
          rating = 4;
        }
        if (/basico|entrada|economico/.test(combinedText)) {
          rating = Math.min(rating, 4);
        }
        if (/usado|recondicionado|open box/.test(combinedText)) {
          rating = Math.min(rating, 3);
        }
        if (/defeito|quebrado|falha|fragil/.test(combinedText)) {
          rating = 2;
        }
        if (Number.isFinite(rewardValue) && rewardValue < 5 && rating > 4) {
          rating = 4;
        }

        const qualityByRating = {
          5: 'excelente',
          4: 'boa',
          3: 'regular',
          2: 'ruim',
          1: 'ruim'
        };
        const quality = qualityByRating[rating] || 'boa';
        const recommend = rating >= 4 ? 'sim' : 'nao';

        const introOptions = [
          `Analisando o anuncio de ${productName} no ${marketplaceName}, os dados principais estao completos.`,
          `${productName} no ${marketplaceName} apresenta informacoes claras para validar a compra.`,
          `Revisei o anuncio de ${productName} e o cadastro esta consistente no ${marketplaceName}.`
        ];
        const intro = introOptions[hashString(`${review.id}-intro`) % introOptions.length];

        const priceValue = Number(meta.price || 0);
        const priceLine = Number.isFinite(priceValue) && priceValue > 0
          ? `Faixa de preco informada: ${formatCurrency(priceValue)}.`
          : 'Faixa de preco dentro do padrao para o produto.';

        const specs = Array.isArray(meta.specs) ? meta.specs.filter(Boolean).slice(0, 2) : [];
        const specsLine = specs.length > 0
          ? `Pontos vistos no anuncio: ${specs.join(' | ')}.`
          : 'O anuncio traz descricao e especificacoes minimas para avaliacao.';

        const qualityLineByKey = {
          excelente: 'A percepcao geral e de qualidade alta, com bom acabamento e confianca no anuncio.',
          boa: 'A qualidade aparenta ser boa e adequada para uso do dia a dia.',
          regular: 'A qualidade parece regular, atende o basico mas sem destaque.',
          ruim: 'A qualidade aparenta ser fraca e precisa de mais validacao antes da compra.'
        };
        const qualityLine = qualityLineByKey[quality] || qualityLineByKey.boa;
        const recommendationLine = recommend === 'sim'
          ? 'Recomendaria para quem busca custo-beneficio dentro dessa categoria.'
          : 'Nao recomendaria no momento, pois o custo-beneficio nao parece ideal.';

        const feedback = [intro, priceLine, specsLine, qualityLine, recommendationLine].join(' ');

        return {
          rating,
          recommend,
          quality,
          title: productName,
          sku: String(meta.sku || ''),
          feedback
        };
      }

      function getSelectableValues(selectElement) {
        if (!selectElement) {
          return [];
        }
        return Array.from(selectElement.options || [])
          .map((option) => String(option.value || '').trim())
          .filter((value) => value.length > 0);
      }

      function normalizeOptionValue(value) {
        return String(value || '')
          .trim()
          .toLowerCase();
      }

      function pickVariableValue(availableValues, rankedValues) {
        const available = Array.isArray(availableValues) ? availableValues.filter(Boolean) : [];
        if (available.length === 0) {
          return '';
        }
        const normalizedAvailableMap = new Map(
          available.map((value) => [normalizeOptionValue(value), value])
        );
        const rankedNormalized = (Array.isArray(rankedValues) ? rankedValues : [])
          .map((value) => normalizeOptionValue(value))
          .filter(
            (value, index, arr) => value && arr.indexOf(value) === index && normalizedAvailableMap.has(value)
          );
        const ranked = rankedNormalized.map((value) => normalizedAvailableMap.get(value));
        const pool = ranked.length > 0 ? ranked : available;
        const topWindow = Math.min(3, pool.length);
        const pickIndex = Math.floor(Math.random() * topWindow);
        return pool[pickIndex] || pool[0];
      }

      function getQualityCandidatesByRating(rating, fallbackQuality) {
        const normalizedRating = Number.isFinite(rating) ? rating : 4;
        if (normalizedRating >= 5) {
          return [fallbackQuality, 'excelente', 'boa', 'regular'];
        }
        if (normalizedRating === 4) {
          return [fallbackQuality, 'boa', 'excelente', 'regular'];
        }
        if (normalizedRating === 3) {
          return [fallbackQuality, 'regular', 'boa', 'ruim'];
        }
        return [fallbackQuality, 'ruim', 'regular', 'boa'];
      }

      function autoFillReviewForm(review) {
        if (!review) {
          return;
        }
        const autoData = getReviewAutoFillData(review);
        const availableRatingValues = Array.from(reviewRatingInputs)
          .map((input) => Number(input.value))
          .filter((value) => Number.isFinite(value));
        const preferredRatings = [
          autoData.rating,
          autoData.rating - 1,
          autoData.rating + 1,
          5,
          4,
          3,
          2,
          1
        ]
          .filter((value, index, arr) => Number.isFinite(value) && value >= 1 && value <= 5 && arr.indexOf(value) === index)
          .map(String);
        const selectedRating = pickVariableValue(
          availableRatingValues.map(String),
          preferredRatings
        );

        reviewRatingInputs.forEach((input) => {
          input.checked = input.value === selectedRating;
        });

        const normalizedSelectedRating = Number(selectedRating || autoData.rating || 4);

        const availableRecommendValues = getSelectableValues(reviewRecommend);
        const recommendRanking =
          normalizedSelectedRating >= 4
            ? [autoData.recommend, 'sim', 'nao']
            : [autoData.recommend, 'nao', 'sim'];
        const selectedRecommend = pickVariableValue(availableRecommendValues, recommendRanking);
        reviewRecommend.value = selectedRecommend || availableRecommendValues[0] || '';

        const availableQualityValues = getSelectableValues(reviewQuality);
        const qualityRanking = getQualityCandidatesByRating(normalizedSelectedRating, autoData.quality);
        const selectedQuality = pickVariableValue(availableQualityValues, qualityRanking);
        reviewQuality.value = selectedQuality || availableQualityValues[0] || '';

        reviewTitle.value = autoData.title;
        if (reviewSku) {
          reviewSku.value = autoData.sku;
        }
        reviewFeedback.value = autoData.feedback;
        reviewMessage.textContent = 'Avaliacao preenchida com variacao inteligente nas opcoes disponiveis.';
        reviewMessage.className = 'mt-3 text-xs text-cyan-300';
      }
      function renderAdminReviews() {
        if (!accountState) {
          return;
        }
        const adminReviews = accountState.reviews.filter((review) => review.source === 'admin' && review.status === 'pending');
        if (adminReviews.length === 0) {
          adminReviewList.innerHTML = '<li class="text-white/50">Nenhuma avaliação manual cadastrada.</li>';
          return;
        }
        adminReviewList.innerHTML = adminReviews
          .map(
            (review) => `
            <li class="rounded-xl border border-white/10 bg-ink-800/70 p-3">
              <div class="flex items-center justify-between gap-3">
                <div>
                  <p class="text-sm font-semibold">${review.marketplaceName} · ${review.productName}</p>
                  <p class="text-xs text-white/60">${applyPrivacyText(formatCurrency(review.reward))} · Expira em ${formatTimeLeft(review.expiresAt)}</p>
                </div>
                <button data-admin-review-remove="${review.id}" class="text-xs text-rose-300 hover:text-rose-200">Remover</button>
              </div>
            </li>
          `
          )
          .join('');
      }

      function renderAdminReportList() {
        if (!adminReportList || !accountState) {
          return;
        }
        const manualSales = Array.isArray(accountState.manualSales) ? accountState.manualSales : [];
        if (manualSales.length === 0) {
          adminReportList.innerHTML = '<li class="text-white/50">Nenhum resultado manual cadastrado.</li>';
          return;
        }
        const sorted = [...manualSales].sort((a, b) => (a.date < b.date ? 1 : -1));
        adminReportList.innerHTML = sorted
          .map((entry) => {
            const date = parseDateKey(entry.date);
            const label = date ? date.toLocaleDateString('pt-BR') : entry.date;
            return `
              <li class="rounded-xl border border-white/10 bg-ink-800/70 p-3">
                <div class="flex items-center justify-between gap-3">
                  <div>
                    <p class="text-sm font-semibold">${label}</p>
                    <p class="text-xs text-white/60">${applyPrivacyText(formatCurrency(entry.value))}</p>
                  </div>
                  <div class="flex items-center gap-3">
                    <button data-admin-report-edit="${entry.date}" class="text-xs text-sky-200 hover:text-sky-100">Editar</button>
                    <button data-admin-report-remove="${entry.date}" class="text-xs text-rose-300 hover:text-rose-200">Remover</button>
                  </div>
                </div>
              </li>
            `;
          })
          .join('');
      }

      function formatMonthLabel(monthKey) {
        const parts = String(monthKey || '').split('-').map(Number);
        if (parts.length < 2 || !parts[0] || !parts[1]) {
          return monthKey;
        }
        const date = new Date(parts[0], parts[1] - 1, 1);
        return date.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
      }

      function renderAdminReportMonthList() {
        if (!adminReportMonthList || !accountState) {
          return;
        }
        const manualMonths = Array.isArray(accountState.manualSalesMonths) ? accountState.manualSalesMonths : [];
        if (manualMonths.length === 0) {
          adminReportMonthList.innerHTML = '<li class="text-white/50">Nenhum mes cadastrado.</li>';
          return;
        }
        const sorted = [...manualMonths].sort((a, b) => (a.month < b.month ? 1 : -1));
        adminReportMonthList.innerHTML = sorted
          .map((entry) => {
            const label = formatMonthLabel(entry.month);
            return `
              <li class="rounded-xl border border-white/10 bg-ink-800/70 p-3">
                <div class="flex items-center justify-between gap-3">
                  <div>
                    <p class="text-sm font-semibold">${label}</p>
                    <p class="text-xs text-white/60">${applyPrivacyText(formatCurrency(entry.value))}</p>
                  </div>
                  <button data-admin-report-month-remove="${entry.month}" class="text-xs text-rose-300 hover:text-rose-200">Remover</button>
                </div>
              </li>
            `;
          })
          .join('');
      }

      function renderRequestList(list, container, emptyText, showActions = true) {
        if (list.length === 0) {
          container.innerHTML = `<li class="text-white/50">${emptyText}</li>`;
          return;
        }

        container.innerHTML = list
          .map((request) => {
            const statusColor =
              request.status === 'aprovado' ? 'text-emerald-300' : request.status === 'rejeitado' ? 'text-rose-300' : 'text-white/60';
            const actions =
              showActions && request.status === 'pendente'
                ? `
                <div class="mt-2 flex gap-2">
                  <button data-action="aprovar" data-request-id="${request.id}" class="rounded-full border border-emerald-400/30 px-3 py-1 text-xs text-emerald-200">Aprovar</button>
                  <button data-action="rejeitar" data-request-id="${request.id}" class="rounded-full border border-rose-400/30 px-3 py-1 text-xs text-rose-200">Rejeitar</button>
                </div>`
                : '';

            const label = applyPrivacyText(request.label);
            const amount = applyPrivacyText(formatCurrency(request.amount));
            const originText =
              request.source === 'review'
                ? request.status === 'pendente'
                  ? 'Origem: avaliação aguardando aprovação'
                  : request.status === 'aprovado'
                    ? 'Origem: avaliação aprovada'
                    : 'Origem: avaliação rejeitada'
                : '';
            const pixDetailsText =
              request.pixKeyType || request.pixBank
                ? `PIX: ${getPixTypeLabel(request.pixKeyType)}${request.pixBank ? ` · Banco: ${applyPrivacyText(request.pixBank)}` : ''}`
                : '';
            return `
              <li class="rounded-xl border border-white/10 bg-ink-800/70 p-3">
                <div class="flex items-center justify-between gap-3">
                  <p class="text-sm font-semibold">${label}</p>
                  <span class="text-xs text-white/50">${amount}</span>
                </div>
                <p class="mt-1 text-xs ${statusColor}">Status: ${request.status}</p>
                ${originText ? `<p class="mt-1 text-xs text-white/40">${originText}</p>` : ''}
                ${pixDetailsText ? `<p class="mt-1 text-xs text-white/40">${pixDetailsText}</p>` : ''}
                ${actions}
              </li>
            `;
          })
          .join('');
      }

      function renderAllAdminLists() {
        renderAdminReviews();
        renderAdminReportList();
        renderAdminReportMonthList();
        renderRequestList(accountState?.balanceRequests || [], balanceRequestList, 'Sem solicitações de saldo.');
        renderRequestList(accountState?.withdrawalRequests || [], withdrawalRequestList, 'Sem solicitações de saque.');
        renderFinanceLists();
        renderAdminAutoIAControl();
        renderAdminLevelControl();
        renderAdminSupportAssistantConfig();
        renderTeamMembers();
        updateDashboardStats();
      }

      function renderFinancePaymentsFilterButtons() {
        if (!financePaymentsFilterPending || !financePaymentsFilterAll) {
          return;
        }
        const isAll = financePaymentsFilterMode === 'all';
        financePaymentsFilterPending.className = isAll
          ? 'rounded-full px-3 py-1 text-white/70 transition hover:bg-white/10'
          : 'rounded-full bg-glow-500/20 px-3 py-1 text-glow-200';
        financePaymentsFilterAll.className = isAll
          ? 'rounded-full bg-glow-500/20 px-3 py-1 text-glow-200'
          : 'rounded-full px-3 py-1 text-white/70 transition hover:bg-white/10';
      }

      function renderFinanceLists() {
        renderFinancePaymentsFilterButtons();
        if (!accountState) {
          return;
        }
        if (financeBalanceRequestList) {
          const reviewRequests = (accountState.balanceRequests || []).filter((request) => request.source === 'review');
          const list = financePaymentsFilterMode === 'all'
            ? reviewRequests
            : reviewRequests.filter((request) => request.status === 'pendente');
          const emptyMessage = financePaymentsFilterMode === 'all'
            ? 'Sem pagamentos registrados.'
            : 'Sem pagamentos pendentes.';
          renderRequestList(list, financeBalanceRequestList, emptyMessage, false);
        }
        if (financeWithdrawalList) {
          renderRequestList(accountState.withdrawalRequests || [], financeWithdrawalList, 'Sem solicitações de saque.', false);
        }
      }

      function setSupportAssistantStatus(text) {
        if (!supportAssistantState) {
          return;
        }
        supportAssistantState.textContent = text;
      }

      function getSupportAssistantRuntime() {
        const config = ensureSupportAssistantConfigState();
        const hasApiKey = Boolean(String(config.openAIApiKey || '').trim());
        const useOpenAI = config.mode === 'openai' && hasApiKey;
        return {
          config,
          hasApiKey,
          useOpenAI,
          displayName: useOpenAI ? 'ChatGPT' : 'Atlas IA'
        };
      }

      function updateSupportAssistantModeLabel() {
        if (!supportAssistantModeLabel) {
          return;
        }
        const runtime = getSupportAssistantRuntime();
        if (runtime.useOpenAI) {
          supportAssistantModeLabel.textContent = `Modo: ChatGPT real (${runtime.config.openAIModel})`;
          supportAssistantModeLabel.className = 'text-xs text-emerald-300';
          return;
        }
        if (runtime.config.mode === 'openai' && !runtime.hasApiKey) {
          supportAssistantModeLabel.textContent = 'Modo: ChatGPT real (faltando API key)';
          supportAssistantModeLabel.className = 'text-xs text-amber-300';
          return;
        }
        supportAssistantModeLabel.textContent = 'Modo: Atlas IA local';
        supportAssistantModeLabel.className = 'text-xs text-glow-300';
      }

      function setSupportTypingState(active, text = 'Processando...') {
        if (supportTypingLabel) {
          supportTypingLabel.textContent = text;
        }
        if (supportTypingIndicator) {
          supportTypingIndicator.classList.toggle('hidden', !active);
        }
        if (active && supportChatList) {
          supportChatList.scrollTop = supportChatList.scrollHeight;
        }
      }

      function setSupportComposerState(disabled) {
        const isDisabled = Boolean(disabled);
        if (supportChatInput) {
          supportChatInput.disabled = isDisabled;
        }
        if (supportChatSend) {
          supportChatSend.disabled = isDisabled;
          supportChatSend.classList.toggle('opacity-70', isDisabled);
          supportChatSend.classList.toggle('cursor-not-allowed', isDisabled);
        }
      }

      function formatSupportTime(value = Date.now()) {
        return new Date(value).toLocaleTimeString('pt-BR', {
          hour: '2-digit',
          minute: '2-digit'
        });
      }

      function appendSupportMessage(role, text, options = {}) {
        if (!supportChatList) {
          return;
        }
        const safeText = String(text || '').trim();
        if (!safeText) {
          return;
        }
        const runtime = getSupportAssistantRuntime();
        const isUser = role === 'user';
        const assistantName = String(options.assistantName || runtime.displayName || 'Atlas IA').trim();
        const assistantIsOpenAI = !isUser && /chatgpt/i.test(assistantName);

        const item = document.createElement('li');
        item.className = `support-row ${isUser ? 'support-row-user' : 'support-row-assistant'}`;

        const avatar = document.createElement('span');
        avatar.className = `support-avatar ${isUser ? 'support-avatar-user' : 'support-avatar-assistant'}`;
        avatar.textContent = isUser ? 'VOC' : (assistantIsOpenAI ? 'GPT' : 'IA');

        const content = document.createElement('div');
        content.className = 'support-content';

        const tag = document.createElement('span');
        tag.className = 'support-meta';
        tag.textContent = `${isUser ? 'Você' : assistantName} • ${formatSupportTime()}`;

        const bubble = document.createElement('div');
        bubble.className = `support-bubble ${isUser ? 'support-bubble-user' : 'support-bubble-assistant'}`;
        bubble.textContent = applyPrivacyText(safeText);

        content.appendChild(tag);
        content.appendChild(bubble);
        if (isUser) {
          item.appendChild(content);
          item.appendChild(avatar);
        } else {
          item.appendChild(avatar);
          item.appendChild(content);
        }
        supportChatList.appendChild(item);
        supportChatList.scrollTop = supportChatList.scrollHeight;
      }

      function getSupportSnapshot() {
        const now = new Date();
        const startToday = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0, 0);
        const endToday = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59, 999);
        const requests = accountState?.balanceRequests || [];
        const reviewRequests = requests.filter((request) => request.source === 'review');
        const approvedToday = getUnifiedPeriodTotal(startToday, endToday);
        const pendingValue = reviewRequests
          .filter((request) => request.status === 'pendente')
          .reduce((sum, request) => sum + Number(request.amount || 0), 0);
        const approvedValue = reviewRequests
          .filter((request) => request.status === 'aprovado')
          .reduce((sum, request) => sum + Number(request.amount || 0), 0);
        const pendingCount = reviewRequests.filter((request) => request.status === 'pendente').length;
        const approvedCount = reviewRequests.filter((request) => request.status === 'aprovado').length;
        const connectedCount = (accountState?.marketplaces || [])
          .filter((marketplace) => isMarketplaceConnectionValidForCurrentAccount(marketplace))
          .length;
        const levelState = accountState ? getAIRobotLevelState() : null;

        return {
          approvedToday,
          pendingValue,
          approvedValue,
          pendingCount,
          approvedCount,
          connectedCount,
          balance: Number(accountState?.balance || 0),
          bonusBalance: Number(accountState?.bonusBalance || 0),
          levelName: levelState?.currentLevel?.name || 'Bronze'
        };
      }

      function getSupportRangeByDays(days) {
        const safeDays = Math.max(1, Math.min(365, Number(days || 1)));
        const now = new Date();
        const end = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59, 999);
        const start = new Date(end);
        start.setDate(end.getDate() - (safeDays - 1));
        start.setHours(0, 0, 0, 0);
        return {
          days: safeDays,
          start,
          end,
          total: getUnifiedPeriodTotal(start, end)
        };
      }

      function extractSupportDays(lowerQuestion) {
        const normalized = String(lowerQuestion || '').toLowerCase();
        const direct = normalized.match(/(\d{1,3})\s*dias?/);
        if (direct && direct[1]) {
          const parsed = Number(direct[1]);
          if (Number.isFinite(parsed)) {
            return Math.max(1, Math.min(365, parsed));
          }
        }
        if (/(ultimo[s]?|último[s]?).*30|30.*dias?/.test(normalized)) {
          return 30;
        }
        if (/(ultimo[s]?|último[s]?).*15|15.*dias?/.test(normalized)) {
          return 15;
        }
        if (/(ultimo[s]?|último[s]?).*7|7.*dias?/.test(normalized)) {
          return 7;
        }
        if (/(hoje|dia atual)/.test(normalized)) {
          return 1;
        }
        return null;
      }

      function detectSupportIntent(lowerQuestion) {
        const lower = String(lowerQuestion || '').toLowerCase();
        if (/(relatorio|relatório|periodo|período|dias|fatur|total)/.test(lower)) {
          return 'periodo';
        }
        if (/(aprova|pendent|avali)/.test(lower)) {
          return 'aprova';
        }
        if (/(saldo|carteira|bonus|bônus|saque|pix)/.test(lower)) {
          return 'financeiro';
        }
        if (/(marketplace|integra|conectar|catalogo|catálogo|codigo|código)/.test(lower)) {
          return 'integracoes';
        }
        if (/(nivel|nível|robo|robô|ia)/.test(lower)) {
          return 'niveis';
        }
        return 'geral';
      }

      function buildSupportAccountContext() {
        const snapshot = getSupportSnapshot();
        const localAccountId = getOrCreateLocalAccountId() || 'N/A';
        const levelState = getAIRobotLevelState();
        const connectedMarketplaces = (accountState?.marketplaces || [])
          .filter((marketplace) => isMarketplaceConnectionValidForCurrentAccount(marketplace))
          .map((marketplace) => `${marketplace.name} (${marketplace.accountId})`)
          .slice(0, 10);
        const reviewsPending = (accountState?.reviews || []).filter((review) => review.status === 'pending').length;
        const reviewsCompleted = (accountState?.reviews || []).filter((review) => review.status === 'approved').length;
        const todayRange = getSupportRangeByDays(1);
        const range30 = getSupportRangeByDays(30);
        return [
          'Contexto operacional da conta ReviewPay:',
          `ID local: ${localAccountId}`,
          `Saldo: ${formatCurrency(snapshot.balance)}`,
          `Bonus: ${formatCurrency(snapshot.bonusBalance)}`,
          `Aprovado hoje: ${formatCurrency(todayRange.total)}`,
          `Total últimos 30 dias: ${formatCurrency(range30.total)}`,
          `Pendentes (valor): ${formatCurrency(snapshot.pendingValue)}`,
          `Aprovados (valor): ${formatCurrency(snapshot.approvedValue)}`,
          `Pendentes (qtd): ${snapshot.pendingCount}`,
          `Aprovados (qtd): ${snapshot.approvedCount}`,
          `Avaliações pendentes: ${reviewsPending}`,
          `Avaliações concluídas: ${reviewsCompleted}`,
          `Nível atual: ${levelState.currentLevel.name}`,
          `Tempo diário da IA: ${levelState.currentLevel.dailyMinutes} min`,
          `Uso hoje: ${formatMinutesFromMs(levelState.usedMs)}`,
          `Tempo restante hoje: ${formatMinutesFromMs(levelState.remainingMs)}`,
          `Marketplaces conectados (${connectedMarketplaces.length}): ${connectedMarketplaces.join(', ') || 'nenhum'}`
        ].join('\n');
      }

      function buildOpenAIChatMessages(question) {
        const runtime = getSupportAssistantRuntime();
        const systemInstruction =
          'Você é um assistente de suporte premium do ReviewPay.'
          + ' Responda em português do Brasil de forma direta, útil e profissional.'
          + ' Use somente o contexto operacional fornecido.'
          + ' Se faltar dado para algo externo, diga claramente e não invente.'
          + ' Sempre priorize regras da plataforma: integrações exigem o ID local correto da conta.';
        const contextInstruction = buildSupportAccountContext();
        const history = supportConversationTurns
          .slice(-8)
          .flatMap((turn) => ([
            { role: 'user', content: String(turn.question || '') },
            { role: 'assistant', content: String(turn.answer || '') }
          ]));
        return {
          model: runtime.config.openAIModel,
          messages: [
            { role: 'system', content: systemInstruction },
            { role: 'system', content: contextInstruction },
            ...history,
            { role: 'user', content: question }
          ]
        };
      }

      async function requestOpenAISupportReply(question) {
        const runtime = getSupportAssistantRuntime();
        if (!runtime.useOpenAI) {
          throw new Error('OPENAI_NOT_ENABLED');
        }
        const payload = buildOpenAIChatMessages(question);
        const response = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            Authorization: `Bearer ${runtime.config.openAIApiKey}`
          },
          body: JSON.stringify({
            model: payload.model,
            messages: payload.messages,
            temperature: 0.35,
            max_tokens: 520
          })
        });

        let data = null;
        try {
          data = await response.json();
        } catch (error) {
          data = null;
        }

        if (!response.ok) {
          const apiMessage = String(data?.error?.message || '').trim();
          throw new Error(apiMessage || `HTTP_${response.status}`);
        }

        const text = String(data?.choices?.[0]?.message?.content || '').trim();
        if (!text) {
          throw new Error('Resposta vazia da API.');
        }
        return text;
      }

      function generateSupportReply(question) {
        const text = String(question || '').trim();
        const lower = text.toLowerCase();
        const snapshot = getSupportSnapshot();
        const hasData = Boolean(accountState);

        if (!hasData) {
          return {
            text: 'Faça login para eu responder usando os dados reais da conta (saldo, aprovações, integrações e níveis).',
            intent: 'geral'
          };
        }

        if (/(mentir|enganar|inventar|falso)/.test(lower)) {
          return {
            text: 'Eu trabalho com os dados da sua conta em tempo real. Se quiser, eu te mostro agora total por período, pendentes e saldo disponível.',
            intent: 'geral'
          };
        }

        const requestedDays = extractSupportDays(lower);
        if (requestedDays) {
          const range = getSupportRangeByDays(requestedDays);
          const label = requestedDays === 1 ? 'hoje' : `últimos ${requestedDays} dias`;
          return {
            text:
              `No período de ${label}, seu total operacional é ${formatCurrency(range.total)}.`
              + ` Pendente atual: ${formatCurrency(snapshot.pendingValue)}.`
              + ` Aprovado acumulado: ${formatCurrency(snapshot.approvedValue)}.`,
            intent: 'periodo'
          };
        }

        const intent = detectSupportIntent(lower);

        if (intent === 'aprova') {
          return {
            text:
              `Fluxo real: avaliação enviada -> pagamento pendente -> aprovação -> saldo.`
              + ` Agora: ${snapshot.pendingCount} pendente(s), ${snapshot.approvedCount} aprovado(s), pendente em valor ${formatCurrency(snapshot.pendingValue)}.`,
            intent
          };
        }

        if (intent === 'financeiro') {
          const available = getAvailableBalance();
          return {
            text:
              `Financeiro atual: saldo ${formatCurrency(snapshot.balance)}, disponível para saque ${formatCurrency(available)} e bônus ${formatCurrency(snapshot.bonusBalance)}.`
              + ` Se quiser, te passo o melhor período para análise (7, 15 ou 30 dias).`,
            intent
          };
        }

        if (intent === 'integracoes') {
          const localAccountId = getOrCreateLocalAccountId();
          return {
            text:
              `Integrações ativas: ${snapshot.connectedCount}.`
              + ` Para conectar novo marketplace, use a aba Catálogo e informe exatamente seu ID local (${localAccountId || 'N/A'}).`
              + ' A sincronização só vale para conectados com o ID local correto.',
            intent
          };
        }

        if (intent === 'niveis') {
          const levelState = getAIRobotLevelState();
          return {
            text:
              `Seu nível atual é ${snapshot.levelName}.`
              + ` Tempo diário da IA: ${levelState.currentLevel.dailyMinutes} min.`
              + ` Uso de hoje: ${formatMinutesFromMs(levelState.usedMs)}.`
              + ` Restante: ${formatMinutesFromMs(levelState.remainingMs)}.`,
            intent
          };
        }

        const lastTurn = supportConversationTurns[supportConversationTurns.length - 1];
        if (/(isso|esse|detalha|explica melhor|aprofunda)/.test(lower) && lastTurn?.intent === 'periodo') {
          const range30 = getSupportRangeByDays(30);
          return {
            text:
              `Detalhando: últimos 30 dias = ${formatCurrency(range30.total)}.`
              + ' Você pode filtrar por período no Financeiro > aba Relatórios para ver a variação dia a dia no gráfico.',
            intent: 'periodo'
          };
        }

        return {
          text:
            'Posso operar como copiloto da conta. Me peça direto: "total últimos 30 dias", "status das aprovações", "saldo e saque", "nível da IA" ou "integrações ativas".',
          intent
        };
      }

      function initializeSupportAssistant(force = false) {
        if (!supportChatList) {
          return;
        }
        if (!force && supportChatList.dataset.ready === '1') {
          return;
        }
        const runtime = getSupportAssistantRuntime();
        supportChatList.dataset.ready = '1';
        supportChatList.innerHTML = '';
        supportConversationTurns = [];
        supportRequestInFlight = false;
        setSupportTypingState(false);
        setSupportComposerState(false);
        updateSupportAssistantModeLabel();
        appendSupportMessage(
          'assistant',
          runtime.useOpenAI
            ? `Sou o ChatGPT conectado ao ReviewPay. Vou responder com base nos dados reais da conta e no contexto da plataforma.`
            : 'Sou o Atlas IA Copilot. Respondo com base nos dados reais da sua conta: período, aprovações, saldo, integrações e níveis.',
          { assistantName: runtime.displayName }
        );
        const snapshot = getSupportSnapshot();
        if (accountState) {
          appendSupportMessage(
            'assistant',
            `Status inicial: saldo ${formatCurrency(snapshot.balance)}, pendente ${formatCurrency(snapshot.pendingValue)}, nível ${snapshot.levelName}.`
            + (runtime.config.mode === 'openai' && !runtime.hasApiKey
              ? ' Modo ChatGPT está ativo, mas sem chave API. Enquanto isso, uso o Atlas local.'
              : ''),
            { assistantName: runtime.displayName }
          );
        }
        setSupportAssistantStatus(
          runtime.useOpenAI
            ? `ChatGPT online (${runtime.config.openAIModel})`
            : 'Atlas IA online'
        );
      }

      function formatRelativeTime(value) {
        if (!value) {
          return 'Sem sync';
        }
        const diff = Date.now() - new Date(value).getTime();
        if (Number.isNaN(diff)) {
          return 'Sem sync';
        }
        const minutes = Math.floor(diff / 60000);
        if (minutes < 1) {
          return 'Agora';
        }
        if (minutes < 60) {
          return `${minutes} min atrás`;
        }
        const hours = Math.floor(minutes / 60);
        return `${hours}h atrás`;
      }

      function renderMarketplaces() {
        if (!accountState) {
          return;
        }
        const synced = syncMarketplacesWithCatalog(accountState.marketplaces);
        const current = Array.isArray(accountState.marketplaces) ? accountState.marketplaces : [];
        const needsSync =
          current.length !== synced.length
          || current.some((item, index) => !synced[index] || item.id !== synced[index].id || item.name !== synced[index].name);
        if (needsSync) {
          accountState.marketplaces = synced;
          saveAccountState();
        }

        const localAccountId = getOrCreateLocalAccountId();
        let normalizedConnectionChanged = false;
        accountState.marketplaces = (accountState.marketplaces || []).map((marketplace) => {
          const accountId = normalizeMarketplaceAccountCode(marketplace.accountId || '');
          const isValidConnection =
            Boolean(localAccountId)
            && Boolean(marketplace.connected)
            && isValidMarketplaceAccountCode(accountId)
            && accountId === localAccountId;
          if (isValidConnection) {
            if (accountId !== marketplace.accountId) {
              normalizedConnectionChanged = true;
              return {
                ...marketplace,
                accountId
              };
            }
            return marketplace;
          }
          const changed =
            Boolean(marketplace.connected)
            || Boolean(marketplace.lastSync)
            || String(marketplace.accountId || '') !== accountId;
          if (!changed) {
            return marketplace;
          }
          normalizedConnectionChanged = true;
          return {
            ...marketplace,
            connected: false,
            accountId,
            lastSync: null
          };
        });
        if (normalizedConnectionChanged) {
          saveAccountState();
        }

        const sortedMarketplaces = [...accountState.marketplaces].sort((a, b) => {
          const connectedDiff =
            Number(isMarketplaceConnectionValidForCurrentAccount(b))
            - Number(isMarketplaceConnectionValidForCurrentAccount(a));
          if (connectedDiff !== 0) {
            return connectedDiff;
          }
          return String(a.name || '').localeCompare(String(b.name || ''), 'pt-BR');
        });
        const connectedMarketplaces = sortedMarketplaces.filter(
          (marketplace) => isMarketplaceConnectionValidForCurrentAccount(marketplace)
        );
        const connectedHtml = connectedMarketplaces.length > 0
          ? connectedMarketplaces
              .map((marketplace) => {
                const syncText = marketplace.lastSync
                  ? `Última sync: ${formatRelativeTime(marketplace.lastSync)}`
                  : 'Sem sync recente';
                const accountIdText = marketplace.accountId
                  ? escapeHtml(marketplace.accountId)
                  : '--';
                return `
                  <li class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                    <div class="flex items-center justify-between gap-3">
                      <div>
                        <p class="text-sm font-semibold">${marketplace.name}</p>
                        <p class="text-xs text-white/50">${syncText}</p>
                        <p class="text-[11px] text-white/40">ID conectado: ${accountIdText}</p>
                      </div>
                      <div class="flex flex-col items-end gap-2">
                        <span class="rounded-full border border-emerald-500/30 bg-emerald-500/20 px-3 py-1 text-xs text-emerald-200">
                          Conectado
                        </span>
                        <button
                          data-marketplace-disconnect="${marketplace.id}"
                          class="rounded-full border border-white/10 px-3 py-1 text-xs text-white/80 hover:bg-white/10"
                          type="button"
                        >
                          Desconectar
                        </button>
                      </div>
                    </div>
                  </li>
                `;
              })
              .join('')
          : '<li class="rounded-2xl border border-white/10 bg-ink-700/60 p-4 text-white/50">Nenhum marketplace conectado. Use a aba Catálogo em Integrações para conectar com o ID local da conta.</li>';

        const catalogHtml = sortedMarketplaces
          .map((marketplace) => {
            const accountIdText = marketplace.accountId ? escapeHtml(marketplace.accountId) : '';
            const isConnected = isMarketplaceConnectionValidForCurrentAccount(marketplace);
            const syncText = isConnected && marketplace.lastSync
              ? `Última sync: ${formatRelativeTime(marketplace.lastSync)}`
              : 'Sem sync';

            if (isConnected) {
              return `
                <li class="rounded-2xl border border-emerald-500/30 bg-emerald-500/10 p-4">
                  <div class="flex items-center justify-between gap-3">
                    <div>
                      <p class="text-sm font-semibold">${marketplace.name}</p>
                      <p class="text-xs text-emerald-200/80">${syncText}</p>
                      <p class="text-[11px] text-emerald-100/80">ID conectado: ${accountIdText || '--'}</p>
                    </div>
                    <button
                      data-marketplace-catalog-disconnect="${marketplace.id}"
                      class="rounded-full border border-emerald-400/30 px-3 py-1 text-xs text-emerald-100 hover:bg-emerald-500/20"
                      type="button"
                    >
                      Desconectar
                    </button>
                  </div>
                </li>
              `;
            }

            return `
              <li class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                <div class="flex flex-wrap items-center justify-between gap-3">
                  <div>
                    <p class="text-sm font-semibold">${marketplace.name}</p>
                    <p class="text-xs text-white/50">Conexão rápida individual deste marketplace.</p>
                  </div>
                  <span class="rounded-full border border-white/10 bg-white/5 px-3 py-1 text-xs text-white/60">
                    Desconectado
                  </span>
                </div>
                <div class="mt-3 flex justify-end">
                  <button
                    data-marketplace-connect="${marketplace.id}"
                    class="market-future-btn px-3 py-1 text-[11px] font-semibold"
                    type="button"
                  >
                    Conectar
                  </button>
                </div>
              </li>
            `;
          })
          .join('');

        if (integrationCatalogCount) {
          integrationCatalogCount.textContent = String(marketplaceCatalog.length);
        }
        if (integrationConnectedCount) {
          const connectedCount = connectedMarketplaces.length;
          integrationConnectedCount.textContent = String(connectedCount);
        }

        if (marketplaceList) {
          marketplaceList.innerHTML = connectedHtml;
        }
        if (marketplaceConnectedList) {
          marketplaceConnectedList.innerHTML = connectedHtml;
        }
        if (marketplaceCatalogList) {
          marketplaceCatalogList.innerHTML = catalogHtml;
        }
      }

      function renderProductHighlights() {
        if (!productHighlights) {
          return;
        }
        const allProducts = Object.values(productCatalog).flat();
        const counts = {};
        if (accountState) {
          accountState.reviews.forEach((review) => {
            if (!review.productName) {
              return;
            }
            counts[review.productName] = (counts[review.productName] || 0) + 1;
          });
        }
        const uniqueProducts = [...new Set(allProducts)];
        const sortedProducts = uniqueProducts.sort((a, b) => (counts[b] || 0) - (counts[a] || 0));
        const topProducts = sortedProducts.slice(0, 6);
        productHighlights.innerHTML = topProducts
          .map((name) => {
            const total = counts[name] || 0;
            return `
              <li class="rounded-2xl border border-white/10 bg-ink-700/60 p-4">
                <p class="text-sm font-semibold">${name}</p>
                <p class="text-xs text-white/50">${applyPrivacyText(`${total} avaliações registradas`)}</p>
              </li>
            `;
          })
          .join('');
      }

      const memberPulseNames = [
        'Ana',
        'Bruno',
        'Camila',
        'Diego',
        'Fernanda',
        'Gustavo',
        'Helena',
        'Igor',
        'Juliana',
        'Lucas',
        'Mariana',
        'Rafael'
      ];
      function getMemberMarketplaceOptions() {
        if (accountState && Array.isArray(accountState.marketplaces) && accountState.marketplaces.length > 0) {
          const connected = accountState.marketplaces.filter(
            (item) => item.connected && String(item.accountId || '').trim()
          );
          if (connected.length > 0) {
            return connected.map((item) => item.name);
          }
        }
        return marketplaceCatalog.map((item) => item.name);
      }
      const memberPulseCities = [
        'São Paulo, SP',
        'Rio de Janeiro, RJ',
        'Belo Horizonte, MG',
        'Curitiba, PR',
        'Recife, PE',
        'Fortaleza, CE',
        'Salvador, BA',
        'Brasília, DF',
        'Goiânia, GO',
        'Porto Alegre, RS'
      ];
      const memberPulseFeedbacks = [
        'Achei a navegação bem tranquila, dá pra resolver tudo rápido.',
        'O painel fica limpo mesmo com bastante tarefa.',
        'As aprovações agora fazem sentido, ficou mais organizado.',
        'Gostei do resumo no fim do dia, ajuda a ter visão geral.',
        'O fluxo de avaliação está mais estável e sem travar.',
        'A parte financeira ficou clara, sem confusão.',
        'Consigo acompanhar as tarefas sem perder tempo.',
        'Visual bonito e direto, sem excesso de informação.'
      ];
      const memberPulseTags = ['Fluxo rápido', 'Operação estável', 'Painel claro', 'ROI em alta', 'Equipe focada'];
      let memberPulseData = [];
      let memberPulseUpdatedAt = null;

      function buildMemberPulseData(count = 6) {
        const data = [];
        for (let i = 0; i < count; i += 1) {
          const reviews = Math.max(4, Math.round(randomRange(6, 45)));
          const approvals = Math.min(reviews, Math.max(1, Math.round(randomRange(3, reviews))));
          const rating = (Math.round(randomRange(43, 50)) / 10).toFixed(1);
          const avgTime = Math.round(randomRange(4, 18));
          const earnings = roundCurrency(randomRange(120, 980));
          data.push({
            name: memberPulseNames[Math.floor(Math.random() * memberPulseNames.length)],
            marketplace: getMemberMarketplaceOptions()[
              Math.floor(Math.random() * getMemberMarketplaceOptions().length)
            ],
            city: memberPulseCities[Math.floor(Math.random() * memberPulseCities.length)],
            tag: memberPulseTags[Math.floor(Math.random() * memberPulseTags.length)],
            comment: memberPulseFeedbacks[Math.floor(Math.random() * memberPulseFeedbacks.length)],
            rating,
            reviews,
            approvals,
            avgTime,
            earnings
          });
        }
        return data;
      }

      function renderMemberPulse() {
        if (!memberPulseList || !memberPulseSummary) {
          return;
        }
        if (memberPulseData.length === 0) {
          memberPulseSummary.innerHTML = '';
          memberPulseList.innerHTML = '<li class="text-white/50">Sem atualizações no momento.</li>';
          return;
        }

        const totalReviews = memberPulseData.reduce((sum, item) => sum + item.reviews, 0);
        const avgRating =
          memberPulseData.reduce((sum, item) => sum + Number(item.rating || 0), 0) / Math.max(1, memberPulseData.length);
        const avgTime = memberPulseData.reduce((sum, item) => sum + item.avgTime, 0) / Math.max(1, memberPulseData.length);
        const totalEarnings = memberPulseData.reduce((sum, item) => sum + item.earnings, 0);

        memberPulseSummary.innerHTML = `
          <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-3">
            <p class="text-xs text-white/50">Membros ativos</p>
            <p class="text-lg font-semibold">${applyPrivacyText(memberPulseData.length)}</p>
          </div>
          <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-3">
            <p class="text-xs text-white/50">Avaliações feitas</p>
            <p class="text-lg font-semibold">${applyPrivacyText(totalReviews)}</p>
          </div>
          <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-3">
            <p class="text-xs text-white/50">Satisfação média</p>
            <p class="text-lg font-semibold">${applyPrivacyText(avgRating.toFixed(1))}★</p>
          </div>
          <div class="rounded-2xl border border-white/10 bg-ink-700/60 p-3">
            <p class="text-xs text-white/50">Ganhos estimados</p>
            <p class="text-lg font-semibold">${applyPrivacyText(formatCurrency(totalEarnings))}</p>
          </div>
        `;

        memberPulseList.innerHTML = memberPulseData
          .map((member) => {
            const ratingText = applyPrivacyText(`${member.rating}★`);
            const reviewsText = applyPrivacyText(`${member.reviews}`);
            const approvalsText = applyPrivacyText(`${member.approvals}`);
            const timeText = applyPrivacyText(`${member.avgTime} min`);
            const earningsText = applyPrivacyText(formatCurrency(member.earnings));
            return `
              <li class="rounded-2xl border border-white/10 bg-ink-700/60 p-3 transition hover:bg-white/5">
                <div class="flex items-start justify-between gap-3">
                  <div>
                    <p class="text-sm font-semibold">${member.name}</p>
                    <p class="text-xs text-white/60">${member.marketplace} · ${member.city}</p>
                  </div>
                  <span class="rounded-full border border-emerald-400/30 bg-emerald-400/10 px-2 py-1 text-[10px] text-emerald-200">${ratingText}</span>
                </div>
                <p class="mt-2 text-xs text-white/70">${applyPrivacyText(member.comment)}</p>
                <div class="mt-3 grid gap-2 text-[11px] text-white/60 md:grid-cols-2">
                  <div class="rounded-xl border border-white/10 px-2 py-1">Avaliações: <span class="text-white">${reviewsText}</span></div>
                  <div class="rounded-xl border border-white/10 px-2 py-1">Aprovadas: <span class="text-white">${approvalsText}</span></div>
                  <div class="rounded-xl border border-white/10 px-2 py-1">Tempo médio: <span class="text-white">${timeText}</span></div>
                  <div class="rounded-xl border border-white/10 px-2 py-1">Ganhos: <span class="text-white">${earningsText}</span></div>
                </div>
                <div class="mt-2 flex flex-wrap gap-2 text-[10px] text-white/60">
                  <span class="rounded-full border border-white/10 px-2 py-1">${member.tag}</span>
                  <span class="rounded-full border border-white/10 px-2 py-1">Atualizado recentemente</span>
                </div>
              </li>
            `;
          })
          .join('');

        if (memberPulseUpdated) {
          const label = memberPulseUpdatedAt ? `Atualizado ${formatRelativeTime(memberPulseUpdatedAt)}` : 'Atualizado agora';
          memberPulseUpdated.textContent = label;
        }
      }

      function refreshMemberPulse() {
        memberPulseData = buildMemberPulseData(3);
        memberPulseUpdatedAt = Date.now();
        renderMemberPulse();
      }

      function updateDashboardStats() {
        if (!accountState) {
          renderGeneralSection();
          renderAdminAutoIAControl();
          renderAdminLevelControl();
          renderAutoIAToolControl();
          renderAIRobotLevelsPanel();
          return;
        }
        const now = Date.now();
        const pendingReviews = accountState.reviews.filter((review) => review.status === 'pending');
        const completedReviews = accountState.reviews.filter((review) => review.status !== 'pending');
        const expiringSoon = pendingReviews.filter((review) => review.expiresAt && review.expiresAt - now <= 5 * 60 * 1000);
        const pendingBalances = (accountState.balanceRequests || []).filter((request) => request.status === 'pendente').length;
        const withdrawalRequests = accountState.withdrawalRequests || [];
        const pendingWithdrawals = withdrawalRequests.filter((request) => request.status === 'pendente').length;
        const approvedWithdrawals = withdrawalRequests.filter((request) => request.status === 'aprovado').length;
        const rejectedWithdrawals = withdrawalRequests.filter((request) => request.status === 'rejeitado').length;
        const approvedReviews = accountState.reviews.filter((review) => review.status === 'approved').length;
        const ratingReviews = accountState.reviews.filter((review) => review.details && Number(review.details.rating));
        const ratingTotal = ratingReviews.reduce((total, review) => total + Number(review.details.rating || 0), 0);
        const averageRating = ratingReviews.length > 0 ? ratingTotal / ratingReviews.length : 0;
        const reviewRequests = (accountState.balanceRequests || []).filter((request) => request.source === 'review');
        const walletCreditsTotal = (accountState.walletCredits || []).reduce((total, entry) => {
          const value = Number(entry.amount || 0);
          return Number.isNaN(value) ? total : total + value;
        }, 0);

        const approvedValue =
          reviewRequests
            .filter((request) => request.status === 'aprovado')
            .reduce((total, request) => total + Number(request.amount || 0), 0) +
          walletCreditsTotal;
        const pendingValue = reviewRequests
          .filter((request) => request.status === 'pendente')
          .reduce((total, request) => total + Number(request.amount || 0), 0);
        const decidedReviews = accountState.reviews.filter((review) => review.status === 'approved' || review.status === 'rejected');
        const approvalRate = decidedReviews.length > 0 ? (approvedReviews / decidedReviews.length) * 100 : 0;
        const approvalTimes = accountState.reviews
          .filter((review) => review.approvedAt && review.completedAt)
          .map((review) => (review.approvedAt - review.completedAt) / 60000)
          .filter((value) => value >= 0);
        const avgApprovalTime =
          approvalTimes.length > 0 ? approvalTimes.reduce((total, value) => total + value, 0) / approvalTimes.length : null;

        setSensitiveValue(statActiveReviews, pendingReviews.length);
        if (statActiveReviewsMirror) {
          setSensitiveValue(statActiveReviewsMirror, pendingReviews.length);
        }
        setSensitiveValue(statExpiringReviews, expiringSoon.length);
        setSensitiveValue(statPendingBalances, pendingBalances);
        setSensitiveValue(statPendingWithdrawals, pendingWithdrawals);
        if (statCompletedReviews) {
          setSensitiveValue(statCompletedReviews, completedReviews.length);
        }
        if (vipBonusValue) {
          setSensitiveValue(vipBonusValue, formatCurrency(accountState.bonusBalance || 0));
        }
        if (financePendingBalance) {
          setSensitiveValue(financePendingBalance, pendingBalances);
        }
        if (financePendingWithdrawals) {
          setSensitiveValue(financePendingWithdrawals, pendingWithdrawals);
        }
        if (financeApprovedWithdrawals) {
          setSensitiveValue(financeApprovedWithdrawals, approvedWithdrawals);
        }
        if (financeRejectedWithdrawals) {
          setSensitiveValue(financeRejectedWithdrawals, rejectedWithdrawals);
        }
        if (reportAverageRating) {
          setSensitiveValue(reportAverageRating, averageRating ? averageRating.toFixed(1) : '0.0');
        }
        if (reportApprovalRate) {
          setSensitiveValue(reportApprovalRate, `${approvalRate.toFixed(0)}%`);
        }
        if (reportApprovalTime) {
          setSensitiveValue(reportApprovalTime, avgApprovalTime ? `${Math.round(avgApprovalTime)} min` : '--');
        }
        if (reportApprovedValue) {
          setSensitiveValue(reportApprovedValue, formatCurrency(approvedValue));
        }
        if (reportPendingValue) {
          setSensitiveValue(reportPendingValue, formatCurrency(pendingValue));
        }
        if (reportApprovedReviews) {
          setSensitiveValue(reportApprovedReviews, approvedReviews);
        }
        renderAlerts();
        updateSalesReport();
        updateReportSummary();
        renderAdminAutoIAControl();
        renderAdminLevelControl();
        renderAutoIAToolControl();
        renderAIRobotLevelsPanel();
        renderGeneralSection();
      }

      function startCountdownTimer() {
        clearInterval(countdownTimer);
        countdownTimer = setInterval(() => {
          if (!accountState) {
            return;
          }
          pruneExpiredReviews();
          renderReviewList();
          renderAdminReviews();
        }, 15000);
      }

      navItems.forEach((item) => {
        item.addEventListener('click', () => {
          setActiveSection(item.dataset.sectionTarget);
        });
      });

      if (sidebarGeneralButton) {
        sidebarGeneralButton.addEventListener('click', () => {
          setActiveSection('geral');
        });
      }

      if (integrationTabConnected) {
        integrationTabConnected.addEventListener('click', () => {
          setIntegrationsTab('connected');
        });
      }

      if (integrationTabCatalog) {
        integrationTabCatalog.addEventListener('click', () => {
          setIntegrationsTab('catalog');
          renderMarketplaces();
        });
      }

      if (financeTabOverview) {
        financeTabOverview.addEventListener('click', () => {
          setFinanceTab('overview');
        });
      }

      if (financeTabReports) {
        financeTabReports.addEventListener('click', () => {
          setFinanceTab('reports');
        });
      }

      if (financePaymentsFilterPending) {
        financePaymentsFilterPending.addEventListener('click', () => {
          financePaymentsFilterMode = 'pending';
          renderFinanceLists();
        });
      }

      if (financePaymentsFilterAll) {
        financePaymentsFilterAll.addEventListener('click', () => {
          financePaymentsFilterMode = 'all';
          renderFinanceLists();
        });
      }

      if (levelRobotActionButton) {
        levelRobotActionButton.addEventListener('click', () => {
          toggleAIRobotAutomation();
        });
      }

      if (aiRobotFloatingButton) {
        aiRobotFloatingButton.addEventListener('click', () => {
          toggleAIRobotAutomation();
        });
      }

      document.getElementById('loginForm').addEventListener('submit', (event) => {
        event.preventDefault();
        const form = event.target;
        authMessage.textContent = '';

        if (isLocalPasswordValid(form.password.value)) {
          safeStorageSet(localAuthKey, 'true');
          try {
            setUserInfo({ id: 'local-user' });
          } catch (error) {
            console.error('Erro ao iniciar conta:', error);
          }
          setStatus('Conectado');
          showApp();
          return;
        }

        authMessage.textContent = 'Senha incorreta. Tente novamente.';
        setStatus('Desconectado');
      });

      logoutButton.addEventListener('click', () => {
        stopAIRobotAutomation('', true);
        safeStorageRemove(localAuthKey);
        clearTimeout(taskTimer);
        clearInterval(countdownTimer);
        showAuth();
        authMessage.textContent = 'Logout realizado.';
      });

      adminClose.addEventListener('click', closeAdminOverlay);

      if (quickSync) {
        quickSync.addEventListener('click', () => {
          if (!accountState) {
            return;
          }
          openMarketplaceConnectOverlay();
        });
      }

      if (quickGenerate) {
        quickGenerate.addEventListener('click', () => {
          if (!accountState) {
            return;
          }
          const activeCount = accountState.reviews.filter((review) => review.status === 'pending').length;
          const maxPending = 12;
          const desiredNew = 3;
          const createCount = Math.min(desiredNew, Math.max(0, maxPending - activeCount));
          if (createCount === 0) {
            showToast({
              title: 'Fila cheia',
              message: 'Você já tem avaliações suficientes no momento.',
              type: 'warning'
            });
            return;
          }
          let createdCount = 0;
          for (let i = 0; i < createCount; i += 1) {
            const template = getRandomReviewTemplate();
            if (!template) {
              break;
            }
            accountState.reviews.unshift(createReviewItem(template, 'auto'));
            createdCount += 1;
          }
          if (createdCount === 0) {
            showToast({
              title: 'Marketplace desconectado',
              message: 'Conecte ao menos um marketplace para gerar novas avaliações.',
              type: 'warning'
            });
            return;
          }
          saveAccountState();
          renderReviewList();
          updateDashboardStats();
          addActivity(`Geradas ${createdCount} novas avaliações recomendadas.`);
          showToast({
            title: 'Novas avaliações',
            message: `${createdCount} novas avaliações adicionadas.`,
            type: 'info'
          });
        });
      }

      if (quickSummary) {
        quickSummary.addEventListener('click', () => {
          if (!accountState) {
            return;
          }
          const now = new Date();
          const startToday = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0, 0);
          const endToday = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59, 999);
          const bonusToday = sumBonusEarnedBetween(startToday, endToday);
          showToast({
            title: 'Resumo VIP do dia',
            message: `Bônus de hoje: ${formatCurrency(bonusToday)}.`,
            type: 'info'
          });
          addActivity(`Resumo VIP do dia: bônus hoje ${formatCurrency(bonusToday)}.`);
        });
      }

      if (memberPulseRefresh) {
        memberPulseRefresh.addEventListener('click', () => {
          refreshMemberPulse();
        });
      }
      refreshMemberPulse();
      setInterval(() => {
        refreshMemberPulse();
      }, 5 * 60 * 1000);

      if (salesApply) {
        salesApply.addEventListener('click', () => {
          updateSalesReport({ syncReport: true });
        });
      }

      if (reportRangeSelect) {
        reportRangeSelect.addEventListener('change', () => {
          updateReportSummary();
        });
      }

      if (reportCustomApply) {
        reportCustomApply.addEventListener('click', () => {
          if (reportRangeSelect) {
            reportRangeSelect.value = 'custom';
          }
          updateReportSummary();
        });
      }

      [reportCustomStartDate, reportCustomEndDate].forEach((input) => {
        if (!input) {
          return;
        }
        input.addEventListener('change', () => {
          if (reportRangeSelect) {
            reportRangeSelect.value = 'custom';
          }
        });
      });

      if (supportChatForm) {
        supportChatForm.addEventListener('submit', async (event) => {
          event.preventDefault();
          if (!supportChatInput || supportRequestInFlight) {
            return;
          }
          const question = supportChatInput.value.trim();
          if (!question) {
            return;
          }
          const runtime = getSupportAssistantRuntime();
          appendSupportMessage('user', question);
          supportChatInput.value = '';
          supportRequestInFlight = true;
          setSupportComposerState(true);
          setSupportAssistantStatus(
            runtime.useOpenAI
              ? `Consultando ChatGPT (${runtime.config.openAIModel})...`
              : 'Atlas IA analisando contexto...'
          );
          setSupportTypingState(
            true,
            runtime.useOpenAI
              ? `ChatGPT (${runtime.config.openAIModel}) está gerando a resposta...`
              : 'Atlas IA está processando os dados da conta...'
          );

          let replyText = '';
          let replyIntent = detectSupportIntent(question);
          let assistantName = runtime.displayName;
          try {
            if (runtime.useOpenAI) {
              replyText = await requestOpenAISupportReply(question);
            } else {
              const responseDelay = 460 + Math.floor(Math.random() * 420);
              await new Promise((resolve) => setTimeout(resolve, responseDelay));
              const payload = generateSupportReply(question);
              replyText = typeof payload === 'string' ? payload : payload?.text || '';
              replyIntent = typeof payload === 'string' ? 'geral' : payload?.intent || replyIntent;
            }
          } catch (error) {
            const fallbackPayload = generateSupportReply(question);
            const fallbackText = typeof fallbackPayload === 'string' ? fallbackPayload : fallbackPayload?.text || '';
            replyText =
              `${fallbackText}\n\nObs: não consegui consultar o ChatGPT agora. Verifique API key, modelo e conexão.`;
            replyIntent = typeof fallbackPayload === 'string' ? replyIntent : fallbackPayload?.intent || replyIntent;
            assistantName = 'Atlas IA';
            showToast({
              title: 'Falha no ChatGPT',
              message: 'Sem resposta da API. O suporte voltou para o modo local nesta mensagem.',
              type: 'warning'
            });
          } finally {
            supportRequestInFlight = false;
            setSupportComposerState(false);
            setSupportTypingState(false);
          }

          appendSupportMessage('assistant', replyText, { assistantName });
          supportConversationTurns.push({
            question,
            answer: replyText,
            intent: replyIntent,
            createdAt: Date.now()
          });
          supportConversationTurns = supportConversationTurns.slice(-14);
          const runtimeAfter = getSupportAssistantRuntime();
          setSupportAssistantStatus(
            runtimeAfter.useOpenAI
              ? `ChatGPT online (${runtimeAfter.config.openAIModel})`
              : 'Atlas IA online'
          );
        });
      }

      window.addEventListener('resize', () => {
        if (reportResizeTimer) {
          clearTimeout(reportResizeTimer);
        }
        reportResizeTimer = setTimeout(() => {
          updateReportSummary();
        }, 140);
      });

      adminBalanceForm.addEventListener('submit', async (event) => {
        event.preventDefault();
        adminBalanceMessage.textContent = '';
        adminBalanceMessage.className = 'mt-3 text-xs text-white/60';

        const amount = parseAmount(adminBalanceAmount.value);
        if (amount === null) {
          adminBalanceMessage.textContent = 'Informe um valor válido.';
          adminBalanceMessage.classList.add('text-rose-300');
          return;
        }

        if (!accountState) {
          adminBalanceMessage.textContent = 'Conta indisponível.';
          adminBalanceMessage.classList.add('text-rose-300');
          return;
        }

        accountState.balance = roundCurrency((accountState.balance || 0) + amount);
        recordWalletCredit(amount, 'admin', 'Saldo admin');
        saveAccountState();
        updateAdminBalance();
        renderFinanceLists();
        updateDashboardStats();
        adminBalanceMessage.textContent = applyPrivacyText(
          `Saldo atualizado. Novo saldo: ${formatCurrency(accountState.balance)}`
        );
        adminBalanceMessage.classList.add('text-emerald-300');
      });

      if (adminBonusForm) {
        adminBonusForm.addEventListener('submit', (event) => {
          event.preventDefault();
          adminBonusMessage.textContent = '';
          adminBonusMessage.className = 'mt-3 text-xs text-white/60';
          if (!accountState) {
            adminBonusMessage.textContent = 'Conta indisponível.';
            adminBonusMessage.classList.add('text-rose-300');
            return;
          }
          const amount = parseAmount(adminBonusAmount.value);
          if (amount === null) {
            adminBonusMessage.textContent = 'Informe um valor válido.';
            adminBonusMessage.classList.add('text-rose-300');
            return;
          }
          recordBonusEarned(amount, 'admin', 'Bônus manual');
          accountState.bonusBalance = roundCurrency((accountState.bonusBalance || 0) + amount);
          saveAccountState();
          updateWalletBalance();
          updateDashboardStats();
          adminBonusMessage.textContent = applyPrivacyText(
            `Bônus atualizado. Novo bônus: ${formatCurrency(accountState.bonusBalance)}`
          );
          adminBonusMessage.classList.add('text-emerald-300');
          adminBonusForm.reset();
        });
      }

      if (adminRollingForm) {
        adminRollingForm.addEventListener('submit', (event) => {
          event.preventDefault();
          adminRollingMessage.textContent = '';
          adminRollingMessage.className = 'mt-3 text-xs text-white/60';

          if (!accountState) {
            adminRollingMessage.textContent = 'Conta indisponivel.';
            adminRollingMessage.classList.add('text-rose-300');
            return;
          }

          const days = Number.parseInt(adminRollingDays?.value || '0', 10);
          if (!Number.isFinite(days) || days < 1 || days > 365) {
            adminRollingMessage.textContent = 'Informe uma quantidade de dias entre 1 e 365.';
            adminRollingMessage.classList.add('text-rose-300');
            return;
          }

          const amount = parseAmountAllowZero(adminRollingAmount?.value);
          if (amount === null) {
            adminRollingMessage.textContent = 'Informe um valor valido.';
            adminRollingMessage.classList.add('text-rose-300');
            return;
          }

          const mode = adminRollingMode?.value === 'weighted' ? 'weighted' : 'equal';
          const applied = applyManualSalesForLastDays(days, amount, mode);
          if (!applied) {
            adminRollingMessage.textContent = 'Nao foi possivel aplicar o periodo.';
            adminRollingMessage.classList.add('text-rose-300');
            return;
          }

          saveAccountState();
          renderAdminReportList();
          updateWalletBalance();
          updateSalesReport();
          if (reportRangeSelect) {
            reportRangeSelect.value = 'custom';
          }
          if (reportCustomStartDate) {
            reportCustomStartDate.value = applied.startKey;
          }
          if (reportCustomEndDate) {
            reportCustomEndDate.value = applied.endKey;
          }
          updateReportSummary();
          addActivity(`Distribuicao aplicada: ${formatCurrency(amount)} em ${days} dias (${mode === 'weighted' ? 'inteligente' : 'linear'}).`);

          adminRollingMessage.textContent = `Distribuicao aplicada de ${applied.startKey} ate ${applied.endKey}.`;
          adminRollingMessage.classList.add('text-emerald-300');
          if (adminRollingAmount) {
            adminRollingAmount.value = '';
          }
        });
      }

      if (adminRollingClear) {
        adminRollingClear.addEventListener('click', () => {
          if (!accountState) {
            return;
          }
          const days = Number.parseInt(adminRollingDays?.value || '0', 10);
          if (!Number.isFinite(days) || days < 1 || days > 365) {
            adminRollingMessage.textContent = 'Informe uma quantidade de dias valida para limpar.';
            adminRollingMessage.className = 'mt-3 text-xs text-rose-300';
            return;
          }
          const confirmed = window.confirm(`Remover valores manuais dos ultimos ${days} dias?`);
          if (!confirmed) {
            return;
          }
          const now = new Date();
          const end = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59, 999);
          const start = new Date(end);
          start.setDate(end.getDate() - (days - 1));
          start.setHours(0, 0, 0, 0);
          const removed = clearManualSalesForRange(start, end);
          saveAccountState();
          renderAdminReportList();
          updateWalletBalance();
          updateSalesReport();
          if (reportRangeSelect) {
            reportRangeSelect.value = 'custom';
          }
          if (reportCustomStartDate) {
            reportCustomStartDate.value = formatDateInput(start);
          }
          if (reportCustomEndDate) {
            reportCustomEndDate.value = formatDateInput(end);
          }
          updateReportSummary();
          adminRollingMessage.textContent = removed > 0
            ? `${removed} dia(s) manual(is) removido(s).`
            : 'Nao havia valores manuais nesse periodo.';
          adminRollingMessage.classList.add('text-emerald-300');
        });
      }

      if (adminReportForm) {
        adminReportForm.addEventListener('submit', (event) => {
          event.preventDefault();
          adminReportMessage.textContent = '';
          adminReportMessage.className = 'mt-3 text-xs text-white/60';

          if (!accountState) {
            adminReportMessage.textContent = 'Conta indisponível.';
            adminReportMessage.classList.add('text-rose-300');
            return;
          }

          const dateValue = adminReportDate?.value;
          const amount = parseAmountAllowZero(adminReportAmount?.value);
          if (!dateValue) {
            adminReportMessage.textContent = 'Selecione a data do resultado.';
            adminReportMessage.classList.add('text-rose-300');
            return;
          }
          if (amount === null) {
            adminReportMessage.textContent = 'Informe um valor válido.';
            adminReportMessage.classList.add('text-rose-300');
            return;
          }

          if (!Array.isArray(accountState.manualSales)) {
            accountState.manualSales = [];
          }

          const entry = {
            date: dateValue,
            value: roundCurrency(amount),
            updatedAt: new Date().toISOString()
          };
          const existingIndex = accountState.manualSales.findIndex((item) => item.date === dateValue);
          if (existingIndex >= 0) {
            accountState.manualSales[existingIndex] = entry;
          } else {
            accountState.manualSales.push(entry);
          }
          accountState.lastManualSaleDate = dateValue;

          saveAccountState();
          renderAdminReportList();
          updateSalesReport();
          if (reportRangeSelect) {
            reportRangeSelect.value = 'custom';
          }
          if (reportCustomStartDate) {
            reportCustomStartDate.value = dateValue;
          }
          if (reportCustomEndDate) {
            reportCustomEndDate.value = dateValue;
          }
          updateReportSummary();
          addActivity(`Resultado do dia ${dateValue} ajustado para ${formatCurrency(entry.value)}.`);

          adminReportMessage.textContent = 'Resultado atualizado com sucesso.';
          adminReportMessage.classList.add('text-emerald-300');
          if (adminReportAmount) {
            adminReportAmount.value = '';
          }
        });
      }

      if (adminReportMonthForm) {
        adminReportMonthForm.addEventListener('submit', (event) => {
          event.preventDefault();
          adminReportMonthMessage.textContent = '';
          adminReportMonthMessage.className = 'mt-3 text-xs text-white/60';

          if (!accountState) {
            adminReportMonthMessage.textContent = 'Conta indisponivel.';
            adminReportMonthMessage.classList.add('text-rose-300');
            return;
          }

          const monthValue = adminReportMonth?.value;
          const amount = parseAmountAllowZero(adminReportMonthAmount?.value);
          if (!monthValue) {
            adminReportMonthMessage.textContent = 'Selecione o mes do resultado.';
            adminReportMonthMessage.classList.add('text-rose-300');
            return;
          }
          if (amount === null) {
            adminReportMonthMessage.textContent = 'Informe um valor valido.';
            adminReportMonthMessage.classList.add('text-rose-300');
            return;
          }

          if (!Array.isArray(accountState.manualSalesMonths)) {
            accountState.manualSalesMonths = [];
          }

          const entry = {
            month: monthValue,
            value: roundCurrency(amount),
            updatedAt: new Date().toISOString()
          };
          const existingIndex = accountState.manualSalesMonths.findIndex((item) => item.month === monthValue);
          if (existingIndex >= 0) {
            accountState.manualSalesMonths[existingIndex] = entry;
          } else {
            accountState.manualSalesMonths.push(entry);
          }

          saveAccountState();
          renderAdminReportMonthList();
          updateSalesReport();
          updateReportSummary();
          addActivity(`Resultado do mes ${monthValue} ajustado para ${formatCurrency(entry.value)}.`);

          adminReportMonthMessage.textContent = 'Resultado mensal atualizado com sucesso.';
          adminReportMonthMessage.classList.add('text-emerald-300');
          if (adminReportMonthAmount) {
            adminReportMonthAmount.value = '';
          }
        });
      }

      if (adminReportMonthList) {
        adminReportMonthList.addEventListener('click', (event) => {
          const target = event.target.closest('[data-admin-report-month-remove]');
          if (!target || !accountState) {
            return;
          }
          const monthValue = target.getAttribute('data-admin-report-month-remove');
          accountState.manualSalesMonths = (accountState.manualSalesMonths || []).filter((entry) => entry.month !== monthValue);
          saveAccountState();
          renderAdminReportMonthList();
          updateSalesReport();
          updateReportSummary();
          addActivity(`Resultado mensal removido para ${monthValue}.`);
          showToast({
            title: 'Resultado mensal removido',
            message: 'O total do mes foi removido dos relatorios.',
            type: 'warning'
          });
        });
      }

      if (adminReportList) {
        adminReportList.addEventListener('click', (event) => {
          const editTarget = event.target.closest('[data-admin-report-edit]');
          if (editTarget && accountState) {
            const dateValue = editTarget.getAttribute('data-admin-report-edit');
            const entry = (accountState.manualSales || []).find((item) => item.date === dateValue);
            if (!entry) {
              return;
            }
            if (adminReportDate) {
              adminReportDate.value = dateValue;
            }
            if (adminReportAmount) {
              adminReportAmount.value = formatCurrencyInputValue(entry.value);
              adminReportAmount.focus();
            }
            if (adminReportMessage) {
              adminReportMessage.textContent = `Editando ${dateValue}. Clique em salvar para atualizar.`;
              adminReportMessage.className = 'mt-3 text-xs text-sky-300';
            }
            return;
          }

          const target = event.target.closest('[data-admin-report-remove]');
          if (!target || !accountState) {
            return;
          }
          const dateValue = target.getAttribute('data-admin-report-remove');
          accountState.manualSales = (accountState.manualSales || []).filter((entry) => entry.date !== dateValue);
          saveAccountState();
          renderAdminReportList();
          updateSalesReport();
          updateReportSummary();
          addActivity(`Resultado manual removido para ${dateValue}.`);
          showToast({
            title: 'Resultado removido',
            message: 'O resultado do dia foi removido dos relatórios.',
            type: 'warning'
          });
        });
      }

      adminClearBalance.addEventListener('click', () => {
        if (!accountState) {
          return;
        }
        const confirmed = window.confirm('Tem certeza que deseja zerar o saldo desta conta?');
        if (!confirmed) {
          return;
        }
        accountState.balance = 0;
        saveAccountState();
        updateAdminBalance();
        renderFinanceLists();
        adminClearMessage.textContent = 'Saldo zerado com sucesso.';
        adminClearMessage.className = 'mt-3 text-xs text-emerald-300';
      });

      if (adminResetAccount) {
        adminResetAccount.addEventListener('click', () => {
          if (!accountState) {
            return;
          }
          const confirmed = window.confirm('Isso vai apagar tudo da conta. Deseja continuar?');
          if (!confirmed) {
            return;
          }
          stopAIRobotAutomation('', true);
          const storageKey = accountState.storageKey;
          accountState = defaultAccountState();
          accountState.storageKey = storageKey;
          lastPendingReviewCount = 0;
          saveAccountState();
          updateAdminBalance();
          renderAllAdminLists();
          renderReviewList();
          renderMarketplaces();
          renderProductHighlights();
          updateDashboardStats();
          renderActivities();
          renderTeamMembers();
          initializeSupportAssistant(true);
          adminResetMessage.textContent = 'Conta resetada com sucesso.';
          adminResetMessage.className = 'mt-3 text-xs text-emerald-300';
          showToast({
            title: 'Conta resetada',
            message: 'Todos os dados da conta foram apagados.',
            type: 'warning'
          });
        });
      }

      if (adminAutoAIUnlockButton) {
        adminAutoAIUnlockButton.addEventListener('click', () => {
          if (!accountState) {
            return;
          }
          const nextAdminUnlock = !Boolean(accountState.autoAIAdminUnlocked);
          accountState.autoAIAdminUnlocked = nextAdminUnlock;

          const unlockStateAfter = getAutoIAUnlockState();
          if (!nextAdminUnlock && !unlockStateAfter.unlockedByTarget) {
            accountState.autoAIEnabled = false;
          }

          saveAccountState();
          renderAdminAutoIAControl();
          renderAutoIAToolControl();

          if (adminAutoAIMessage) {
            if (nextAdminUnlock) {
              adminAutoAIMessage.textContent = 'Auto IA liberado. Meta dos R$ 1.000,00 concluida.';
              adminAutoAIMessage.className = 'mt-3 text-xs text-emerald-300';
            } else if (unlockStateAfter.unlockedByTarget) {
              adminAutoAIMessage.textContent = 'Auto IA segue liberado: meta dos R$ 1.000,00 concluida.';
              adminAutoAIMessage.className = 'mt-3 text-xs text-emerald-300';
            } else {
              adminAutoAIMessage.textContent = 'Auto IA bloqueado até atingir a meta dos R$ 1.000,00.';
              adminAutoAIMessage.className = 'mt-3 text-xs text-amber-300';
            }
          }
        });
      }

      if (adminLevelForm) {
        adminLevelForm.addEventListener('submit', (event) => {
          event.preventDefault();
          if (!accountState || !adminLevelSelect || !adminLevelMessage) {
            return;
          }
          const selectedLevel = getAIRobotLevelById(adminLevelSelect.value);
          if (!selectedLevel) {
            adminLevelMessage.textContent = 'Selecione um nível válido.';
            adminLevelMessage.className = 'mt-3 text-xs text-rose-300';
            return;
          }
          accountState.aiRobotLevelOverrideId = selectedLevel.id;
          saveAccountState();
          renderAdminLevelControl();
          renderAIRobotLevelsPanel();
          updateDashboardStats();
          addActivity(`Nível do Robô IA ajustado manualmente para ${selectedLevel.name}.`);
          adminLevelMessage.textContent = `Nível manual aplicado: ${selectedLevel.name}.`;
          adminLevelMessage.className = 'mt-3 text-xs text-emerald-300';
        });
      }

      if (adminLevelResetButton) {
        adminLevelResetButton.addEventListener('click', () => {
          if (!accountState || !adminLevelMessage) {
            return;
          }
          accountState.aiRobotLevelOverrideId = '';
          saveAccountState();
          renderAdminLevelControl();
          renderAIRobotLevelsPanel();
          updateDashboardStats();
          addActivity('Nível do Robô IA voltou para cálculo automático.');
          adminLevelMessage.textContent = 'Controle manual removido. Nível automático reativado.';
          adminLevelMessage.className = 'mt-3 text-xs text-sky-300';
        });
      }

      if (adminProfileForm) {
        adminProfileForm.addEventListener('submit', (event) => {
          event.preventDefault();
          if (!accountState || !adminProfileMessage) {
            return;
          }
          const ownerName = String(adminProfileOwnerName?.value || '').trim();
          if (!ownerName) {
            adminProfileMessage.textContent = 'Informe ao menos o nome do dono da conta.';
            adminProfileMessage.className = 'mt-3 text-xs text-rose-300';
            return;
          }
          accountState.profile = {
            ownerName,
            businessName: String(adminProfileBusinessName?.value || '').trim(),
            email: String(adminProfileEmail?.value || '').trim(),
            phone: String(adminProfilePhone?.value || '').trim(),
            document: String(adminProfileDocument?.value || '').trim(),
            cityState: String(adminProfileCityState?.value || '').trim()
          };
          saveAccountState();
          renderGeneralSection();
          addActivity('Dados da conta (Geral) atualizados no painel admin.');
          adminProfileMessage.textContent = 'Dados da conta atualizados com sucesso.';
          adminProfileMessage.className = 'mt-3 text-xs text-emerald-300';
        });
      }

      if (adminSupportAIForm) {
        adminSupportAIForm.addEventListener('submit', (event) => {
          event.preventDefault();
          if (!accountState || !adminSupportMessage) {
            return;
          }
          const mode = normalizeSupportAssistantMode(adminSupportMode?.value || 'atlas');
          const model = normalizeSupportAssistantModel(adminSupportModel?.value || '');
          const apiKey = normalizeSupportAssistantApiKey(adminSupportApiKey?.value || '');
          accountState.supportAssistantConfig = normalizeSupportAssistantConfig({
            mode,
            openAIModel: model,
            openAIApiKey: apiKey
          });
          saveAccountState();
          renderAdminSupportAssistantConfig();
          initializeSupportAssistant(true);
          addActivity(
            mode === 'openai'
              ? `Suporte IA ajustado para ChatGPT (${model}).`
              : 'Suporte IA ajustado para Atlas local.'
          );
        });
      }

      if (adminSupportClearKey) {
        adminSupportClearKey.addEventListener('click', () => {
          if (!accountState || !adminSupportApiKey) {
            return;
          }
          const current = ensureSupportAssistantConfigState();
          accountState.supportAssistantConfig = {
            ...current,
            openAIApiKey: ''
          };
          saveAccountState();
          adminSupportApiKey.value = '';
          renderAdminSupportAssistantConfig();
          initializeSupportAssistant(true);
          addActivity('Chave de API do suporte IA removida.');
        });
      }

      if (teamMemberForm) {
        teamMemberForm.addEventListener('submit', (event) => {
          event.preventDefault();
          if (!accountState) {
            return;
          }
          teamMemberMessage.textContent = '';
          teamMemberMessage.className = 'mt-3 text-xs text-white/60';
          const name = teamMemberName.value.trim();
          const role = teamMemberRole.value.trim();
          if (!name || !role) {
            teamMemberMessage.textContent = 'Preencha nome e cargo.';
            teamMemberMessage.classList.add('text-rose-300');
            return;
          }
          const member = {
            id: `tm-${Date.now()}`,
            name,
            role,
            status: 'ativo'
          };
          accountState.teamMembers = [member, ...(accountState.teamMembers || [])];
          saveAccountState();
          renderTeamMembers();
          teamMemberForm.reset();
          teamMemberMessage.textContent = 'Membro adicionado com sucesso.';
          teamMemberMessage.classList.add('text-emerald-300');
          addActivity(`Novo membro adicionado: ${name}.`);
        });
      }

      if (vipBonusCashout) {
        vipBonusCashout.addEventListener('click', () => {
          if (!accountState) {
            return;
          }
          const bonus = Number(accountState.bonusBalance || 0);
          if (bonus <= 0) {
            showToast({
              title: 'Saldo bônus',
              message: 'Nenhum bônus disponível para sacar.',
              type: 'warning'
            });
            return;
          }
          accountState.balance = roundCurrency((accountState.balance || 0) + bonus);
          accountState.bonusBalance = 0;
          recordWalletCredit(bonus, 'bonus', 'Bônus VIP');
          saveAccountState();
          updateWalletBalance();
          updateDashboardStats();
          showToast({
            title: 'Bônus sacado',
            message: `${formatCurrency(bonus)} transferido para a carteira principal.`,
            type: 'success'
          });
          launchConfetti();
        });
      }

      adminReviewForm.addEventListener('submit', (event) => {
        event.preventDefault();
        if (!accountState) {
          return;
        }
        const marketplaceId = adminMarketplace.value;
        const productName = adminProductName.value.trim();
        const reward = parseAmount(adminRewardValue.value);
        const marketplace = marketplaceCatalog.find((item) => item.id === marketplaceId);

        if (!marketplace || !productName || reward === null) {
          return;
        }

        const template = {
          marketplaceId: marketplace.id,
          marketplaceName: marketplace.name,
          productName,
          reward
        };

        accountState.reviews.unshift(createReviewItem(template, 'admin'));
        saveAccountState();
        renderAdminReviews();
        renderReviewList();
        updateDashboardStats();
        addActivity(`Avaliação manual criada: ${marketplace.name} · ${productName}.`);

        adminMarketplace.value = '';
        adminProductName.value = '';
        adminRewardValue.value = '';
      });

      balanceRequestForm.addEventListener('submit', (event) => {
        event.preventDefault();
        if (!accountState) {
          return;
        }
        const amount = parseAmount(balanceRequestAmount.value);
        const request = {
          id: `balance-${Date.now()}`,
          label: balanceRequestLabel.value.trim(),
          amount: amount ? amount.toFixed(2) : '0.00',
          status: 'pendente',
          createdAt: Date.now()
        };
        if (!request.label || amount === null) {
          return;
        }
        accountState.balanceRequests.unshift(request);
        saveAccountState();
        renderRequestList(accountState.balanceRequests, balanceRequestList, 'Sem solicitações de saldo.');
        renderFinanceLists();
        updateDashboardStats();
        balanceRequestLabel.value = '';
        balanceRequestAmount.value = '';
      });

      withdrawalRequestForm.addEventListener('submit', (event) => {
        event.preventDefault();
        if (!accountState) {
          return;
        }
        const amount = parseAmount(withdrawalRequestAmount.value);
        const request = {
          id: `withdraw-${Date.now()}`,
          label: withdrawalRequestLabel.value.trim(),
          amount: amount ? amount.toFixed(2) : '0.00',
          status: 'pendente',
          createdAt: Date.now()
        };
        if (!request.label || amount === null) {
          return;
        }
        accountState.withdrawalRequests.unshift(request);
        saveAccountState();
        renderRequestList(accountState.withdrawalRequests, withdrawalRequestList, 'Sem solicitações de saque.');
        renderFinanceLists();
        updateDashboardStats();
        withdrawalRequestLabel.value = '';
        withdrawalRequestAmount.value = '';
      });

      if (userWithdrawalForm) {
        userWithdrawalForm.addEventListener('submit', (event) => {
          event.preventDefault();
          if (!accountState) {
            return;
          }
          userWithdrawalMessage.textContent = '';
          userWithdrawalMessage.className = 'mt-3 text-xs text-white/60';

          const amount = parseAmount(userWithdrawalAmount.value);
          if (amount === null) {
            userWithdrawalMessage.textContent = 'Informe um valor válido.';
            userWithdrawalMessage.classList.add('text-rose-300');
            return;
          }
          const availableBalance = getAvailableBalance();
          if (availableBalance < amount) {
            userWithdrawalMessage.textContent = applyPrivacyText(
              `Saldo disponível insuficiente. Disponível: ${formatCurrency(availableBalance)}.`
            );
            userWithdrawalMessage.classList.add('text-rose-300');
            return;
          }

          const pixData = updateUserWithdrawalPixState();
          if (!pixData.valid) {
            userWithdrawalMessage.textContent = pixData.reason || 'Informe uma chave PIX válida.';
            userWithdrawalMessage.classList.add('text-rose-300');
            return;
          }
          const destinationBank = String(pixData.bank || '').trim();
          if (!destinationBank) {
            userWithdrawalMessage.textContent = 'Não foi possível detectar o banco automaticamente para esta chave PIX.';
            userWithdrawalMessage.classList.add('text-rose-300');
            return;
          }

          const request = {
            id: `withdraw-${Date.now()}`,
            label: 'Saque PIX',
            pixKey: 'PIX oculto',
            pixKeyType: pixData.type,
            pixBank: destinationBank,
            amount: amount.toFixed(2),
            status: 'pendente',
            createdAt: Date.now()
          };
          accountState.withdrawalRequests.unshift(request);
          saveAccountState();
          updateWalletBalance();
          renderFinanceLists();
          updateDashboardStats();
          userWithdrawalForm.reset();
          updateUserWithdrawalPixState();
          userWithdrawalMessage.textContent = `Solicitação enviada para ${destinationBank}. Aguarde aprovação.`;
          userWithdrawalMessage.classList.add('text-emerald-300');
        });
      }

      adminReviewList.addEventListener('click', (event) => {
        const target = event.target.closest('[data-admin-review-remove]');
        if (!target) {
          return;
        }
        const reviewId = target.getAttribute('data-admin-review-remove');
        if (!accountState) {
          return;
        }
        accountState.reviews = accountState.reviews.filter((review) => review.id !== reviewId);
        saveAccountState();
        renderAdminReviews();
        renderReviewList();
        updateDashboardStats();
      });

      function setMarketplaceConnectionState(marketplaceId, connected, accountId = '') {
        if (!accountState || !marketplaceId) {
          return null;
        }
        const normalizedAccountId = normalizeMarketplaceAccountCode(accountId || '');
        const nowIso = new Date().toISOString();
        let updatedMarketplace = null;
        accountState.marketplaces = (accountState.marketplaces || []).map((marketplace) => {
          if (marketplace.id !== marketplaceId) {
            return marketplace;
          }
          const nextConnected = Boolean(connected && normalizedAccountId);
          updatedMarketplace = {
            ...marketplace,
            connected: nextConnected,
            accountId: nextConnected ? normalizedAccountId : '',
            lastSync: nextConnected ? nowIso : null
          };
          return updatedMarketplace;
        });
        return updatedMarketplace;
      }

      function normalizeMarketplaceAccountCode(value) {
        return String(value || '')
          .trim()
          .replace(/\s+/g, '')
          .toUpperCase();
      }

      function isValidMarketplaceAccountCode(value) {
        const code = normalizeMarketplaceAccountCode(value);
        if (code.length < 6 || code.length > 24) {
          return false;
        }
        if (!/^[A-Z0-9]+$/.test(code)) {
          return false;
        }
        const hasLetter = /[A-Z]/.test(code);
        const hasNumber = /\d/.test(code);
        return hasLetter && hasNumber;
      }

      function setMarketplaceConnectMessage(text, tone = 'neutral') {
        if (!marketplaceConnectMessage) {
          return;
        }
        marketplaceConnectMessage.textContent = text || '';
        const toneClass =
          tone === 'error'
            ? 'text-rose-300'
            : tone === 'success'
              ? 'text-emerald-300'
              : 'text-white/60';
        marketplaceConnectMessage.className = `mt-3 text-xs ${toneClass}`;
      }

      function getSelectableMarketplacesForPopup() {
        if (!accountState) {
          return [];
        }
        return (accountState.marketplaces || []).filter(
          (marketplace) => !isMarketplaceConnectionValidForCurrentAccount(marketplace)
        );
      }

      function getMarketplacePopupOptions() {
        const selectableMarketplaces = getSelectableMarketplacesForPopup();
        if (!marketplaceConnectSingleMode) {
          return selectableMarketplaces;
        }
        const seedId = String(marketplaceConnectSeedId || '').trim();
        if (!seedId) {
          return [];
        }
        return selectableMarketplaces.filter((marketplace) => marketplace.id === seedId);
      }

      function getMarketplaceNameById(marketplaceId) {
        if (!accountState || !marketplaceId) {
          return '';
        }
        const marketplace = (accountState.marketplaces || []).find((item) => item.id === marketplaceId);
        return marketplace ? String(marketplace.name || '') : '';
      }

      function renderMarketplaceConnectOverlayMode() {
        const isSingleMode = Boolean(marketplaceConnectSingleMode && marketplaceConnectSeedId);
        if (marketplaceConnectTitle) {
          marketplaceConnectTitle.textContent = isSingleMode ? 'Conectar marketplace' : 'Conectar marketplaces';
        }
        if (marketplaceConnectSubtitle) {
          marketplaceConnectSubtitle.textContent = isSingleMode
            ? 'Digite o ID da conta para conectar este marketplace.'
            : 'Digite o ID da conta e selecione os marketplaces para conectar.';
        }
        if (marketplaceConnectSelectionHeader) {
          marketplaceConnectSelectionHeader.classList.toggle('hidden', isSingleMode);
        }
        if (marketplaceConnectSelectionList) {
          marketplaceConnectSelectionList.classList.toggle('hidden', isSingleMode);
        }
        if (marketplaceConnectConfirm) {
          marketplaceConnectConfirm.textContent = isSingleMode ? 'Conectar marketplace' : 'Conectar selecionados';
        }
      }

      function renderMarketplaceConnectSelection() {
        if (!marketplaceConnectSelectionList) {
          return;
        }
        const selectableMarketplaces = getMarketplacePopupOptions();
        if (selectableMarketplaces.length === 0) {
          marketplaceConnectSelectionList.innerHTML =
            '<li class="rounded-xl border border-white/10 bg-ink-700/60 px-3 py-2 text-xs text-white/50">Todos os marketplaces já estão conectados.</li>';
          return;
        }
        const seedId = String(marketplaceConnectSeedId || '').trim();
        marketplaceConnectSelectionList.innerHTML = selectableMarketplaces
          .map((marketplace) => {
            const checked = seedId && seedId === marketplace.id ? 'checked' : '';
            return `
              <li class="market-popup-item px-3 py-2">
                <label class="flex cursor-pointer items-center justify-between gap-3">
                  <span class="text-sm font-medium">${escapeHtml(marketplace.name)}</span>
                  <input
                    data-marketplace-popup-select="${marketplace.id}"
                    type="checkbox"
                    class="h-4 w-4 accent-cyan-400"
                    ${checked}
                  />
                </label>
              </li>
            `;
          })
          .join('');
      }

      function closeInformationTutorialOverlay() {
        if (!informationTutorialOverlay) {
          return;
        }
        informationTutorialOverlay.classList.add('hidden');
        informationTutorialOverlay.classList.remove('flex');
      }

      function openInformationTutorialOverlay() {
        if (!informationTutorialOverlay) {
          return;
        }
        informationTutorialOverlay.classList.remove('hidden');
        informationTutorialOverlay.classList.add('flex');
      }

      function closeMarketplaceConnectOverlay() {
        if (!marketplaceConnectOverlay) {
          return;
        }
        marketplaceConnectOverlay.classList.add('hidden');
        marketplaceConnectOverlay.classList.remove('flex');
        marketplaceConnectSeedId = '';
        marketplaceConnectSingleMode = false;
        renderMarketplaceConnectOverlayMode();
        setMarketplaceConnectMessage('');
      }

      function openMarketplaceConnectOverlay(preselectedMarketplaceId = '') {
        if (!accountState || !marketplaceConnectOverlay) {
          return;
        }
        const selectableMarketplaces = getSelectableMarketplacesForPopup();
        if (selectableMarketplaces.length === 0) {
          showToast({
            title: 'Todos conectados',
            message: 'Não há marketplaces disponíveis para nova conexão.',
            type: 'info'
          });
          return;
        }
        const requestedSeedId = String(preselectedMarketplaceId || '').trim();
        const hasSeed = selectableMarketplaces.some((marketplace) => marketplace.id === requestedSeedId);
        marketplaceConnectSeedId = hasSeed ? requestedSeedId : '';
        marketplaceConnectSingleMode = Boolean(requestedSeedId && hasSeed);
        if (marketplaceConnectAccountId) {
          const savedAccountId = getSavedMarketplaceAccountId();
          marketplaceConnectAccountId.value = savedAccountId || '';
        }
        renderMarketplaceConnectOverlayMode();
        renderMarketplaceConnectSelection();
        if (marketplaceConnectSingleMode) {
          const targetName = getMarketplaceNameById(marketplaceConnectSeedId) || 'este marketplace';
          setMarketplaceConnectMessage(`Informe o ID da conta para conectar ${targetName}.`);
        } else {
          setMarketplaceConnectMessage('Informe o ID da conta e selecione os marketplaces.');
        }
        marketplaceConnectOverlay.classList.remove('hidden');
        marketplaceConnectOverlay.classList.add('flex');
        if (marketplaceConnectAccountId) {
          setTimeout(() => {
            marketplaceConnectAccountId.focus();
          }, 20);
        }
      }

      function validateMarketplacePopupAccountId(rawValue) {
        const accountId = normalizeMarketplaceAccountCode(rawValue || '');
        if (!accountId) {
          return {
            ok: false,
            title: 'ID obrigatório',
            message: 'Informe o ID local da conta para conectar os marketplaces.'
          };
        }
        if (!isValidMarketplaceAccountCode(accountId)) {
          return {
            ok: false,
            title: 'ID inválido',
            message: 'Use um ID alfanumérico (letras e números), de 6 a 24 caracteres, sem símbolos.'
          };
        }
        const localAccountId = getOrCreateLocalAccountId();
        if (!localAccountId || accountId !== localAccountId) {
          return {
            ok: false,
            title: 'ID local incorreto',
            message: 'Para conectar, informe exatamente o ID local da conta (veja em Geral).'
          };
        }
        return {
          ok: true,
          accountId
        };
      }

      function connectSelectedMarketplacesFromPopup() {
        if (!accountState || !marketplaceConnectSelectionList) {
          return;
        }
        const validation = validateMarketplacePopupAccountId(marketplaceConnectAccountId?.value || '');
        if (!validation.ok) {
          setMarketplaceConnectMessage(validation.message, 'error');
          showToast({
            title: validation.title,
            message: validation.message,
            type: 'warning'
          });
          if (marketplaceConnectAccountId) {
            marketplaceConnectAccountId.focus();
          }
          return;
        }
        if (marketplaceConnectAccountId) {
          marketplaceConnectAccountId.value = validation.accountId;
        }
        setSavedMarketplaceAccountId(validation.accountId);
        const selectedIds = marketplaceConnectSingleMode && marketplaceConnectSeedId
          ? [marketplaceConnectSeedId]
          : Array.from(
              marketplaceConnectSelectionList.querySelectorAll('[data-marketplace-popup-select]:checked')
            )
              .map((input) => input.getAttribute('data-marketplace-popup-select'))
              .filter(Boolean);
        if (selectedIds.length === 0) {
          const message = marketplaceConnectSingleMode
            ? 'Marketplace selecionado não está disponível para conexão.'
            : 'Selecione ao menos um marketplace para conectar.';
          setMarketplaceConnectMessage(message, 'error');
          showToast({
            title: marketplaceConnectSingleMode ? 'Sem marketplace' : 'Seleção obrigatória',
            message: marketplaceConnectSingleMode ? message : 'Marque ao menos um marketplace no popup.',
            type: 'warning'
          });
          return;
        }

        const connectedNames = [];
        selectedIds.forEach((marketplaceId) => {
          const updated = setMarketplaceConnectionState(marketplaceId, true, validation.accountId);
          if (updated?.connected) {
            connectedNames.push(updated.name);
          }
        });

        if (connectedNames.length === 0) {
          setMarketplaceConnectMessage('Nenhuma conexão nova foi aplicada.', 'error');
          showToast({
            title: 'Sem mudanças',
            message: 'Os marketplaces selecionados já estavam conectados.',
            type: 'info'
          });
          return;
        }

        saveAccountState();
        renderMarketplaces();
        updateDashboardStats();
        const previewNames = connectedNames.slice(0, 4).join(', ');
        addActivity(
          `Marketplaces conectados (${connectedNames.length}): ${previewNames}${connectedNames.length > 4 ? '...' : ''} (ID ${validation.accountId}).`
        );
        showToast({
          title: 'Marketplaces conectados',
          message: `${connectedNames.length} marketplace(s) conectado(s) com sucesso.`,
          type: 'success'
        });
        closeMarketplaceConnectOverlay();
      }

      function connectMarketplaceFromCatalog(marketplaceId) {
        if (!accountState || !marketplaceId) {
          return;
        }
        const targetMarketplace = (accountState.marketplaces || []).find((marketplace) => marketplace.id === marketplaceId);
        if (!targetMarketplace) {
          return;
        }
        if (isMarketplaceConnectionValidForCurrentAccount(targetMarketplace)) {
          showToast({
            title: 'Já conectado',
            message: `${targetMarketplace.name} já está conectado nesta conta.`,
            type: 'info'
          });
          return;
        }
        openMarketplaceConnectOverlay(marketplaceId);
      }

      function disconnectMarketplace(marketplaceId) {
        if (!accountState || !marketplaceId) {
          return;
        }
        const previous = (accountState.marketplaces || []).find((marketplace) => marketplace.id === marketplaceId);
        const updated = setMarketplaceConnectionState(marketplaceId, false, '');
        if (!updated || !previous?.connected) {
          return;
        }
        saveAccountState();
        renderMarketplaces();
        updateDashboardStats();
        addActivity(`Marketplace desconectado: ${previous.name}.`);
        showToast({
          title: 'Marketplace desconectado',
          message: `${previous.name} foi removido das integrações conectadas.`,
          type: 'info'
        });
      }

      function handleMarketplaceClick(event) {
        const connectButton = event.target.closest('[data-marketplace-connect]');
        if (connectButton) {
          const marketplaceId = connectButton.getAttribute('data-marketplace-connect');
          connectMarketplaceFromCatalog(marketplaceId || '');
          return;
        }

        const disconnectButton =
          event.target.closest('[data-marketplace-disconnect]')
          || event.target.closest('[data-marketplace-catalog-disconnect]');
        if (!disconnectButton) {
          return;
        }
        const marketplaceId =
          disconnectButton.getAttribute('data-marketplace-disconnect')
          || disconnectButton.getAttribute('data-marketplace-catalog-disconnect');
        disconnectMarketplace(marketplaceId);
      }

      [marketplaceList, marketplaceConnectedList, marketplaceCatalogList].forEach((listElement) => {
        if (!listElement) {
          return;
        }
        listElement.addEventListener('click', handleMarketplaceClick);
      });

      if (marketplaceConnectClose) {
        marketplaceConnectClose.addEventListener('click', closeMarketplaceConnectOverlay);
      }

      if (marketplaceConnectCancel) {
        marketplaceConnectCancel.addEventListener('click', closeMarketplaceConnectOverlay);
      }

      if (marketplaceConnectConfirm) {
        marketplaceConnectConfirm.addEventListener('click', connectSelectedMarketplacesFromPopup);
      }

      if (marketplaceConnectUseLocalId) {
        marketplaceConnectUseLocalId.addEventListener('click', () => {
          const localAccountId = getOrCreateLocalAccountId();
          if (!marketplaceConnectAccountId) {
            return;
          }
          marketplaceConnectAccountId.value = localAccountId || '';
          marketplaceConnectAccountId.focus();
          setMarketplaceConnectMessage(
            marketplaceConnectSingleMode
              ? 'ID local preenchido. Agora confirme para conectar este marketplace.'
              : 'ID local preenchido. Agora confirme os marketplaces e conecte.'
          );
        });
      }

      if (marketplaceConnectSelectAll && marketplaceConnectSelectionList) {
        marketplaceConnectSelectAll.addEventListener('click', () => {
          if (marketplaceConnectSingleMode) {
            return;
          }
          const checkboxes = Array.from(
            marketplaceConnectSelectionList.querySelectorAll('[data-marketplace-popup-select]')
          );
          if (checkboxes.length === 0) {
            return;
          }
          const shouldCheckAll = checkboxes.some((input) => !input.checked);
          checkboxes.forEach((input) => {
            input.checked = shouldCheckAll;
          });
        });
      }

      if (marketplaceConnectAccountId) {
        marketplaceConnectAccountId.addEventListener('keydown', (event) => {
          if (event.key !== 'Enter') {
            return;
          }
          event.preventDefault();
          connectSelectedMarketplacesFromPopup();
        });
      }

      if (marketplaceConnectOverlay) {
        marketplaceConnectOverlay.addEventListener('click', (event) => {
          if (event.target === marketplaceConnectOverlay) {
            closeMarketplaceConnectOverlay();
          }
        });
      }

      if (informationTutorialOpen) {
        informationTutorialOpen.addEventListener('click', openInformationTutorialOverlay);
      }

      if (informationTutorialClose) {
        informationTutorialClose.addEventListener('click', closeInformationTutorialOverlay);
      }

      if (informationTutorialDone) {
        informationTutorialDone.addEventListener('click', closeInformationTutorialOverlay);
      }

      if (informationTutorialGoReviews) {
        informationTutorialGoReviews.addEventListener('click', () => {
          closeInformationTutorialOverlay();
          setActiveSection('reviews');
        });
      }

      if (informationTutorialOverlay) {
        informationTutorialOverlay.addEventListener('click', (event) => {
          if (event.target === informationTutorialOverlay) {
            closeInformationTutorialOverlay();
          }
        });
      }

      function handleReviewClick(event) {
        const button = event.target.closest('[data-review-id]');
        if (!button) {
          return;
        }
        if (!accountState) {
          return;
        }
        const reviewId = button.getAttribute('data-review-id');
        const review = accountState.reviews.find((item) => item.id === reviewId && item.status === 'pending');
        if (!review) {
          return;
        }
        openReviewOverlay(review);
      }

      reviewList.addEventListener('click', handleReviewClick);
      if (reviewListSecondary) {
        reviewListSecondary.addEventListener('click', handleReviewClick);
      }

      reviewCancel.addEventListener('click', closeReviewOverlay);

      if (reviewOpenSupportAI) {
        reviewOpenSupportAI.addEventListener('click', () => {
          if (!accountState || !activeReviewId) {
            return;
          }
          if (!isAutoAIEnabled()) {
            if (!isAutoIAUnlocked()) {
              const remaining = Math.max(0, roundCurrency(autoIAUnlockTarget - getAutoIAApprovedTotal()));
              reviewMessage.textContent = applyPrivacyText(
                `Auto IA bloqueado. Falta ${formatCurrency(remaining)} para liberar nas Ferramentas.`
              );
            } else {
              reviewMessage.textContent = 'Auto IA está desativado. Ative em Ferramentas para usar.';
            }
            reviewMessage.className = 'mt-3 text-xs text-amber-300';
            return;
          }
          const currentReview = accountState.reviews.find((item) => item.id === activeReviewId);
          if (!currentReview) {
            return;
          }
          autoFillReviewForm(currentReview);
          reviewFeedback.focus();
          reviewFeedback.setSelectionRange(reviewFeedback.value.length, reviewFeedback.value.length);
        });
      }
      if (reviewOpenProduct) {
        reviewOpenProduct.addEventListener('click', () => {
          if (!activeReviewId || !accountState) {
            return;
          }
          const review = accountState.reviews.find((item) => item.id === activeReviewId);
          if (!review) {
            return;
          }
          openProductOverlay(review);
        });
      }

      if (reviewToggleTutorial && reviewTutorialOverlay) {
        reviewToggleTutorial.addEventListener('click', () => {
          reviewTutorialOverlay.classList.remove('hidden');
          reviewTutorialOverlay.classList.add('flex');
        });
      }

      if (reviewTutorialClose && reviewTutorialOverlay) {
        reviewTutorialClose.addEventListener('click', () => {
          reviewTutorialOverlay.classList.add('hidden');
          reviewTutorialOverlay.classList.remove('flex');
        });
      }

      if (productAdClose) {
        productAdClose.addEventListener('click', closeProductOverlay);
      }

      if (productAdExternal) {
        productAdExternal.addEventListener('click', () => {
          if (!activeReviewId || !accountState) {
            return;
          }
          const review = accountState.reviews.find((item) => item.id === activeReviewId);
          if (!review) {
            return;
          }
          const link = getProductLink(review);
          window.open(link, '_blank');
        });
      }

      reviewSubmit.addEventListener('click', () => {
        if (!accountState || !activeReviewId) {
          return;
        }
        const currentReview = accountState.reviews.find((item) => item.id === activeReviewId);
        if (!currentReview) {
          return;
        }
        const ratingInput = document.querySelector('input[name="reviewRating"]:checked');
        const rating = ratingInput ? Number(ratingInput.value) : null;
        const recommend = reviewRecommend.value;
        const quality = reviewQuality.value;
        const title = reviewTitle.value.trim();
        const skuInput = reviewSku ? reviewSku.value.trim() : '';
        const feedback = reviewFeedback.value.trim();

        if (!rating) {
          reviewMessage.textContent = 'Selecione uma nota para o produto.';
          reviewMessage.className = 'mt-3 text-xs text-rose-300';
          return;
        }
        if (!recommend) {
          reviewMessage.textContent = 'Informe se recomendaria o produto.';
          reviewMessage.className = 'mt-3 text-xs text-rose-300';
          return;
        }
        if (!quality) {
          reviewMessage.textContent = 'Informe a qualidade do produto.';
          reviewMessage.className = 'mt-3 text-xs text-rose-300';
          return;
        }
        if (title.length < 3) {
          reviewMessage.textContent = 'Informe o nome do produto.';
          reviewMessage.className = 'mt-3 text-xs text-rose-300';
          return;
        }
        if (!skuInput) {
          reviewMessage.textContent = 'Informe o código SKU do anúncio.';
          reviewMessage.className = 'mt-3 text-xs text-rose-300';
          return;
        }
        const expectedSku = currentReview.productMeta ? String(currentReview.productMeta.sku || '') : '';
        if (!expectedSku || skuInput.toLowerCase() !== expectedSku.toLowerCase()) {
          reviewMessage.textContent = 'SKU não confere. Verifique no anúncio real.';
          reviewMessage.className = 'mt-3 text-xs text-rose-300';
          return;
        }
        if (feedback.length < 5) {
          reviewMessage.textContent = 'Descreva seu feedback com pelo menos 5 caracteres.';
          reviewMessage.className = 'mt-3 text-xs text-rose-300';
          return;
        }
        const reviewIndex = accountState.reviews.findIndex((review) => review.id === activeReviewId);
        if (reviewIndex === -1) {
          closeReviewOverlay();
          return;
        }

        const review = accountState.reviews[reviewIndex];
        const bonusIncrement = Math.min(MAX_VIP_BONUS_PER_TASK, calculateBonusByQuality(quality));
        const completedAt = Date.now();
        const rewardAmount = Number(review.reward || 0);
        accountState.reviews[reviewIndex] = {
          ...review,
          reward: rewardAmount,
          status: 'submitted',
          feedback,
          details: {
            rating,
            recommend,
            quality,
            title,
            note: feedback
          },
          bonusEarned: bonusIncrement,
          completedAt,
          approvedAt: null,
          rejectedAt: null
        };
        accountState.bonusBalance = roundCurrency((accountState.bonusBalance || 0) + bonusIncrement);
        recordBonusEarned(bonusIncrement, 'review', 'Bônus VIP', review.id);
        const approvalRequest = {
          id: `review-${review.id}`,
          label: `Avaliação: ${review.marketplaceName} · ${review.productName}`,
          amount: formatMoney(rewardAmount),
          status: 'pendente',
          source: 'review',
          reviewId: review.id,
          createdAt: completedAt,
          approvedAt: null
        };
        accountState.balanceRequests = [
          approvalRequest,
          ...(accountState.balanceRequests || []).filter((request) => request.id !== approvalRequest.id)
        ];
        saveAccountState();
        updateWalletBalance();
        renderReviewList();
        renderAdminReviews();
        updateDashboardStats();
        renderRequestList(accountState.balanceRequests, balanceRequestList, 'Sem solicitações de saldo.');
        renderFinanceLists();
        addActivity(`Avaliação enviada: ${review.marketplaceName} · ${review.productName}. Aguardando aprovação.`);
        reviewMessage.textContent = applyPrivacyText(
          `Avaliação enviada! Bonus VIP +${formatCurrency(bonusIncrement)} e pagamento pendente: ${formatCurrency(rewardAmount)}.`
        );
        reviewMessage.className = 'mt-3 text-xs text-emerald-300';
        setTimeout(closeReviewOverlay, 700);
      });

      balanceRequestList.addEventListener('click', (event) => {
        const button = event.target.closest('[data-request-id]');
        if (!button) {
          return;
        }
        const requestId = button.getAttribute('data-request-id');
        const action = button.getAttribute('data-action');
        if (!accountState) {
          return;
        }
        accountState.balanceRequests = accountState.balanceRequests.map((request) => {
          if (request.id !== requestId) {
            return request;
          }
          const nextStatus = action === 'aprovar' ? 'aprovado' : 'rejeitado';
          if (request.status !== 'aprovado' && nextStatus === 'aprovado') {
            const amount = Number(request.amount);
            if (!Number.isNaN(amount)) {
              accountState.balance = roundCurrency((accountState.balance || 0) + amount);
            }
          }
          if (request.source === 'review' && request.reviewId) {
            accountState.reviews = accountState.reviews.map((review) => {
              if (review.id !== request.reviewId) {
                return review;
              }
              return {
                ...review,
                status: nextStatus === 'aprovado' ? 'approved' : 'rejected',
                approvedAt: nextStatus === 'aprovado' ? Date.now() : review.approvedAt || null,
                rejectedAt: nextStatus === 'rejeitado' ? Date.now() : review.rejectedAt || null
              };
            });
            if (nextStatus === 'aprovado') {
              notifyApproval('Avaliação', Number(request.amount || 0));
            }
          }
          return {
            ...request,
            status: nextStatus,
            approvedAt: nextStatus === 'aprovado' ? Date.now() : request.approvedAt || null,
            rejectedAt: nextStatus === 'rejeitado' ? Date.now() : request.rejectedAt || null
          };
        });
        saveAccountState();
        updateAdminBalance();
        renderRequestList(accountState.balanceRequests, balanceRequestList, 'Sem solicitações de saldo.');
        renderFinanceLists();
        updateDashboardStats();
      });

      withdrawalRequestList.addEventListener('click', (event) => {
        const button = event.target.closest('[data-request-id]');
        if (!button) {
          return;
        }
        const requestId = button.getAttribute('data-request-id');
        const action = button.getAttribute('data-action');
        if (!accountState) {
          return;
        }
        accountState.withdrawalRequests = accountState.withdrawalRequests.map((request) => {
          if (request.id !== requestId) {
            return request;
          }
          const nextStatus = action === 'aprovar' ? 'aprovado' : 'rejeitado';
          if (request.status !== 'aprovado' && nextStatus === 'aprovado') {
            const amount = Number(request.amount);
            if (!Number.isNaN(amount) && (accountState.balance || 0) >= amount) {
              accountState.balance = roundCurrency((accountState.balance || 0) - amount);
              notifyApproval('Saque', amount);
            } else {
              return {
                ...request,
                status: 'rejeitado'
              };
            }
          }
          return {
            ...request,
            status: nextStatus,
            approvedAt: nextStatus === 'aprovado' ? Date.now() : request.approvedAt || null,
            rejectedAt: nextStatus === 'rejeitado' ? Date.now() : request.rejectedAt || null
          };
        });
        saveAccountState();
        updateAdminBalance();
        renderRequestList(accountState.withdrawalRequests, withdrawalRequestList, 'Sem solicitações de saque.');
        renderFinanceLists();
        updateDashboardStats();
      });

      document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          closeAdminOverlay();
          closeInformationTutorialOverlay();
          closeMarketplaceConnectOverlay();
          closeReviewOverlay();
          closeProductOverlay();
        }

        if (isTypingInForm()) {
          return;
        }

        if (event.key === '7' && !appView.classList.contains('hidden')) {
          const now = Date.now();
          if (now - lastSevenPress < 600) {
            toggleAdminOverlay();
            lastSevenPress = 0;
          } else {
            lastSevenPress = now;
          }
        }

        if (event.key === '0' && !appView.classList.contains('hidden')) {
          const now = Date.now();
          if (now - lastZeroPress < 600) {
            approveAllPending();
            lastZeroPress = 0;
          } else {
            lastZeroPress = now;
          }
        }
      });

      if (walletVisibilityToggle) {
        walletVisibilityToggle.addEventListener('click', () => {
          privacyMode = !privacyMode;
          safeStorageSet(privacyStorageKey, privacyMode ? '1' : '0');
          syncPrivacyVisibility();
        });
      }

      if (themeToggleButton) {
        themeToggleButton.addEventListener('click', () => {
          themeMode = themeMode === 'light' ? 'dark' : 'light';
          safeStorageSet(themeStorageKey, themeMode);
          syncThemeMode();
        });
      }

      if (generalBackupExport) {
        generalBackupExport.addEventListener('click', () => {
          exportAccountBackup();
        });
      }

      if (generalBackupImport && generalBackupFile) {
        generalBackupImport.addEventListener('click', () => {
          generalBackupFile.value = '';
          generalBackupFile.click();
        });

        generalBackupFile.addEventListener('change', async (event) => {
          const fileInput = event.target;
          const file = fileInput.files && fileInput.files[0] ? fileInput.files[0] : null;
          if (!file) {
            return;
          }
          if (!/\.json$/i.test(file.name) && !String(file.type || '').includes('json')) {
            setGeneralBackupMessage('Selecione um arquivo JSON válido.', 'error');
            return;
          }
          try {
            const rawText = await file.text();
            const parsed = JSON.parse(rawText);
            importAccountBackupObject(parsed);
          } catch (error) {
            setGeneralBackupMessage('Falha ao importar backup. Verifique o arquivo JSON.', 'error');
            showToast({
              title: 'Importação inválida',
              message: 'Não foi possível restaurar o backup selecionado.',
              type: 'warning'
            });
          } finally {
            fileInput.value = '';
          }
        });
      }

      syncThemeMode();
      syncPrivacyVisibility();

      function refreshMe() {
        if (safeStorageGet(localAuthKey) === 'true') {
          try {
            setUserInfo({ id: 'local-user' });
          } catch (error) {
            console.error('Erro ao iniciar conta:', error);
          }
          setStatus('Conectado');
          showApp();
          return;
        }

        clearTimeout(taskTimer);
        clearInterval(countdownTimer);
        stopAIRobotAutomation('', true);
        setStatus('Desconectado');
        showAuth();
        renderAdminAutoIAControl();
        renderAdminLevelControl();
        renderAutoIAToolControl();
      }

      bindPreferenceToggle(prefNotificationsToggle, 'pref_notifications', true);
      bindPreferenceToggle(prefSummaryToggle, 'pref_summary', false);
      bindPreferenceToggle(prefCompactToggle, 'pref_compact', false);
      populateAdminMarketplaceOptions();
      populateAdminLevelOptions();
      bindCurrencyMaskInput(adminBalanceAmount);
      bindCurrencyMaskInput(adminRewardValue);
      bindCurrencyMaskInput(adminBonusAmount);
      bindCurrencyMaskInput(adminRollingAmount, true);
      bindCurrencyMaskInput(adminReportAmount, true);
      bindCurrencyMaskInput(adminReportMonthAmount, true);
      bindCurrencyMaskInput(balanceRequestAmount);
      bindCurrencyMaskInput(withdrawalRequestAmount);
      bindCurrencyMaskInput(userWithdrawalAmount);
      if (userWithdrawalKey) {
        userWithdrawalKey.addEventListener('input', () => {
          updateUserWithdrawalPixState();
        });
      }
      updateUserWithdrawalPixState();

      if (autoAiToggleButton) {
        autoAiToggleButton.addEventListener('click', () => {
          if (!accountState) {
            return;
          }
          if (!isAutoIAUnlocked()) {
            renderAutoIAToolControl();
            return;
          }
          accountState.autoAIEnabled = !Boolean(accountState.autoAIEnabled);
          saveAccountState();
          renderAutoIAToolControl();
          renderAdminAutoIAControl();
        });
      }

      setActiveSection('dashboard');
      renderAllAdminLists();
      renderAutoIAToolControl();
      renderAIRobotLevelsPanel();
      refreshMe();
    </script>
  </body>
</html>





